<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Qu·∫£n l√Ω V·∫≠n h√†nh Khai th√°c gi√†n DGCP</title>
    
    <!-- 1. T·∫£i c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt t·ª´ CDN -->
    <!-- Tailwind CSS (Giao di·ªán) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Core) - S·ª≠ d·ª•ng b·∫£n Production -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- FIX: ƒê·∫£m b·∫£o bi·∫øn 'react' t·ªìn t·∫°i -->
    <script>
        window.react = window.React;
    </script>

    
	
	

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        
        /* ·∫®n m≈©i t√™n tƒÉng gi·∫£m (spinners) trong input number */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        
        /* Loading fallback */
        .loading-fallback {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-size: 1.2rem;
            color: #4b5563;
        }
        
        /* Hide scrollbar for chrome/safari/opera */
        .no-scrollbar::-webkit-scrollbar {
          display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
          -ms-overflow-style: none;  /* IE and Edge */
          scrollbar-width: none;  /* Firefox */
        }
        /* Custom scrollbar for small areas */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 2px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* PRINT STYLES - C·∫¨P NH·∫¨T M·ªöI ƒê·ªÇ KH·∫ÆC PH·ª§C L·ªñI C·∫ÆT TRANG */
        @media print {
            /* 1. ·∫®n m·ªçi th·ª© kh√¥ng c·∫ßn thi·∫øt */
            body * {
                visibility: hidden;
            }
            
            /* 2. Ch·ªâ hi·ªán modal b√°o c√°o */
            #report-modal, #report-modal * {
                visibility: visible;
            }

            /* 3. Reset Modal Wrapper: ƒê∆∞a v·ªÅ g√≥c tr√™n c√πng, b·ªè background m·ªù */
            #report-modal {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                display: block !important; /* Quan tr·ªçng: B·ªè flex ƒë·ªÉ tr√°nh l·ªói cƒÉn gi·ªØa khi in */
                z-index: 9999;
                inset: 0 !important;
            }

            /* 4. Reset Modal Container (Khung tr·∫Øng): B·ªè gi·ªõi h·∫°n chi·ªÅu cao, b·ªè shadow */
            #report-container {
                max-width: 100% !important;
                width: 100% !important;
                max-height: none !important; /* Quan tr·ªçng: Cho ph√©p d√†i v√¥ t·∫≠n */
                height: auto !important;
                overflow: visible !important; /* Quan tr·ªçng: Cho ph√©p n·ªôi dung tr√†n ra */
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                position: static !important;
                display: block !important; /* B·ªè flex col */
            }

            /* 5. Reset Modal Body (Ph·∫ßn n·ªôi dung): B·ªè thanh cu·ªôn */
            #report-body {
                overflow: visible !important; /* Quan tr·ªçng: Hi·ªÉn th·ªã h·∫øt n·ªôi dung */
                height: auto !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* 6. T√πy ch·ªânh Header khi in ƒë·ªÉ ti·∫øt ki·ªám m·ª±c (optional) */
            #report-header {
                background: white !important;
                color: black !important;
                border-bottom: 2px solid #000 !important;
            }
            #report-header h2, #report-header p {
                color: black !important;
            }

            /* 7. ·∫®n c√°c n√∫t b·∫•m khi in */
            .no-print, button {
                display: none !important;
            }

            /* 8. ƒê·∫£m b·∫£o m√†u n·ªÅn ƒë∆∞·ª£c in ra (cho c√°c b·∫£ng bi·ªÉu, highlight) */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* 9. Ng·∫Øt trang th√¥ng minh h∆°n */
            section, table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root">
        <div class="loading-fallback">ƒêang t·∫£i ·ª©ng d·ª•ng...</div>
    </div>

    <!-- 2. M√£ ngu·ªìn ·ª®ng d·ª•ng -->
    <script type="text/babel">
        // L·∫•y c√°c h√†m t·ª´ th∆∞ vi·ªán ƒë√£ t·∫£i
        const { useState, useEffect, useMemo, useRef } = React;

        // ƒê·ªíNG B·ªò Auto-Sync CLOUD
        const API_URL = "https://script.google.com/macros/s/AKfycbzgGsP72GuRQs736FSAbvQwkNmen1rhWDqfFlMfgXCpqPQwt8Q61tbOZgFxBxPNK0r--w/exec"; 
                    
        // ƒê·ªìng b·ªô Update DETAIL cho DGCP Svodka
        const SVODKA_API_URL = "https://script.google.com/macros/s/AKfycbwVcMcvedS-IuOJcdlpLsxb_QWFQRcb6l8vMJ5zCP4SbfpcCt0cWDtwf7TL32C_yIoc/exec";

        // 2. C·∫•u h√¨nh RP3 (L·∫•y theo t·ªça ƒë·ªô c·ªë ƒë·ªãnh - Sheet 17h)
        const RP3_CONFIG = [
            // Booster RP3 => RP2 (D√≤ng 4, C·ªôt C)
            { label: "Booster RP3 => RP2", key: "booster_rp3_rp2", rowIndex: 3, colIndex: 2, unit: "m¬≥" },
            
            // –°–±–æ—Ä –≥–∞–∑ –°1 –Ω–∞ DGCP (D√≤ng 7, C·ªôt C)
            { label: "Gas –°1 to DGCP", key: "c1_gas_dgcp", rowIndex: 6, colIndex: 2, unit: "m¬≥" },
                                   
            // –ì–∞–∑ C-1 –Ω–∞ —Ñ–∞–∫–µ–ª (D√≤ng 9, C·ªôt C)
            { label: "Gas C-1 to Flare", key: "gas_c1_flare", rowIndex: 8, colIndex: 2, unit: "m¬≥" },
            
            // –ì–∞–∑ HP RP-3 –∏ DGCP –Ω–∞ —Ñ–∞–∫–µ–ª (D√≤ng 10, C·ªôt C)
            { label: "Gas HP Flare RP3", key: "gas_hp_flare", rowIndex: 9, colIndex: 2, unit: "m¬≥" },
                                   
            // T·ªïng gas RP3 to Flare (D√≤ng 14, C·ªôt C)
            { label: "T·ªïng gas RP3 to Flare", key: "total_gas_rp3_flare", rowIndex: 13, colIndex: 2, unit: "m¬≥" },
			
			// –ì–∞–∑ DGCP –Ω–∞ Taurus (D√≤ng 12, C·ªôt C)
            { label: "Gas DGCP to Taurus", key: "gas_dgcp_taurus", rowIndex: 11, colIndex: 2, unit: "m¬≥" },
            
            // –ì–∞–∑ DGCP –Ω–∞ Saturn (D√≤ng 13, C·ªôt C)
            { label: "Gas DGCP to Saturn", key: "gas_dgcp_saturn", rowIndex: 12, colIndex: 2, unit: "m¬≥" },
            
			// –ì–∞–∑ DGCP –Ω–∞ Typhoon (D√≤ng 8, C·ªôt C)
            { label: "Gas DGCP to Typhoon", key: "gas_dgcp_typhoon", rowIndex: 7, colIndex: 2, unit: "m¬≥" }
			            
        ];

        // --- C·∫§U H√åNH RP2 (C·∫≠p nh·∫≠t th√™m ƒê∆°n v·ªã) ---
        const RP2_CONFIG = [
            { label: "L∆∞u l∆∞·ª£ng (B4)", key: "gas_prod", colIndex: 1, unit: "m¬≥" }, 
            { label: "ƒêu·ªëc RP-2 (C4)", key: "flare", colIndex: 2, unit: "m¬≥" },    
            { label: "√Åp su·∫•t C-1 (D4)", key: "pressure", colIndex: 3, unit: "Bar" } 
        ];

        // 4. C·∫•u h√¨nh RP1 (L·∫•y C·ªôt D & E, d√≤ng 5-10 sheet 17h)
        const RP1_CONFIG = [
            // --- C·ªòT D: L∆ØU L∆Ø·ª¢NG (m¬≥) ---
            { label: "Gas RP-1/RC-6", key: "gas_rp1_rc6", rowIndex: 4, colIndex: 3, unit: "m¬≥" },
            { label: "RP-1 Flare", key: "rp1_flare", rowIndex: 5, colIndex: 3, unit: "m¬≥" },
            { label: "Gas RCDM", key: "gas_rcdm", rowIndex: 6, colIndex: 3, unit: "m¬≥" },
            { label: "Gas RC4", key: "gas_rc4", rowIndex: 7, colIndex: 3, unit: "m¬≥" },
            { label: "Gas RC5/9", key: "gas_rc5_9", rowIndex: 8, colIndex: 3, unit: "m¬≥" },
            { label: "Gas RC-8", key: "gas_rc8", rowIndex: 9, colIndex: 3, unit: "m¬≥" },
            
            // --- C·ªòT E: √ÅP SU·∫§T (Barg) ---
            { label: "P. Gas RP-1/RC-6", key: "press_rp1_rc6", rowIndex: 4, colIndex: 4, unit: "Barg" },
            { label: "P. Flare", key: "press_rp1_flare", rowIndex: 5, colIndex: 4, unit: "Barg" },
            { label: "P. RCDM", key: "press_rcdm", rowIndex: 6, colIndex: 4, unit: "Barg" },
            { label: "P. RC4", key: "press_rc4", rowIndex: 7, colIndex: 4, unit: "Barg" },
            { label: "P. RC5/9", key: "press_rc5_9", rowIndex: 8, colIndex: 4, unit: "Barg" },
            { label: "P. RC-8", key: "press_rc8", rowIndex: 9, colIndex: 4, unit: "Barg" }
        ];

		// 5. C·∫•u h√¨nh RC1/3 (L·∫•y B4, B5, C4, C5 sheet 17h)
        const RC13_CONFIG = [
            // --- C·ªòT B: L∆ØU L∆Ø·ª¢NG (m¬≥) ---
            { label: "Gaslift BK8", key: "gaslift_bk8", rowIndex: 3, colIndex: 1, unit: "m¬≥" }, // D√≤ng 4, C·ªôt B
            { label: "Gi·∫øng kh√≠ & Cond", key: "wells_cond", rowIndex: 4, colIndex: 1, unit: "m¬≥" }, // D√≤ng 5, C·ªôt B
            
            // --- C·ªòT C: √ÅP SU·∫§T (at) ---
            { label: "P. Gaslift BK8", key: "press_bk8", rowIndex: 3, colIndex: 2, unit: "at" }, // D√≤ng 4, C·ªôt C
            { label: "P. Gi·∫øng kh√≠& Cond", key: "press_wells", rowIndex: 4, colIndex: 2, unit: "at" }  // D√≤ng 5, C·ªôt C
        ];

		// 6. C·∫•u h√¨nh Th√¥ng s·ªë ƒêi·ªán (Sheet Daily: E7-E10)
        const ELEC_CONFIG = [
            { label: "T·ªïng ng√†y", key: "total_day", rowIndex: 6, colIndex: 4, unit: "kWh" }, // D√≤ng 7, C·ªôt E
            { label: "GNR", key: "kpd", rowIndex: 7, colIndex: 4, unit: "kWh" },         // D√≤ng 8, C·ªôt E
            { label: "Booster", key: "booster", rowIndex: 8, colIndex: 4, unit: "kWh" },     // D√≤ng 9, C·ªôt E
            { label: "RP3 ", key: "rp3", rowIndex: 9, colIndex: 4, unit: "kWh" },             // D√≤ng 10, C·ªôt E
			{ label: "Th·ªùi gian ch·∫°y", key: "run_hours", unit: "Gi·ªù", defaultValue: "24" } 
        
        ];

		// 7. C·∫•u h√¨nh Performance GTC (Sheet 17h: B3:I4)
        const GTC_CONFIG = [
            // --- GTC-A (D√≤ng 3 - Index 2) ---
            { label: "GTC-A: Act. Power", key: "gtca_power", rowIndex: 2, colIndex: 1, unit: "kW" },
            { label: "GTC-A: Isen. Head", key: "gtca_head", rowIndex: 2, colIndex: 2, unit: "kJ/kg" },
            { label: "GTC-A: Flow DP", key: "gtca_dp", rowIndex: 2, colIndex: 3, unit: "kPa" },
            { label: "GTC-A: Speed", key: "gtca_speed", rowIndex: 2, colIndex: 4, unit: "Rpm" },
            { label: "GTC-A: Surge Margin", key: "gtca_surge", rowIndex: 2, colIndex: 5, unit: "%" },
            { label: "GTC-A: Fuel Flow", key: "gtca_fuel", rowIndex: 2, colIndex: 6, unit: "kg/h" },
            { label: "GTC-A: Flow Rate", key: "gtca_flow", rowIndex: 2, colIndex: 7, unit: "Sm¬≥/h" },
            { label: "GTC-A: Contam. Fac", key: "gtca_contam", rowIndex: 2, colIndex: 8, unit: "%" },

            // --- GTC-B (D√≤ng 4 - Index 3) ---
            { label: "GTC-B: Act. Power", key: "gtcb_power", rowIndex: 3, colIndex: 1, unit: "kW" },
            { label: "GTC-B: Isen. Head", key: "gtcb_head", rowIndex: 3, colIndex: 2, unit: "kJ/kg" },
            { label: "GTC-B: Flow DP", key: "gtcb_dp", rowIndex: 3, colIndex: 3, unit: "kPa" },
            { label: "GTC-B: Speed", key: "gtcb_speed", rowIndex: 3, colIndex: 4, unit: "Rpm" },
            { label: "GTC-B: Surge Margin", key: "gtcb_surge", rowIndex: 3, colIndex: 5, unit: "%" },
            { label: "GTC-B: Fuel Flow", key: "gtcb_fuel", rowIndex: 3, colIndex: 6, unit: "kg/h" },
            { label: "GTC-B: Flow Rate", key: "gtcb_flow", rowIndex: 3, colIndex: 7, unit: "Sm¬≥/h" },
            { label: "GTC-B: Contam. Fac", key: "gtcb_contam", rowIndex: 3, colIndex: 8, unit: "%" }
        ];

		// 8. C·∫•u h√¨nh DGCP GAS (ƒê√£ c·∫≠p nh·∫≠t t√™n d√≤ng Fuelgas)
        const DGCP_GAS_CONFIG = [
            { label: "Gaslift", key: "gaslift", unit: "m¬≥" },
            { label: "BCP (FT-305)", key: "bcp_ft305", unit: "m¬≥" },
            { label: "BCP (FT-801)", key: "bcp_ft801", unit: "m¬≥" },
            { label: "Fuelgas (QI-1501)", key: "fuel_gas", unit: "m¬≥" },
            { label: "Condensate", key: "condensate", unit: "m¬≥" },
            { label: "Lost gas", key: "lost_gas", unit: "m¬≥" }
        ];

		// üëá TH√äM C·∫§U H√åNH M·ªöI: H√ìA PH·∫®M
        const CHEMICALS_CONFIG = [
            { label: "Gaslift (L√≠t)", key: "gaslift_lit", defaultVal: "29", unit: "L√≠t" },
            { label: "AC-202A/B (L√≠t)", key: "ac202_lit", defaultVal: "0", unit: "L√≠t" },
            { label: "Oxy/Ace ƒê·∫ßy", key: "oxy_ace_full", defaultVal: "10/4", unit: "B√¨nh" }, // C·ªôt C: 10/4
            { label: "Oxy/Ace R·ªóng", key: "oxy_ace_empty", defaultVal: "2/8", unit: "B√¨nh" } // C·ªôt D: 2/8
        ];

        // --- Constants & Utilities ---

        const MONTHS = Array.from({ length: 12 }, (_, i) => i + 1);
        const CURRENT_YEAR = new Date().getFullYear();
        
        // C·∫≠p nh·∫≠t: H√†m l·∫•y key storage d·ª±a theo nƒÉm
        const getStorageKey = (year) => `gas_production_data_v3_${year}_maint_shutdown`;
        
        const SYSTEMS = {
            GASLIFT: 'Gaslift (GTC-A/B)',
            BCP: 'BCP-DGCP'
        };

        const EVENT_STATUS_OPTIONS = ['Ch∆∞a th·ª±c hi·ªán', 'ƒêang th·ª±c hi·ªán', 'ƒê√£ ho√†n th√†nh'];
        const EVENT_TYPE_OPTIONS = ['K·∫ø ho·∫°ch', 'S·ª± c·ªë', 'Kh√°c'];
        
        const SHUTDOWN_STATUS_OPTIONS = ['Ch∆∞a kh·∫Øc ph·ª•c', 'ƒê√£ kh·∫Øc ph·ª•c'];
        const AFFECTED_EQUIPMENT_OPTIONS = ['GTC-A', 'GTC-B', 'BCP-DGCP', 'GTG', 'DGCP'];
        
        const PERFORMING_UNITS = ['XNK', 'XNKT', 'DVK'];
        const RELATED_PLATFORMS = ['DGCP', 'RP1', 'RP2', 'RP3', 'RC1/3', 'RC4', 'RC5', 'RC6', 'RC7', 'RC8', 'RC9', 'RC10', 'RCDM', 'BT7/BK14', 'BK2', 'BK8', 'CCP', 'CTK3', 'CPP2', 'CTC'];
        const MAINTENANCE_EQUIPMENT = ['GTC-A', 'GTC-B', 'GTG', 'BCP-DGCP', 'BCP-RP3'];

        const getDaysInMonth = (month, year) => new Date(year, month, 0).getDate();

        const calculateDateDiff = (start, end) => {
            if (!start || !end) return 0;
            const startDate = new Date(start);
            const endDate = new Date(end);
            const diffTime = endDate - startDate;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            return diffDays >= 0 ? diffDays + 1 : 0; // +1 ƒë·ªÉ t√≠nh c·∫£ ng√†y b·∫Øt ƒë·∫ßu
        };

        // H√†m t√≠nh s·ªë gi·ªù (cho b√°o c√°o)
        const calculateHoursDiff = (start, end) => {
            if (!start) return 0;
            const startDate = new Date(start);
            // N·∫øu ch∆∞a k·∫øt th√∫c (end l√† null/undefined), t√≠nh ƒë·∫øn th·ªùi ƒëi·ªÉm hi·ªán t·∫°i
            const endDate = end ? new Date(end) : new Date(); 
            const diffMs = endDate - startDate;
            const hours = diffMs / (1000 * 60 * 60);
            return Math.max(0, hours); 
        };

        const formatDate = (dateStr) => {
            if (!dateStr) return "";
            if (dateStr.includes('T')) {
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                const d = date.getDate().toString().padStart(2, '0');
                const m = (date.getMonth() + 1).toString().padStart(2, '0');
                const y = date.getFullYear();
                const h = date.getHours().toString().padStart(2, '0');
                const min = date.getMinutes().toString().padStart(2, '0');
                return `${h}:${min} ${d}/${m}/${y}`;
            }
            const parts = dateStr.split('-');
            if (parts.length === 3) {
                const [y, m, d] = parts;
                return `${d}/${m}/${y}`;
            }
            return dateStr;
        };

        const ensureDateTimeFormat = (dateStr) => {
            if (!dateStr) return '';
            if (dateStr.length === 10 && !dateStr.includes('T')) return dateStr + 'T00:00';
            return dateStr;
        };

        const formatVolume = (val) => {
            if (val === undefined || val === null || isNaN(val)) return '-';
            return val.toLocaleString('vi-VN', { maximumFractionDigits: 0 });
        };

        const generateInitialData = (system, year) => {
            const data = {};
            MONTHS.forEach(m => {
                const daysInMonth = getDaysInMonth(m, year);
                data[m] = {
                    plan: {
                        target: system === 'GASLIFT' ? 30000 : 15000,
                        workingDays: daysInMonth,
                        maintenancePlans: [], 
                    },
                    actuals: {},
                    actualsNotes: {}, 
                    events: []
                };
            });
            return data;
        };
        
        const generateSharedData = () => {
            const data = {};
            MONTHS.forEach(m => {
                data[m] = {
                    events: [],
                    maintenancePlans: [], 
                    shutdownIncidents: [] 
                };
            });
            return data;
        };

        // H√†m helper ƒë·ªÉ load data cho 1 nƒÉm c·ª• th·ªÉ
        const initDbForYear = (targetYear) => {
            try {
                const key = getStorageKey(targetYear);
                const savedData = localStorage.getItem(key);
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    // --- TH√äM D√íNG N√ÄY: Kh·ªüi t·∫°o tem th·ªùi gian n·∫øu ch∆∞a c√≥ ---
                    if (!parsed.lastUpdated) parsed.lastUpdated = new Date().toISOString();
                    if (!parsed.SHARED) parsed.SHARED = generateSharedData();
                    MONTHS.forEach(m => {
                        if (!parsed.SHARED[m]) parsed.SHARED[m] = { events: [], maintenancePlans: [], shutdownIncidents: [] };
                        if (!parsed.SHARED[m].maintenancePlans) parsed.SHARED[m].maintenancePlans = [];
                        if (!parsed.SHARED[m].events) parsed.SHARED[m].events = [];
                        if (!parsed.SHARED[m].shutdownIncidents) parsed.SHARED[m].shutdownIncidents = [];
                    });
                    return parsed;
                }
            } catch (error) {
                console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error);
            }
            return {
                GASLIFT: generateInitialData('GASLIFT', targetYear),
                BCP: generateInitialData('BCP', targetYear),
                SHARED: generateSharedData()
            };
        };

        // --- Components ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-lg shadow-sm border border-gray-200 ${className}`}>
                {children}
            </div>
        );
		const CollapsibleHeader = ({ title, isCollapsed, onToggle, iconColor = "text-blue-600" }) => (
					<div 
						className="bg-slate-50 p-3 border-b flex justify-between items-center cursor-pointer hover:bg-slate-100 transition-colors"
						onClick={onToggle}
					>
						<h3 className={`font-bold ${iconColor} text-sm flex items-center gap-2 uppercase`}>
							{title}
						</h3>
						<div className="flex items-center gap-2">
							<span className="text-[10px] text-gray-400 font-bold uppercase">
								{isCollapsed ? 'M·ªü r·ªông' : 'Thu g·ªçn'}
							</span>
							<button 
								className="text-gray-400 transition-transform duration-300" 
								style={{ transform: isCollapsed ? 'rotate(-90deg)' : 'rotate(0deg)' }}
							>
								<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
									<path d="m6 9 6 6 6-6"/>
								</svg>
							</button>
						</div>
					</div>
		);
        const SectionTitle = ({ icon: Icon, title, rightElement }) => (
            <div className="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
                <h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2">
                    {title}
                </h3>
                {rightElement && <div>{rightElement}</div>}
            </div>
        );

        // --- Main App Component ---	
        const SimpleChart = ({ data, planGas, planBCP, month }) => {
            // State ƒë·ªÉ l∆∞u th√¥ng tin ƒëi·ªÉm ƒëang ƒë∆∞·ª£c di chu·ªôt v√†o
            const [hoveredPoint, setHoveredPoint] = React.useState(null);

            // 1. L·ªçc d·ªØ li·ªáu
            const validData = data.filter(d => (d.gasVal !== undefined && d.gasVal !== null) || (d.bcpVal !== undefined && d.bcpVal !== null));
            if (validData.length < 2) return null;

            // 2. C·∫•u h√¨nh k√≠ch th∆∞·ªõc
            const height = 350; 
            const width = 1000; 
            const margin = { top: 40, right: 30, bottom: 50, left: 60 };
            const graphWidth = width - margin.left - margin.right;
            const graphHeight = height - margin.top - margin.bottom;

            // 3. Logic Tr·ª•c Tung
            const maxDataVal = Math.max(...validData.map(d => Math.max(d.gasVal || 0, d.bcpVal || 0)));
            const maxVal = Math.max(
                maxDataVal,
                (planGas / 30) * 1.2, 
                (planBCP / 30) * 1.2
            );

            const formatYLabel = (val) => {
                if (val >= 1000) return (val / 1000).toFixed(1).replace('.0','') + "k";
                return val.toFixed(0);
            };

            // H√†m format s·ªë hi·ªÉn th·ªã trong tooltip (ƒë·∫ßy ƒë·ªß)
            const formatTooltipVal = (val) => {
                return val ? val.toLocaleString('vi-VN') : '0';
            };

            // 4. H√†m chuy·ªÉn ƒë·ªïi
            const getX = (index) => margin.left + (index * graphWidth / (validData.length - 1));
            const getY = (val) => margin.top + graphHeight - ((val / maxVal) * graphHeight);

            // 5. T·∫°o ƒë∆∞·ªùng
            const createPathInfo = (key) => {
                let linePath = "";
                let areaPath = "";
                validData.forEach((d, i) => {
                    const x = getX(i);
                    const y = getY(d[key] || 0);
                    const command = i === 0 ? 'M' : 'L';
                    linePath += `${command} ${x} ${y} `;
                });
                const firstX = getX(0);
                const lastX = getX(validData.length - 1);
                const yBottom = margin.top + graphHeight;
                areaPath = `${linePath} L ${lastX} ${yBottom} L ${firstX} ${yBottom} Z`;
                return { linePath, areaPath };
            };

            const gasPaths = createPathInfo('gasVal');
            const bcpPaths = createPathInfo('bcpVal');

            return (
                /* S·ª¨A 1: B·ªè border-t-4, b·ªè mt-6, ƒë·ªïi p-5 th√†nh p-2 ƒë·ªÉ gi·∫£m kho·∫£ng c√°ch */
                <div className="bg-white p-2"> 
                    
                    {/* Header: CƒÉn gi·ªØa, gi·∫£m margin bottom (mb-1) */}
                    <div className="flex justify-center items-center mb-1 mt-2">
                        <div className="flex gap-6 bg-gray-50 px-4 py-1.5 rounded-full border border-gray-200">
                            <div className="flex items-center gap-2">
                                <span className="w-3 h-3 rounded-full bg-blue-600"></span>
                                <span className="text-xs font-bold text-gray-700">Gaslift</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="w-3 h-3 rounded-full bg-orange-500"></span>
                                <span className="text-xs font-bold text-gray-700">BCP</span>
                            </div>
                        </div>
                    </div>
                    
                    <div className="w-full overflow-x-auto custom-scrollbar pb-2">
                        <div className="min-w-[800px]">
                            {/* SVG Chart gi·ªØ nguy√™n */}
                            <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-auto bg-white rounded" onMouseLeave={() => setHoveredPoint(null)}>
                                <defs>
                                    <linearGradient id="gradGasV6" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stopColor="#2563eb" stopOpacity="0.2" />
                                        <stop offset="100%" stopColor="#2563eb" stopOpacity="0" />
                                    </linearGradient>
                                    <linearGradient id="gradBCPV6" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stopColor="#f97316" stopOpacity="0.2" />
                                        <stop offset="100%" stopColor="#f97316" stopOpacity="0" />
                                    </linearGradient>
                                    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                        <feDropShadow dx="0" dy="2" stdDeviation="2" floodColor="#000000" floodOpacity="0.2"/>
                                    </filter>
                                </defs>

                                {/* TR·ª§C TUNG */}
                                {[0, 0.25, 0.5, 0.75, 1].map((ratio, i) => {
                                    const y = margin.top + graphHeight - (ratio * graphHeight);
                                    const val = maxVal * ratio;
                                    return (
                                        <g key={i}>
                                            <line x1={margin.left} y1={y} x2={width - margin.right} y2={y} stroke="#f3f4f6" strokeWidth="1" />
                                            <text x={margin.left - 10} y={y + 4} fontSize="11" textAnchor="end" fill="#9ca3af" fontWeight="500">
                                                {formatYLabel(val)}
                                            </text>
                                        </g>
                                    );
                                })}
                                <text x={margin.left - 5} y={margin.top - 10} fontSize="12" textAnchor="end" fill="#4b5563" fontWeight="bold" fontStyle="italic">(m¬≥)</text>

                                {/* V·∫º BI·ªÇU ƒê·ªí */}
                                <path d={gasPaths.areaPath} fill="url(#gradGasV6)" />
                                <path d={gasPaths.linePath} fill="none" stroke="#2563eb" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" />

                                <path d={bcpPaths.areaPath} fill="url(#gradBCPV6)" />
                                <path d={bcpPaths.linePath} fill="none" stroke="#f97316" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" />

                                {/* TR·ª§C HO√ÄNH */}
                                <line x1={margin.left} y1={margin.top + graphHeight} x2={width - margin.right} y2={margin.top + graphHeight} stroke="#e5e7eb" strokeWidth="1" />
                                
                                {validData.map((d, i) => {
                                    const cx = getX(i);
                                    const cyGas = getY(d.gasVal || 0);
                                    const cyBCP = getY(d.bcpVal || 0);
                                    
                                    return (
                                        <g key={d.day}>
                                            <line x1={cx} y1={margin.top} x2={cx} y2={margin.top + graphHeight} stroke={hoveredPoint && hoveredPoint.day === d.day ? "#93c5fd" : "#f9fafb"} strokeWidth={hoveredPoint && hoveredPoint.day === d.day ? "2" : "1"} />
                                            <line x1={cx} y1={margin.top + graphHeight} x2={cx} y2={margin.top + graphHeight + 5} stroke="#9ca3af" strokeWidth="1"/>
                                            <text x={cx} y={height - 15} fontSize="10" textAnchor="middle" fill="#6b7280" fontWeight="bold">{d.day}</text>

                                            {/* ƒêi·ªÉm t∆∞∆°ng t√°c Gaslift */}
                                            <circle 
                                                cx={cx} cy={cyGas} 
                                                r={hoveredPoint && hoveredPoint.day === d.day && hoveredPoint.type === 'Gaslift' ? 6 : 4} 
                                                fill="white" stroke="#2563eb" strokeWidth="2"
                                                onMouseEnter={() => setHoveredPoint({ x: cx, y: cyGas, day: d.day, val: d.gasVal, type: 'Gaslift', color: '#2563eb' })}
                                            />

                                            {/* ƒêi·ªÉm t∆∞∆°ng t√°c BCP */}
                                            <circle 
                                                cx={cx} cy={cyBCP} 
                                                r={hoveredPoint && hoveredPoint.day === d.day && hoveredPoint.type === 'BCP' ? 6 : 4} 
                                                fill="white" stroke="#f97316" strokeWidth="2"
                                                onMouseEnter={() => setHoveredPoint({ x: cx, y: cyBCP, day: d.day, val: d.bcpVal, type: 'BCP', color: '#f97316' })}
                                            />
                                        </g>
                                    );
                                })}
                                
                                <text x={width / 2} y={height - 2} fontSize="12" fill="#4b5563" fontWeight="bold" textAnchor="middle">
                                    Ng√†y trong th√°ng {month}
                                </text>

                                {/* PH·∫¶N TOOLTIP N·ªîI */}
                                {hoveredPoint && (
                                    <g transform={`translate(${hoveredPoint.x}, ${hoveredPoint.y})`} style={{ pointerEvents: 'none' }}>
                                        <rect x="-60" y="-65" width="120" height="50" rx="8" ry="8" fill="white" stroke={hoveredPoint.color} strokeWidth="2" filter="url(#shadow)" />
                                        <path d="M -6 -15 L 0 -8 L 6 -15 Z" fill={hoveredPoint.color} />
                                        <text x="0" y="-45" textAnchor="middle" fontSize="11" fill="#6b7280" fontWeight="bold">Ng√†y {hoveredPoint.day}/{month}</text>
                                        <text x="0" y="-28" textAnchor="middle" fontSize="13" fill={hoveredPoint.color} fontWeight="900">{formatTooltipVal(hoveredPoint.val)} m¬≥</text>
                                    </g>
                                )}
                            </svg>
                        </div>
                    </div>
                </div>
            );
        };
        function GasProductionManager() {
			// --- 1. H√ÄM T·∫¢I TH∆Ø VI·ªÜN ƒê·ªòNG (LAZY LOAD) ---
            const loadXLSX = () => {
                return new Promise((resolve, reject) => {
                    if (window.XLSX) return resolve(window.XLSX); // ƒê√£ c√≥ th√¨ tr·∫£ v·ªÅ ngay
                    
                    // T·∫°o th·∫ª script ·∫£o
                    const script = document.createElement('script');
                    script.src = "https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js";
                    script.onload = () => resolve(window.XLSX);
                    script.onerror = () => reject(new Error("L·ªói t·∫£i script XLSX"));
                    document.body.appendChild(script);
                });
            };

            // --- 2. H√ÄM B·ªåC (WRAPPER) T·ª∞ ƒê·ªòNG X·ª¨ L√ù ---
            // C√°ch d√πng: onChange={withXLSX(handleImport...)}
            const withXLSX = (originalHandler) => {
                return async (e) => {
                    // Quan tr·ªçng: Gi·ªØ l·∫°i s·ª± ki·ªán (ƒë·ªÉ kh√¥ng b·ªã m·∫•t khi await)
                    if (e && e.persist) e.persist();

                    // N·∫øu ch∆∞a c√≥ th∆∞ vi·ªán th√¨ t·∫£i
                    if (!window.XLSX) {
                        const btn = e.target; // L∆∞u l·∫°i n√∫t ƒëang b·∫•m
                        const originalText = btn.innerText || "";
                        
                        // Hi·ªáu ·ª©ng UX: ƒê·ªïi tr·ªè chu·ªôt th√†nh loading
                        document.body.style.cursor = 'wait';
                        
                        try {
                            console.log("‚è≥ ƒêang t·∫£i th∆∞ vi·ªán Excel...");
                            await loadXLSX();
                        } catch (err) {
                            alert("‚ùå Kh√¥ng th·ªÉ t·∫£i th∆∞ vi·ªán Excel. Ki·ªÉm tra m·∫°ng!");
                            document.body.style.cursor = 'default';
                            return; // D·ª´ng l·∫°i, kh√¥ng ch·∫°y h√†m ch√≠nh
                        } finally {
                             document.body.style.cursor = 'default';
                        }
                    }

                    // Khi ƒë√£ c√≥ th∆∞ vi·ªán (ho·∫∑c t·∫£i xong), ch·∫°y h√†m g·ªëc
                    return originalHandler(e);
                };
            };
            // --- S·ª¨ D·ª§NG React.useState ƒê·ªÇ TR√ÅNH L·ªñI M√ÄN H√åNH TR·∫ÆNG ---
            const [selectedMonth, setSelectedMonth] = React.useState(new Date().getMonth() + 1);
            const [year, setYear] = React.useState(CURRENT_YEAR);
            const [showCombinedReport, setShowCombinedReport] = React.useState(false); 
            
            const [importMode, setImportMode] = React.useState(null); 
            const [importText, setImportText] = React.useState("");

            const [isPulling, setIsPulling] = React.useState(false);
            const [isPushing, setIsPushing] = React.useState(false);
			
			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho BCP-RP3 stop
            const [bcpStopData, setBcpStopData] = React.useState({});
			
			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho Fuelgas DGCP
			const [fuelGasData, setFuelGasData] = React.useState({ density: 0.908 });

			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho RP3
            const [rp3Data, setRp3Data] = React.useState({}); 
			
            // üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho RP2
            const [rp2Data, setRp2Data] = React.useState({}); 

            // üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho RP1
            const [rp1Data, setRp1Data] = React.useState({});
			
			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho RC1/3
			const [rc13Data, setRc13Data] = React.useState({});

			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho ƒêi·ªán
            const [elecData, setElecData] = React.useState({});
			
			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho GTC-A/B
            const [gtcData, setGtcData] = React.useState({});
			
			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho DGCP Gas
			const [dgcpGasData, setDgcpGasData] = React.useState({});

			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho Th√¥ng s·ªë CN
			const [techData, setTechData] = React.useState({});
			
			// üëá TH√äM Bi·∫øn d·ªØ li·ªáu (State) cho H√≥a ph·∫©m
            const [chemicalsData, setChemicalsData] = React.useState({});
			
			// üëá TH√äM D√íNG N√ÄY: State cho th√¥ng s·ªë BCP
            const [bcpTechData, setBcpTechData] = React.useState({});
			
			// üëá TH√äM D√íNG N√ÄY: State cho K·∫ø ho·∫°ch ng√†y mai
            const [nextDayPlan, setNextDayPlan] = React.useState({});

			// üëá TH√äM D√íNG N√ÄY: State cho Th√¥ng tin trong ng√†y
            const [dailyInfo, setDailyInfo] = React.useState({});
			
			// üëá TH√äM D√íNG N√ÄY: State cho ƒê·∫∑t t√†u
			const [shipBooking, setShipBooking] = React.useState({});
			
			// üëá TH√äM D√íNG N√ÄY: State cho B·∫£ng Nh√¢n s·ª± (M·∫£ng danh s√°ch)
            const [personnelData, setPersonnelData] = React.useState([
                { id: 1, company: "PGO", count: "23", job: "PGO" } // D√≤ng m·∫´u m·∫∑c ƒë·ªãnh
            ]);

			// üëá TH√äM D√íNG N√ÄY: State cho Ng∆∞·ªùi qu·∫£n l√Ω
            const [managerData, setManagerData] = React.useState({ name: "" });
			
			// üëá TH√äM D√íNG N√ÄY: State cho An to√†n (HSE)
            const [safetyData, setSafetyData] = React.useState({});

            const [isFormAutoSave, setIsFormAutoSave] = React.useState(true);
            
			// --- STATE CHO T√çNH NƒÇNG CHUY·ªÇN TH√ÅNG TH·ª¶ C√îNG ---
            const [showTransferModal, setShowTransferModal] = useState(false);
            const [pendingItems, setPendingItems] = useState([]); // Danh s√°ch c√°c m·ª•c t√¨m ƒë∆∞·ª£c
            const [selectedTransferIds, setSelectedTransferIds] = useState(new Set()); // C√°c m·ª•c ƒë∆∞·ª£c t√≠ch ch·ªçn

			// --- STATE QU·∫¢N L√ù COLLAPSE CHO DASHBOARD ---
            const [collapseStates, setCollapseStates] = React.useState({
                chart: false,      // Bi·ªÉu ƒë·ªì
                table: false,      // B·∫£ng s·ªë li·ªáu
                equipment: false   // V·∫≠n h√†nh thi·∫øt b·ªã
            });

            // H√†m toggle tr·∫°ng th√°i
            const toggleCollapse = (key) => {
                setCollapseStates(prev => ({ ...prev, [key]: !prev[key] }));
            };

			// --- STATE CHO B·∫¢NG B√ÅO C√ÅO B·∫¢O D∆Ø·ª†NG NƒÇM ---
            const [showAnnualMaintModal, setShowAnnualMaintModal] = useState(false);
			const [yearFilterEq, setYearFilterEq] = useState('ALL');   // L·ªçc Thi·∫øt b·ªã
            const [yearFilterSt, setYearFilterSt] = useState('ALL');   // L·ªçc Tr·∫°ng th√°i
			
			// --- STATE CHO B·∫¢NG B√ÅO C√ÅO S·ª∞ C·ªê NƒÇM ---
			const [showAnnualShutdownModal, setShowAnnualShutdownModal] = useState(false);
			const [shutdownReportPeriod, setShutdownReportPeriod] = useState('YEAR'); // M·∫∑c ƒë·ªãnh xem c·∫£ nƒÉm
			
			// --- STATE CHO B·∫¢NG B√ÅO C√ÅO S·ª∞ KI·ªÜN NƒÇM ---
			const [showAnnualEventModal, setShowAnnualEventModal] = useState(false);
			const [eventReportPeriod, setEventReportPeriod] = useState('YEAR'); // M·∫∑c ƒë·ªãnh xem c·∫£ nƒÉm

			// H√†m logic x√°c ƒë·ªãnh tr·∫°ng th√°i d·ª±a tr√™n m·ªëc th·ªùi gian th·ª±c t·∫ø
			const autoDetermineStatus = (startTime, endTime, isIncident = false) => {
				if (!startTime || startTime === "") {
					return isIncident ? "Ch∆∞a kh·∫Øc ph·ª•c" : "Ch∆∞a th·ª±c hi·ªán"; // Tr·∫°ng th√°i ban ƒë·∫ßu
				}
				if (startTime && (!endTime || endTime === "")) {
					return isIncident ? "ƒêang x·ª≠ l√Ω" : "ƒêang th·ª±c hi·ªán"; // ƒêang di·ªÖn ra
				}
				if (startTime && endTime) {
					return isIncident ? "ƒê√£ kh·∫Øc ph·ª•c" : "ƒê√£ ho√†n th√†nh"; // K·∫øt th√∫c
				}
				return "Ch∆∞a th·ª±c hi·ªán";
			};
            
            // T√≠nh to√°n b√π gi·ªù ƒë·ªÉ lu√¥n l·∫•y ƒë√∫ng ng√†y h√¥m nay t·∫°i Vi·ªát Nam
            const [dailyDate, setDailyDate] = React.useState(() => {
                const d = new Date();
                const offset = d.getTimezoneOffset() * 60000; // T√≠nh ƒë·ªô l·ªách m√∫i gi·ªù
                return new Date(d.getTime() - offset).toISOString().slice(0, 10);
            });
			
			// LU√îN CU·ªòN L√äN ƒê·∫¶U TRANG KHI M·ªû APP HO·∫∂C ƒê·ªîI TAB ---
            useEffect(() => {
                // 1. T·∫Øt t√≠nh nƒÉng t·ª± nh·ªõ v·ªã tr√≠ c·ªßa tr√¨nh duy·ªát
                if ('scrollRestoration' in window.history) {
                    window.history.scrollRestoration = 'manual';
                }
                // 2. Cu·ªôn l√™n ƒë·∫ßu trang
                window.scrollTo(0, 0);
            }, []); // Ch·ªâ ch·∫°y 1 l·∫ßn khi F5/M·ªü app

            // N·∫øu mu·ªën ƒë·ªïi Tab (Dashboard <-> Nh·∫≠p li·ªáu) c≈©ng t·ª± l√™n ƒë·∫ßu th√¨ d√πng c√°i n√†y:
            useEffect(() => {
                window.scrollTo(0, 0);
            }, [activeView]);
			
			// C·∫§U H√åNH MAPPING D·ªÆ LI·ªÜU APP -> SHEET "DETAIL" (D·ª±a tr√™n file du lieu.xlsx)
			const SHEET_MAPPING = [
				// --- DGCP GAS ---
				{ sys: 'DGCP_GAS', key: 'gaslift', col: 'D' },
				{ sys: 'DGCP_GAS', key: 'bcp_ft305', col: 'E' },
				{ sys: 'DGCP_GAS', key: 'bcp_ft801', col: 'F' },
				{ sys: 'DGCP_GAS', key: 'fuel_gas', col: 'V' },
				{ sys: 'DGCP_GAS', key: 'condensate', col: 'AL' },
				{ sys: 'DGCP_GAS', key: 'lost_gas', col: 'AF' },

				// --- RP3 ---
				{ sys: 'RP3', key: 'booster_rp3_rp2', col: 'G' },
				{ sys: 'RP3', key: 'c1_gas_dgcp', col: 'AB' },
				{ sys: 'RP3', key: 'gas_c1_flare', col: 'AJ' },
				{ sys: 'RP3', key: 'gas_hp_flare', col: 'AK' },
				{ sys: 'RP3', key: 'gas_dgcp_taurus', col: 'T' },
				{ sys: 'RP3', key: 'gas_dgcp_saturn', col: 'S' },
				{ sys: 'RP3', key: 'gas_dgcp_typhoon', col: 'R' },
				
				
				
				// --- RP2 ---
				{ sys: 'RP2', key: 'gas_prod', col: 'AA' },
				{ sys: 'RP2', key: 'flare', col: 'AI' },

				// --- RP1 ---
				{ sys: 'RP1', key: 'gas_rp1_rc6', col: 'X' },
				{ sys: 'RP1', key: 'rp1_flare', col: 'AH' },
				{ sys: 'RP1', key: 'gas_rcdm', col: 'AD' },
				{ sys: 'RP1', key: 'gas_rc4', col: 'AC' },
				{ sys: 'RP1', key: 'gas_rc5_9', col: 'Y' },
				{ sys: 'RP1', key: 'gas_rc8', col: 'Z' },
				{ sys: 'RP1', key: 'press_rp1_flare', col: 'CW' },

				// --- RC1/3 ---
				{ sys: 'RC13', key: 'gaslift_bk8', col: 'W' },
				{ sys: 'RC13', key: 'wells_cond', col: 'I' },

				// --- ƒêI·ªÜN ---
				{ sys: 'ELEC', key: 'total_day', col: 'AM' },
				{ sys: 'ELEC', key: 'kpd', col: 'AN' },
				{ sys: 'ELEC', key: 'booster', col: 'AO' },
				{ sys: 'ELEC', key: 'rp3', col: 'AP' },
				{ sys: 'ELEC', key: 'run_hours', col: 'AQ' },

				// --- FUEL GAS (Chi ti·∫øt) ---
				{ sys: 'FUEL_GAS', key: 'gtca_kg', col: 'L' },
				{ sys: 'FUEL_GAS', key: 'gtcb_kg', col: 'N' },
				{ sys: 'FUEL_GAS', key: 'gtg_kg', col: 'P' },
				

				// --- TH√îNG S·ªê CN (GTC) ---
				// GTC-A
				{ sys: 'TECH_PARAMS', key: 'gtca_p1in', col: 'BI' }, { sys: 'TECH_PARAMS', key: 'gtca_t1in', col: 'BJ' },
				{ sys: 'TECH_PARAMS', key: 'gtca_p1out', col: 'BK' }, { sys: 'TECH_PARAMS', key: 'gtca_t1out', col: 'BL' },
				{ sys: 'TECH_PARAMS', key: 'gtca_p2in', col: 'BM' }, { sys: 'TECH_PARAMS', key: 'gtca_t2in', col: 'BN' },
				{ sys: 'TECH_PARAMS', key: 'gtca_p2out', col: 'BO' }, { sys: 'TECH_PARAMS', key: 'gtca_t2out', col: 'BP' },
				{ sys: 'TECH_PARAMS', key: 'gtca_ngp', col: 'CM' }, { sys: 'TECH_PARAMS', key: 'gtca_npt', col: 'CN' },
				{ sys: 'TECH_PARAMS', key: 'gtca_t5', col: 'CS' },{ sys: 'TECH_PARAMS', key: 'gtca_pcd', col: 'CQ' },				
				{ sys: 'TECH_PARAMS', key: 'gtca_stop_nor', col: 'AR' },{ sys: 'TECH_PARAMS', key: 'gtca_stop_emer', col: 'AS' },
				
				//GTC-B
				{ sys: 'TECH_PARAMS', key: 'gtcb_p1in', col: 'BX' }, { sys: 'TECH_PARAMS', key: 'gtcb_t1in', col: 'BY' },
				{ sys: 'TECH_PARAMS', key: 'gtcb_p1out', col: 'BZ' }, { sys: 'TECH_PARAMS', key: 'gtcb_t1out', col: 'CA' },
				{ sys: 'TECH_PARAMS', key: 'gtcb_p2in', col: 'CB' }, { sys: 'TECH_PARAMS', key: 'gtcb_t2in', col: 'CC' },
				{ sys: 'TECH_PARAMS', key: 'gtcb_p2out', col: 'CD' }, { sys: 'TECH_PARAMS', key: 'gtcb_t2out', col: 'CE' },
				{ sys: 'TECH_PARAMS', key: 'gtcb_ngp', col: 'CO' }, { sys: 'TECH_PARAMS', key: 'gtcb_npt', col: 'CP' },
				{ sys: 'TECH_PARAMS', key: 'gtcb_t5', col: 'CT' },{ sys: 'TECH_PARAMS', key: 'gtcb_pcd', col: 'CR' },
				{ sys: 'TECH_PARAMS', key: 'gtcb_stop_nor', col: 'AU' },{ sys: 'TECH_PARAMS', key: 'gtcb_stop_emer', col: 'AV' },


				{ sys: 'TECH_PARAMS', key: 'common_gaslift', col: 'BC' },
				{ sys: 'TECH_PARAMS', key: 'gen_rp3_pin', col: 'BE' }, { sys: 'TECH_PARAMS', key: 'gen_rp3_tin', col: 'BF' },
				{ sys: 'TECH_PARAMS', key: 'gen_slug_pin', col: 'BG' }, { sys: 'TECH_PARAMS', key: 'gen_slug_tin', col: 'BH' },
				{ sys: 'TECH_PARAMS', key: 'gen_dgcp_pout', col: 'CU' },{ sys: 'TECH_PARAMS', key: 'gen_dgcp_tout', col: 'CV' },
				
				//BCP-DGCP
				{ sys: 'BCP_TECH', key: 'c5_pin_rp3', col: 'CX' }, { sys: 'BCP_TECH', key: 'c5_tin_rp3', col: 'CY' },
				{ sys: 'BCP_TECH', key: 'inlet_pin', col: 'CZ' }, { sys: 'BCP_TECH', key: 'inlet_tin', col: 'DA' },
				{ sys: 'BCP_TECH', key: 'outlet_pout', col: 'DB' }, { sys: 'BCP_TECH', key: 'outlet_tout', col: 'DC' },
				{ sys: 'BCP_TECH', key: 'oil_temp', col: 'DF' }, { sys: 'BCP_TECH', key: 'motor_load', col: 'DG' },
				{ sys: 'BCP_TECH', key: 'pcv_301c', col: 'DH' }, { sys: 'BCP_TECH', key: 'pcv_303c', col: 'DI' },
				{ sys: 'BCP_TECH', key: 'flow_ft305c', col: 'BD' }, { sys: 'BCP_TECH', key: 'out_pout_rp3', col: 'DD' },
				{ sys: 'BCP_TECH', key: 'out_tout_rp3', col: 'DE' },
				{ sys: 'BCP_TECH', key: 'stop_normal', col: 'AX' },{ sys: 'BCP_TECH', key: 'stop_emergency', col: 'AY' },

				// Performance GTC-A
				{ sys: 'GTC', key: 'gtca_power', col: 'BQ' }, { sys: 'GTC', key: 'gtca_head', col: 'BR' },
				{ sys: 'GTC', key: 'gtca_dp', col: 'BS' }, { sys: 'GTC', key: 'gtca_speed', col: 'BT' },
				{ sys: 'GTC', key: 'gtca_surge', col: 'BU' }, { sys: 'GTC', key: 'gtca_fuel', col: 'BV' },
				{ sys: 'GTC', key: 'gtca_flow', col: 'BA' }, { sys: 'GTC', key: 'gtca_contam', col: 'BW' },

				
				// Performance GTC-B
				{ sys: 'GTC', key: 'gtcb_power', col: 'CF' }, { sys: 'GTC', key: 'gtcb_head', col: 'CG' },
				{ sys: 'GTC', key: 'gtcb_dp', col: 'CH' }, { sys: 'GTC', key: 'gtcb_speed', col: 'CI' },
				{ sys: 'GTC', key: 'gtcb_surge', col: 'CJ' }, { sys: 'GTC', key: 'gtcb_fuel', col: 'CK' },
				{ sys: 'GTC', key: 'gtcb_flow', col: 'BB' }, { sys: 'GTC', key: 'gtcb_contam', col: 'CL' },
			
				// --- H√ìA PH·∫®M (CHEMICALS) ---
				{ sys: 'CHEMICALS', key: 'gaslift_lit', col: 'DJ' },      // Gaslift CI
				{ sys: 'CHEMICALS', key: 'ac202_lit', col: 'DK' },        // AC-202
				{ sys: 'CHEMICALS', key: 'oxy_ace_full', col: 'DN' },     // Oxy/Ace ƒê·∫ßy
				{ sys: 'CHEMICALS', key: 'oxy_ace_empty', col: 'DO' },    // Oxy/Ace R·ªóng

			];

            // --- H√ÄM ƒê·ªåC FILE SVODKA ƒê·ªÇ PREVIEW (CH∆ØA L∆ØU) ---
			const handleSvodkaPlanUpload = (e) => {
				const file = e.target.files[0];
				if (!file) return;

				const reader = new FileReader();
				reader.onload = (evt) => {
					try {
						const data = new Uint8Array(evt.target.result);
						const workbook = XLSX.read(data, { type: 'array' });

						// 1. T√¨m sheet t√™n l√† "Total"
						const sheetName = workbook.SheetNames.find(n => n.toLowerCase() === 'total');
						if (!sheetName) {
							alert('‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y sheet "Total" trong file n√†y!');
							return;
						}
						const worksheet = workbook.Sheets[sheetName];

						// 2. ƒê·ªçc sheet theo d·∫°ng C·ªôt
						const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: "A", defval: 0 });

						const mappedData = [];
						let count = 0;

						jsonData.forEach((row) => {
							const monthRaw = row['A'];
							// L·∫•y gi√° tr·ªã c·ªôt B (Gaslift) ƒë·ªÉ ki·ªÉm tra
							const gasVal = parseFloat(row['B']) || 0; 
							
							// ƒêI·ªÄU KI·ªÜN L·ªåC:
							// 1. C·ªôt A ph·∫£i l√† s·ªë t·ª´ 1 ƒë·∫øn 12
							// 2. C·ªôt B ph·∫£i l·ªõn h∆°n 1000 (ƒê·ªÉ lo·∫°i b·ªè d√≤ng ƒë√°nh s·ªë c·ªôt 1, 2, 3, 4...)
							if (typeof monthRaw === 'number' && monthRaw >= 1 && monthRaw <= 12 && gasVal > 1000) {
								
								const days = getDaysInMonth(monthRaw, year); 

								mappedData.push({
									arg1: monthRaw,
									val1: gasVal,                     // C·ªôt B: Gaslift
									day1: days,
									val2: parseFloat(row['D']) || 0,  // C·ªôt D: BCP
									day2: days
								});
								count++;
							}
						});

						if (mappedData.length === 0) {
							alert("‚ö†Ô∏è Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu th√°ng n√†o! H√£y ki·ªÉm tra l·∫°i sheet Total.");
							return;
						}

						// 3. ƒê∆∞a v√†o b·∫£ng Preview
						setPreviewData(mappedData);
						
						// Reset input
						e.target.value = '';

					} catch (err) {
						console.error(err);
						alert("‚ùå L·ªói khi ƒë·ªçc file: " + err.message);
					}
				};
				reader.readAsArrayBuffer(file);
			};
						
			// --- H√ÄM IMPORT SVODKA v2.2: FIX DUPLICATE + LAZY LOAD XLSX ---
            const handleImportFullHistory = async (e) => { // 1. Th√™m async
                const file = e.target.files[0];
                if (!file) return;

                // 2. üëá TH√äM ƒêO·∫†N N√ÄY: Ki·ªÉm tra v√† t·∫£i th∆∞ vi·ªán Excel n·∫øu ch∆∞a c√≥
                if (!window.XLSX) {
                    console.log("‚è≥ ƒêang t·∫£i th∆∞ vi·ªán x·ª≠ l√Ω Excel...");
                    try {
                        await loadXLSX(); // G·ªçi h√†m t·∫£i ƒë·ªông (ƒë√£ khai b√°o ·ªü tr√™n)
                    } catch (err) {
                        console.error(err);
                        alert("‚ùå L·ªói: Kh√¥ng th·ªÉ t·∫£i th∆∞ vi·ªán Excel. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng!");
                        return;
                    }
                }
                // -----------------------------------------------------------

                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const bstr = evt.target.result;
                        const wb = XLSX.read(bstr, { type: 'binary', cellDates: true });
                        
                        const newDb = { ...db }; 
                        if (!newDb.DAILY_REPORTS) newDb.DAILY_REPORTS = {};

                        let stats = { detail: 0, others: 0, hr: 0 };

                        const isValidDate = (val) => {
                            if (!val) return false;
                            if (val instanceof Date) return true;
                            if (typeof val === 'string' && val.match(/\d+[\/\-]\d+/)) return true;
                            return false;
                        };

                        // H√†m chu·∫©n h√≥a ng√†y v·ªÅ YYYY-MM-DD
                        const getSafeDateKey = (val) => {
                            if (!val) return null;
                            try {
                                const pad = (num) => String(num).padStart(2, '0');
                                if (val instanceof Date) {
                                    const offset = val.getTimezoneOffset() * 60000;
                                    const d = new Date(val.getTime() - offset);
                                    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
                                } 
                                if (typeof val === 'string') {
                                    const parts = val.match(/(\d+)/g);
                                    if (parts && parts.length >= 3) {
                                        if (parts[0].length === 4) { // YYYY-M-D
                                            return `${parts[0]}-${pad(parts[1])}-${pad(parts[2])}`;
                                        }
                                        // D-M-YYYY
                                        return `${parts[2]}-${pad(parts[1])}-${pad(parts[0])}`; 
                                    }
                                }
                            } catch (e) { return null; }
                            return null;
                        };

                        // 1. DETAIL
                        const wsDetail = wb.Sheets["Detail"];
                        if (wsDetail) {
                            const rows = XLSX.utils.sheet_to_json(wsDetail, { header: 1, range: 7 }); 
                            const getColIdx = (letter) => {
                                let column = 0, length = letter.length;
                                for (let i = 0; i < length; i++) column += (letter.charCodeAt(i) - 64) * Math.pow(26, length - i - 1);
                                return column - 1;
                            };
                            rows.forEach(row => {
                                const dateKey = getSafeDateKey(row[0]);
                                if (dateKey) {
                                    if (!newDb.DAILY_REPORTS[dateKey]) newDb.DAILY_REPORTS[dateKey] = {};
                                    SHEET_MAPPING.forEach(mapItem => {
                                        const colIdx = getColIdx(mapItem.col);
                                        const cellValue = row[colIdx];
                                        if (cellValue !== undefined && cellValue !== null) {
                                            if (!newDb.DAILY_REPORTS[dateKey][mapItem.sys]) newDb.DAILY_REPORTS[dateKey][mapItem.sys] = {};
                                            newDb.DAILY_REPORTS[dateKey][mapItem.sys][mapItem.key] = cellValue;
                                        }
                                    });
                                    stats.detail++;
                                }
                            });
                        }

                        // 2. OTHERS
                        const wsOthers = wb.Sheets["Others"];
                        if (wsOthers) {
                            const rows = XLSX.utils.sheet_to_json(wsOthers, { header: 1, range: 1 }); 
                            rows.forEach(row => {
                                const dateKey = getSafeDateKey(row[0]);
                                if (dateKey) {
                                    if (!newDb.DAILY_REPORTS[dateKey]) newDb.DAILY_REPORTS[dateKey] = {};
                                    if(row[1]) newDb.DAILY_REPORTS[dateKey].SAFETY = { ...(newDb.DAILY_REPORTS[dateKey].SAFETY || {}), incidents: String(row[1]) };
                                    if(row[2]) newDb.DAILY_REPORTS[dateKey].SAFETY = { ...(newDb.DAILY_REPORTS[dateKey].SAFETY || {}), systems: String(row[2]) };
                                    if(row[3]) newDb.DAILY_REPORTS[dateKey].SAFETY = { ...(newDb.DAILY_REPORTS[dateKey].SAFETY || {}), suggestions: String(row[3]) };
                                    if(row[4]) newDb.DAILY_REPORTS[dateKey].SAFETY = { ...(newDb.DAILY_REPORTS[dateKey].SAFETY || {}), env_impact: String(row[4]) };
                                    if(row[5]) newDb.DAILY_REPORTS[dateKey].DAILY_INFO = { content: String(row[5]) };
                                    if(row[6]) newDb.DAILY_REPORTS[dateKey].NEXT_DAY_PLAN = { content: String(row[6]) };
                                    if(row[7]) newDb.DAILY_REPORTS[dateKey].SHIP_BOOKING = { content: String(row[7]) };
                                    if(row[8]) newDb.DAILY_REPORTS[dateKey].MANAGER = { name: String(row[8]) };
                                    stats.others++;
                                }
                            });
                        }

                        // 3. HR (LOGIC FIX DUPLICATE)
                        const wsHR = wb.Sheets["HR"];
                        if (wsHR) {
                            const rows = XLSX.utils.sheet_to_json(wsHR, { header: 1, range: 4 }); 
                            let currentProcessingDate = null; 

                            rows.forEach(row => {
                                const colA = row[0]; // Ng√†y
                                const colB = row[1]; // T√™n Cty
                                const colC = row[2]; // S·ªë l∆∞·ª£ng
                                const colD = row[3]; // C√¥ng vi·ªác

                                // --- N·∫æU PH√ÅT HI·ªÜN NG√ÄY M·ªöI ---
                                if (isValidDate(colA)) {
                                    const parsedDate = getSafeDateKey(colA);
                                    if (parsedDate) {
                                        currentProcessingDate = parsedDate;
                                        if (!newDb.DAILY_REPORTS[currentProcessingDate]) {
                                            newDb.DAILY_REPORTS[currentProcessingDate] = {};
                                        }
                                        // Reset m·∫£ng nh√¢n s·ª± v·ªÅ R·ªóng [] ngay khi g·∫∑p ng√†y m·ªõi
                                        newDb.DAILY_REPORTS[currentProcessingDate].PERSONNEL = []; 
                                    }
                                }

                                // --- N·∫†P D·ªÆ LI·ªÜU ---
                                if (currentProcessingDate) {
                                    const hasData = (colB || (colC !== undefined && colC !== null) || colD);
                                    if (hasData) {
                                        if (!newDb.DAILY_REPORTS[currentProcessingDate].PERSONNEL) {
                                            newDb.DAILY_REPORTS[currentProcessingDate].PERSONNEL = [];
                                        }
                                        
                                        newDb.DAILY_REPORTS[currentProcessingDate].PERSONNEL.push({
                                            id: Date.now() + Math.random(),
                                            company: colB ? String(colB) : "",
                                            count: colC ? String(colC) : "0",
                                            job: colD ? String(colD) : ""
                                        });
                                        stats.hr++;
                                    }
                                }
                            });
                        }

                        setDb(newDb);
                        logToCloud(currentUser, "Import Full History (Fix Duplicate)");
                        alert(`‚úÖ ƒê√É IMPORT TH√ÄNH C√îNG!\n(ƒê√£ t·ª± ƒë·ªông x√≥a d√≤ng tr√πng l·∫∑p ·ªü sheet HR)\n\n- Detail: ${stats.detail} ng√†y\n- Others: ${stats.others} ng√†y\n- HR: ${stats.hr} d√≤ng`);

                    } catch (err) {
                        console.error(err);
                        alert("L·ªói import: " + err.message);
                    }
                };
                reader.readAsBinaryString(file);
                e.target.value = null; 
            };
			
			// --- H√ÄM C·∫§U H√åNH CHO FILE SVODKA (ƒê√É CH·ªàNH THEO FILE B·∫†N G·ª¨I) ---
			const SVODKA_CONFIG = {
				SHEET_NAME: "Detail", 
				ROW_DATA_START: 7,    // D·ªØ li·ªáu b·∫Øt ƒë·∫ßu t·ª´ d√≤ng 8 (index 7)
				COL_DATE: 0,          // C·ªôt A: Ng√†y
				COL_GAS_MAIN: 3,      // C·ªôt D: Gaslift –ö–ü–î (Gaslift GNR)
				COL_BCP_MAIN: 4      // C·ªôt E: BCP
			};

			// --- 2. STATE QU·∫¢N L√ù CH·∫æ ƒê·ªò XEM ---
			const [activeView, setActiveView] = useState('DASHBOARD'); // 'DASHBOARD' ho·∫∑c 'DATA_LAKE'
			const [svodkaMode, setSvodkaMode] = useState(null); // Mode import Svodka
			
			// --- M·ªöI: STATE CHO AUTO-SYNC ---
			const [isAutoSyncing, setIsAutoSyncing] = useState(false); // Tr·∫°ng th√°i ƒëang ch·∫°y ng·∫ßm
			const autoSaveTimerRef = useRef(null); // Ref ƒë·ªÉ gi·ªØ timer (tr√°nh render l·∫°i)
			// --------------------------------

            const [systemLogs, setSystemLogs] = useState([]); // L∆∞u danh s√°ch log
            const [showLogModal, setShowLogModal] = useState(false); // ·∫®n/hi·ªán b·∫£ng log
            const [logSearchTerm, setLogSearchTerm] = useState(""); // √î t√¨m ki·∫øm trong log
			
			// --- STATE HI·ªÇN TH·ªä B·∫¢NG K·∫æ HO·∫†CH 12 TH√ÅNG ---
            const [showGasPlanTable, setShowGasPlanTable] = useState(false);
            const [showBcpPlanTable, setShowBcpPlanTable] = useState(false);
            
			// --- M·ªöI: STATE S·∫ÆP X·∫æP LOG ---
			const [logSortOrder, setLogSortOrder] = useState('desc'); // 'desc' l√† m·ªõi nh·∫•t tr∆∞·ªõc, 'asc' l√† c≈© nh·∫•t tr∆∞·ªõc
			
			// --- STATE CHO IMPORT EXCEL ---
            const [previewData, setPreviewData] = useState([]); // D·ªØ li·ªáu xem tr∆∞·ªõc
            const fileInputRef = useRef(null); // Ref ƒë·ªÉ reset √¥ ch·ªçn file
			
            // State for Undo
            const [backupDb, setBackupDb] = useState(null); 
            
            // Edit States
            const [isEditingPlan, setIsEditingPlan] = useState(false);
			
			const initialMaintState = {
				id: null,
				description: "",
				performingUnit: "DGCP", // M·∫∑c ƒë·ªãnh l√† DGCP
				maintenanceEquipment: "GTC-A",
				start: "",              // ƒê·ªÉ tr·ªëng ng√†y b·∫Øt ƒë·∫ßu th·ª±c t·∫ø
				end: "",                // ƒê·ªÉ tr·ªëng ng√†y k·∫øt th√∫c th·ª±c t·∫ø
				plannedStart: "", 
				plannedEnd: "",
				plannedHours: 0,
				actualHours: 0,
				info: "",
				status: "Ch∆∞a th·ª±c hi·ªán",
				isUnplanned: false,
				isNew: true
			};
            
            // --- NEW: Edit Maintenance State ---
            const [isEditingMaint, setIsEditingMaint] = useState(false);
            
            const [isEditingShutdown, setIsEditingShutdown] = useState(false); 
            const [isEditingEvent, setIsEditingEvent] = useState(false);
            const [isEditingActuals, setIsEditingActuals] = useState(false);

            // Temp States for Edits (Dual System)
            const [tempPlanGas, setTempPlanGas] = useState({ target: 0, workingDays: 0 });
            const [tempPlanBCP, setTempPlanBCP] = useState({ target: 0, workingDays: 0 });
            
            // --- NEW: Temp Maints State ---
            const [tempMaints, setTempMaints] = useState([]);
            
            const [tempShutdowns, setTempShutdowns] = useState([]);
            const [tempEvents, setTempEvents] = useState([]);
            
            const [tempActualsGas, setTempActualsGas] = useState({});
            const [tempActualsNotesGas, setTempActualsNotesGas] = useState({});
            const [tempActualsBCP, setTempActualsBCP] = useState({});
            const [tempActualsNotesBCP, setTempActualsNotesBCP] = useState({});

            // NEW STATE: Remaining Maintenance Days Input
            const [gasMaintInput, setGasMaintInput] = useState(0);
            const [bcpMaintInput, setBcpMaintInput] = useState(0);

            // Sorting State for Actuals (Combined Table)
            const [actualsSortConfig, setActualsSortConfig] = useState({ key: 'day', direction: 'asc' });

            // Detail Modal States
            const [dayDetail, setDayDetail] = useState(null); 
            const [maintDetail, setMaintDetail] = useState(null); 
            const [shutdownDetail, setShutdownDetail] = useState(null); 
            const [eventDetail, setEventDetail] = useState(null); 

            // --- NEW: Maint Editing States ---
            const [newMaint, setNewMaint] = useState({ 
                description: '', start: '', end: '', info: '', 
                status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', 
                maintenanceEquipment: ''
            }); 
            const [editingMaintId, setEditingMaintId] = useState(null);

            const [newShutdown, setNewShutdown] = useState({ 
                description: '', start: '', end: '', info: '', 
                status: 'Ch∆∞a kh·∫Øc ph·ª•c', performingUnit: '', relatedPlatforms: '', 
                eventType: 'S·ª± c·ªë', equipment: '', cause: '' 
            }); 
            const [editingShutdownId, setEditingShutdownId] = useState(null); 

            const [newEvent, setNewEvent] = useState({ name: '', startDate: '', endDate: '', info: '', status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', eventType: 'Kh√°c', equipment: '' });
            const [editingEventId, setEditingEventId] = useState(null);

            // Forecast States (Separated)
            const [eodForecastGas, setEodForecastGas] = useState({ accumulated: '', currentRate: '', time: '' });
            const [eodForecastBCP, setEodForecastBCP] = useState({ accumulated: '', currentRate: '', time: '' });
            
            // --- C·∫¨P NH·∫¨T: Forecast States (T·ª± ƒë·ªông nh·ªõ gi√° tr·ªã c≈©) ---
            const [eomForecastGas, setEomForecastGas] = useState(() => {
                const saved = localStorage.getItem('DGCP_PREF_GAS_RATE');
                return { representativeDaily: saved || '' };
            });

            const [eomForecastBCP, setEomForecastBCP] = useState(() => {
                const saved = localStorage.getItem('DGCP_PREF_BCP_RATE');
                return { representativeDaily: saved || '' };
            });

            const [currentTime, setCurrentTime] = useState(new Date());
			
			// --- LOGIC ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU TAB NH·∫¨P LI·ªÜU (C·∫¶U N·ªêI 2 CHI·ªÄU)(Auto-Sync) ---
            
            
            // 1. CHI·ªÄU XU·ªêNG: Load d·ªØ li·ªáu t·ª´ Database ra Form
            useEffect(() => {
                const todayData = db?.DAILY_REPORTS?.[dailyDate] || {};

                // --- 1. C√ÅC TH·∫∫ ƒê∆†N GI·∫¢N ---
                setRp3Data(todayData.RP3 || {});
                setRp2Data(todayData.RP2 || {});
                setRp1Data(todayData.RP1 || {});
                setRc13Data(todayData.RC13 || {});
                setGtcData(todayData.GTC || {});
                setDgcpGasData(todayData.DGCP_GAS || {});

				// üëá --- X·ª¨ L√ù ƒêI·ªÜN (C√ì K·∫æ TH·ª™A TH·ªúI GIAN CH·∫†Y) ---
                const currentElec = todayData.ELEC || {};
                
                // Ki·ªÉm tra xem ƒë√£ c√≥ "Th·ªùi gian ch·∫°y" ch∆∞a
                if (currentElec.run_hours === undefined || currentElec.run_hours === "") {
                    // N·∫øu ch∆∞a c√≥ -> T√¨m ng√†y c≈© g·∫ßn nh·∫•t ƒë·ªÉ k·∫ø th·ª´a
                    let inheritedHours = "24"; // M·∫∑c ƒë·ªãnh l√† 24
                    
                    if (db?.DAILY_REPORTS) {
                        const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        const prevDate = sortedDates.find(d => 
                            d < dailyDate && 
                            db.DAILY_REPORTS[d].ELEC?.run_hours
                        );
                        
                        if (prevDate) {
                            inheritedHours = db.DAILY_REPORTS[prevDate].ELEC.run_hours;
                        }
                    }
                    // G·ªôp d·ªØ li·ªáu c≈© (n·∫øu c√≥) + Gi·ªù ch·∫°y k·∫ø th·ª´a
                    setElecData({ ...currentElec, run_hours: inheritedHours });
                } else {
                    // N·∫øu ƒë√£ c√≥ d·ªØ li·ªáu r·ªìi th√¨ d√πng lu√¥n
                    setElecData(currentElec);
                }

                // --- 2. X·ª¨ L√ù GTC TECH (Gi·ªØ nguy√™n logic chu·∫©n) ---
                const currentTech = todayData.TECH_PARAMS || {};
                if (Object.keys(currentTech).length > 0) {
                    setTechData(currentTech);
                } else {
                    let lastStatusA = "Running";
                    let lastStatusB = "Running";
                    if (db?.DAILY_REPORTS) {
                        const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        const prevDate = sortedDates.find(d => d < dailyDate && db.DAILY_REPORTS[d].TECH_PARAMS);
                        if (prevDate) {
                            const prev = db.DAILY_REPORTS[prevDate].TECH_PARAMS;
                            if (prev.gtca_status) lastStatusA = prev.gtca_status;
                            if (prev.gtcb_status) lastStatusB = prev.gtcb_status;
                        }
                    }
                    setTechData({
                        gtca_stop_nor: "0", gtca_stop_emer: "0",
                        gtcb_stop_nor: "0", gtcb_stop_emer: "0",
                        gtca_status: lastStatusA, gtcb_status: lastStatusB,
                        gtca_p1in: "", gtca_t1in: "", gtca_p1out: "", gtca_t1out: "", gtca_p2in: "", gtca_t2in: "", gtca_p2out: "", gtca_t2out: "", gtca_ngp: "", gtca_npt: "", gtca_pcd: "", gtca_t5: "", gtca_gaslift: "",
                        gtcb_p1in: "", gtcb_t1in: "", gtcb_p1out: "", gtcb_t1out: "", gtcb_p2in: "", gtcb_t2in: "", gtcb_p2out: "", gtcb_t2out: "", gtcb_ngp: "", gtcb_npt: "", gtcb_pcd: "", gtcb_t5: "", gtcb_gaslift: "",
                        gen_rp3_pin: "", gen_rp3_tin: "", gen_slug_pin: "", gen_slug_tin: "", gen_dgcp_pout: "", gen_dgcp_tout: ""
                    });
                }

                // --- 3. X·ª¨ L√ù BCP TECH (Gi·ªØ nguy√™n logic chu·∫©n y h·ªát GTC) ---
                const currentBcp = todayData.BCP_TECH || {};
                if (Object.keys(currentBcp).length > 0) {
                    setBcpTechData(currentBcp);
                } else {
                    let lastStatus = "Running";
                    if (db?.DAILY_REPORTS) {
                        const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        const prevDate = sortedDates.find(d => d < dailyDate && db.DAILY_REPORTS[d].BCP_TECH);
                        if (prevDate) {
                             const prev = db.DAILY_REPORTS[prevDate].BCP_TECH;
                             if (prev.status && prev.status !== "") lastStatus = prev.status;
                        }
                    }
                    setBcpTechData({
                        stop_normal: "0", stop_emergency: "0", 
                        status: lastStatus,
                        c5_pin_rp3: "", c5_tin_rp3: "", inlet_pin: "", inlet_tin: "", outlet_pout: "", outlet_tout: "", oil_temp: "", motor_load: "", pcv_301c: "", pcv_303c: "", flow_ft305c: "", out_pout_rp3: "", out_tout_rp3: ""
                    });
                }

                // --- 4. C√ÅC PH·∫¶N KH√ÅC ---
                if (todayData.BCP_STOP) { setBcpStopData(todayData.BCP_STOP); } else { setBcpStopData({ normal: "0", emergency: "0" }); }

                if (todayData.FUEL_GAS) { setFuelGasData(todayData.FUEL_GAS); } else {
                    let lastD = 0.908, lastN = "Q4-2026";
                    if(db?.DAILY_REPORTS) {
                        const s = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        const p = s.find(d => d < dailyDate && db.DAILY_REPORTS[d].FUEL_GAS?.density);
                        if(p) { lastD=db.DAILY_REPORTS[p].FUEL_GAS.density; lastN=db.DAILY_REPORTS[p].FUEL_GAS.density_note; }
                    }
                    setFuelGasData({ gtca_kg: '', gtcb_kg: '', gtg_kg: '', density: lastD, density_note: lastN });
                }

                if (todayData.CHEMICALS) { setChemicalsData(todayData.CHEMICALS); } else {
                    let fd = null;
                    if(db?.DAILY_REPORTS) {
                        const s = Object.keys(db.DAILY_REPORTS).filter(d=>d<dailyDate && db.DAILY_REPORTS[d].CHEMICALS).sort().reverse();
                        if(s.length>0) fd = db.DAILY_REPORTS[s[0]].CHEMICALS;
                    }
                    setChemicalsData(fd || { gaslift_lit: "29", ac202_lit: "0", oxy_ace_full: "10/4", oxy_ace_empty: "2/8" });
                }

                // üëá X·ª¨ L√ù K·∫æ HO·∫†CH NG√ÄY MAI& TH√îNG TIN TRONG NG√ÄY & ƒê·∫∂T T√ÄU: X·ª¨ L√ù K·∫æ TH·ª™A TH√îNG MINH (M·ªöI C·∫¨P NH·∫¨T) ---
				// H√†m ti·ªán √≠ch: T√¨m d·ªØ li·ªáu c≈© g·∫ßn nh·∫•t n·∫øu h√¥m nay ch∆∞a nh·∫≠p
				const getInheritedContent = (categoryKey) => {
					// 1. ∆Øu ti√™n: L·∫•y d·ªØ li·ªáu c·ªßa ch√≠nh ng√†y h√¥m nay (n·∫øu c√≥)
					if (todayData[categoryKey] && todayData[categoryKey].content && todayData[categoryKey].content.trim() !== "") {
						return todayData[categoryKey].content;
					}

					// 2. D·ª± ph√≤ng: N·∫øu h√¥m nay tr·ªëng, ƒëi t√¨m ng√†y c≈© g·∫ßn nh·∫•t ƒë·ªÉ k·∫ø th·ª´a
					if (db?.DAILY_REPORTS) {
						// L·∫•y danh s√°ch ng√†y, s·∫Øp x·∫øp t·ª´ M·ªõi -> C≈©
						const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
						
						// T√¨m ng√†y qu√° kh·ª© ƒë·∫ßu ti√™n c√≥ d·ªØ li·ªáu
						const prevDate = sortedDates.find(d => 
							d < dailyDate && // Ng√†y ph·∫£i nh·ªè h∆°n ng√†y ƒëang ch·ªçn
							db.DAILY_REPORTS[d][categoryKey] && 
							db.DAILY_REPORTS[d][categoryKey].content &&
							db.DAILY_REPORTS[d][categoryKey].content.trim() !== ""
						);

						if (prevDate) {
							return db.DAILY_REPORTS[prevDate][categoryKey].content;
						}
					}
					return ""; // N·∫øu kh√¥ng t√¨m th·∫•y g√¨ c·∫£ th√¨ tr·∫£ v·ªÅ r·ªóng
				};

					// √Åp d·ª•ng cho 3 th·∫ª:
					setNextDayPlan({ content: getInheritedContent('NEXT_DAY_PLAN') });
					setDailyInfo({ content: getInheritedContent('DAILY_INFO') });
					setShipBooking({ content: getInheritedContent('SHIP_BOOKING') });

				// üëá --- 7. X·ª¨ L√ù NH√ÇN S·ª∞ (ƒê√É N√ÇNG C·∫§P T√çNH K·∫æ TH·ª™A) ---
                const currentPersonnel = todayData.PERSONNEL;

				

                // TR∆Ø·ªúNG H·ª¢P 1: H√¥m nay ƒë√£ nh·∫≠p d·ªØ li·ªáu -> L·∫•y ra d√πng ngay
                if (currentPersonnel && Array.isArray(currentPersonnel) && currentPersonnel.length > 0) {
                    setPersonnelData(currentPersonnel);
                } else {
                    // TR∆Ø·ªúNG H·ª¢P 2: Ch∆∞a nh·∫≠p -> ƒêi t√¨m d·ªØ li·ªáu c·ªßa ng√†y c≈© g·∫ßn nh·∫•t
                    let inheritedData = null;

                    if (db?.DAILY_REPORTS) {
                        const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        
                        // T√¨m ng√†y trong qu√° kh·ª© c√≥ ch·ª©a d·ªØ li·ªáu PERSONNEL
                        const prevDate = sortedDates.find(d => 
                            d < dailyDate && 
                            db.DAILY_REPORTS[d].PERSONNEL && 
                            Array.isArray(db.DAILY_REPORTS[d].PERSONNEL) &&
                            db.DAILY_REPORTS[d].PERSONNEL.length > 0
                        );
                        
                        if (prevDate) {
                            // N·∫øu t√¨m th·∫•y -> Copy d·ªØ li·ªáu ƒë√≥ sang ng√†y h√¥m nay
                            // L∆∞u √Ω: C·∫ßn map l·∫°i ƒë·ªÉ t·∫°o ID m·ªõi, tr√°nh tr√πng key React khi render
                            inheritedData = db.DAILY_REPORTS[prevDate].PERSONNEL.map(item => ({
                                ...item,
                                id: Date.now() + Math.random() // T·∫°o ID m·ªõi cho ng√†y m·ªõi
                            }));
                        }
                    }

                    // QUY·∫æT ƒê·ªäNH CU·ªêI C√ôNG
                    if (inheritedData) {
                        setPersonnelData(inheritedData); // K·∫ø th·ª´a t·ª´ qu√° kh·ª©
                    } else {
                        // N·∫øu kh√¥ng t√¨m th·∫•y l·ªãch s·ª≠ n√†o (Ng√†y ƒë·∫ßu ti√™n) -> T·∫°o d√≤ng m·∫∑c ƒë·ªãnh
                        setPersonnelData([
                            { id: Date.now(), company: "PGO", count: "23", job: "Van hanh & BDSC" }
                        ]);
                    }
                }

			// üëá --- 8. X·ª¨ L√ù NG∆Ø·ªúI QU·∫¢N L√ù (TH√äM M·ªöI + K·∫æ TH·ª™A) ---
                const currentManager = todayData.MANAGER || {};
                
                // N·∫øu h√¥m nay ƒë√£ ch·ªçn ng∆∞·ªùi qu·∫£n l√Ω -> L·∫•y d√πng ngay
                if (currentManager.name && currentManager.name !== "") {
                    setManagerData(currentManager);
                } else {
                    // N·∫øu ch∆∞a ch·ªçn -> T√¨m ng∆∞·ªùi qu·∫£n l√Ω c·ªßa ng√†y g·∫ßn nh·∫•t
                    let lastManagerName = ""; // M·∫∑c ƒë·ªãnh r·ªóng

                    if (db?.DAILY_REPORTS) {
                        const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        const prevDate = sortedDates.find(d => 
                            d < dailyDate && 
                            db.DAILY_REPORTS[d].MANAGER?.name && 
                            db.DAILY_REPORTS[d].MANAGER.name !== ""
                        );
                        
                        if (prevDate) {
                            lastManagerName = db.DAILY_REPORTS[prevDate].MANAGER.name;
                        }
                    }

                    // G√°n gi√° tr·ªã (K·∫ø th·ª´a ho·∫∑c R·ªóng)
                    setManagerData({ name: lastManagerName });
                }

				// üëá --- 9. X·ª¨ L√ù AN TO√ÄN HSE (C·∫¨P NH·∫¨T M·∫∂C ƒê·ªäNH TI·∫æNG NGA) ---
                const currentSafety = todayData.SAFETY || {};
                
                // N·∫øu h√¥m nay ƒë√£ nh·∫≠p -> L·∫•y d√πng
                if (Object.keys(currentSafety).length > 0) {
                    setSafetyData(currentSafety);
                } else {
                    // N·∫øu ch∆∞a nh·∫≠p -> K·∫ø th·ª´a ho·∫∑c d√πng M·∫∑c ƒë·ªãnh theo File Excel
                    let lastSafety = {
                        incidents: "–ù–æ—Ä–º–∞–ª—å–Ω–æ/–ù–µ—Ç",      // C·ªôt 1
                        systems: "–ù–µ—Ç/–ù–µ—Ç/–ù–µ—Ç",          // C·ªôt 2
                        suggestions: "–ù–µ—Ç/–ù–µ—Ç/–ù–µ—Ç",      // C·ªôt 3
                        env_impact: "–ù–µ—Ç"                // C·ªôt 4
                    };

                    if (db?.DAILY_REPORTS) {
                        const sortedDates = Object.keys(db.DAILY_REPORTS).sort().reverse();
                        const prevDate = sortedDates.find(d => d < dailyDate && db.DAILY_REPORTS[d].SAFETY);
                        if (prevDate) {
                            lastSafety = db.DAILY_REPORTS[prevDate].SAFETY;
                        }
                    }
                    setSafetyData(lastSafety);
                }

            }, [dailyDate, db]); 

            // 2. CHI·ªÄU L√äN: Auto-sync t·ª´ Form v√†o Database (Cho ph√©p l∆∞u r·ªóng ƒë·ªÉ X√ìA)
            useEffect(() => {
                if (!dailyDate) return;

                const timer = setTimeout(() => {
                    setDb(prev => {
                        // Copy c·∫•u tr√∫c
                        const newDb = { ...prev };
                        newDb.DAILY_REPORTS = { ...newDb.DAILY_REPORTS };
                        newDb.DAILY_REPORTS[dailyDate] = { ...(newDb.DAILY_REPORTS[dailyDate] || {}) };

                        // H√ÄM L∆ØU (ƒê√É S·ª¨A: CHO PH√âP L∆ØU D·ªÆ LI·ªÜU R·ªñNG)
                        const saveToReports = (key, stateData) => {
                             // N·∫øu bi·∫øn t·ªìn t·∫°i (k·ªÉ c·∫£ r·ªóng) th√¨ c·ª© l∆∞u ƒë√® v√†o DB
                             // ƒê·ªÉ khi b·∫•m "X√≥a", DB c≈©ng s·∫Ω b·ªã x√≥a theo
                             if (stateData !== undefined) {
                                newDb.DAILY_REPORTS[dailyDate][key] = stateData;
                             }
                        };

                        // L∆∞u t·∫•t c·∫£ c√°c th·∫ª
                        saveToReports('DGCP_GAS', dgcpGasData); 
                        saveToReports('RP3', rp3Data);
                        saveToReports('RP2', rp2Data);
                        saveToReports('RP1', rp1Data);
                        saveToReports('RC13', rc13Data);
                        saveToReports('ELEC', elecData);
                        saveToReports('GTC', gtcData);
                        saveToReports('TECH_PARAMS', techData);
                        saveToReports('FUEL_GAS', fuelGasData);
                        saveToReports('BCP_STOP', bcpStopData);
                        saveToReports('CHEMICALS', chemicalsData);
                        saveToReports('BCP_TECH', bcpTechData); // BCP
						saveToReports('NEXT_DAY_PLAN', nextDayPlan);
						saveToReports('DAILY_INFO', dailyInfo);
						saveToReports('PERSONNEL', personnelData);
						saveToReports('MANAGER', managerData);
						saveToReports('SAFETY', safetyData);
						saveToReports('SHIP_BOOKING', shipBooking);

                        // --- ƒê·ªíNG B·ªò LOGIC (GI·ªÆ NGUY√äN) ---
                        const [y, m, d] = dailyDate.split('-').map(Number);
                        if (y === year) {
                            if (dgcpGasData.gaslift !== undefined) { 
                                newDb.GASLIFT = { ...newDb.GASLIFT }; 
                                if (!newDb.GASLIFT[m]) newDb.GASLIFT[m] = { plan: { target: 30000, workingDays: 30 }, actuals: {} };
                                else newDb.GASLIFT[m] = { ...newDb.GASLIFT[m] };
                                newDb.GASLIFT[m].actuals = { ...newDb.GASLIFT[m].actuals };
                                newDb.GASLIFT[m].actuals[d] = parseFloat(dgcpGasData.gaslift) || 0;
                            }
                            if (dgcpGasData.bcp_ft305 !== undefined) {
                                newDb.BCP = { ...newDb.BCP }; 
                                if (!newDb.BCP[m]) newDb.BCP[m] = { plan: { target: 15000, workingDays: 30 }, actuals: {} };
                                else newDb.BCP[m] = { ...newDb.BCP[m] };
                                newDb.BCP[m].actuals = { ...newDb.BCP[m].actuals };
                                newDb.BCP[m].actuals[d] = parseFloat(dgcpGasData.bcp_ft305) || 0;
                            }
                        }
                        return newDb;
                    });
                }, 500);

                return () => clearTimeout(timer);
            }, [
                dailyDate, year,
                rp3Data, rp2Data, rp1Data, rc13Data, elecData, 
                gtcData, techData, dgcpGasData, fuelGasData, 
                bcpStopData, chemicalsData, bcpTechData, nextDayPlan, dailyInfo, personnelData, managerData, safetyData, shipBooking // ƒê·∫£m b·∫£o ƒë·ªß bi·∫øn
            ]);

			

            // Initialize time for Forecasts
            useEffect(() => {
                const now = new Date();
                const tzOffset = now.getTimezoneOffset() * 60000;
                const localISOTime = (new Date(now - tzOffset)).toISOString().slice(0, 16);
                setEodForecastGas(prev => ({ ...prev, time: localISOTime }));
                setEodForecastBCP(prev => ({ ...prev, time: localISOTime }));
            }, []);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);
			
			// --- T√çNH NƒÇNG: N√öT QUAY V·ªÄ ƒê·∫¶U TRANG (SCROLL TO TOP) ---
            const [showScrollTop, setShowScrollTop] = useState(false);

            useEffect(() => {
                const handleScroll = () => {
                    // N·∫øu cu·ªôn xu·ªëng qu√° 300px th√¨ hi·ªán n√∫t
                    if (window.scrollY > 300) {
                        setShowScrollTop(true);
                    } else {
                        setShowScrollTop(false);
                    }
                };

                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const scrollToTop = () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth' // Hi·ªáu ·ª©ng tr∆∞·ª£t m∆∞·ª£t m√†
                });
            };
            // --------------------------------------------------------

            // --- FIX L·ªñI: AUTO CHECK CLOUD (SAFE MODE) ---
            useEffect(() => {
                const checkCloudData = async () => {
                    // 1. Ki·ªÉm tra c·∫•u h√¨nh API
                    if (typeof API_URL === 'undefined' || !API_URL) return;
                    
                    try {
                        console.log("ƒêang ki·ªÉm tra d·ªØ li·ªáu Cloud...");
                        
                        // Th√™m AbortController ƒë·ªÉ timeout n·∫øu m·∫°ng lag (5 gi√¢y)
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);

                        const res = await fetch(API_URL, { 
                            method: "GET",
                            signal: controller.signal 
                        });
                        clearTimeout(timeoutId); // X√≥a timeout n·∫øu t·∫£i xong

                        if (!res.ok) throw new Error(`HTTP Error: ${res.status}`);

                        const cloudData = await res.json();
                        
                        // ... (Ph·∫ßn logic so s√°nh d·ªØ li·ªáu gi·ªØ nguy√™n nh∆∞ c≈©) ...
                        // 2. X√ÅC ƒê·ªäNH D·ªÆ LI·ªÜU DB CHU·∫®N
                        let incomingDb = null;
                        if (cloudData && cloudData.db && cloudData.db.GASLIFT) {
                            incomingDb = cloudData.db; 
                        } else if (cloudData && cloudData.GASLIFT) {
                            incomingDb = cloudData;
                        }

                        // 3. C·∫¨P NH·∫¨T T·ª∞ ƒê·ªòNG N·∫æU L·∫¶N ƒê·∫¶U M·ªû APP (DB TR·ªêNG)
                        // Logic: N·∫øu m√°y local ch∆∞a c√≥ d·ªØ li·ªáu g√¨ c·∫£, th√¨ t·∫£i v·ªÅ lu√¥n kh√¥ng c·∫ßn h·ªèi
                        const isLocalEmpty = !db || !db.GASLIFT || Object.keys(db.GASLIFT).length === 0;

                        if (incomingDb) {
                            if (isLocalEmpty) {
                                console.log("T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu ban ƒë·∫ßu...");
                                setDb(incomingDb);
                                if (cloudData.logs) setSystemLogs(cloudData.logs);
                            } else if (incomingDb.lastUpdated) {
                                // N·∫øu m√°y c√≥ d·ªØ li·ªáu r·ªìi th√¨ m·ªõi so s√°nh th·ªùi gian v√† h·ªèi
                                const localTime = db.lastUpdated ? new Date(db.lastUpdated).getTime() : 0;
                                const cloudTime = new Date(incomingDb.lastUpdated).getTime();

                                if (cloudTime > localTime) {
                                    if (window.confirm(`‚òÅÔ∏è C√ì D·ªÆ LI·ªÜU M·ªöI TR√äN CLOUD!\nC·∫≠p nh·∫≠t ngay?`)) {
                                        setDb(incomingDb);
                                        if (cloudData.logs) setSystemLogs(cloudData.logs);
                                    }
                                }
                            }
                        }

                    } catch (err) {
                        console.error("L·ªói ki·ªÉm tra Cloud:", err);
                        // Ch·ªâ hi·ªán alert n·∫øu ng∆∞·ªùi d√πng ƒëang thao t√°c, c√≤n t·ª± ƒë·ªông ch·∫°y th√¨ ch·ªâ log console
                        // ƒë·ªÉ tr√°nh spam th√¥ng b√°o khi m·∫•t m·∫°ng
                    }
                };

                checkCloudData();
            }, []); // Ch·ªâ ch·∫°y 1 l·∫ßn khi m·ªü App
			
            const restoreInputRef = useRef(null);

            // Initialize DB with logic for specific year
            const [db, setDb] = useState(() => initDbForYear(CURRENT_YEAR));

            // Data references
            const gasData = db.GASLIFT[selectedMonth];
            const bcpData = db.BCP[selectedMonth];
            const currentSharedData = db.SHARED[selectedMonth] || { events: [], maintenancePlans: [], shutdownIncidents: [] }; 
            const daysInCurrentMonth = getDaysInMonth(selectedMonth, year);

            // Sync temp states
            useEffect(() => {
                if (!isEditingPlan) {
                    setTempPlanGas({ target: gasData.plan.target, workingDays: gasData.plan.workingDays });
                    setTempPlanBCP({ target: bcpData.plan.target, workingDays: bcpData.plan.workingDays });
                }
                // --- Sync Maint ---
                if (!isEditingMaint) {
                    setTempMaints(currentSharedData.maintenancePlans || []);
                }
                if (!isEditingShutdown) {
                    setTempShutdowns(currentSharedData.shutdownIncidents || []); 
                }
                if (!isEditingEvent) {
                    setTempEvents(currentSharedData.events || []); 
                }
                if (!isEditingActuals) {
                    setTempActualsGas(gasData.actuals || {});
                    setTempActualsNotesGas(gasData.actualsNotes || {});
                    setTempActualsBCP(bcpData.actuals || {});
                    setTempActualsNotesBCP(bcpData.actualsNotes || {});
                }
            }, [selectedMonth, isEditingPlan, isEditingMaint, isEditingShutdown, isEditingEvent, isEditingActuals, gasData, bcpData, currentSharedData]);

            // Auto-save: Depends on [db, year]
            useEffect(() => {
                localStorage.setItem(getStorageKey(year), JSON.stringify(db));
            }, [db, year]);

            // Handler: Change Year
            const handleChangeYear = (offset) => {
                const newYear = year + offset;
                
                // 1. Load d·ªØ li·ªáu c·ªßa nƒÉm m·ªõi
                const newData = initDbForYear(newYear);
                setDb(newData);
                setYear(newYear);
                
                // 2. üëá TH√äM ƒêO·∫†N N√ÄY: C·∫≠p nh·∫≠t lu√¥n ng√†y nh·∫≠p li·ªáu v·ªÅ nƒÉm m·ªõi
                // Gi·ªØ nguy√™n ng√†y/th√°ng, ch·ªâ ƒë·ªïi nƒÉm
                const currentDaily = new Date(dailyDate);
                currentDaily.setFullYear(newYear);
                
                // Ki·ªÉm tra n·∫øu ng√†y ƒë√≥ kh√¥ng t·ªìn t·∫°i (v√≠ d·ª• 29/2 nƒÉm kh√¥ng nhu·∫≠n) th√¨ l√πi v·ªÅ ng√†y 1
                if (isNaN(currentDaily.getTime())) {
                     setDailyDate(`${newYear}-01-01`);
                } else {
                     setDailyDate(currentDaily.toISOString().slice(0, 10));
                }
                // -----------------------------------------------------------
                
                // Reset edit modes to prevent confusion
                setIsEditingPlan(false);
                setIsEditingMaint(false); 
                setIsEditingShutdown(false);
                setIsEditingEvent(false);
                setIsEditingActuals(false);
            };

            const updateMonthData = (system, month, field, value) => {
                setDb(prev => ({
                    ...prev,
                    [system]: {
                        ...prev[system],
                        [month]: {
                            ...prev[system][month],
                            [field]: value
                        }
                    }
                }));
            };
            
            const updateSharedMonthData = (month, field, value) => {
                setDb(prev => ({
                    ...prev,
                    SHARED: {
                        ...prev.SHARED,
                        [month]: {
                            ...prev.SHARED[month],
                            [field]: value
                        }
                    }
                }));
            };

            // --- Sorting Logic for Combined Actuals ---
            const requestActualsSort = (key) => {
                let direction = 'asc';
                if (actualsSortConfig.key === key && actualsSortConfig.direction === 'asc') {
                    direction = 'desc';
                }
                setActualsSortConfig({ key, direction });
            };

            const sortedCombinedActuals = useMemo(() => {
                // Source
                const sGas = isEditingActuals ? tempActualsGas : gasData.actuals;
                const nGas = isEditingActuals ? tempActualsNotesGas : gasData.actualsNotes;
                const sBCP = isEditingActuals ? tempActualsBCP : bcpData.actuals;
                const nBCP = isEditingActuals ? tempActualsNotesBCP : bcpData.actualsNotes;

                const data = Array.from({ length: daysInCurrentMonth }, (_, i) => {
                    const day = i + 1;
                    return { 
                        day, 
                        gasVal: sGas[day], gasNote: nGas?.[day],
                        bcpVal: sBCP[day], bcpNote: nBCP?.[day]
                    };
                });

                return data.sort((a, b) => {
                    if (actualsSortConfig.key === 'day') {
                        return actualsSortConfig.direction === 'asc' ? a.day - b.day : b.day - a.day;
                    } else if (actualsSortConfig.key === 'gasVal') {
                        const vA = a.gasVal || 0; const vB = b.gasVal || 0;
                        return actualsSortConfig.direction === 'asc' ? vA - vB : vB - vA;
                    } else if (actualsSortConfig.key === 'bcpVal') {
                        const vA = a.bcpVal || 0; const vB = b.bcpVal || 0;
                        return actualsSortConfig.direction === 'asc' ? vA - vB : vB - vA;
                    }
                    return 0;
                });
            }, [daysInCurrentMonth, gasData, bcpData, tempActualsGas, tempActualsBCP, isEditingActuals, actualsSortConfig, tempActualsNotesGas, tempActualsNotesBCP]);


			// --- M·ªöI: LOGIC AUTO-SYNC (6 gi√¢y) ---
			useEffect(() => {
				if (!API_URL || !ADMIN_USERS.includes(currentUser)) return;
				if (autoSaveTimerRef.current) clearTimeout(autoSaveTimerRef.current);

				autoSaveTimerRef.current = setTimeout(async () => {
					if (db) {
						try {
							setIsAutoSyncing(true); 
							// console.log("‚è≥ B·∫Øt ƒë·∫ßu Auto-Sync...");

							const payload = {
								action: 'SAVE',
								user: 'AutoSync Bot',
                                year: year, // üëà QUAN TR·ªåNG: TH√äM D√íNG N√ÄY
								db: { ...db, lastUpdated: new Date().toISOString() }
							};
                            

							// G·ªçi API (mode no-cors)
							await fetch(API_URL, {
								method: "POST",
								mode: "no-cors",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify(payload)
							});

							// Ghi log ng·∫ßm (T√πy ch·ªçn: c√≥ th·ªÉ b·ªè qua n·∫øu kh√¥ng mu·ªën spam log file)
							// logToCloud('AutoSave', 'T·ª± ƒë·ªông ƒë·ªìng b·ªô d·ªØ li·ªáu sau thay ƒë·ªïi');

							console.log("‚úÖ Auto-Sync ho√†n t·∫•t.");
						} catch (err) {
							console.error("L·ªói Auto-Sync:", err);
						} finally {
							setIsAutoSyncing(false); // T·∫Øt icon
						}
					}
				}, 5000); // 5000ms = 5 gi√¢y

				// Cleanup khi component unmount
				return () => {
					if (autoSaveTimerRef.current) clearTimeout(autoSaveTimerRef.current);
				};

			}, [db]); // Dependency l√† [db]: B·∫•t c·ª© khi n√†o db thay ƒë·ªïi, logic n√†y s·∫Ω ch·∫°y l·∫°i
			// -------------------------------------

            // --- Handlers ---
            const handleStartEditPlan = () => setIsEditingPlan(true);
            const handleCancelEditPlan = () => {
                setIsEditingPlan(false);
                setTempPlanGas({ target: gasData.plan.target, workingDays: gasData.plan.workingDays });
                setTempPlanBCP({ target: bcpData.plan.target, workingDays: bcpData.plan.workingDays });
            };

            const handleSavePlan = () => {
                if (window.confirm("C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën thay ƒë·ªïi K·∫ø ho·∫°ch s·∫£n l∆∞·ª£ng cho C·∫¢ HAI h·ªá th·ªëng?")) {
                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    
                    // --- ƒêO·∫†N CODE M·ªöI: LOG CHI TI·∫æT S·ª¨A K·∫æ HO·∫†CH ---
                    // ƒê·ªãnh d·∫°ng s·ªë cho d·ªÖ ƒë·ªçc
                    const fmt = (n) => Number(n).toLocaleString('vi-VN');
                    
                    const logMsg = `S·ª≠a K·∫ø ho·∫°ch Th√°ng ${selectedMonth}: ` +
                                   `GASLIFT [M·ª•c ti√™u: ${fmt(tempPlanGas.target)} m3, Ng√†y: ${tempPlanGas.workingDays}] - ` +
                                   `BCP [M·ª•c ti√™u: ${fmt(tempPlanBCP.target)} m3, Ng√†y: ${tempPlanBCP.workingDays}]`;
                                   
                    logToCloud(currentUser, logMsg);
                    // ------------------------------------------------

                    setDb(prev => ({
                        ...prev,
                        GASLIFT: {
                            ...prev.GASLIFT,
                            [selectedMonth]: { ...prev.GASLIFT[selectedMonth], plan: { ...prev.GASLIFT[selectedMonth].plan, target: parseFloat(tempPlanGas.target), workingDays: parseFloat(tempPlanGas.workingDays) } }
                        },
                        BCP: {
                            ...prev.BCP,
                            [selectedMonth]: { ...prev.BCP[selectedMonth], plan: { ...prev.BCP[selectedMonth].plan, target: parseFloat(tempPlanBCP.target), workingDays: parseFloat(tempPlanBCP.workingDays) } }
                        }
                    }));
                    setIsEditingPlan(false);
                }
            };

            // --- MAINTENANCE HANDLERS (UPDATED TO INLINE) ---
            const handleStartEditMaintSection = () => {
                setTempMaints(currentSharedData.maintenancePlans || []);
                setNewMaint({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', maintenanceEquipment: '' });
                setEditingMaintId(null);
                setIsEditingMaint(true);
            };

            const handleAddMaintDirectly = () => {
				const now = new Date().toISOString().slice(0, 16);
				setMaintDetail({
					...initialMaintState,
					plannedStart: now, // Ch·ªâ m·∫∑c ƒë·ªãnh ng√†y cho ph·∫ßn k·∫ø ho·∫°ch
					plannedEnd: now
				});
			};

            const handleAddOrUpdateMaint = () => {
                // ... (gi·ªØ nguy√™n ph·∫ßn ki·ªÉm tra ƒë·∫ßu v√†o c≈©) ...
                if (!newMaint.description || !newMaint.start || !newMaint.end) return alert("Vui l√≤ng nh·∫≠p: M√¥ t·∫£, Ng√†y b·∫Øt ƒë·∫ßu v√† Ng√†y k·∫øt th√∫c.");
                const days = calculateDateDiff(newMaint.start, newMaint.end);
                if (days <= 0) return alert("Th·ªùi gian k·∫øt th√∫c ph·∫£i sau ho·∫∑c b·∫±ng th·ªùi gian b·∫Øt ƒë·∫ßu.");

                const newItem = {
                    id: editingMaintId || Date.now(),
                    description: newMaint.description, start: newMaint.start, end: newMaint.end,
                    days: days, info: newMaint.info, status: newMaint.status || 'Ch∆∞a th·ª±c hi·ªán',
                    performingUnit: newMaint.performingUnit, relatedPlatforms: newMaint.relatedPlatforms,
                    maintenanceEquipment: newMaint.maintenanceEquipment
                };

                let updatedMaints;
                if (editingMaintId) {
                    updatedMaints = currentSharedData.maintenancePlans.map(item => item.id === editingMaintId ? { ...item, ...newItem } : item);
                } else {
                    updatedMaints = [...currentSharedData.maintenancePlans, newItem];
                }

                if (window.confirm(`X√°c nh·∫≠n ${editingMaintId ? "c·∫≠p nh·∫≠t" : "th√™m"} k·∫ø ho·∫°ch b·∫£o d∆∞·ª°ng?`)) {
                    // --- ƒêO·∫†N CODE M·ªöI: GHI LOG CHI TI·∫æT ---
                    const actionType = editingMaintId ? "S·ª≠a B·∫£o d∆∞·ª°ng" : "Th√™m B·∫£o d∆∞·ª°ng";
                    const detailMsg = `${actionType}: ${newItem.description} (${formatDate(newItem.start)} - ${formatDate(newItem.end)}) [${newItem.status}]`;
                    logToCloud(currentUser, detailMsg);
                    // ---------------------------------------

                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    updateSharedMonthData(selectedMonth, 'maintenancePlans', updatedMaints);
                    setEditingMaintId(null);
                    setIsEditingMaint(false); 
                    setNewMaint({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', maintenanceEquipment: '' });
                }
            };

            const handleStartEditMaintItem = (plan) => {
                setNewMaint({
                    description: plan.description, start: plan.start, end: plan.end,
                    info: plan.info || '', status: plan.status || 'Ch∆∞a th·ª±c hi·ªán', performingUnit: plan.performingUnit || '',
                    relatedPlatforms: plan.relatedPlatforms || '', maintenanceEquipment: plan.maintenanceEquipment || ''
                });
                setEditingMaintId(plan.id);
            };
            
            const handleCancelMaintEdit = () => {
                setNewMaint({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', maintenanceEquipment: '' });
                setEditingMaintId(null);
                // setIsEditingMaint(false); // Optional: keep edit mode open
            };

            const handleDeleteMaintItem = (id) => {
                // T√¨m item b·ªã x√≥a ƒë·ªÉ l·∫•y th√¥ng tin ghi log
                const itemToDelete = currentSharedData.maintenancePlans.find(i => i.id === id);
                
                if (window.confirm(`X√°c nh·∫≠n x√≥a k·∫ø ho·∫°ch: ${itemToDelete?.description}?`)) {
                    // --- LOG CHI TI·∫æT ---
                    logToCloud(currentUser, `X√≥a B·∫£o d∆∞·ª°ng: ${itemToDelete?.description} (${formatDate(itemToDelete?.start)})`);
                    // --------------------

                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    const updatedMaints = currentSharedData.maintenancePlans.filter(item => item.id !== id);
                    updateSharedMonthData(selectedMonth, 'maintenancePlans', updatedMaints);
                    if (editingMaintId === id) handleCancelMaintEdit();
                    setIsEditingMaint(false);
                }
            };

			// --- H√ÄM NH√ÇN B·∫¢N B·∫¢O D∆Ø·ª†NG (COPY) - ƒê√É S·ª¨A L·ªñI ---
            const handleDuplicateMaint = (originalItem) => {
                // 1. H·ªèi x√°c nh·∫≠n
                if (!window.confirm(`B·∫°n c√≥ mu·ªën nh√¢n b·∫£n c√¥ng vi·ªác: "${originalItem.description}" kh√¥ng?`)) return;

                // 2. T·∫°o b·∫£n sao m·ªõi (L∆∞u √Ω: d√πng description thay v√¨ task)
                const newItem = {
                    ...originalItem,           
                    id: Date.now(),            // T·∫°o ID m·ªõi
                    description: `${originalItem.description} (Copy)`, // Th√™m ch·ªØ Copy
                    status: 'Ch∆∞a th·ª±c hi·ªán',  // Reset tr·∫°ng th√°i
                    isUnplanned: false,        // M·∫∑c ƒë·ªãnh l√† k·∫ø ho·∫°ch
                    actualHours: 0,            // Reset gi·ªù th·ª±c t·∫ø
                    start: originalItem.start, // Gi·ªØ nguy√™n ng√†y b·∫Øt ƒë·∫ßu d·ª± ki·∫øn
                    end: originalItem.end      // Gi·ªØ nguy√™n ng√†y k·∫øt th√∫c d·ª± ki·∫øn
                };


                // 3. C·∫≠p nh·∫≠t v√†o Database d√πng chung (SHARED DATA)
                setBackupDb(JSON.parse(JSON.stringify(db))); // Backup ƒë·ªÉ undo n·∫øu c·∫ßn

                const updatedMaints = [...(currentSharedData.maintenancePlans || []), newItem];
                updateSharedMonthData(selectedMonth, 'maintenancePlans', updatedMaints);
                
                // Ghi log
                logToCloud(currentUser, `Nh√¢n b·∫£n B·∫£o d∆∞·ª°ng: ${newItem.description}`);
                alert("‚úÖ ƒê√£ nh√¢n b·∫£n th√†nh c√¥ng!");
            };

			// --- H√ÄM COPY K·∫æ HO·∫†CH T·ª™ NƒÇM B·∫§T K·ª≤ (ƒê√É C·∫¨P NH·∫¨T) ---
            const handleCopyFromAnyYear = () => {
                // 1. Ki·ªÉm tra quy·ªÅn
                if (!ADMIN_USERS.includes(currentUser)) return alert("‚õî Ch·ªâ Admin m·ªõi c√≥ quy·ªÅn th·ª±c hi·ªán!");
                
                // 2. H·ªèi ng∆∞·ªùi d√πng mu·ªën copy t·ª´ nƒÉm n√†o
                const defaultSource = year - 1;
                const inputYear = window.prompt(`B·∫°n mu·ªën copy k·∫ø ho·∫°ch Th√°ng ${selectedMonth} t·ª´ nƒÉm n√†o?\n(Nh·∫≠p nƒÉm ngu·ªìn, v√≠ d·ª•: ${defaultSource})`, defaultSource);

                if (inputYear === null) return; // Ng∆∞·ªùi d√πng b·∫•m H·ªßy
                
                const sourceYear = parseInt(inputYear);
                if (isNaN(sourceYear) || sourceYear < 2000 || sourceYear > 3000) {
                    return alert("‚ùå NƒÉm kh√¥ng h·ª£p l·ªá!");
                }

                if (sourceYear === year) {
                    return alert("‚ö†Ô∏è Kh√¥ng th·ªÉ copy t·ª´ ch√≠nh nƒÉm hi·ªán t·∫°i!");
                }

                // 3. L·∫•y d·ªØ li·ªáu NƒÇM NGU·ªíN t·ª´ b·ªô nh·ªõ
                const sourceKey = getStorageKey(sourceYear);
                const sourceDataStr = localStorage.getItem(sourceKey);

                if (!sourceDataStr) {
                    return alert(`‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu c·ªßa nƒÉm ${sourceYear} trong m√°y n√†y!\nVui l√≤ng chuy·ªÉn sang nƒÉm ${sourceYear} v√† t·∫£i d·ªØ li·ªáu v·ªÅ tr∆∞·ªõc.`);
                }

                try {
                    const sourceDb = JSON.parse(sourceDataStr);
                    const sourcePlans = sourceDb?.SHARED?.[selectedMonth]?.maintenancePlans || [];

                    if (sourcePlans.length === 0) {
                        return alert(`‚ö†Ô∏è Th√°ng ${selectedMonth}/${sourceYear} kh√¥ng c√≥ ƒë·∫ßu vi·ªác n√†o ƒë·ªÉ copy.`);
                    }

                    if (!window.confirm(`‚ö†Ô∏è X√ÅC NH·∫¨N:\n\nT√¨m th·∫•y ${sourcePlans.length} c√¥ng vi·ªác trong T${selectedMonth}/${sourceYear}.\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën COPY sang T${selectedMonth}/${year} kh√¥ng?`)) return;

                    // 4. X·ª≠ l√Ω d·ªØ li·ªáu (Chuy·ªÉn nƒÉm, Reset th·ª±c t·∫ø)
                    const copiedPlans = sourcePlans.map(item => {
                        // H√†m ƒë·ªïi nƒÉm gi·ªØ nguy√™n ng√†y gi·ªù
                        const shiftYear = (dateStr) => {
                            if (!dateStr) return "";
                            const d = new Date(dateStr);
                            if (isNaN(d.getTime())) return "";
                            d.setFullYear(year); // G√°n nƒÉm ƒê√çCH (nƒÉm hi·ªán t·∫°i ƒëang ch·ªçn)
                            const offset = d.getTimezoneOffset() * 60000;
                            return new Date(d.getTime() - offset).toISOString().slice(0, 16);
                        };

                        return {
                            id: Date.now() + Math.random(), // T·∫°o ID m·ªõi
                            description: item.description,
                            maintenanceEquipment: item.maintenanceEquipment,
                            performingUnit: item.performingUnit,
                            relatedPlatforms: item.relatedPlatforms,
                            
                            // COPY C√ÅC TR∆Ø·ªúNG D·ª∞ KI·∫æN (Chuy·ªÉn sang nƒÉm hi·ªán t·∫°i)
                            plannedStart: shiftYear(item.plannedStart || item.start), 
                            plannedEnd: shiftYear(item.plannedEnd || item.end),
                            plannedHours: item.plannedHours || 0, 
                            
                            // RESET C√ÅC TR∆Ø·ªúNG TH·ª∞C T·∫æ
                            start: "", 
                            end: "",
                            actualHours: 0,
                            status: 'Ch∆∞a th·ª±c hi·ªán',
                            isUnplanned: false, 
                            info: item.info || "" 
                        };
                    });

                    // 5. L∆∞u v√†o DB hi·ªán t·∫°i
                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    const currentPlans = currentSharedData.maintenancePlans || [];
                    const newPlans = [...currentPlans, ...copiedPlans];
                    
                    updateSharedMonthData(selectedMonth, 'maintenancePlans', newPlans);
                    
                    logToCloud(currentUser, `Copy ${copiedPlans.length} job b·∫£o d∆∞·ª°ng t·ª´ ${sourceYear} sang ${year}`);
                    alert(`‚úÖ ƒê√£ copy xong ${copiedPlans.length} c√¥ng vi·ªác t·ª´ nƒÉm ${sourceYear}!`);

                } catch (err) {
                    console.error(err);
                    alert("L·ªói d·ªØ li·ªáu: " + err.message);
                }
            };

            // --- Shutdown Handlers ---
             const handleStartEditShutdownSection = () => {
                setTempShutdowns(currentSharedData.shutdownIncidents || []);
                setNewShutdown({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a kh·∫Øc ph·ª•c', performingUnit: '', relatedPlatforms: '', eventType: 'S·ª± c·ªë', equipment: '', cause: '' });
                setEditingShutdownId(null);
                setIsEditingShutdown(true);
            };
            // --- H√ÄM M·ªû B·∫¢NG TH√äM M·ªöI S·ª∞ C·ªê (ƒê·ªíNG B·ªò V·ªöI CHI TI·∫æT) ---
			const handleAddShutdownDirectly = () => {
				const now = new Date().toISOString().slice(0, 16);
				setShutdownDetail({
					id: null, // null ƒë·ªÉ h·ªá th·ªëng hi·ªÉu l√† th√™m m·ªõi
					description: '',
					equipment: '',
					performingUnit: 'DGCP',
					relatedPlatforms: '',
					eventType: 'S·ª± c·ªë',
					start: now,
					end: '',
					cause: '',
					info: '',
					status: 'Ch∆∞a kh·∫Øc ph·ª•c'
				});
			};

            const handleAddOrUpdateShutdown = () => {
                // ... (Gi·ªØ nguy√™n logic ki·ªÉm tra input c≈©) ...
                if (!newShutdown.description || !newShutdown.start) return alert("Vui l√≤ng nh·∫≠p: M√¥ t·∫£ v√† Th·ªùi gian b·∫Øt ƒë·∫ßu.");
                
                // ... (Gi·ªØ nguy√™n logic t√≠nh ng√†y) ...
                let days = 0;
                if (newShutdown.end) {
                     days = calculateDateDiff(newShutdown.start, newShutdown.end);
                     if (days <= 0) return alert("Th·ªùi gian k·∫øt th√∫c ph·∫£i sau ho·∫∑c b·∫±ng th·ªùi gian b·∫Øt ƒë·∫ßu.");
                } else {
                     const diffTime = new Date() - new Date(newShutdown.start);
                     const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                     days = diffDays > 0 ? diffDays : 1; 
                }

                 const newItem = {
                    id: editingShutdownId || Date.now(),
                    description: newShutdown.description, start: newShutdown.start, end: newShutdown.end,
                    days: days, info: newShutdown.info, status: newShutdown.status || 'Ch∆∞a kh·∫Øc ph·ª•c',
                    performingUnit: newShutdown.performingUnit, relatedPlatforms: newShutdown.relatedPlatforms,
                    eventType: newShutdown.eventType || 'S·ª± c·ªë', equipment: newShutdown.equipment, cause: newShutdown.cause
                };

                let updatedShutdowns;
                if (editingShutdownId) { updatedShutdowns = currentSharedData.shutdownIncidents.map(item => item.id === editingShutdownId ? { ...item, ...newItem } : item); } 
                else { updatedShutdowns = [...currentSharedData.shutdownIncidents, newItem]; }

                if (window.confirm(`X√°c nh·∫≠n ${editingShutdownId ? "c·∫≠p nh·∫≠t" : "th√™m"} s·ª± c·ªë?`)) {
                    // --- ƒêO·∫†N CODE M·ªöI: GHI LOG CHI TI·∫æT ---
                    const actionType = editingShutdownId ? "S·ª≠a S·ª± c·ªë" : "Th√™m S·ª± c·ªë";
                    const detailMsg = `${actionType}: ${newItem.equipment || 'N/A'} - ${newItem.description} (Tr·∫°ng th√°i: ${newItem.status})`;
                    logToCloud(currentUser, detailMsg);
                    // ---------------------------------------

                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    updateSharedMonthData(selectedMonth, 'shutdownIncidents', updatedShutdowns);
                    setEditingShutdownId(null);
                    setIsEditingShutdown(false);
                    setNewShutdown({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a kh·∫Øc ph·ª•c', performingUnit: '', relatedPlatforms: '', eventType: 'S·ª± c·ªë', equipment: '', cause: '' });
                }
            };

            const handleStartEditShutdownItem = (plan) => {
                setNewShutdown({
                    description: plan.description, start: ensureDateTimeFormat(plan.start), end: ensureDateTimeFormat(plan.end || ''),
                    info: plan.info || '', status: plan.status || 'Ch∆∞a kh·∫Øc ph·ª•c', performingUnit: plan.performingUnit || '',
                    relatedPlatforms: plan.relatedPlatforms || '', eventType: plan.eventType || 'S·ª± c·ªë', equipment: plan.equipment || '', cause: plan.cause || ''
                });
                setEditingShutdownId(plan.id);
            };

            const handleCancelShutdownItemEdit = () => {
                setNewShutdown({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a kh·∫Øc ph·ª•c', performingUnit: '', relatedPlatforms: '', eventType: 'S·ª± c·ªë', equipment: '', cause: '' });
                setEditingShutdownId(null);
            };

            const handleDeleteShutdownItem = (id) => {
                // L·∫•y th√¥ng tin s·ª± c·ªë TR∆Ø·ªöC KHI x√≥a ƒë·ªÉ ghi log
                const itemToDelete = currentSharedData.shutdownIncidents.find(i => i.id === id);
                
                if (window.confirm(`C·∫¢NH B√ÅO: B·∫°n ch·∫Øc ch·∫Øn mu·ªën X√ìA vƒ©nh vi·ªÖn th√¥ng tin s·ª± c·ªë: ${itemToDelete?.description}?`)) {
                    setBackupDb(JSON.parse(JSON.stringify(db)));

                    // --- GHI LOG CHI TI·∫æT ---
                    const logMsg = `X√ìA S·ª± c·ªë: ${itemToDelete?.equipment || 'N/A'} - ${itemToDelete?.description} ` +
                                   `(Kh·ªüi ƒëi·ªÉm: ${formatDate(itemToDelete?.start)})`;
                    
                    logToCloud(currentUser, logMsg);
                    // ------------------------

                    const updatedList = currentSharedData.shutdownIncidents.filter(item => item.id !== id);
                    updateSharedMonthData(selectedMonth, 'shutdownIncidents', updatedList);
                    
                    // N·∫øu ƒëang m·ªü form s·ª≠a th√¨ ƒë√≥ng l·∫°i
                    if (editingShutdownId === id) {
                        setEditingShutdownId(null);
                        setNewShutdown({ description: '', start: '', end: '', info: '', status: 'Ch∆∞a kh·∫Øc ph·ª•c', performingUnit: '', relatedPlatforms: '', eventType: 'S·ª± c·ªë', equipment: '', cause: '' });
                    }
                    setIsEditingShutdown(false);
                }
            };

            // --- Event Handlers ---
            const getEventStatusColor = (status) => {
                switch(status) {
                    case 'ƒêang th·ª±c hi·ªán': return 'bg-blue-100 text-blue-700 border-blue-200';
                    case 'ƒê√£ ho√†n th√†nh': return 'bg-green-100 text-green-700 border-green-200';
                    case 'ƒê√£ kh·∫Øc ph·ª•c': return 'bg-green-100 text-green-700 border-green-200'; 
                    case 'Ch∆∞a kh·∫Øc ph·ª•c': return 'bg-red-100 text-red-700 border-red-200'; 
                    default: return 'bg-gray-100 text-gray-600 border-gray-200';
                }
            };

            const handleStartEditEventSection = () => { setTempEvents(currentSharedData?.events || []); setNewEvent({ name: '', startDate: '', endDate: '', info: '', status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', eventType: 'Kh√°c', equipment: '' }); setEditingEventId(null); setIsEditingEvent(true); };
            
			// --- H√ÄM M·ªû B·∫¢NG TH√äM M·ªöI S·ª∞ KI·ªÜN (ƒê·ªíNG B·ªò V·ªöI B·∫¢NG CHI TI·∫æT) ---
            const handleAddEventDirectly = () => {
                const now = new Date().toISOString().slice(0, 16);
                setEventDetail({
                    id: null, // null ƒë·ªÉ h·ªá th·ªëng hi·ªÉu l√† th√™m m·ªõi
                    name: '',
                    startDate: now,
                    endDate: '',
                    info: '',
                    status: 'Ch∆∞a th·ª±c hi·ªán',
                    eventType: 'Kh√°c',
                    equipment: '',
                    relatedPlatforms: ''
                });
            };
            const handleAddOrUpdateEvent = () => {
                if (!newEvent.name) return alert("Vui l√≤ng nh·∫≠p t√™n s·ª± ki·ªán/n·ªôi dung.");

                const newItem = { 
                    id: editingEventId || Date.now(), 
                    name: newEvent.name, 
                    startDate: newEvent.startDate, 
                    endDate: newEvent.endDate, 
                    info: newEvent.info, 
                    status: newEvent.status || 'Ch∆∞a th·ª±c hi·ªán', 
                    performingUnit: newEvent.performingUnit, 
                    relatedPlatforms: newEvent.relatedPlatforms, 
                    eventType: newEvent.eventType || 'Kh√°c', 
                    equipment: newEvent.equipment || ''
                };

                let updatedEvents;
                if (editingEventId) { 
                    updatedEvents = currentSharedData.events.map(item => item.id === editingEventId ? { ...item, ...newItem } : item); 
                } else { 
                    updatedEvents = [...currentSharedData.events, newItem]; 
                }

                const actionText = editingEventId ? "C·∫≠p nh·∫≠t" : "Th√™m m·ªõi";

                if (window.confirm(`X√°c nh·∫≠n ${actionText.toLowerCase()} s·ª± ki·ªán?`)) {
                    // 1. Ghi l·∫°i b·∫£n sao l∆∞u tr∆∞·ªõc khi thay ƒë·ªïi
                    setBackupDb(JSON.parse(JSON.stringify(db)));

                    // --- 2. B∆Ø·ªöC GHI LOG CHI TI·∫æT ---
                    const logMsg = `${actionText} S·ª± ki·ªán kh√°c: ${newItem.name} ` +
                                   `(Ng√†y: ${newItem.startDate}${newItem.endDate ? ' ƒë·∫øn ' + newItem.endDate : ''}) ` +
                                   `[Tr·∫°ng th√°i: ${newItem.status}] [Lo·∫°i: ${newItem.eventType}]`;
                    
                    logToCloud(currentUser, logMsg);
                    // -------------------------------

                    // 3. C·∫≠p nh·∫≠t d·ªØ li·ªáu v√†o h·ªá th·ªëng
                    updateSharedMonthData(selectedMonth, 'events', updatedEvents); 
                    
                    // 4. Reset tr·∫°ng th√°i giao di·ªán
                    setEditingEventId(null); 
                    setIsEditingEvent(false); 
                    setNewEvent({ 
                        name: '', startDate: '', endDate: '', info: '', 
                        status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', 
                        relatedPlatforms: '', eventType: 'Kh√°c', equipment: '' 
                    });
                }
            };

			
			const handleStartEditEventItem = (ev) => { 
				setNewEvent({ 
					name: ev.name, 
					// Th√™m ensureDateTimeFormat v√†o ƒë√¢y
					startDate: ensureDateTimeFormat(ev.startDate || ev.date), 
					endDate: ensureDateTimeFormat(ev.endDate || ''), 
					info: ev.info || '', 
					status: ev.status || 'Ch∆∞a th·ª±c hi·ªán', 
					performingUnit: ev.performingUnit || '', 
					relatedPlatforms: ev.relatedPlatforms || '', 
					eventType: ev.eventType || 'Kh√°c', 
					equipment: ev.equipment || '' 
				}); 
				setEditingEventId(ev.id); 
			};
            const handleCancelEventItemEdit = () => { setNewEvent({ name: '', startDate: '', endDate: '', info: '', status: 'Ch∆∞a th·ª±c hi·ªán', performingUnit: '', relatedPlatforms: '', eventType: 'Kh√°c', equipment: '' }); setEditingEventId(null); };
            const handleDeleteEventItem = (id) => { if (window.confirm("X√°c nh·∫≠n x√≥a s·ª± ki·ªán n√†y?")) { setBackupDb(JSON.parse(JSON.stringify(db))); const updatedEvents = currentSharedData.events.filter(item => item.id !== id); updateSharedMonthData(selectedMonth, 'events', updatedEvents); if (editingEventId === id) handleCancelEventItemEdit(); setIsEditingEvent(false); } };

            const handleUndo = () => {
                if (backupDb && window.confirm("B·∫°n mu·ªën kh√¥i ph·ª•c l·∫°i d·ªØ li·ªáu tr∆∞·ªõc khi thay ƒë·ªïi g·∫ßn nh·∫•t?")) { setDb(backupDb); setBackupDb(null); alert("ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!"); }
            };

            // --- Handlers for ACTUALS Editing (Dual) ---
            const handleStartEditActuals = () => {
                setTempActualsGas(gasData.actuals || {}); setTempActualsNotesGas(gasData.actualsNotes || {});
                setTempActualsBCP(bcpData.actuals || {}); setTempActualsNotesBCP(bcpData.actualsNotes || {});
                setIsEditingActuals(true);
            };

            const handleCancelEditActuals = () => {
                setIsEditingActuals(false); setTempActualsGas({}); setTempActualsNotesGas({}); setTempActualsBCP({}); setTempActualsNotesBCP({});
            };

            const handleSaveActuals = () => {
                if (window.confirm("X√°c nh·∫≠n c·∫≠p nh·∫≠t S·∫£n l∆∞·ª£ng th·ª±c t·∫ø cho C·∫¢ HAI h·ªá th·ªëng?")) {
                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    
                    // --- ƒêO·∫†N CODE M·ªöI: T·∫†O LOG CHI TI·∫æT ---
                    let logDetails = [];
                    // Ki·ªÉm tra xem ng√†y n√†o c√≥ s·ªë li·ªáu thay ƒë·ªïi trong b·∫£ng t·∫°m (temp)
                    Object.keys(tempActualsGas).forEach(day => {
                        logDetails.push(`Ng√†y ${day}: Gas=${tempActualsGas[day]}m3`);
                    });
                    Object.keys(tempActualsBCP).forEach(day => {
                        // Ch·ªâ log n·∫øu ch∆∞a log ·ªü d√≤ng tr√™n ho·∫∑c mu·ªën log ri√™ng
                        if (!logDetails.some(l => l.includes(`Ng√†y ${day}`))) {
                             logDetails.push(`Ng√†y ${day}: BCP=${tempActualsBCP[day]}m3`);
                        } else {
                             // G·ªôp v√†o d√≤ng log ng√†y ƒë√≥ (ƒë·ªÉ cho g·ªçn)
                             const idx = logDetails.findIndex(l => l.includes(`Ng√†y ${day}`));
                             logDetails[idx] += `, BCP=${tempActualsBCP[day]}m3`;
                        }
                    });

                    // G·ª≠i log chi ti·∫øt l√™n Cloud ngay l·∫≠p t·ª©c
                    if (logDetails.length > 0) {
                        const message = `C·∫≠p nh·∫≠t SL th·ª±c t·∫ø th√°ng ${selectedMonth}: ` + logDetails.join(' | ');
                        logToCloud(currentUser, message);
                    }
                    // ----------------------------------------

                    setDb(prev => ({
                        ...prev,
                        GASLIFT: { ...prev.GASLIFT, [selectedMonth]: { ...prev.GASLIFT[selectedMonth], actuals: tempActualsGas, actualsNotes: tempActualsNotesGas } },
                        BCP: { ...prev.BCP, [selectedMonth]: { ...prev.BCP[selectedMonth], actuals: tempActualsBCP, actualsNotes: tempActualsNotesBCP } }
                    }));
                    setIsEditingActuals(false);
                }
            };

            const updateTempActual = (sys, day, val) => {
                const setter = sys === 'GAS' ? setTempActualsGas : setTempActualsBCP;
                setter(prev => {
                    const next = { ...prev };
                    if (val === "") delete next[day]; else next[day] = parseFloat(val);
                    return next;
                });
            };
            const updateTempNote = (sys, day, val) => {
                const setter = sys === 'GAS' ? setTempActualsNotesGas : setTempActualsNotesBCP;
                setter(prev => {
                    const next = { ...prev };
                    if (val === "") delete next[day]; else next[day] = val;
                    return next;
                });
            };

            // --- Day Detail Modal Handlers ---
            const openDayDetail = (item) => {
                setDayDetail({
                    day: item.day,
                    gasVal: isEditingActuals ? (tempActualsGas[item.day] ?? '') : (gasData.actuals[item.day] ?? ''),
                    gasNote: isEditingActuals ? (tempActualsNotesGas[item.day] || '') : (gasData.actualsNotes?.[item.day] || ''),
                    bcpVal: isEditingActuals ? (tempActualsBCP[item.day] ?? '') : (bcpData.actuals[item.day] ?? ''),
                    bcpNote: isEditingActuals ? (tempActualsNotesBCP[item.day] || '') : (bcpData.actualsNotes?.[item.day] || '')
                });
            };
            const closeDayDetail = () => setDayDetail(null);
            // --- H√ÄM L∆ØU CHI TI·∫æT S·∫¢N L∆Ø·ª¢NG NG√ÄY (C√ì LOG) ---
            const saveDayDetail = () => {
                const { day, gasVal, gasNote, bcpVal, bcpNote } = dayDetail;
                
                if (isEditingActuals) {
                    // N·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô "C·∫≠p nh·∫≠t s·ªë li·ªáu" (s·ª≠a c·∫£ b·∫£ng), 
                    // ta ch·ªâ c·∫≠p nh·∫≠t v√†o tr·∫°ng th√°i t·∫°m th·ªùi, Log s·∫Ω ƒë∆∞·ª£c ghi khi b·∫•m "L∆∞u t·∫•t c·∫£".
                    updateTempActual('GAS', day, gasVal); updateTempNote('GAS', day, gasNote);
                    updateTempActual('BCP', day, bcpVal); updateTempNote('BCP', day, bcpNote);
                    closeDayDetail();
                } else {
                    // CH·∫æ ƒê·ªò S·ª¨A L·∫∫ T·ª™NG NG√ÄY: Ghi log v√† l∆∞u tr·ª±c ti·∫øp
                    if(window.confirm(`X√°c nh·∫≠n c·∫≠p nh·∫≠t d·ªØ li·ªáu ng√†y ${day}/${selectedMonth} cho c·∫£ 2 h·ªá th·ªëng?`)) {
                        setBackupDb(JSON.parse(JSON.stringify(db)));
                        
                        // --- B∆Ø·ªöC GHI LOG CHI TI·∫æT ---
                        const logMsg = `S·ª≠a SL th·ª±c t·∫ø ng√†y ${day}/${selectedMonth}: ` +
                                       `Gas=${gasVal || 0} m3 (${gasNote || 'Kh√¥ng ghi ch√∫'}) | ` +
                                       `BCP=${bcpVal || 0} m3 (${bcpNote || 'Kh√¥ng ghi ch√∫'})`;
                        
                        logToCloud(currentUser, logMsg);
                        // -----------------------------

                        const newGas = { ...gasData.actuals }; 
                        if(gasVal === '') delete newGas[day]; else newGas[day] = parseFloat(gasVal);
                        
                        const newGasNote = { ...gasData.actualsNotes }; 
                        if(!gasNote) delete newGasNote[day]; else newGasNote[day] = gasNote;
                        
                        const newBCP = { ...bcpData.actuals }; 
                        if(bcpVal === '') delete newBCP[day]; else newBCP[day] = parseFloat(bcpVal);
                        
                        const newBCPNote = { ...bcpData.actualsNotes }; 
                        if(!bcpNote) delete newBCPNote[day]; else newBCPNote[day] = bcpNote;
                        
                        setDb(prev => ({
                            ...prev,
                            GASLIFT: { ...prev.GASLIFT, [selectedMonth]: { ...prev.GASLIFT[selectedMonth], actuals: newGas, actualsNotes: newGasNote } },
                            BCP: { ...prev.BCP, [selectedMonth]: { ...prev.BCP[selectedMonth], actuals: newBCP, actualsNotes: newBCPNote } }
                        }));
                        
                        closeDayDetail();
                    }
                }
            };

            // --- Modals for Plans/Maint/Shutdown/Event ---
            const openMaintDetail = (plan) => { 
                setMaintDetail({ 
                    ...plan, 
                    // Th√™m ensureDateTimeFormat ƒë·ªÉ ƒë·∫£m b·∫£o c√≥ gi·ªù ph√∫t khi m·ªü l√™n
                    start: ensureDateTimeFormat(plan.start),
                    end: ensureDateTimeFormat(plan.end || ''),
                    status: plan.status || 'Ch∆∞a th·ª±c hi·ªán', 
                    isNew: false 
                }); 
            };
			
            const closeMaintDetail = () => setMaintDetail(null);
            
			

            const openShutdownDetail = (plan) => {
                setShutdownDetail({ ...plan, start: ensureDateTimeFormat(plan.start), end: ensureDateTimeFormat(plan.end || ''), equipment: plan.equipment || '', cause: plan.cause || '', eventType: plan.eventType || 'S·ª± c·ªë', status: plan.status || 'Ch∆∞a kh·∫Øc ph·ª•c' });
            };
            const closeShutdownDetail = () => setShutdownDetail(null);
            
			

            // --- H√ÄM X√ìA S·ª∞ C·ªê T·ª™ TRONG MODAL CHI TI·∫æT ---
            const deleteShutdownFromDetail = () => {
                // 1. L·∫•y d·ªØ li·ªáu t·ª´ state ƒëang m·ªü trong Modal
                const item = shutdownDetail;
                if (!item || !item.id) return;

                if (window.confirm(`C·∫¢NH B√ÅO: B·∫°n ch·∫Øc ch·∫Øn mu·ªën X√ìA vƒ©nh vi·ªÖn th√¥ng tin s·ª± c·ªë: ${item.description}?`)) {
                    // 2. GHI LOG CHI TI·∫æT
                    const logMsg = `X√ìA S·ª± c·ªë (t·ª´ Modal): ${item.equipment || 'N/A'} - ${item.description} ` +
                                   `(Kh·ªüi ƒëi·ªÉm: ${formatDate(item.start)})`;
                    logToCloud(currentUser, logMsg);

                    // 3. TH·ª∞C HI·ªÜN X√ìA TRONG DATABASE
                    setBackupDb(JSON.parse(JSON.stringify(db)));
                    const updatedList = currentSharedData.shutdownIncidents.filter(i => i.id !== item.id);
                    updateSharedMonthData(selectedMonth, 'shutdownIncidents', updatedList);
                    
                    // 4. ƒê√ìNG MODAL
                    closeShutdownDetail();
                }
            };

            // --- C·∫¨P NH·∫¨T: M·ªü Modal S·ª± ki·ªán (Convert sang DateTime) ---
            const openEventDetail = (ev) => { 
				setEventDetail({ 
					...ev, 
					// Quan tr·ªçng: Convert ƒë·ªÉ hi·ªán gi·ªù ph√∫t trong input datetime-local
					startDate: ensureDateTimeFormat(ev.startDate || ev.date), 
					endDate: ensureDateTimeFormat(ev.endDate || ''), 
					equipment: ev.equipment || '' 
				}); 
			};
			
            const closeEventDetail = () => setEventDetail(null);
            
			// 2. H√ÄM L∆ØU K·∫æ HO·∫†CH B·∫¢O D∆Ø·ª†NG
			const saveMaintDetail = () => {
				if (!maintDetail.description) return alert("Vui l√≤ng nh·∫≠p m√¥ t·∫£ c√¥ng vi·ªác");

				// 1. Chu·∫©n b·ªã d·ªØ li·ªáu v√† t·ª± ƒë·ªông √©p tr·∫°ng th√°i theo th·ªùi gian th·ª±c t·∫ø
				const updatedPlan = {
					...maintDetail,
					plannedHours: parseFloat(maintDetail.plannedHours || 0),
					// T·ª± ƒë·ªông t√≠nh s·ªë gi·ªù th·ª±c t·∫ø d·ª±a tr√™n start/end th·ª±c t·∫ø tr∆∞·ªõc khi l∆∞u
					actualHours: parseFloat(autoCalculateHours(maintDetail.start, maintDetail.end)),
					plannedStart: maintDetail.plannedStart || maintDetail.start,
					plannedEnd: maintDetail.plannedEnd || maintDetail.end,
					// √âp tr·∫°ng th√°i theo th·ªùi gian th·ª±c t·∫ø (Ch∆∞a th·ª±c hi·ªán/ƒêang th·ª±c hi·ªán/ƒê√£ ho√†n th√†nh)
					status: autoDetermineStatus(maintDetail.start, maintDetail.end),
					updatedAt: new Date().toISOString()
				};

				const confirmMsg = updatedPlan.isNew 
					? "X√°c nh·∫≠n th√™m m·ªõi k·∫ø ho·∫°ch b·∫£o d∆∞·ª°ng?" 
					: "X√°c nh·∫≠n c·∫≠p nh·∫≠t v√† ƒê·ªíNG B·ªò tr·∫°ng th√°i c√¥ng vi·ªác n√†y cho t·∫•t c·∫£ c√°c th√°ng li√™n quan?";

				if (window.confirm(confirmMsg)) {
					setBackupDb(JSON.parse(JSON.stringify(db)));

					setDb(prev => {
						const newDb = { ...prev };
						const targetDesc = updatedPlan.description;
						const targetEquip = updatedPlan.maintenanceEquipment;

						// --- LOGIC: ƒê·ªíNG B·ªò XUY√äN TH√ÅNG ---
						// Duy·ªát qua 12 th√°ng ƒë·ªÉ t√¨m c√°c b·∫£n sao c·ªßa c√¥ng vi·ªác n√†y (t·∫°o ra do chuy·ªÉn t·ªìn ƒë·ªçng)
						for (let m = 1; m <= 12; m++) {
							if (newDb.SHARED[m] && newDb.SHARED[m].maintenancePlans) {
								newDb.SHARED[m].maintenancePlans = newDb.SHARED[m].maintenancePlans.map(item => {
									// N·∫øu tr√πng M√¥ t·∫£ v√† Thi·∫øt b·ªã d·ª´ng (ƒë·ªãnh danh c√¥ng vi·ªác k√©o d√†i)
									if (item.description === targetDesc && item.maintenanceEquipment === targetEquip) {
										return { 
											...item, 
											start: updatedPlan.start,   // ƒê·ªìng b·ªô ng√†y b·∫Øt ƒë·∫ßu th·ª±c t·∫ø
											end: updatedPlan.end,       // ƒê·ªìng b·ªô ng√†y k·∫øt th√∫c th·ª±c t·∫ø
											status: updatedPlan.status, // ƒê·ªìng b·ªô tr·∫°ng th√°i
											actualHours: updatedPlan.actualHours,
											performingUnit: updatedPlan.performingUnit,
											info: updatedPlan.info
										};
									}
									return item;
								});
							}
						}

						// --- LOGIC: X·ª¨ L√ù TH√äM M·ªöI (N·∫øu l√† record m·ªõi ho√†n to√†n) ---
						if (updatedPlan.isNew) {
							const newId = Date.now();
							const cleanPlan = { ...updatedPlan, id: newId, isNew: undefined };
							
							if (!newDb.SHARED[selectedMonth]) {
								newDb.SHARED[selectedMonth] = { maintenancePlans: [], shutdownIncidents: [], events: [] };
							}
							
							// Ki·ªÉm tra tr√°nh tr√πng l·∫∑p trong ch√≠nh th√°ng hi·ªán t·∫°i
							const exists = newDb.SHARED[selectedMonth].maintenancePlans.some(p => p.description === targetDesc);
							if (!exists) {
								newDb.SHARED[selectedMonth].maintenancePlans = [...newDb.SHARED[selectedMonth].maintenancePlans, cleanPlan];
							}
						}

						return newDb;
					});

					logToCloud(currentUser, `${updatedPlan.isNew ? 'Th√™m m·ªõi' : 'C·∫≠p nh·∫≠t & ƒê·ªìng b·ªô'} B·∫£o d∆∞·ª°ng: ${updatedPlan.description}`);
					closeMaintDetail();
					alert("‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√† ƒë·ªìng b·ªô h√≥a th√†nh c√¥ng!");
				}
			};
			
			// 2. H√ÄM L∆ØU S·ª∞ C·ªê CHI TI·∫æT
			const saveShutdownDetail = () => {
				if (!shutdownDetail.description) return alert("Vui l√≤ng nh·∫≠p m√¥ t·∫£");

				const updatedPlan = { ...shutdownDetail };
				// 1. T·ª± ƒë·ªông x√°c ƒë·ªãnh tr·∫°ng th√°i d·ª±a tr√™n th·ªùi gian th·ª±c t·∫ø
				updatedPlan.status = autoDetermineStatus(updatedPlan.start, updatedPlan.end, true);

				if (window.confirm(`H·ªá th·ªëng s·∫Ω c·∫≠p nh·∫≠t tr·∫°ng th√°i [${updatedPlan.status.toUpperCase()}] cho s·ª± c·ªë n√†y ·ªü T·∫§T C·∫¢ c√°c th√°ng li√™n quan. X√°c nh·∫≠n?`)) {
					setBackupDb(JSON.parse(JSON.stringify(db)));

					setDb(prev => {
						const newDb = { ...prev };
						// L·∫•y n·ªôi dung v√† thi·∫øt b·ªã ƒë·ªÉ l√†m ƒë·ªãnh danh t√¨m ki·∫øm xuy√™n th√°ng
						const targetDesc = updatedPlan.description;
						const targetEquip = updatedPlan.equipment;

						// 2. V√≤ng l·∫∑p qu√©t qua t·∫•t c·∫£ 12 th√°ng trong Database
						for (let m = 1; m <= 12; m++) {
							if (newDb.SHARED[m] && newDb.SHARED[m].shutdownIncidents) {
								newDb.SHARED[m].shutdownIncidents = newDb.SHARED[m].shutdownIncidents.map(item => {
									// N·∫øu t√¨m th·∫•y s·ª± c·ªë tr√πng M√¥ t·∫£ v√† Thi·∫øt b·ªã ·ªü b·∫•t k·ª≥ th√°ng n√†o
									if (item.description === targetDesc && item.equipment === targetEquip) {
										return { 
											...item, 
											end: updatedPlan.end, // C·∫≠p nh·∫≠t ng√†y k·∫øt th√∫c
											status: updatedPlan.status, // C·∫≠p nh·∫≠t tr·∫°ng th√°i
											info: updatedPlan.info, // ƒê·ªìng b·ªô ghi ch√∫
											cause: updatedPlan.cause // ƒê·ªìng b·ªô nguy√™n nh√¢n
										};
									}
									return item;
								});
							}
						}
						return newDb;
					});

					logToCloud(currentUser, `ƒê·ªìng b·ªô s·ª± c·ªë xuy√™n th√°ng: ${updatedPlan.description}`);
					closeShutdownDetail();
					alert("‚úÖ ƒê√£ ƒë·ªìng b·ªô tr·∫°ng th√°i k·∫øt th√∫c cho c√°c th√°ng li√™n quan!");
				}
			};
			
			// 3. H√ÄM L∆ØU CHI TI·∫æT S·ª∞ KI·ªÜN (ƒê·ªíNG B·ªò XUY√äN TH√ÅNG & T·ª∞ ƒê·ªòNG TR·∫†NG TH√ÅI)
			const saveEventDetail = () => {
				if (!eventDetail.name) return alert("Vui l√≤ng nh·∫≠p t√™n s·ª± ki·ªán.");

				// 1. T·∫°o ƒë·ªëi t∆∞·ª£ng c·∫≠p nh·∫≠t v√† t·ª± ƒë·ªông x√°c ƒë·ªãnh tr·∫°ng th√°i theo th·ªùi gian th·ª±c t·∫ø
				const updatedEvent = { 
					...eventDetail,
					status: autoDetermineStatus(eventDetail.startDate, eventDetail.endDate)
				};

					const confirmMsg = updatedEvent.id 
						? `X√°c nh·∫≠n c·∫≠p nh·∫≠t s·ª± ki·ªán n√†y? (H·ªá th·ªëng s·∫Ω ƒë·ªìng b·ªô tr·∫°ng th√°i k·∫øt th√∫c cho c√°c th√°ng li√™n quan n·∫øu c√≥)`
						: `X√°c nh·∫≠n th√™m m·ªõi s·ª± ki·ªán n√†y?`;

					if (window.confirm(confirmMsg)) {
						setBackupDb(JSON.parse(JSON.stringify(db)));

						setDb(prev => {
							const newDb = { ...prev };
							const targetName = updatedEvent.name;
							const targetEquip = updatedEvent.equipment;

							// --- LOGIC 1: ƒê·ªíNG B·ªò XUY√äN TH√ÅNG (Cho c√°c s·ª± ki·ªán k√©o d√†i) ---
							// Duy·ªát qua t·∫•t c·∫£ 12 th√°ng ƒë·ªÉ t√¨m c√°c b·∫£n sao c·ªßa s·ª± ki·ªán n√†y
							for (let m = 1; m <= 12; m++) {
								if (newDb.SHARED[m] && newDb.SHARED[m].events) {
									newDb.SHARED[m].events = newDb.SHARED[m].events.map(ev => {
										// N·∫øu tr√πng t√™n v√† thi·∫øt b·ªã (ƒë·ªãnh danh s·ª± ki·ªán k√©o d√†i)
										if (ev.name === targetName && ev.equipment === targetEquip) {
											return { 
												...ev, 
												endDate: updatedEvent.endDate, // ƒê·ªìng b·ªô ng√†y k·∫øt th√∫c th·ª±c t·∫ø
												status: updatedEvent.status,   // ƒê·ªìng b·ªô tr·∫°ng th√°i m·ªõi nh·∫•t
												info: updatedEvent.info,       // ƒê·ªìng b·ªô ghi ch√∫
												eventType: updatedEvent.eventType,
												relatedPlatforms: updatedEvent.relatedPlatforms
											};
										}
										return ev;
									});
								}
							}

							// --- LOGIC 2: X·ª¨ L√ù TH√äM M·ªöI V√ÄO TH√ÅNG HI·ªÜN T·∫†I ---
							// N·∫øu l√† th√™m m·ªõi (id === null), ƒë·ªëi t∆∞·ª£ng ch∆∞a t·ªìn t·∫°i trong m·∫£ng c·ªßa th√°ng hi·ªán t·∫°i sau l·ªánh map ·ªü tr√™n
							if (updatedEvent.id === null) {
								updatedEvent.id = Date.now(); // T·∫°o ID duy nh·∫•t
								if (!newDb.SHARED[selectedMonth]) {
									newDb.SHARED[selectedMonth] = { events: [], maintenancePlans: [], shutdownIncidents: [] };
								}
								newDb.SHARED[selectedMonth].events = [...newDb.SHARED[selectedMonth].events, updatedEvent];
							}

							return newDb;
						});

						// 3. Ghi log v√† ƒë√≥ng Modal
						const logAction = updatedEvent.id ? "C·∫≠p nh·∫≠t" : "Th√™m m·ªõi";
						logToCloud(currentUser, `${logAction} S·ª± ki·ªán: ${updatedEvent.name} [Tr·∫°ng th√°i: ${updatedEvent.status}]`);
						
						closeEventDetail();
						alert("‚úÖ ƒê√£ l∆∞u v√† ƒë·ªìng b·ªô d·ªØ li·ªáu s·ª± ki·ªán th√†nh c√¥ng!");
					}
				};

            // 2. H√ÄM X√ìA S·ª∞ KI·ªÜN T·ª™ MODAL (C√ì LOG)
            const deleteEventFromDetail = () => {
                const item = eventDetail;
                if (!item || !item.id) return;

                if(window.confirm(`X√°c nh·∫≠n X√ìA vƒ©nh vi·ªÖn s·ª± ki·ªán: ${item.name}?`)) {
                    setBackupDb(JSON.parse(JSON.stringify(db)));

                    // --- GHI LOG CHI TI·∫æT ---
                    logToCloud(currentUser, `X√ìA S·ª± ki·ªán (t·ª´ Modal): ${item.name} (Ng√†y: ${formatDate(item.startDate)})`);
                    // ------------------------

                    const updated = currentSharedData.events.filter(i => i.id !== item.id);
                    updateSharedMonthData(selectedMonth, 'events', updated);
                    closeEventDetail();
                }
            };

            const handleReportItemDoubleClick = (item) => {
                if (item.month && item.month !== selectedMonth) setSelectedMonth(item.month);
                if (item.type === 'S·ª± ki·ªán chung') openEventDetail(item);
                else if (item.type === 'B·∫£o d∆∞·ª°ng') openMaintDetail(item);
                else if (item.type === 'S·ª± c·ªë d·ª´ng m√°y') openShutdownDetail(item);
            };

            // --- Calculation Helpers ---
            const calculateMetrics = (systemKey) => {
                const sData = db[systemKey][selectedMonth];
                const planTarget = parseFloat(sData.plan.target) || 0;
                const actualValues = Object.values(sData.actuals);
                const accumulated = actualValues.reduce((sum, val) => sum + (parseFloat(val) || 0), 0);
                const daysPassed = Object.keys(sData.actuals).length;
                const remainingTarget = Math.max(0, planTarget - accumulated);
                const daysRemainingCount = Math.max(0, daysInCurrentMonth - daysPassed);
                const dailyRequired = daysRemainingCount > 0 ? remainingTarget / daysRemainingCount : 0;
                const hourlyRequired = dailyRequired / 24;
                const percentComplete = planTarget > 0 ? (accumulated / planTarget) * 100 : 0;
                const maintenancePlans = currentSharedData.maintenancePlans || []; 
                const totalMaintenanceDays = maintenancePlans.reduce((sum, plan) => sum + (plan.days || 0), 0);
                
                // Get today's value
                const d = new Date();
                const dDate = d.getDate();
                const dMonth = d.getMonth() + 1;
                const dYear = d.getFullYear();
                let todayVal = 0;
                if (dYear === year && dMonth === selectedMonth) todayVal = sData.actuals[dDate] || 0;

                return { accumulated, remainingTarget, daysRemainingCount, dailyRequired, hourlyRequired, percentComplete, totalMaintenanceDays, todayVal };
            };

            const gasMetrics = useMemo(() => calculateMetrics('GASLIFT'), [db, selectedMonth, year]);
            const bcpMetrics = useMemo(() => calculateMetrics('BCP'), [db, selectedMonth, year]);

            // --- New Daily Required Calculation ---
            const calcDailyReq = (metrics, maintInput) => {
                const remainingWorkingDays = Math.max(0, metrics.daysRemainingCount - maintInput);
                const required = remainingWorkingDays > 0 ? metrics.remainingTarget / remainingWorkingDays : 0;
                return { remainingWorkingDays, required };
            };

            const gasDailyReq = useMemo(() => calcDailyReq(gasMetrics, gasMaintInput), [gasMetrics, gasMaintInput]);
            const bcpDailyReq = useMemo(() => calcDailyReq(bcpMetrics, bcpMaintInput), [bcpMetrics, bcpMaintInput]);


            const calcEod = (forecastState, dailyTarget) => {
                const acc = parseFloat(forecastState.accumulated);
                const currRate = parseFloat(forecastState.currentRate) || 0; 
                if (isNaN(acc) || !forecastState.time) return null;
                const inputTime = new Date(forecastState.time);
                let targetTime = new Date(inputTime); targetTime.setHours(17, 0, 0, 0);
                if (inputTime >= targetTime) targetTime.setDate(targetTime.getDate() + 1);
                const diffMs = targetTime - inputTime;
                const diffHours = diffMs / (1000 * 60 * 60);
                if (diffHours <= 0) return null;
                
                const targetVol = dailyTarget; 
                const remainingVol = Math.max(0, targetVol - acc);
                const hourlyRate = remainingVol / diffHours;
                const projectedTotal = acc + (currRate * diffHours);
                const percent = targetVol > 0 ? (projectedTotal / targetVol) * 100 : 0;
                
                return { targetVol, remainingVol, diffHours, hourlyRate, projectedTotal, percent, targetTimeStr: `${targetTime.getDate()}/${targetTime.getMonth()+1} ${targetTime.getHours()}:00` };
            };

            const gasEod = useMemo(() => calcEod(eodForecastGas, gasDailyReq.required), [eodForecastGas, gasDailyReq.required]);
            const bcpEod = useMemo(() => calcEod(eodForecastBCP, bcpDailyReq.required), [eodForecastBCP, bcpDailyReq.required]);

            // New helper for Year Data (UPDATED for Long Term Forecast)
            const calcYearlyData = (systemKey, currentMonth, currentMonthForecast) => {
                let pastActuals = 0;
                let futurePlan = 0;
                let totalYearPlan = 0;

                MONTHS.forEach(m => {
                    const mData = db[systemKey][m];
                    const mTarget = parseFloat(mData.plan.target) || 0;
                    totalYearPlan += mTarget;

                    if (m < currentMonth) {
                        const mActual = Object.values(mData.actuals).reduce((a, b) => a + (b || 0), 0);
                        pastActuals += mActual;
                    } else if (m > currentMonth) {
                        futurePlan += mTarget;
                    }
                });

                const totalYearForecast = pastActuals + currentMonthForecast + futurePlan;
                const totalYearPercent = totalYearPlan > 0 ? (totalYearForecast / totalYearPlan) * 100 : 0;

                return { totalYearForecast, totalYearPercent, totalYearPlan };
            };

            // Updated calcLongTerm to include EOM and EOY
            const calcLongTerm = (forecastState, sysMetrics, sysData, maintInput, systemKey) => {
                const repDaily = parseFloat(forecastState.representativeDaily);
                if (isNaN(repDaily)) return null;

                // EOM Calculation
                const remainingDays = Math.max(0, sysMetrics.daysRemainingCount - maintInput);
                const expectedMonthTotal = sysMetrics.accumulated + (repDaily * remainingDays);
                const expectedMonthPercent = sysData.plan.target > 0 ? (expectedMonthTotal / sysData.plan.target) * 100 : 0;

                // EOY Calculation
                const { totalYearForecast, totalYearPercent } = calcYearlyData(systemKey, selectedMonth, expectedMonthTotal);

                return { 
                    expectedMonthTotal, expectedMonthPercent, 
                    totalYearForecast, totalYearPercent,
                    remainingDaysUsed: remainingDays
                };
            };

            const gasLongTerm = useMemo(() => calcLongTerm(eomForecastGas, gasMetrics, gasData, gasMaintInput, 'GASLIFT'), [eomForecastGas, gasMetrics, gasData, gasMaintInput, db]);
            const bcpLongTerm = useMemo(() => calcLongTerm(eomForecastBCP, bcpMetrics, bcpData, bcpMaintInput, 'BCP'), [eomForecastBCP, bcpMetrics, bcpData, bcpMaintInput, db]);

			
			// --- H√ÄM T√çNH TO√ÅN GI·ªú CH·∫†Y (C·∫¨P NH·∫¨T: TH√äM GAP CH√äNH L·ªÜCH) ---
			const calcEquipmentRunHours = (month, currentSharedData) => {
				try {
					const EQUIPMENT_LIST = ['GTC-A', 'GTC-B', 'BCP-DGCP', 'GTG'];
					const selectedYear = new Date().getFullYear();
					
					// M·ªëc th·ªùi gian
					const now = new Date();
					const startOfMonth = new Date(selectedYear, month - 1, 1);
					const endOfMonth = new Date(selectedYear, month, 0, 23, 59, 59);
					const totalMonthHours = (new Date(selectedYear, month, 0).getDate()) * 24;

					// Gi·ªù l·ªãch ƒë√£ tr√¥i qua
					let hoursPassed = 0;
					const currentMonthIndex = now.getMonth() + 1;
					if (selectedYear === now.getFullYear() && month === currentMonthIndex) {
						hoursPassed = Math.max(0, (now - startOfMonth) / (1000 * 60 * 60));
					} else if (new Date(selectedYear, month - 1, 1) < now) {
						hoursPassed = totalMonthHours; // Th√°ng qu√° kh·ª©
					}

					const hoursRemaining = Math.max(0, totalMonthHours - hoursPassed);
					const stats = {};

					// H√†m t√≠nh giao nhau
					const getOverlap = (start, end, limitStart, limitEnd) => {
						const s = Math.max(start, limitStart);
						const e = Math.min(end, limitEnd);
						if (e <= s) return 0;
						return (e - s) / (1000 * 60 * 60);
					};

					EQUIPMENT_LIST.forEach(eq => {
						const plans = (currentSharedData?.maintenancePlans || []).filter(i => i.maintenanceEquipment === eq);
						const scheduledMaints = plans.filter(p => !p.isUnplanned);
						const breakdowns = plans.filter(p => p.isUnplanned === true);

						// --- 1. T√çNH T·ªîNG GI·ªú CH·∫†Y THEO K·∫æ HO·∫†CH (BASELINE) ---
						let totalPlannedMaint = 0;
						scheduledMaints.forEach(m => {
							if (m.plannedStart && m.plannedEnd) {
								 totalPlannedMaint += getOverlap(new Date(m.plannedStart).getTime(), new Date(m.plannedEnd).getTime(), startOfMonth.getTime(), endOfMonth.getTime());
							}
						});
						// ƒê√¢y l√† con s·ªë m·ª•c ti√™u: T·ªïng gi·ªù th√°ng - T·ªïng gi·ªù BD theo k·∫ø ho·∫°ch
						const plannedRunTotal = Math.max(0, totalMonthHours - totalPlannedMaint);

						// --- 2. T√çNH HI·ªÜN T·∫†I (CURRENT) ---
						let maintDownSoFar = 0;
						let breakdownSoFar = 0;

						scheduledMaints.forEach(m => {
							// ∆Øu ti√™n l·∫•y gi·ªù th·ª±c t·∫ø (start/end), n·∫øu ch∆∞a c√≥ th√¨ l·∫•y planned
							const s = m.start ? new Date(m.start).getTime() : new Date(m.plannedStart).getTime();
							const e = m.end ? new Date(m.end).getTime() : new Date(m.plannedEnd).getTime();
							maintDownSoFar += getOverlap(s, e, startOfMonth.getTime(), now.getTime());
						});

						breakdowns.forEach(b => {
							if (b.start) {
								const endTime = b.end ? new Date(b.end).getTime() : now.getTime();
								breakdownSoFar += getOverlap(new Date(b.start).getTime(), endTime, startOfMonth.getTime(), now.getTime());
							}
						});

						const runSoFar = Math.max(0, hoursPassed - maintDownSoFar - breakdownSoFar);

						// --- 3. T√çNH D·ª∞ B√ÅO CU·ªêI TH√ÅNG (FORECAST) ---
						let maintRemaining = 0;
						scheduledMaints.forEach(m => {
							// T√≠nh ph·∫ßn k·∫ø ho·∫°ch n·∫±m trong t∆∞∆°ng lai
							if (m.plannedStart && m.plannedEnd) {
								maintRemaining += getOverlap(new Date(m.plannedStart).getTime(), new Date(m.plannedEnd).getTime(), now.getTime(), endOfMonth.getTime());
							}
						});

						const futureRun = Math.max(0, hoursRemaining - maintRemaining);
						const runForecast = runSoFar + futureRun;

						// --- 4. T√çNH CH√äNH L·ªÜCH (GAP) ---
						// Gap = Th·ª±c t·∫ø d·ª± b√°o - K·∫ø ho·∫°ch ban ƒë·∫ßu
						const gap = runForecast - plannedRunTotal;

						stats[eq] = {
							plannedRunTotal: plannedRunTotal.toFixed(1),
							maintDownSoFar: maintDownSoFar.toFixed(1),
							breakdownSoFar: breakdownSoFar.toFixed(1),
							runSoFar: runSoFar.toFixed(1),
							maintRemaining: maintRemaining.toFixed(1),
							runForecast: runForecast.toFixed(1),
							gap: gap.toFixed(1) // <--- Bi·∫øn m·ªõi
						};
					});

					return stats;
				} catch (error) {
					console.error("Calculation Error:", error);
					return {};
				}
			};

            // T√≠nh to√°n d·ªØ li·ªáu cho Dashboard hi·ªán t·∫°i
            const equipStats = useMemo(() => calcEquipmentRunHours(selectedMonth, currentSharedData), [selectedMonth, year, currentSharedData, currentTime]);
			
			// --- M·ªöI: T√çNH T·ªîNG TH·ª∞C T·∫æ NƒÇM (YEAR TO DATE) ---
            const calcYearTotal = (sysKey) => {
                return MONTHS.reduce((total, m) => {
                    const mData = db[sysKey][m];
                    const mActual = Object.values(mData.actuals || {}).reduce((sum, val) => sum + (parseFloat(val) || 0), 0);
                    return total + mActual;
                }, 0);
            };

			// --- M·ªöI: T√çNH T·ªîNG K·∫æ HO·∫†CH NƒÇM ---
						const calcYearPlanTotal = (sysKey) => {
							return MONTHS.reduce((total, m) => {
								const mData = db[sysKey][m];
								const mTarget = parseFloat(mData.plan.target) || 0;
								return total + mTarget;
							}, 0);
						};

            const gasYearPlanTotal = useMemo(() => calcYearPlanTotal('GASLIFT'), [db, year]);
            const bcpYearPlanTotal = useMemo(() => calcYearPlanTotal('BCP'), [db, year]);
            // ------------------------------------------------

            const gasYearTotal = useMemo(() => calcYearTotal('GASLIFT'), [db, year]);
            const bcpYearTotal = useMemo(() => calcYearTotal('BCP'), [db, year]);
            // ------------------------------------------------

            // --- H√ÄM T·∫¢I FILE M·∫™U EXCEL (ƒê√É N√ÇNG C·∫§P CHO C·∫¢ NƒÇM) ---
            const handleDownloadTemplate = () => {
                let header, data, fileName;
                
                if (importMode === 'PLAN') {
                    // ... (Gi·ªØ nguy√™n logic PLAN c≈©) ...
                    header = ["Th√°ng", "KH Gaslift (m3)", "Ng√†y LV Gaslift", "KH BCP (m3)", "Ng√†y LV BCP"];
                    data = Array.from({length: 12}, (_, i) => [i + 1, 30000, getDaysInMonth(i + 1, year), 15000, getDaysInMonth(i + 1, year)]);
                    fileName = `Mau_KeHoach_Nam_${year}.xlsx`;

                } else if (importMode === 'YEAR_ACTUAL') {
                    // --- LOGIC M·ªöI: M·∫™U C·∫¢ NƒÇM ---
                    header = ["Ng√†y/Th√°ng/NƒÉm", "Th·ª±c t·∫ø Gaslift (m3)", "Th·ª±c t·∫ø BCP (m3)"];
                    data = [];
                    // T·∫°o v√≤ng l·∫∑p qua 12 th√°ng ƒë·ªÉ sinh ra t·∫•t c·∫£ c√°c ng√†y
                    for (let m = 0; m < 12; m++) {
                        const days = getDaysInMonth(m + 1, year);
                        for (let d = 1; d <= days; d++) {
                            // T·∫°o chu·ªói ng√†y th√°ng nƒÉm (Excel s·∫Ω hi·ªÉu l√† Date ho·∫∑c String t√πy format)
                            const dateStr = `${d}/${m + 1}/${year}`; 
                            data.push([dateStr, 0, 0]);
                        }
                    }
                    fileName = `Mau_ThucTe_ToanBo_Nam_${year}.xlsx`;

                } else {
                    // ... (Gi·ªØ nguy√™n logic ACTUAL th√°ng l·∫ª c≈©) ...
                    header = ["Ng√†y", "Th·ª±c t·∫ø Gaslift (m3)", "Th·ª±c t·∫ø BCP (m3)"];
                    data = Array.from({length: daysInCurrentMonth}, (_, i) => [i + 1, 0, 0]);
                    fileName = `Mau_ThucTe_Thang_${selectedMonth}.xlsx`;
                }

                const ws = XLSX.utils.aoa_to_sheet([header, ...data]);
                ws['!cols'] = [{wch:15}, {wch:20}, {wch:20}, {wch:20}, {wch:15}];
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Template");
                XLSX.writeFile(wb, fileName);
            };

            // --- H√ÄM X·ª¨ L√ù FILE UPLOAD (ƒê√É CH·ªàNH S·ª¨A: QU√âT ƒê√öNG 119 C·ªòT) ---
            const handleFileUpload = async (e) => { // Th√™m async
				const file = e.target.files[0];
				if (!file) return;

				// üëá TH√äM D√íNG N√ÄY: Ch·ªù t·∫£i th∆∞ vi·ªán xong m·ªõi ch·∫°y ti·∫øp
				if (!window.XLSX) {
					alert("ƒêang t·∫£i th∆∞ vi·ªán Excel, vui l√≤ng ƒë·ª£i 2-3 gi√¢y r·ªìi ch·ªçn l·∫°i file...");
					await loadXLSX(); 
				}

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary', cellDates: true });
                    
                    let mappedData = [];

                    // --- TR∆Ø·ªúNG H·ª¢P: IMPORT SVODKA (SHEET DETAIL) ---
                    if (importMode === 'SVODKA') {
                        const ws = wb.Sheets[SVODKA_CONFIG.SHEET_NAME];
                        if (!ws) { alert(`Kh√¥ng t√¨m th·∫•y sheet "${SVODKA_CONFIG.SHEET_NAME}"`); return; }

                        // ƒê·ªçc to√†n b·ªô sheet
                        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                        
                        // --- THAY ƒê·ªîI ·ªû ƒê√ÇY: CH·ªà L·∫§Y 119 C·ªòT --- 
                        const totalCols = 119; 
                        // ---------------------------------------

                        // 1. X√ÇY D·ª∞NG T√äN C·ªòT (HEADER)
                        const headers = [];
                        for (let c = 0; c < totalCols; c++) {
                            let parts = [];
                            // Gh√©p 5 d√≤ng ƒë·∫ßu l√†m ti√™u ƒë·ªÅ
                            for (let r = 0; r < 5; r++) { 
                                if (rows[r] && rows[r][c]) {
                                    const val = String(rows[r][c]).trim();
                                    if (val && val !== 'NaN') parts.push(val);
                                }
                            }
                            // N·∫øu kh√¥ng c√≥ t√™n th√¨ ƒë·∫∑t t√™n t·∫°m l√† C·ªôt_X
                            let headerName = parts.join(" - ") || `C·ªôt_${c}`;
                            // X·ª≠ l√Ω tr√πng t√™n c·ªôt
                            if (headers.includes(headerName)) headerName += `_${c}`;
                            headers.push(headerName);
                        }

                        // 2. QU√âT D·ªÆ LI·ªÜU
                        for (let i = SVODKA_CONFIG.ROW_DATA_START; i < rows.length; i++) {
                            const row = rows[i];
                            if (!row || row.length === 0) continue;

                            // L·∫•y ng√†y th√°ng (C·ªôt c·∫•u h√¨nh)
                            let dateVal = row[SVODKA_CONFIG.COL_DATE];
                            let dateObj = null;
                            if (dateVal instanceof Date) dateObj = dateVal;
                            else if (typeof dateVal === 'string') {
                                try { const p = dateVal.trim().split(/[-/]/); if(p.length===3) dateObj = new Date(p[2], p[1]-1, p[0]); } catch(e){}
                            }

                            if (dateObj && !isNaN(dateObj)) {
                                const day = dateObj.getDate();
                                const month = dateObj.getMonth() + 1;
                                const yearVal = dateObj.getFullYear();

                                if (yearVal === year) {
                                    let fullRowData = {};
                                    
                                    // V√íNG L·∫∂P CH·∫†Y ƒê√öNG 119 L·∫¶N
                                    for (let c = 1; c < totalCols; c++) {
                                        let cellVal = row[c]; 
                                        
                                        // L√†m s·∫°ch d·ªØ li·ªáu hi·ªÉn th·ªã
                                        if (cellVal === undefined || cellVal === null) {
                                            cellVal = "";
                                        } else if (cellVal instanceof Date) {
                                            cellVal = cellVal.toLocaleDateString('vi-VN');
                                        } else if (typeof cellVal === 'object') {
                                            cellVal = ""; 
                                        }
                                        
                                        fullRowData[headers[c]] = cellVal;
                                    }

                                    const dataItem = {
                                        fullDate: dateObj,
                                        displayDate: `${day}/${month}/${yearVal}`,
                                        // V·∫´n gi·ªØ l·∫•y s·ªë li·ªáu ch√≠nh cho bi·ªÉu ƒë·ªì (n·∫øu n·∫±m trong 119 c·ªôt n√†y)
                                        gasMain: row[SVODKA_CONFIG.COL_GAS_MAIN] || 0,
                                        bcpMain: row[SVODKA_CONFIG.COL_BCP_MAIN] || 0,
                                        details: fullRowData
                                    };

                                    if (svodkaMode === 'ALL') mappedData.push(dataItem);
                                    else if (svodkaMode === 'ONE' && month === selectedMonth) mappedData.push(dataItem);
                                }
                            }
                        }
                        if (mappedData.length === 0) alert("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ph√π h·ª£p!");

                    } else if (importMode === 'PLAN') {
                        // ... (Gi·ªØ nguy√™n logic Plan c≈©) ...
                        const ws = wb.Sheets[wb.SheetNames[0]];
                        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                        mappedData = rows.slice(1).filter(r=>r.length>0).map(row => ({
                            arg1: row[0], val1: row[1], day1: row[2], val2: row[3], day2: row[4]
                        }));

                    } else if (importMode === 'YEAR_ACTUAL') {
                        // ... (Gi·ªØ nguy√™n logic Year Actual c≈©) ...
                        const ws = wb.Sheets[wb.SheetNames[0]];
                        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                        mappedData = rows.slice(1).filter(r=>r.length>0).map(row => {
                            let d = null;
                            if (row[0] instanceof Date) d = row[0];
                            else try{ const p=row[0].toString().split('/'); if(p.length===3) d=new Date(p[2],p[1]-1,p[0]); }catch(e){}
                            return d ? { fullDate: d, displayDate: `${d.getDate()}/${d.getMonth()+1}`, val1: row[1], val2: row[2] } : null;
                        }).filter(i=>i);

                    } else {
                        // ... (Gi·ªØ nguy√™n logic Month Actual c≈©) ...
                        const ws = wb.Sheets[wb.SheetNames[0]];
                        const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                        mappedData = rows.slice(1).filter(r=>r.length>0).map(row => ({ arg1: row[0], val1: row[1], val2: row[2] }));
                    }

                    setPreviewData(mappedData);
                };
                reader.readAsBinaryString(file);
            };
            
            // --- H√ÄM ƒê·ªåC FILE RP3 (THEO T·ªåA ƒê·ªò C·ªê ƒê·ªäNH) ---
            const handleRP3Import = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary' });
                    
                    // 1. C·ªë g·∫Øng t√¨m sheet "17h" (gi·ªëng c√°c gi√†n kh√°c)
                    // N·∫øu kh√¥ng th·∫•y th√¨ l·∫•y sheet ƒë·∫ßu ti√™n
                    let ws = wb.Sheets["17h"]; 
                    if (!ws) ws = wb.Sheets[wb.SheetNames[0]];

                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    const extractedData = { ...rp3Data };
                    let foundCount = 0;

                    // 2. Duy·ªát qua c·∫•u h√¨nh RP3 ƒë·ªÉ l·∫•y d·ªØ li·ªáu theo t·ªça ƒë·ªô rowIndex, colIndex
                    RP3_CONFIG.forEach(config => {
                        const row = rows[config.rowIndex]; 
                        if (row) {
                            let val = row[config.colIndex]; 
                            
                            // X·ª≠ l√Ω s·ªë li·ªáu (x√≥a d·∫•u ph·∫©y, kho·∫£ng tr·∫Øng n·∫øu c√≥)
                            if (val !== undefined && val !== null) {
                                if (typeof val === 'string') {
                                    val = parseFloat(val.replace(/,/g,'').replace(/\s/g,''));
                                }
                                extractedData[config.key] = val;
                                foundCount++;
                            }
                        }
                    });

                    setRp3Data(extractedData);
                    
                    if (foundCount > 0) alert(`‚úÖ ƒê√£ l·∫•y th√†nh c√¥ng ${foundCount} ch·ªâ s·ªë cho RP3 (Theo t·ªça ƒë·ªô c·ªë ƒë·ªãnh)!`);
                    else alert("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i file Excel.");
                };
                reader.readAsBinaryString(file);
                e.target.value = null; 
            };
 
            // --- H√ÄM ƒê·ªåC FILE RP2 (C·∫¨P NH·∫¨T: ∆ØU TI√äN SHEET "17h", L·∫§Y B4-C4-D4) ---
            const handleRP2Import = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary' });
                    
                    // 1. C·ªë g·∫Øng t√¨m sheet t√™n l√† "17h"
                    let ws = wb.Sheets["17h"];
                    
                    // N·∫øu kh√¥ng th·∫•y sheet "17h" (do ƒë·ªïi t√™n file...), th·ª≠ l·∫•y sheet ƒë·∫ßu ti√™n l√†m d·ª± ph√≤ng
                    if (!ws) {
                        console.warn("Kh√¥ng t√¨m th·∫•y sheet '17h', h·ªá th·ªëng s·∫Ω th·ª≠ l·∫•y sheet ƒë·∫ßu ti√™n.");
                        ws = wb.Sheets[wb.SheetNames[0]];
                    }

                    // ƒê·ªçc d·ªØ li·ªáu
                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });

                    // 2. L·∫§Y D·ªÆ LI·ªÜU D√íNG 4 (Trong l·∫≠p tr√¨nh l√† Index 3)
                    const dataRow = rows[3]; 

                    if (!dataRow || dataRow.length === 0) {
                        alert("‚ö†Ô∏è L·ªói c·∫•u tr√∫c: Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ·ªü d√≤ng 4 (Sheet 17h)!");
                        return;
                    }

                    const extractedData = { ...rp2Data };
                    
                    // L·∫•y √î B4 (L∆∞u l∆∞·ª£ng) -> Index 1
                    let valB = dataRow[1];
                    if (valB !== undefined) {
                        extractedData['gas_prod'] = typeof valB === 'string' ? parseFloat(valB.replace(/,/g,'').replace(/\s/g,'')) : valB;
                    }

                    // L·∫•y √î C4 (ƒêu·ªëc) -> Index 2
                    let valC = dataRow[2];
                    if (valC !== undefined) {
                        extractedData['flare'] = typeof valC === 'string' ? parseFloat(valC.replace(/,/g,'').replace(/\s/g,'')) : valC;
                    }

                    // L·∫•y √î D4 (√Åp su·∫•t) -> Index 3 (Gi·ªØ nguy√™n Text v√¨ c√≥ th·ªÉ l√† "9.5/10.4")
                    let valD = dataRow[3];
                    if (valD !== undefined) {
                        extractedData['pressure'] = valD;
                    }

                    setRp2Data(extractedData);
                    alert(`‚úÖ ƒê√£ l·∫•y d·ªØ li·ªáu t·ª´ Sheet "17h" (D√≤ng 4):\n- L∆∞u l∆∞·ª£ng: ${extractedData.gas_prod || 0}\n- ƒêu·ªëc: ${extractedData.flare || 0}\n- √Åp su·∫•t: ${extractedData.pressure || '-'}`);
                };
                reader.readAsBinaryString(file);
                e.target.value = null; 
            };

            // --- H√ÄM ƒê·ªåC FILE RP1 (Sheet 17h: D5-D10) ---
            const handleRP1Import = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary' });
                    
                    // 1. C·ªë g·∫Øng t√¨m sheet "17h"
                    let ws = wb.Sheets["17h"];
                    if (!ws) {
                        console.warn("Kh√¥ng t√¨m th·∫•y sheet '17h', th·ª≠ sheet ƒë·∫ßu ti√™n.");
                        ws = wb.Sheets[wb.SheetNames[0]];
                    }

                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    const extractedData = { ...rp1Data };
                    let foundCount = 0;

                    // 2. Duy·ªát qua c·∫•u h√¨nh RP1 ƒë·ªÉ l·∫•y d·ªØ li·ªáu theo t·ªça ƒë·ªô
                    RP1_CONFIG.forEach(config => {
                        const row = rows[config.rowIndex]; // L·∫•y d√≤ng
                        if (row) {
                            let val = row[config.colIndex]; // L·∫•y c·ªôt D (index 3)
                            
                            if (val !== undefined && val !== null) {
                                if (typeof val === 'string') {
                                    val = parseFloat(val.replace(/,/g,'').replace(/\s/g,''));
                                }
                                extractedData[config.key] = val;
                                foundCount++;
                            }
                        }
                    });

                    setRp1Data(extractedData);
                    
                    if (foundCount > 0) alert(`‚úÖ ƒê√£ l·∫•y th√†nh c√¥ng ${foundCount} ch·ªâ s·ªë cho RP1!`);
                    else alert("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i file Excel (Sheet 17h, C·ªôt D).");
                };
                reader.readAsBinaryString(file);
                e.target.value = null; 
            };

			// --- H√ÄM ƒê·ªåC FILE RC1/3 (Sheet 17h: B4,B5,C4,C5) ---
            const handleRC13Import = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = XLSX.read(bstr, { type: 'binary' });
                    
                    // 1. C·ªë g·∫Øng t√¨m sheet "17h"
                    let ws = wb.Sheets["17h"];
                    if (!ws) {
                        console.warn("Kh√¥ng t√¨m th·∫•y sheet '17h', th·ª≠ sheet ƒë·∫ßu ti√™n.");
                        ws = wb.Sheets[wb.SheetNames[0]];
                    }

                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    const extractedData = { ...rc13Data };
                    let foundCount = 0;

                    // 2. Duy·ªát qua c·∫•u h√¨nh RC13
                    RC13_CONFIG.forEach(config => {
                        const row = rows[config.rowIndex]; // L·∫•y d√≤ng (3 ho·∫∑c 4)
                        if (row) {
                            let val = row[config.colIndex]; // L·∫•y c·ªôt B(1) ho·∫∑c C(2)
                            
                            if (val !== undefined && val !== null) {
                                // N·∫øu l√† s·ªë li·ªáu l∆∞u l∆∞·ª£ng (C·ªôt B), chuy·ªÉn sang s·ªë
                                if (config.colIndex === 1 && typeof val === 'string') {
                                    val = parseFloat(val.replace(/,/g,'').replace(/\s/g,''));
                                }
                                // N·∫øu l√† √°p su·∫•t (C·ªôt C), gi·ªØ nguy√™n text (v√¨ c√≥ th·ªÉ l√† kho·∫£ng 104.9-105.5)
                                
                                extractedData[config.key] = val;
                                foundCount++;
                            }
                        }
                    });

                    setRc13Data(extractedData);
                    
                    if (foundCount > 0) alert(`‚úÖ ƒê√£ l·∫•y th√†nh c√¥ng ${foundCount} ch·ªâ s·ªë cho RC1/3!`);
                    else alert("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i file Excel (Sheet 17h).");
                };
                reader.readAsBinaryString(file);
                e.target.value = null; 
            };
			
			// --- H√ÄM ƒê·ªåC FILE ƒêI·ªÜN (Sheet Daily: E7-E10) ---
            const handleElecImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const wb = XLSX.read(evt.target.result, { type: 'binary' });
                    // T√¨m sheet "Daily"
                    let ws = wb.Sheets["Daily"];
                    if (!ws) {
                        console.warn("Kh√¥ng t√¨m th·∫•y sheet 'Daily', th·ª≠ sheet ƒë·∫ßu ti√™n.");
                        ws = wb.Sheets[wb.SheetNames[0]];
                    }
                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    const extracted = { ...elecData };
                    let count = 0;
                    ELEC_CONFIG.forEach(cfg => {
                        const row = rows[cfg.rowIndex];
                        if (row && row[cfg.colIndex] !== undefined) {
                            let val = row[cfg.colIndex];
                            if (typeof val === 'string') val = parseFloat(val.replace(/,/g,'').replace(/\s/g,''));
                            extracted[cfg.key] = val;
                            count++;
                        }
                    });
                    setElecData(extracted);
                    if(count>0) alert("ƒê√£ import Th√¥ng s·ªë ƒêi·ªán th√†nh c√¥ng!");
                };
                reader.readAsBinaryString(file);
                e.target.value = null;
            };
			
			// --- H√ÄM ƒê·ªåC FILE GTC (Sheet 17h: B3:I4) ---
            const handleGtcImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const wb = XLSX.read(evt.target.result, { type: 'binary' });
                    // T√¨m sheet "17h"
                    let ws = wb.Sheets["17h"];
                    if (!ws) ws = wb.Sheets[wb.SheetNames[0]]; // Fallback
                    
                    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                    const extracted = { ...gtcData };
                    let count = 0;
                    
                    GTC_CONFIG.forEach(cfg => {
                        const row = rows[cfg.rowIndex];
                        if (row && row[cfg.colIndex] !== undefined) {
                            let val = row[cfg.colIndex];
                            if (typeof val === 'string') val = parseFloat(val.replace(/,/g,'').replace(/\s/g,''));
                            extracted[cfg.key] = val;
                            count++;
                        }
                    });
                    setGtcData(extracted);
                    if(count>0) alert("ƒê√£ import GTC A/B th√†nh c√¥ng!");
                };
                reader.readAsBinaryString(file);
                e.target.value = null;
            };
			
			// --- H√ÄM X√ìA D·ªÆ LI·ªÜU T·ª™NG TH·∫∫ (C√ì H·ªéI L·∫†I) ---
            const clearData = (label, setFunc) => {
                if (window.confirm(`‚ö†Ô∏è C·∫¢NH B√ÅO:\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA s·∫°ch d·ªØ li·ªáu c·ªßa th·∫ª [ ${label} ] kh√¥ng?`)) {
                    setFunc({}); // Reset v·ªÅ object r·ªóng
                }
            };
			
			// --- H√ÄM TƒÇNG/GI·∫¢M NG√ÄY NH·∫¨P LI·ªÜU ---
            const changeDailyDate = (offset) => {
                // T·∫°o ƒë·ªëi t∆∞·ª£ng Date t·ª´ ng√†y hi·ªán t·∫°i
                const date = new Date(dailyDate);
                // C·ªông/Tr·ª´ s·ªë ng√†y
                date.setDate(date.getDate() + offset);
                // C·∫≠p nh·∫≠t l·∫°i state (ƒë·ªãnh d·∫°ng YYYY-MM-DD)
                setDailyDate(date.toISOString().split('T')[0]);
            };

            // --- H√ÄM UPLOAD H√ÄNG LO·∫†T (V4: ƒê√É FIX L·ªñI NH·∫¨N DI·ªÜN RP1/RP3) ---
            const handleBatchUpload = (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                let countSuccess = 0;
                let processedFiles = []; 

                files.forEach(file => {
                    const reader = new FileReader();
                    // Chu·∫©n h√≥a t√™n file: X√≥a d·∫•u, x√≥a kho·∫£ng tr·∫Øng
                    // "05h00-17h00 GAS RP1-RP3, SKID-5" -> "05h00-17h00gasrp1-rp3,skid-5"
                    const nameRaw = file.name.toLowerCase();
                    const name = nameRaw.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, ""); 

                    reader.onload = (evt) => {
                        try {
                            const bstr = evt.target.result;
                            const wb = XLSX.read(bstr, { type: 'binary' });

                            // H√†m parse s·ªë an to√†n
                            const parseVal = (val) => {
                                if (val === undefined || val === null) return undefined;
                                if (typeof val === 'number') return val;
                                const clean = String(val).replace(/,/g, '').replace(/\s/g, '').replace(/[^\d.-]/g, '');
                                return parseFloat(clean);
                            };

                            // --- TH·ª® T·ª∞ ∆ØU TI√äN KI·ªÇM TRA (R·∫§T QUAN TR·ªåNG) ---

                            // 1. FILE ƒêI·ªÜN (∆Øu ti√™n s·ªë 1)
                            // T√™n file: "THONGSODIEN DGCP"
                            if (name.includes("thongsodien") || name.includes("dien") || name.includes("elec")) {
                                console.log(">> ƒê√£ b·∫Øt ƒë∆∞·ª£c file [ƒêI·ªÜN]:", file.name);
                                let ws = wb.Sheets["Daily"] || wb.Sheets[wb.SheetNames[0]];
                                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                                const extracted = {};
                                ELEC_CONFIG.forEach(cfg => {
                                    if (rows[cfg.rowIndex] && rows[cfg.rowIndex][cfg.colIndex] !== undefined) {
                                        extracted[cfg.key] = parseVal(rows[cfg.rowIndex][cfg.colIndex]);
                                    }
                                });
                                if (Object.keys(extracted).length > 0) {
                                    setElecData(prev => ({...prev, ...extracted}));
                                    processedFiles.push("ƒêi·ªán");
                                }
                            }

                            // 2. FILE GTC (∆Øu ti√™n s·ªë 2)
                            // T√™n file: "DGCP Svodka - TS VH"
                            else if (name.includes("gtc") || name.includes("tech") || name.includes("congnghe") || name.includes("ler") || name.includes("tsvh")) {
                                console.log(">> ƒê√£ b·∫Øt ƒë∆∞·ª£c file [GTC/CN]:", file.name);
                                let ws = wb.Sheets["17h"] || wb.Sheets[wb.SheetNames[0]];
                                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                                const extracted = {};
                                GTC_CONFIG.forEach(cfg => {
                                    if (rows[cfg.rowIndex] && rows[cfg.rowIndex][cfg.colIndex] !== undefined) {
                                        extracted[cfg.key] = parseVal(rows[cfg.rowIndex][cfg.colIndex]);
                                    }
                                });
                                if (Object.keys(extracted).length > 0) {
                                    setGtcData(prev => ({...prev, ...extracted}));
                                    processedFiles.push("GTC");
                                }
                            }

                            // 3. FILE RP1 (ƒê·∫®Y L√äN TR∆Ø·ªöC RP3)
                            // T√™n file: "05h00-17h00 GAS RP1-RP3, SKID-5" -> ch·ª©a "skid", "rp1"
                            else if (name.includes("skid") || (name.includes("rp1") )) {
                                console.log(">> ƒê√£ b·∫Øt ƒë∆∞·ª£c file [RP1]:", file.name);
                                let ws = wb.Sheets["17h"] || wb.Sheets[wb.SheetNames[0]];
                                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                                const extracted = {};
                                RP1_CONFIG.forEach(cfg => {
                                    if (rows[cfg.rowIndex]) {
                                        extracted[cfg.key] = parseVal(rows[cfg.rowIndex][cfg.colIndex]);
                                    }
                                });
                                setRp1Data(prev => ({...prev, ...extracted}));
                                processedFiles.push("RP1");
                            }

                            // 4. FILE RP3 (SAU RP1)
                            // T√™n file: "S·ªë li·ªáu kh√≠ g·ª≠i DGCP" -> "solieukhi..."
                            else if (name.includes("rp3") || name.includes("booster") || (name.includes("solieu") && name.includes("khi"))) {
                                console.log(">> ƒê√£ b·∫Øt ƒë∆∞·ª£c file [RP3]:", file.name);
                                let ws = wb.Sheets["17h"] || wb.Sheets[wb.SheetNames[0]];
                                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                                const extracted = {};
                                RP3_CONFIG.forEach(cfg => {
                                    if (rows[cfg.rowIndex] && rows[cfg.rowIndex][cfg.colIndex] !== undefined) {
                                        extracted[cfg.key] = parseVal(rows[cfg.rowIndex][cfg.colIndex]);
                                    }
                                });
                                if (Object.keys(extracted).length > 0) {
                                    setRp3Data(prev => ({...prev, ...extracted}));
                                    processedFiles.push("RP3");
                                }
                            }

                            // 5. FILE RP2
                            else if (name.includes("rp2")) {
                                console.log(">> ƒê√£ b·∫Øt ƒë∆∞·ª£c file [RP2]:", file.name);
                                let ws = wb.Sheets["17h"] || wb.Sheets[wb.SheetNames[0]];
                                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                                const row = rows[3]; 
                                if (row) {
                                    const extracted = {};
                                    if (row[1] !== undefined) extracted.gas_prod = parseVal(row[1]);
                                    if (row[2] !== undefined) extracted.flare = parseVal(row[2]);
                                    if (row[3] !== undefined) extracted.pressure = row[3];
                                    setRp2Data(prev => ({...prev, ...extracted}));
                                    processedFiles.push("RP2");
                                }
                            }

                            // 6. FILE RC1/3
                            else if (name.includes("rc1") || name.includes("rc1-3") || name.includes("bk")) {
                                console.log(">> ƒê√£ b·∫Øt ƒë∆∞·ª£c file [RC1/3]:", file.name);
                                let ws = wb.Sheets["17h"] || wb.Sheets[wb.SheetNames[0]];
                                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                                const extracted = {};
                                RC13_CONFIG.forEach(cfg => {
                                    if (rows[cfg.rowIndex]) {
                                        if (cfg.colIndex === 1) extracted[cfg.key] = parseVal(rows[cfg.rowIndex][cfg.colIndex]);
                                        else extracted[cfg.key] = rows[cfg.rowIndex][cfg.colIndex];
                                    }
                                });
                                setRc13Data(prev => ({...prev, ...extracted}));
                                processedFiles.push("RC1/3");
                            }

                        } catch (err) {
                            console.error("L·ªói ƒë·ªçc file:", file.name, err);
                        }
                    };
                    reader.readAsBinaryString(file);
                });

                e.target.value = null; // Reset input
                
                setTimeout(() => {
                    if (processedFiles.length > 0) {
                         alert(`‚úÖ ƒê√£ x·ª≠ l√Ω xong!\nDanh s√°ch file nh·∫≠n di·ªán ƒë∆∞·ª£c:\n- ${processedFiles.join("\n- ")}`);
                    } else {
                         alert(`‚ö†Ô∏è Kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c file n√†o.`);
                    }
                }, 1000);
            };
			
					
			
            // --- H√ÄM L∆ØU D·ªÆ LI·ªÜU T·ª™ B·∫¢NG XEM TR∆Ø·ªöC (C·∫¨P NH·∫¨T YEAR IMPORT) ---
            // --- H√ÄM L∆ØU D·ªÆ LI·ªÜU (C·∫¨P NH·∫¨T LOGIC SVODKA) ---
            const handleConfirmImport = () => {
                                if (importMode === 'SVODKA') {
                    // --- LOGIC M·ªöI: L∆ØU DATA LAKE (ƒê√É FIX L·ªñI L·ªÜCH NG√ÄY) ---
                    setDb(prev => {
                        const newDb = { ...prev };
                        if (!newDb.DAILY_DETAILS) newDb.DAILY_DETAILS = {};

                        let count = 0;
                        previewData.forEach(row => {
                            const d = row.fullDate;
                            if (!d) return;
                            
                            // --- ƒêO·∫†N S·ª¨A QUAN TR·ªåNG T·∫†I ƒê√ÇY ---
                            // L·∫•y ng√†y th√°ng local, KH√îNG d√πng toISOString()
                            const yyyy = d.getFullYear();
                            const mm = String(d.getMonth() + 1).padStart(2, '0');
                            const dd = String(d.getDate()).padStart(2, '0');
                            const dateKey = `${yyyy}-${mm}-${dd}`;
                            // ------------------------------------

                            const month = d.getMonth() + 1;
                            const day = d.getDate();

                            // 1. C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì ch√≠nh
                            if (newDb.GASLIFT[month] && newDb.BCP[month]) {
                                if (row.gasMain !== undefined) newDb.GASLIFT[month].actuals[day] = parseFloat(row.gasMain);
                                if (row.bcpMain !== undefined) newDb.BCP[month].actuals[day] = parseFloat(row.bcpMain);
                            }

                            // 2. L∆∞u chi ti·∫øt v√†o Data Lake
                            newDb.DAILY_DETAILS[dateKey] = row.details;
                            count++;
                        });

                        logToCloud(currentUser, `Import Svodka (${count} ng√†y)`);
                        return newDb;
                    });
                    
                    alert(`‚úÖ ƒê√£ nh·∫≠p th√†nh c√¥ng!\n- D·ªØ li·ªáu ng√†y 01/01/2026 s·∫Ω hi·ªÉn th·ªã ƒë√∫ng v·ªã tr√≠.\n- T·ªïng c·ªông: ${previewData.length} ng√†y.`);
                    setPreviewData([]);
                    setImportMode(null);
                    setSvodkaMode(null);
                


                } else if (importMode === 'PLAN') {
                     // ... Gi·ªØ nguy√™n logic PLAN ...
                     const updates = { GASLIFT: {}, BCP: {} };
                     previewData.forEach(row => {
                        const m = parseInt(row.arg1);
                        if (m >= 1 && m <= 12) {
                            updates.GASLIFT[m] = { target: parseFloat(row.val1) || 0, workingDays: parseFloat(row.day1) || 0 };
                            updates.BCP[m] = { target: parseFloat(row.val2) || 0, workingDays: parseFloat(row.day2) || 0 };
                        }
                    });
                    setDb(prev => {
                        const newDb = { ...prev };
                        ['GASLIFT', 'BCP'].forEach(sys => {
                            Object.keys(updates[sys]).forEach(m => { if (newDb[sys][m]) newDb[sys][m].plan = { ...newDb[sys][m].plan, ...updates[sys][m] }; });
                        });
                        return newDb;
                    });
                    logToCloud(currentUser, `Import Excel K·∫ø ho·∫°ch nƒÉm ${year}`);
                    alert("ƒê√£ c·∫≠p nh·∫≠t K·∫ø ho·∫°ch th√†nh c√¥ng!");

                } else if (importMode === 'YEAR_ACTUAL') {
                    // ... Gi·ªØ nguy√™n logic C·∫£ nƒÉm ...
                    setDb(prev => {
                        const newDb = { ...prev };
                        let count = 0;
                        previewData.forEach(row => {
                            const d = row.fullDate;
                            const month = d.getMonth() + 1;
                            const day = d.getDate();
                            if (newDb.GASLIFT[month] && newDb.BCP[month]) {
                                if (row.val1 !== undefined) newDb.GASLIFT[month].actuals[day] = parseFloat(row.val1);
                                if (row.val2 !== undefined) newDb.BCP[month].actuals[day] = parseFloat(row.val2);
                                count++;
                            }
                        });
                        logToCloud(currentUser, `Import Th·ª±c t·∫ø C·∫£ nƒÉm (${count} d√≤ng)`);
                        return newDb;
                    });
                    alert("ƒê√£ nh·∫≠p d·ªØ li·ªáu C·∫£ nƒÉm th√†nh c√¥ng!");
                    setPreviewData([]);
                    setImportMode(null);

                } else {
                    // ... Gi·ªØ nguy√™n logic Th√°ng l·∫ª ...
                    const updatesGas = {}; const updatesBCP = {};
                    previewData.forEach(row => {
                        const d = parseInt(row.arg1);
                        if (d >= 1 && d <= 31) {
                            if (row.val1 !== undefined) updatesGas[d] = parseFloat(row.val1);
                            if (row.val2 !== undefined) updatesBCP[d] = parseFloat(row.val2);
                        }
                    });

                    if (!isEditingActuals) {
                         setTempActualsGas({ ...(gasData.actuals || {}), ...updatesGas });
                         setTempActualsBCP({ ...(bcpData.actuals || {}), ...updatesBCP });
                         setTempActualsNotesGas(gasData.actualsNotes || {});
                         setTempActualsNotesBCP(bcpData.actualsNotes || {});
                         setIsEditingActuals(true);
                    } else {
                         setTempActualsGas(prev => ({ ...prev, ...updatesGas }));
                         setTempActualsBCP(prev => ({ ...prev, ...updatesBCP }));
                    }
                    alert(`‚úÖ ƒê√£ nh·∫≠p d·ªØ li·ªáu th√°ng ${selectedMonth} v√†o b·∫£ng t·∫°m!`);
                    setPreviewData([]);
                    setImportMode(null);
                }
            };

            // ... (Backup/Restore handlers) ...
            const handleBackup = () => {
				const dataStr = JSON.stringify(db, null, 2);
				const blob = new Blob([dataStr], { type: 'application/json' });
				const url = URL.createObjectURL(blob);
				const link = document.createElement('a');
				link.href = url;
				link.download = `Backup_DGCP_${new Date().toISOString().slice(0,10)}.json`;
				link.click();
				
				// --- GHI LOG ---
				logToCloud(currentUser, "H√†nh ƒë·ªông: Sao l∆∞u (Backup) d·ªØ li·ªáu ra file JSON");
			};
            // --- CLOUD SYNC LOGIC (M·ªöI) ---
            const [isSyncing, setIsSyncing] = useState(false);

            // --- USER & PERMISSIONS ---
            
				// 1. ƒêi·ªÅn t√™n 'Admin' v√†o ƒë√¢y ƒë·ªÉ v√†o th·∫≥ng v·ªõi quy·ªÅn cao nh·∫•t, khi mu·ªën b·∫≠t l·∫°i ch·∫ø ƒë·ªô b·∫£o m·∫≠t, b·∫°n ch·ªâ c·∫ßn s·ª≠a l·∫°i th√†nh null
				const [currentUser, setCurrentUser] = useState('null'); 
				
				// 2. ƒê·ªïi th√†nh false ƒë·ªÉ ·∫©n b·∫£ng ƒëƒÉng nh·∫≠p ƒëi, khi mu·ªën b·∫≠t l·∫°i ch·∫ø ƒë·ªô b·∫£o m·∫≠t, b·∫°n ch·ªâ c·∫ßn s·ª≠a l·∫°i th√†nh null v√† true
				const [showLoginModal, setShowLoginModal] = useState(true); 
            
            // DANH S√ÅCH T√ÄI KHO·∫¢N ƒê∆Ø·ª¢C PH√âP S·ª¨A & L∆ØU (ADMIN)
            // B·∫°n h√£y li·ªát k√™ t·∫•t c·∫£ t√™n ƒë·ªìng nghi·ªáp v√†o ƒë√¢y:
            const ADMIN_USERS = [
                'philt',
                'namnh',
                'tuannt',
                'namnv',
                'nguyenln',
				'hungpn',
				'viennm',
				'vaodv',
				'ductt',
				'Admin',                
            ];
              
            // --- H√ÄM GHI LOG NG·∫¶M ---
            const logToCloud = async (userName, message) => {
                console.log(`ƒê√£ ghi log: ${message}`); 
                if (!API_URL) return;

                try {
                    await fetch(API_URL, {
                        method: "POST",
                        mode: "no-cors",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: 'LOG',
                            user: userName || 'Unknown',
                            action_detail: message,
                            year: year, // üëà QUAN TR·ªåNG: Log v√†o file c·ªßa nƒÉm hi·ªán t·∫°i
                            timestamp: new Date().toISOString()
                        })
                    });
                } catch (error) {
                    console.error("L·ªói g·ª≠i log:", error);
                }
            };

            // 1. H√†m T·∫£i v·ªÅ (PULL)
            const handlePullFromCloud = async () => {
				if(!API_URL) return alert("Ch∆∞a c·∫•u h√¨nh link API!");
				setIsSyncing(true);
				setIsPulling(true);
				try {
                    // üëá QUAN TR·ªåNG: Th√™m ?year=${year} v√†o cu·ªëi URL
					const res = await fetch(`${API_URL}?year=${year}`);
					const result = await res.json();
					
                    // Ki·ªÉm tra xem Cloud c√≥ tr·∫£ v·ªÅ data kh√¥ng (n·∫øu nƒÉm m·ªõi ch∆∞a c√≥ file th√¨ db s·∫Ω r·ªóng)
                    if (result.db && Object.keys(result.db).length > 0) {
						setDb(result.db);
						setSystemLogs(result.logs || []);
						logToCloud(currentUser, `H√†nh ƒë·ªông: T·∫£i d·ªØ li·ªáu NƒÉm ${year} t·ª´ Cloud`);
						alert(`‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu NƒÉm ${year} th√†nh c√¥ng!`);
					} else {
                        // N·∫øu Cloud ch∆∞a c√≥ file nƒÉm n√†y, gi·ªØ nguy√™n ho·∫∑c th√¥ng b√°o
                        alert(`‚ö†Ô∏è Tr√™n Cloud ch∆∞a c√≥ d·ªØ li·ªáu cho nƒÉm ${year}.`);
                    }
				} catch (error) {
					alert("L·ªói: " + error.message);
				} finally {
					setIsSyncing(false);
					setIsPulling(false);
				}
			};

			// H√†m ch·ªâ l√†m m·ªõi log
            const handleRefreshLogsOnly = async () => {
                if (!API_URL) return;
                try {
                    // üëá Th√™m tham s·ªë nƒÉm
                    const res = await fetch(`${API_URL}?year=${year}`);
                    const result = await res.json();
                    
                    if (result.logs) {
                        setSystemLogs(result.logs);
                    }
                } catch (error) {
                    console.error("L·ªói l√†m m·ªõi log:", error);
                }
            };

            // 2. H√†m ƒê·∫©y l√™n (PUSH) - ƒê√É C·∫¨P NH·∫¨T G·ª¨I K√àM NƒÇM
            const handlePushToCloud = async () => {
                if(!API_URL) return alert("Ch∆∞a c·∫•u h√¨nh API URL!");
                
                if (!ADMIN_USERS.includes(currentUser)) {
                    return alert("‚õî B·∫†N KH√îNG C√ì QUY·ªÄN ƒê·∫®Y D·ªÆ LI·ªÜU!");
                }

                // üëá S·ª¨A 1: Th√™m hi·ªán NƒÉm v√†o th√¥ng b√°o ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n
                if(!window.confirm(`X√°c nh·∫≠n: B·∫°n (${currentUser}) mu·ªën ƒë·∫©y to√†n b·ªô d·ªØ li·ªáu NƒÇM ${year} l√™n Cloud?`)) return;

                setIsSyncing(true);
				setIsPushing(true); 
                try {
                    const payload = {
                        action: 'SAVE',
                        user: currentUser,
                        year: year, // üëà S·ª¨A 2: QUAN TR·ªåNG NH·∫§T - G·ª≠i k√®m nƒÉm hi·ªán t·∫°i
                        db: { ...db, lastUpdated: new Date().toISOString() }
                    };

                    await fetch(API_URL, {
                        method: "POST",
                        mode: "no-cors",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });
                    
                    // Ghi log h√†nh ƒë·ªông
                    logToCloud(currentUser, `ƒê√£ th·ª±c hi·ªán: ƒê·∫©y d·ªØ li·ªáu NƒÇM ${year} l√™n Cloud`);

                    // C·∫≠p nh·∫≠t l·∫°i state c·ª•c b·ªô (ƒë·ªÉ ch·∫Øc ch·∫Øn ƒë·ªìng b·ªô)
                    setDb(payload.db);
                    alert(`‚úÖ ƒê√£ ƒë·∫©y d·ªØ li·ªáu NƒÇM ${year} th√†nh c√¥ng!`);
                } catch (error) {
                    console.error(error);
                    alert("L·ªói: " + error.message);
                } finally {
                    setIsSyncing(false);
					setIsPushing(false); 
                }
            };
			
			// --- H√ÄM QU√âT C√ÅC C√îNG VI·ªÜC D·ªû DANG ---
            const handleScanForTransfer = () => {
                const currentShared = db.SHARED?.[selectedMonth] || { maintenancePlans: [], shutdownIncidents: [], events: [] };
                
                // ƒêi·ªÅu ki·ªán: C√≥ ng√†y b·∫Øt ƒë·∫ßu NH∆ØNG Ch∆∞a c√≥ ng√†y k·∫øt th√∫c
                const isPending = (start, end) => (start && start !== "") && (!end || end === "");

                let list = [];

                // 1. Qu√©t B·∫£o d∆∞·ª°ng
                (currentShared.maintenancePlans || []).forEach(item => {
                    if (isPending(item.start, item.end)) {
                        list.push({ ...item, type: 'B·∫£o d∆∞·ª°ng', dbKey: 'maintenancePlans' });
                    }
                });

                // 2. Qu√©t S·ª± c·ªë
                (currentShared.shutdownIncidents || []).forEach(item => {
                    if (isPending(item.start, item.end)) {
                        list.push({ ...item, type: 'S·ª± c·ªë', dbKey: 'shutdownIncidents' });
                    }
                });

                // 3. Qu√©t S·ª± ki·ªán
                (currentShared.events || []).forEach(item => {
                    if (isPending(item.startDate || item.date, item.endDate)) {
                        list.push({ ...item, type: 'S·ª± ki·ªán', dbKey: 'events' });
                    }
                });

                if (list.length === 0) {
                    alert("Kh√¥ng t√¨m th·∫•y c√¥ng vi·ªác n√†o ƒëang th·ª±c hi·ªán d·ªü dang trong th√°ng n√†y.");
                    return;
                }

                // M·ªü Modal v√† m·∫∑c ƒë·ªãnh ch·ªçn t·∫•t c·∫£
                setPendingItems(list);
                setSelectedTransferIds(new Set(list.map(i => i.id)));
                setShowTransferModal(true);
            };

            // --- H√ÄM TH·ª∞C THI CHUY·ªÇN SANG TH√ÅNG SAU ---
            const handleConfirmTransfer = () => {
                if (selectedTransferIds.size === 0) return alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt m·ª•c ƒë·ªÉ chuy·ªÉn.");
                
                const nextMonth = selectedMonth + 1;
                if (nextMonth > 12) return alert("Ch∆∞a h·ªó tr·ª£ chuy·ªÉn t·ª± ƒë·ªông sang nƒÉm sau. Vui l√≤ng nh·∫≠p tay.");

                setDb(prev => {
                    const nextDb = { ...prev };
                    if (!nextDb.SHARED[nextMonth]) nextDb.SHARED[nextMonth] = { maintenancePlans: [], shutdownIncidents: [], events: [] };
                    
                    const targetData = nextDb.SHARED[nextMonth];
                    let count = 0;

                    // L·ªçc l·∫•y c√°c m·ª•c ƒë∆∞·ª£c user t√≠ch ch·ªçn
                    const itemsToTransfer = pendingItems.filter(item => selectedTransferIds.has(item.id));

                    itemsToTransfer.forEach(item => {
                        // T·∫°o b·∫£n sao m·ªõi v·ªõi ID m·ªõi (ƒë·ªÉ kh√¥ng tr√πng key React)
                        // Gi·ªØ nguy√™n Start Date ƒë·ªÉ bi·∫øt vi·ªác n√†y b·∫Øt ƒë·∫ßu t·ª´ bao gi·ªù
                        const newItem = { 
                            ...item, 
                            id: Date.now() + Math.random(), 
                            type: undefined, // X√≥a c√°c field t·∫°m
                            dbKey: undefined 
                        };

                        // ƒê∆∞a v√†o ƒë√∫ng m·∫£ng d·ªØ li·ªáu c·ªßa th√°ng sau
                        if (item.dbKey === 'maintenancePlans') {
                            // Ki·ªÉm tra tr√πng t√™n ƒë·ªÉ tr√°nh duplicate n·∫øu b·∫•m nhi·ªÅu l·∫ßn
                            if (!targetData.maintenancePlans.some(i => i.description === newItem.description)) {
                                targetData.maintenancePlans.push(newItem);
                                count++;
                            }
                        } else if (item.dbKey === 'shutdownIncidents') {
                            if (!targetData.shutdownIncidents.some(i => i.description === newItem.description)) {
                                targetData.shutdownIncidents.push(newItem);
                                count++;
                            }
                        } else if (item.dbKey === 'events') {
                            if (!targetData.events.some(i => i.name === newItem.name)) {
                                targetData.events.push(newItem);
                                count++;
                            }
                        }
                    });

                    if (count > 0) {
                        alert(`‚úÖ ƒê√£ chuy·ªÉn th√†nh c√¥ng ${count} c√¥ng vi·ªác sang Th√°ng ${nextMonth}.`);
                    } else {
                        alert("‚ö†Ô∏è C√°c m·ª•c ƒë∆∞·ª£c ch·ªçn d∆∞·ªùng nh∆∞ ƒë√£ t·ªìn t·∫°i ·ªü th√°ng sau r·ªìi.");
                    }
                    
                    return nextDb;
                });

                setShowTransferModal(false);
            };
			
			// --- H√ÄM ƒê·∫®Y D·ªÆ LI·ªÜU SANG SVODKA (ƒê√É FIX L·ªñI "totalPeople is not defined") ---
            const handlePushToSvodka = async () => {
                if(!SVODKA_API_URL) return alert("Ch∆∞a c·∫•u h√¨nh Link Svodka API!"); 
                
                if(!window.confirm(`X√°c nh·∫≠n ƒë·∫©y TO√ÄN B·ªò d·ªØ li·ªáu ng√†y [${dailyDate}]?\n(G·ªìm: S·ªë li·ªáu, B√°o c√°o, Nh√¢n s·ª±)`)) return;

                setIsSyncing(true);
                
                try {
                    // =========================================================
                    // 1. G·ª¨I SHEET DETAIL (S·ªê LI·ªÜU)
                    // =========================================================
                    const todayData = db?.DAILY_REPORTS?.[dailyDate] || {};
                    const payloadDetail = {};

                    SHEET_MAPPING.forEach(map => {
                        let value = todayData[map.sys]?.[map.key];
                        if (value === undefined) {
                            if (map.sys === 'RP3') value = rp3Data[map.key];
                            else if (map.sys === 'RP2') value = rp2Data[map.key];
                            else if (map.sys === 'RP1') value = rp1Data[map.key];
                        }
                        if (value !== undefined && value !== "") payloadDetail[map.col] = value;
                    });

                    // T√≠nh t·ªïng RP3
                    const r3_source = Object.keys(rp3Data).length > 0 ? rp3Data : (todayData.RP3 || {}); 
                    const taurus = parseFloat(r3_source['gas_dgcp_taurus'] || 0);
                    const saturn = parseFloat(r3_source['gas_dgcp_saturn'] || 0);
                    const typhoon = parseFloat(r3_source['gas_dgcp_typhoon'] || 0);
                    payloadDetail['U'] = taurus + saturn + typhoon;

                    await fetch(SVODKA_API_URL, { 
                        method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: 'UPDATE_SHEET_DETAIL',
                            user: currentUser,
                            date: dailyDate,
                            data: payloadDetail
                        })
                    });

                    // =========================================================
                    // 2. G·ª¨I SHEET OTHERS (B√ÅO C√ÅO VƒÇN B·∫¢N)
                    // =========================================================
                    const safe = Object.keys(safetyData).length > 0 ? safetyData : (todayData.SAFETY || {});
                    const dInfo = dailyInfo.content ? dailyInfo : (todayData.DAILY_INFO || {content: ""});
                    const nPlan = nextDayPlan.content ? nextDayPlan : (todayData.NEXT_DAY_PLAN || {content: ""});
                    const ship = shipBooking.content ? shipBooking : (todayData.SHIP_BOOKING || {content: ""});
                    const mgr = managerData.name ? managerData : (todayData.MANAGER || {name: ""});

                    const payloadOther = {
                        "B": safe.incidents || "", 
                        "C": safe.systems || "",
                        "D": safe.suggestions || "",
                        "E": safe.env_impact || "",
                        "F": dInfo.content || "",
                        "G": nPlan.content || "",
                        "H": ship.content || "",
                        "I": mgr.name || ""
                    };

                    await fetch(SVODKA_API_URL, { 
                        method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: 'UPDATE_SHEET_OTHER',
                            user: currentUser,
                            date: dailyDate,
                            data: payloadOther
                        })
                    });

                    // =========================================================
                    // 3. G·ª¨I SHEET HR (NH√ÇN S·ª∞) - DANH S√ÅCH
                    // =========================================================
                    
                    // L·∫•y danh s√°ch nh√¢n s·ª±
                    const hrList = personnelData.length > 0 ? personnelData : (todayData.PERSONNEL || []);

                    // üëáüëáüëá T√çNH T·ªîNG S·ªê NG∆Ø·ªúI (ƒê·ªÇ HI·ªÇN TH·ªä ALERT) üëáüëáüëá
                    const totalPeople = hrList.reduce((sum, item) => sum + (parseInt(item.count) || 0), 0);

                    // Chu·∫©n b·ªã d·ªØ li·ªáu m·∫£ng ƒë·ªÉ g·ª≠i
                    const payloadHR = hrList.map(item => ({
                        company: item.company || "", 
                        count: item.count || 0,      
                        job: item.job || ""          
                    }));

                    await fetch(SVODKA_API_URL, { 
                        method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: 'UPDATE_SHEET_HR',
                            user: currentUser,
                            date: dailyDate,
                            data: payloadHR
                        })
                    });
                    
                    // =========================================================

                    logToCloud(currentUser, `ƒê·∫©y Svodka ng√†y ${dailyDate} (All Sheets)`);
                    
                    // ·ªû ƒë√¢y bi·∫øn totalPeople ƒë√£ ƒë∆∞·ª£c t√≠nh to√°n n√™n s·∫Ω kh√¥ng b·ªã l·ªói n·ªØa
                    alert(`‚úÖ ƒê√£ g·ª≠i d·ªØ li·ªáu th√†nh c√¥ng!\n\n1. Detail: S·ªë li·ªáu v·∫≠n h√†nh\n2. Others: B√°o c√°o an to√†n/k·∫ø ho·∫°ch\n3. HR: Nh√¢n s·ª± (T·ªïng: ${totalPeople})\n\nVui l√≤ng ki·ªÉm tra file Excel.`);

                } catch (error) {
                    console.error(error);
                    alert("L·ªói: " + error.message);
                } finally {
                    setIsSyncing(false);
                }
            };
			
			// --- H√ÄM ƒêƒÇNG XU·∫§T ---
            const handleLogout = () => {
                if (window.confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng?")) {
                    // --> TH√äM D√íNG N√ÄY (Ghi log TR∆Ø·ªöC KHI x√≥a user):
                    logToCloud(currentUser, "ƒêƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng");
                    
                    setCurrentUser(null); 
                    setShowLoginModal(true); 
                    // ... (c√°c l·ªánh reset kh√°c) ...
                }
            };
            // ------------------------------------------------
            const handleRestore = (e) => {
				const file = e.target.files[0];
				if (!file) return;
				const reader = new FileReader();
				reader.onload = (event) => {
					try {
						const restoredData = JSON.parse(event.target.result);
						setDb(restoredData);
						
						// --- GHI LOG ---
						logToCloud(currentUser, `H√†nh ƒë·ªông: Kh√¥i ph·ª•c (Restore) d·ªØ li·ªáu t·ª´ file: ${file.name}`);
						alert("‚úÖ Kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!");
					} catch (err) {
						alert("L·ªói file: " + err.message);
					}
				};
				reader.readAsText(file);
			};

			// --- H√ÄM X√ìA S·ªê LI·ªÜU V·∫¨N H√ÄNH (GI·ªÆ B√ÅO C√ÅO & H√ÄNH CH√çNH) ---
            const handleClearAllDailyData = () => {
                if (window.confirm(`‚ö†Ô∏è X√ÅC NH·∫¨N:\n\nB·∫°n mu·ªën x√≥a c√°c S·ªê LI·ªÜU V·∫¨N H√ÄNH (RP, RC, ƒêi·ªán, GTC...) c·ªßa ng√†y [${dailyDate}]?\n\n(C√°c m·ª•c: Nh√¢n s·ª±, H√≥a ph·∫©m, An to√†n, B√°o c√°o, T·ª∑ tr·ªçng kh√≠... s·∫Ω ƒë∆∞·ª£c GI·ªÆ NGUY√äN)`)) {
                    
                    // 1. NH√ìM B·ªä X√ìA (S·ªë li·ªáu k·ªπ thu·∫≠t)
                    setRp3Data({});
                    setRp2Data({});
                    setRp1Data({});
                    setRc13Data({});
                    setDgcpGasData({});
                    setElecData({});
                    setGtcData({});
                    setTechData({});     // Th√¥ng s·ªë CN GTC
                    setBcpTechData({});  // Th√¥ng s·ªë CN BCP
                    setBcpStopData({});  // Gi·ªù d·ª´ng BCP

                    // 2. NH√ìM FUEL GAS (X·ª≠ l√Ω ƒë·∫∑c bi·ªát: X√≥a l∆∞·ª£ng kh√≠, Gi·ªØ t·ª∑ tr·ªçng)
                    setFuelGasData(prev => ({
                        // Gi·ªØ l·∫°i T·ª∑ tr·ªçng v√† ghi ch√∫ t·ª∑ tr·ªçng
                        density: prev.density || 0.908,
                        density_note: prev.density_note || "Q4-2026",
                        // X√≥a c√°c s·ªë li·ªáu nh·∫≠p v√†o
                        gtca_kg: "", gtca_note: "",
                        gtcb_kg: "", gtcb_note: "",
                        gtg_kg: "", gtg_note: ""
                    }));

                    // 3. NH√ìM ƒê∆Ø·ª¢C GI·ªÆ L·∫†I (Kh√¥ng g·ªçi h√†m set... = Kh√¥ng thay ƒë·ªïi)
                    // - setChemicalsData(...) -> Gi·ªØ nguy√™n H√≥a ph·∫©m
                    // - setPersonnelData(...) -> Gi·ªØ nguy√™n Nh√¢n s·ª±
                    // - setSafetyData(...)    -> Gi·ªØ nguy√™n An to√†n
                    // - setManagerData(...)   -> Gi·ªØ nguy√™n Ng∆∞·ªùi qu·∫£n l√Ω
                    // - setNextDayPlan(...)   -> Gi·ªØ nguy√™n K·∫ø ho·∫°ch mai
                    // - setDailyInfo(...)     -> Gi·ªØ nguy√™n Th√¥ng tin ng√†y
                    // - setShipBooking(...)   -> Gi·ªØ nguy√™n ƒê·∫∑t t√†u

                    // Ghi log h√†nh ƒë·ªông
                    logToCloud(currentUser, `ƒê√£ x√≥a s·ªë li·ªáu v·∫≠n h√†nh ng√†y ${dailyDate} (Gi·ªØ l·∫°i b√°o c√°o/nh√¢n s·ª±)`);
                    alert("‚úÖ ƒê√£ x√≥a xong s·ªë li·ªáu v·∫≠n h√†nh!");
                }
            };

            // --- 1. TH√äM STATE QU·∫¢N L√ù K·ª≤ B√ÅO C√ÅO ---
            const [reportPeriod, setReportPeriod] = useState('MONTH'); // 'MONTH', 'Q1', 'Q2', 'Q3', 'Q4', 'YEAR'

            // --- 2. LOGIC T·ªîNG H·ª¢P D·ªÆ LI·ªÜU (C·∫¨P NH·∫¨T: T√çNH C·∫¢ KPI GAS/BCP) ---
            const combinedReportData = useMemo(() => {
                // A. X√°c ƒë·ªãnh danh s√°ch th√°ng
                let monthsToScan = [];
                if (reportPeriod === 'MONTH') monthsToScan = [selectedMonth];
                else if (reportPeriod === 'Q1') monthsToScan = [1, 2, 3];
                else if (reportPeriod === 'Q2') monthsToScan = [4, 5, 6];
                else if (reportPeriod === 'Q3') monthsToScan = [7, 8, 9];
                else if (reportPeriod === 'Q4') monthsToScan = [10, 11, 12];
                else if (reportPeriod === 'YEAR') monthsToScan = Array.from({length: 12}, (_, i) => i + 1);

                let allMaints = [], allShutdowns = [], allEvents = [];
                
                // --- BI·∫æN T√çNH TO√ÅN KPI (M·ªöI) ---
                let kpi = {
                    gasPlan: 0, gasActual: 0,
                    bcpPlan: 0, bcpActual: 0
                };

                monthsToScan.forEach(m => {
                    // 1. L·∫•y d·ªØ li·ªáu c√¥ng vi·ªác chung
                    const mShared = db.SHARED?.[m];
                    if (mShared) {
                        if (mShared.maintenancePlans) allMaints.push(...mShared.maintenancePlans.map(i => ({...i, month: m})));
                        if (mShared.shutdownIncidents) allShutdowns.push(...mShared.shutdownIncidents.map(i => ({...i, month: m})));
                        if (mShared.events) allEvents.push(...mShared.events.map(i => ({...i, month: m})));
                    }

                    // 2. L·∫•y d·ªØ li·ªáu S·∫£n l∆∞·ª£ng (Gas/BCP)
                    const mGas = db.GASLIFT?.[m];
                    const mBcp = db.BCP?.[m];

                    if (mGas) {
                        kpi.gasPlan += parseFloat(mGas.plan?.target || 0);
                        const actuals = Object.values(mGas.actuals || {}).reduce((a, b) => a + (b || 0), 0);
                        kpi.gasActual += actuals;
                    }
                    if (mBcp) {
                        kpi.bcpPlan += parseFloat(mBcp.plan?.target || 0);
                        const actuals = Object.values(mBcp.actuals || {}).reduce((a, b) => a + (b || 0), 0);
                        kpi.bcpActual += actuals;
                    }
                });

                // C. T·∫°o Timeline
                let items = [];
                allMaints.forEach(p => items.push({ ...p, type: 'B·∫£o d∆∞·ª°ng', rawDate: new Date(p.start), sortDate: new Date(p.start) }));
                allShutdowns.forEach(p => items.push({ ...p, type: 'S·ª± c·ªë d·ª´ng m√°y', rawDate: new Date(p.start), sortDate: new Date(p.start) }));
                allEvents.forEach(e => items.push({ ...e, type: 'S·ª± ki·ªán chung', description: e.name, start: e.startDate || e.date, end: e.endDate, rawDate: new Date(e.startDate || e.date || 0), sortDate: new Date(e.startDate || e.date || 0) }));
                items.sort((a, b) => a.sortDate - b.sortDate);

                // D. T√≠nh to√°n th·ªëng k√™ kh√°c
                const totalShutdowns = allShutdowns.length;
                let totalShutdownHours = 0;
                let shutdownFixed = 0;
                const equipCount = {};
                allShutdowns.forEach(s => {
                    totalShutdownHours += calculateHoursDiff(s.start, s.end);
                    if (s.status === 'ƒê√£ kh·∫Øc ph·ª•c') shutdownFixed++;
                    const eq = s.equipment || 'Kh√°c';
                    equipCount[eq] = (equipCount[eq] || 0) + 1;
                });
                const topEquip = Object.entries(equipCount).sort((a,b) => b[1] - a[1])[0];

                const totalMaints = allMaints.length;
                let maintCompleted = 0;
                let totalMaintHours = 0;
                const unitCount = {};
                allMaints.forEach(m => {
                    totalMaintHours += calculateHoursDiff(m.start, m.end);
                    if (m.status === 'ƒê√£ ho√†n th√†nh') maintCompleted++;
                    const unit = m.performingUnit || 'Kh√°c';
                    unitCount[unit] = (unitCount[unit] || 0) + 1;
                });
                const topUnit = Object.entries(unitCount).sort((a,b) => b[1] - a[1])[0];
                const totalEvents = allEvents.length;
                const eventPlanCount = allEvents.filter(e => e.eventType === 'K·∫ø ho·∫°ch').length;
                const today = new Date();
                const futureEvents = items.filter(i => i.rawDate > today);
				
				
				
				// E. Th·ªëng k√™ Gi·ªù ch·∫°y M√°y (Aggregation) ---
                const EQUIPMENT_LIST = ['GTC-A', 'GTC-B', 'BCP-DGCP', 'GTG'];
                const aggRunHours = {};
                
                EQUIPMENT_LIST.forEach(eq => {
                    let totalRun = 0;
                    let totalStop = 0;
                    let totalPotential = 0;

                    monthsToScan.forEach(m => {
                        const daysInM = getDaysInMonth(m, year);
                        const potential = daysInM * 24;
                        totalPotential += potential;

                        // L·∫•y d·ªØ li·ªáu th√°ng ƒë√≥
                        const mShared = db.SHARED?.[m] || { maintenancePlans: [], shutdownIncidents: [] };
                        
                        // T√≠nh gi·ªù d·ª´ng trong th√°ng m
                        const startM = new Date(year, m - 1, 1).getTime();
                        const endM = new Date(year, m, 0, 23, 59, 59).getTime();

                        // Helper overlap (copy l·∫°i t·ª´ tr√™n ho·∫∑c t√°ch ra h√†m chung)
                        const getOL = (s1, e1) => {
                             const s = Math.max(s1, startM);
                             const e = Math.min(e1, endM);
                             return Math.max(0, (e - s) / (1000 * 60 * 60));
                        };

                        (mShared.maintenancePlans || []).filter(i => i.equipment === eq || i.maintenanceEquipment === eq).forEach(job => {
                             totalStop += getOL(new Date(job.start).getTime(), new Date(job.end).getTime());
                        });
                        
                        (mShared.shutdownIncidents || []).filter(i => i.equipment === eq).forEach(job => {
                             // N·∫øu ch∆∞a kh·∫Øc ph·ª•c m√† ƒëang xem th√°ng qu√° kh·ª© -> coi nh∆∞ d·ª´ng c·∫£ th√°ng ƒë√≥ ho·∫∑c ƒë·∫øn khi k·∫øt th√∫c
                             let eTime = job.end ? new Date(job.end).getTime() : endM; 
                             totalStop += getOL(new Date(job.start).getTime(), eTime);
                        });
                    });

                    const run = Math.max(0, totalPotential - totalStop);
                    const avail = totalPotential > 0 ? (run / totalPotential) * 100 : 0;
                    
                    aggRunHours[eq] = {
                        run: run.toFixed(1),
                        stop: totalStop.toFixed(1),
                        avail: avail.toFixed(1)
                    };
                });

                return { 
                    timeline: items, 
                    // KPI Data (M·ªõi)
                    kpi,
                    // Stats Shutdown
                    totalShutdowns, totalShutdownHours, shutdownFixed, 
                    topEquip: topEquip ? `${topEquip[0]} (${topEquip[1]} l·∫ßn)` : "Kh√¥ng c√≥",
                    shutdownPending: totalShutdowns - shutdownFixed,
                    // Stats Maint
                    totalMaints, maintCompleted, totalMaintHours,
                    topUnit: topUnit ? `${topUnit[0]} (${topUnit[1]} job)` : "Kh√¥ng c√≥",
                    maintPercent: totalMaints > 0 ? (maintCompleted/totalMaints)*100 : 0,
                    // Stats Events
                    totalEvents, eventPlanCount, aggRunHours,
                    futureEvents 
                };
            }, [db, selectedMonth, year, reportPeriod]);
			
			// --- 3. T√çNH T·ªîNG H·ª¢P GI·ªú CH·∫†Y THEO K·ª≤ B√ÅO C√ÅO (M·ªöI) ---
            const aggregatedEquipStats = useMemo(() => {
                // A. X√°c ƒë·ªãnh c√°c th√°ng c·∫ßn qu√©t (Gi·ªëng logic KPI)
                let monthsToScan = [];
                if (reportPeriod === 'MONTH') monthsToScan = [selectedMonth];
                else if (reportPeriod === 'Q1') monthsToScan = [1, 2, 3];
                else if (reportPeriod === 'Q2') monthsToScan = [4, 5, 6];
                else if (reportPeriod === 'Q3') monthsToScan = [7, 8, 9];
                else if (reportPeriod === 'Q4') monthsToScan = [10, 11, 12];
                else if (reportPeriod === 'YEAR') monthsToScan = Array.from({length: 12}, (_, i) => i + 1);

                // B. Kh·ªüi t·∫°o bi·∫øn t·ªïng
                const EQUIPMENT_LIST = ['GTC-A', 'GTC-B', 'BCP-DGCP', 'GTG'];
                const totals = {};
                
                EQUIPMENT_LIST.forEach(eq => {
                    totals[eq] = {
                        plannedRunTotal: 0,
                        maintDownSoFar: 0,
                        breakdownSoFar: 0,
                        runSoFar: 0,
                        maintRemaining: 0,
                        runForecast: 0,
                        gap: 0
                    };
                });

                // C. V√≤ng l·∫∑p c·ªông d·ªìn s·ªë li·ªáu t·ª´ng th√°ng
                monthsToScan.forEach(m => {
                    // L·∫•y d·ªØ li·ªáu th√°ng m
                    const mData = db.SHARED?.[m] || { maintenancePlans: [], shutdownIncidents: [] };
                    
                    // G·ªçi h√†m t√≠nh to√°n cho th√°ng m
                    const stats = calcEquipmentRunHours(m, mData);

                    // C·ªông d·ªìn v√†o t·ªïng
                    EQUIPMENT_LIST.forEach(eq => {
                        if (stats[eq]) {
                            totals[eq].plannedRunTotal += parseFloat(stats[eq].plannedRunTotal) || 0;
                            totals[eq].maintDownSoFar += parseFloat(stats[eq].maintDownSoFar) || 0;
                            totals[eq].breakdownSoFar += parseFloat(stats[eq].breakdownSoFar) || 0;
                            totals[eq].runSoFar += parseFloat(stats[eq].runSoFar) || 0;
                            totals[eq].maintRemaining += parseFloat(stats[eq].maintRemaining) || 0;
                            totals[eq].runForecast += parseFloat(stats[eq].runForecast) || 0;
                            totals[eq].gap += parseFloat(stats[eq].gap) || 0;
                        }
                    });
                });

                // D. L√†m tr√≤n s·ªë ƒë·ªÉ hi·ªÉn th·ªã ƒë·∫πp
                EQUIPMENT_LIST.forEach(eq => {
                    Object.keys(totals[eq]).forEach(key => {
                        totals[eq][key] = totals[eq][key].toFixed(1);
                    });
                });

                return totals;

            }, [db, selectedMonth, year, reportPeriod]); // T·ª± ch·∫°y l·∫°i khi ƒë·ªïi k·ª≥ b√°o c√°o

			// ---4. H√ÄM CHUY·ªÇN TH√ÅNG NHANH (C√ì T·ª∞ ƒê·ªîI NƒÇM) ---
            const changeSelectedMonth = (offset) => {
                let newMonth = selectedMonth + offset;
                let newYear = year;

                if (newMonth > 12) {
                    newMonth = 1;
                    newYear += 1;
                } else if (newMonth < 1) {
                    newMonth = 12;
                    newYear -= 1;
                }

                setYear(newYear);
                setSelectedMonth(newMonth);
            };

			// --- 5. LOGIC DASHBOARD (T·ª∞ ƒê·ªòNG C·∫¨P NH·∫¨T T·ª™ TH·∫∫ DGCP GAS) ---
            const renderDashboard = () => {
				
                const daysInMonth = new Date(year, selectedMonth, 0).getDate();
                const daysArray = Array.from({ length: daysInMonth }, (_, i) => i + 1);

                // L·∫•y k·∫ø ho·∫°ch
                const planGas = db?.GASLIFT?.[selectedMonth]?.plan?.target || 30000;
                const planBcp = db?.BCP?.[selectedMonth]?.plan?.target || 15000;

                let totalGaslift = 0;
                let totalBcp = 0;

                const dashboardData = daysArray.map(day => {
                    // T·∫°o chu·ªói ng√†y chu·∫©n ƒë·ªÉ t√¨m trong DB nh·∫≠p tay (V√≠ d·ª•: 2026-02-02)
                    const dateStr = `${year}-${String(selectedMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    
                    // 1. L·∫§Y D·ªÆ LI·ªÜU T·ª™ NH·∫¨P TAY (DGCP_GAS) - ƒê√ÇY L√Ä CH√åA KH√ìA
                    // N√≥ s·∫Ω t√¨m ƒë√∫ng ng√†y, ƒë√∫ng th·∫ª DGCP_GAS ƒë·ªÉ l·∫•y s·ªë li·ªáu
                    const dailyReport = db.DAILY_REPORTS?.[dateStr]?.DGCP_GAS || {};
                    
                    // 2. L·∫§Y D·ªÆ LI·ªÜU T·ª™ EXCEL C≈® (D·ª± ph√≤ng cho c√°c th√°ng c≈©)
                    const excelGas = db.GASLIFT?.[selectedMonth]?.actuals?.[day] || 0;
                    const excelBcp = db.BCP?.[selectedMonth]?.actuals?.[day] || 0;

                    // 3. QUY·∫æT ƒê·ªäNH L·∫§Y S·ªê N√ÄO?
                    // N·∫øu b√™n th·∫ª DGCP Gas ƒë√£ nh·∫≠p s·ªë (k·ªÉ c·∫£ s·ªë 0), th√¨ l·∫•y s·ªë ƒë√≥.
                    // N·∫øu ch∆∞a nh·∫≠p g√¨ (undefined/r·ªóng), th√¨ m·ªõi l·∫•y s·ªë t·ª´ Excel c≈©.
                    
                    let valGas, valBcp;

                    if (dailyReport.gaslift !== undefined && dailyReport.gaslift !== "") {
                        valGas = parseFloat(dailyReport.gaslift);
                    } else {
                        valGas = excelGas;
                    }

                    if (dailyReport.bcp_ft305 !== undefined && dailyReport.bcp_ft305 !== "") {
                        valBcp = parseFloat(dailyReport.bcp_ft305);
                    } else {
                        valBcp = excelBcp;
                    }

                    // C·ªông d·ªìn v√†o t·ªïng th√°ng
                    totalGaslift += valGas;
                    totalBcp += valBcp;

                    return { day, valGas, valBcp };
                });

                // T√≠nh ph·∫ßn trƒÉm ho√†n th√†nh
                const gasPercent = planGas > 0 ? (totalGaslift / planGas) * 100 : 0;
                const bcpPercent = planBcp > 0 ? (totalBcp / planBcp) * 100 : 0;

            };

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans pb-10">
                    <header className="bg-blue-900 text-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <div>
                                    <h1 className="text-xl font-bold">H·ªá th·ªëng Qu·∫£n l√Ω V·∫≠n h√†nh Khai th√°c gi√†n DGCP</h1>
                                    {/* --- YEAR SELECTOR --- */}
                                    <div className="flex items-center gap-2 mt-1">
                                        <p className="text-blue-200 text-sm">NƒÉm</p>
                                        <div className="flex items-center bg-blue-800 rounded px-2 py-0.5">
                                            <button onClick={() => handleChangeYear(-1)} className="text-blue-300 hover:text-white px-1 font-bold text-sm">‚Äπ</button>
                                            <span className="text-white font-bold mx-1 text-sm">{year}</span>
                                            <button onClick={() => handleChangeYear(1)} className="text-blue-300 hover:text-white px-1 font-bold text-sm">‚Ä∫</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                {/* Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng & Th·ªùi gian d·ªØ li·ªáu */}
                                <div className="hidden md:flex flex-col items-end text-right">
                                    
                                    {/* --- M·ªöI: HI·ªÇN TH·ªä TH·ªúI GIAN C·∫¨P NH·∫¨T D·ªÆ LI·ªÜU --- */}
                                    <div className="mb-1 flex items-center gap-1.5">
                                        <span className="text-[10px] text-blue-300 uppercase tracking-wide">C·∫≠p nh·∫≠t g·∫ßn nh·∫•t:</span>
                                        <span className="text-xs font-bold text-white bg-blue-800/50 px-1.5 py-0.5 rounded border border-blue-700/50 shadow-sm">
                                            {db && db.lastUpdated 
                                                ? new Date(db.lastUpdated).toLocaleString('vi-VN') 
                                                : 'Ch∆∞a c√≥ d·ªØ li·ªáu'}
                                        </span>
                                    </div>
                                    {/* ------------------------------------------------ */}

                                    <div className="text-xs text-blue-300">
                                        Xin ch√†o, <span className="font-bold text-yellow-300">{currentUser || 'Kh√°ch'}</span>
                                    </div>
                                    <div className="text-lg font-bold text-white font-mono leading-none mt-0.5">
                                        {currentTime.toLocaleTimeString('vi-VN', { hour12: false })}
                                    </div>
                                </div>

                                <div className="h-8 w-px bg-blue-700 hidden md:block"></div>

                                {/* N√∫t ƒêƒÉng xu·∫•t */}
                                <button 
                                    onClick={handleLogout}
                                    className="flex items-center gap-1 bg-red-600 hover:bg-red-700 text-white text-xs px-3 py-1.5 rounded font-bold transition-colors shadow-sm"
                                    title="Tho√°t kh·ªèi phi√™n l√†m vi·ªác"
                                >
                                    ƒêƒÉng xu·∫•t
                                </button>
                            </div>
                        </div>
                    </header>
					
					{/* 2. THANH c√°c TAB (M·ªöI) */}
                    <div className="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-md mb-1 transition-all">
                        <div className="max-w-7xl mx-auto px-4 flex gap-6">
                            {/* Tab Dashboard T·ªïng quan */}
                            <button 
                                onClick={() => setActiveView('DASHBOARD')}
                                className={`py-3 px-2 text-sm font-bold border-b-2 transition-colors flex items-center gap-2 ${
                                    activeView === 'DASHBOARD' 
                                    ? 'border-blue-600 text-blue-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                }`}
                            >
                                Dashboard T·ªïng quan
                            </button>

                            {/* Tab Nh·∫≠p li·ªáu H√†ng ng√†y */}
                            <button 
                                onClick={() => setActiveView('DAILY_INPUT')}
                                className={`py-3 px-2 text-sm font-bold border-b-2 transition-colors flex items-center gap-2 ${
                                    activeView === 'DAILY_INPUT' 
                                    ? 'border-green-600 text-green-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                }`}
                            >
                                Nh·∫≠p li·ªáu H√†ng ng√†y
                            </button>
                        </div>
                    </div>
            
						<main className="max-w-screen-2xl mx-auto px-4 py-2">
                        
                        {/* --- Kh·ªëi giao di·ªán Tab 1: HI·ªÇN TH·ªä DASHBOARD t·ªïng h·ª£p  */}
                        {activeView === 'DASHBOARD' && (
                            <div className="animate-in fade-in duration-300">
                                {/* --- CONTROL BAR STICKY --- */}
								<div className="sticky top-[48px] z-40 bg-gray-50/95 backdrop-blur-sm pt-2 pb-2 mb-2 transition-all">
									<div className="flex flex-col gap-1.5">

										{/* H√ÄNG 1: CH·ªåN TH√ÅNG + C√îNG C·ª§ ADMIN + CLOUD */}
										<div className="flex flex-wrap items-center gap-3 bg-white p-1.5 rounded-xl shadow-sm border border-gray-200">
											
											{/* KHU V·ª∞C CH·ªåN TH√ÅNG */}
											<div className="flex items-center overflow-x-auto no-scrollbar pr-2">
												<span className="font-bold text-gray-700 mr-2 border border-gray-300 bg-gray-50 px-2 py-1 rounded text-[11px] whitespace-nowrap">Th√°ng:</span>
												<button onClick={() => changeSelectedMonth(-1)} className="w-7 h-7 flex items-center justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-full mr-1">
													<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
												</button>
												<div className="flex items-center gap-1">
													{MONTHS.map(m => (
														<button key={m} onClick={() => setSelectedMonth(m)} className={`w-7 h-7 rounded-full flex items-center justify-center text-[11px] font-bold border transition-all ${selectedMonth === m ? 'bg-blue-600 text-white border-blue-600 shadow-md scale-105' : 'bg-white text-gray-500 border-gray-200 hover:border-blue-400'}`}>
															{m}
														</button>
													))}
												</div>
												<button onClick={() => changeSelectedMonth(1)} className="w-7 h-7 flex items-center justify-center text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-full ml-1">
													<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18l6-6-6-6"/></svg>
												</button>
											</div>

											<div className="h-5 w-px bg-gray-300 mx-0.5 hidden md:block"></div>

											{/* C√îNG C·ª§ QU·∫¢N TR·ªä */}
											{ADMIN_USERS.includes(currentUser) && (
												<div className="flex items-center gap-1.5">
													<button onClick={() => setShowLogModal(true)} className="text-[11px] bg-slate-800 text-white px-2.5 py-1.5 rounded font-bold">Nh·∫≠t k√Ω</button>
													<button onClick={handleBackup} className="text-[11px] bg-indigo-50 text-indigo-700 px-2.5 py-1.5 rounded border border-indigo-200 font-bold">Backup</button>
													<button onClick={() => restoreInputRef.current.click()} className="text-[11px] bg-pink-50 text-pink-700 px-2.5 py-1.5 rounded border border-pink-200 font-bold">Restore</button>
													{backupDb && (
														<button onClick={handleUndo} className="text-[11px] bg-orange-100 text-orange-700 px-2.5 py-1.5 rounded border border-orange-200 font-bold animate-pulse">Ho√†n t√°c</button>
													)}
												</div>
											)}

											<div className="h-5 w-px bg-gray-300 mx-0.5 hidden md:block"></div>

											{/* C√îNG C·ª§ CLOUD */}
											<div className="flex items-center gap-1.5">
												<button onClick={handlePullFromCloud} className="text-[11px] bg-green-50 text-green-700 px-2.5 py-1.5 rounded border border-green-200 font-bold">T·∫£i v·ªÅ</button>
												{ADMIN_USERS.includes(currentUser) && (
													<button onClick={handlePushToCloud} className="text-[11px] bg-green-600 text-white px-2.5 py-1.5 rounded font-bold shadow-sm">ƒê·∫©y l√™n Cloud</button>
												)}
											</div>
										</div>

										{/* H√ÄNG 2: B√ÅO C√ÅO + NGHI·ªÜP V·ª§ */}
										<div className="flex flex-wrap items-center gap-2 pl-1">
											<button onClick={() => setShowCombinedReport(true)} className="text-xs font-bold px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-md transform hover:-translate-y-0.5">
												 B√°o c√°o T·ªïng h·ª£p
											</button>
											{ADMIN_USERS.includes(currentUser) && (
												<>
													<button onClick={handleScanForTransfer} className="text-xs bg-orange-50 text-orange-800 border border-orange-200 px-3 py-2 rounded-lg font-bold flex items-center gap-1.5 shadow-sm">
														<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
														Chuy·ªÉn t·ªìn ƒë·ªçng
													</button>
													<button onClick={() => setImportMode('PLAN')} className="text-xs bg-blue-50 text-blue-700 border border-blue-200 px-3 py-2 rounded-lg font-bold flex items-center gap-1.5 shadow-sm">
														<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
														Nh·∫≠p k·∫ø ho·∫°ch nƒÉm
													</button>
												</>
											)}
										</div>
									</div>
								</div>

                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                {/* CARD K·∫æ HO·∫†CH B·∫¢O D∆Ø·ª†NG */}
                                <Card className="p-5">
                                    <div className="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
                                        <h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2">K·∫ø ho·∫°ch b·∫£o d∆∞·ª°ng</h3>
                                        
                                        <div className="flex items-center gap-2">
                                            {/* --- N√öT B√ÅO C√ÅO NƒÇM (M·ªöI TH√äM) --- */}
                                            <button 
                                                onClick={() => setShowAnnualMaintModal(true)}
                                                className="text-[10px] bg-indigo-50 text-indigo-700 border border-indigo-200 px-2 py-1 rounded hover:bg-indigo-100 transition-colors flex items-center gap-1 font-bold"
                                                title="Xem b·∫£ng t·ªïng h·ª£p c·∫£ nƒÉm"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                                                B√°o c√°o NƒÉm
                                            </button>
											
											{/* N√∫t H·ªßy (khi ƒëang s·ª≠a) */}
                                            {isEditingMaint && (
                                                <button onClick={()=>setIsEditingMaint(false)} className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200">
                                                    H·ªßy
                                                </button>
                                            )}

                                            {/* N√∫t Copy (Ch·ªâ hi·ªán khi KH√îNG s·ª≠a & l√† Admin) */}
                                            {!isEditingMaint && ADMIN_USERS.includes(currentUser) && (
                                                <button 
                                                    onClick={handleCopyFromAnyYear} // <-- G·ªçi h√†m m·ªõi
                                                    className="text-[10px] bg-blue-50 text-blue-600 border border-blue-200 px-2 py-1 rounded hover:bg-blue-100 transition-colors flex items-center gap-1 font-bold ml-auto"
                                                    title="Copy k·∫ø ho·∫°ch t·ª´ nƒÉm kh√°c..."
                                                >
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                                                    Copy t·ª´ nƒÉm...
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    {!isEditingMaint ? (
                                        /* DANH S√ÅCH K·∫æ HO·∫†CH B·∫¢O D∆Ø·ª†NG*/
                                        <div>
                                            <div className="mb-2 flex justify-between items-center">
                                                {ADMIN_USERS.includes(currentUser) && (
                                                    <button onClick={handleAddMaintDirectly} className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200 transition-colors font-medium">
                                                        + Th√™m b·∫£o d∆∞·ª°ng
                                                    </button>
                                                )}
                                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded font-medium">
                                                    T·ªïng: {gasMetrics.totalMaintenanceDays} ng√†y
                                                </span>
                                            </div>

                                            <div className="space-y-2 max-h-80 overflow-y-auto custom-scrollbar">
                                                {(!currentSharedData.maintenancePlans || currentSharedData.maintenancePlans.length === 0) && (
                                                    <p className="text-xs text-gray-400 italic text-center py-2">Kh√¥ng c√≥ k·∫ø ho·∫°ch b·∫£o d∆∞·ª°ng</p>
                                                )}
                                                
                                                {(currentSharedData.maintenancePlans || []).map(plan => {
                                                    // T√≠nh k·ª≥ t·ªõi
                                                    let nextMaintText = null;
                                                    if (plan.end) {
                                                        const endDate = new Date(plan.end);
                                                        if (!isNaN(endDate.getTime())) {
                                                            const nextDate = new Date(endDate.getTime() + (2000 * 60 * 60 * 1000));
                                                            nextMaintText = `${nextDate.getDate().toString().padStart(2,'0')}/${(nextDate.getMonth()+1).toString().padStart(2,'0')}/${nextDate.getFullYear()}`;
                                                        }
                                                    }

                                                    return (
                                                        <div key={plan.id} className="text-sm bg-gray-50 p-3 rounded border border-gray-200 cursor-pointer hover:bg-blue-50 transition-colors flex flex-col gap-1" onDoubleClick={() => openMaintDetail(plan)}>
                                                            
                                                            {/* H√†ng 1: T√™n + Copy + Gi·ªù */}
                                                            <div className="flex justify-between items-start">
                                                                <div className="font-bold text-gray-800 text-sm flex-1 mr-2">{plan.description}</div>
                                                                <div className="flex items-center gap-1">
                                                                    {ADMIN_USERS.includes(currentUser) && (
                                                                        <button onClick={(e) => { e.stopPropagation(); handleDuplicateMaint(plan); }} className="text-cyan-600 hover:bg-cyan-50 p-1 rounded">
                                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                                                        </button>
                                                                    )}
                                                                    <div className="flex items-center font-bold text-blue-600 text-xs bg-blue-100 px-2 py-0.5 rounded-full border border-blue-200">
                                                                        <span className="text-blue-400 text-[10px] uppercase mr-1">Time:</span>
                                                                        {calculateHoursDiff(plan.start, plan.end).toFixed(2)}h
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            {/* H√†ng 2: Th·ªùi gian */}
                                                            <div className="text-xs text-gray-500 mt-2 space-y-1">
                                                                {!plan.isUnplanned && (
                                                                    <div className="flex items-center gap-2 bg-slate-50 p-1 rounded border border-slate-100">
                                                                        <span className="text-[10px] font-bold text-slate-400 uppercase w-20 flex-shrink-0 whitespace-nowrap">üìÖ D·ª± ki·∫øn:</span>
                                                                        <span className="font-mono text-[11px] text-slate-600">
                                                                            {formatDate(plan.plannedStart || plan.start)} <span className="mx-1">‚ûî</span> {formatDate(plan.plannedEnd || plan.end)}
                                                                        </span>
                                                                    </div>
                                                                )}

                                                                {(plan.isUnplanned || (plan.status && plan.status !== 'Ch∆∞a th·ª±c hi·ªán')) && (
                                                                    <div className={`flex items-center gap-2 p-1 rounded border ${plan.isUnplanned ? 'bg-red-50 border-red-100 text-red-800' : 'bg-emerald-50 border-emerald-100 text-emerald-800'}`}>
                                                                        <span className={`text-[10px] font-bold uppercase w-20 flex-shrink-0 whitespace-nowrap ${plan.isUnplanned ? 'text-red-500' : 'text-emerald-500'}`}>
                                                                            {plan.isUnplanned ? '‚ö° S·ª± c·ªë:' : '‚è±Ô∏è Th·ª±c t·∫ø:'}
                                                                        </span>
                                                                        <div className="font-mono font-bold text-[11px]">
                                                                            {formatDate(plan.start)}
                                                                            {plan.end ? (<><span className="mx-1 opacity-60">‚ûî</span>{formatDate(plan.end)}</>) : (<span className="ml-2 text-[10px] italic animate-pulse text-red-500">(ƒêang th·ª±c hi·ªán...)</span>)}
                                                                        </div>
                                                                    </div>
                                                                )}

                                                                <div className="mt-1.5 flex flex-wrap items-center gap-2">
                                                                    {plan.status && <span className={`inline-flex items-center text-[10px] px-2 py-0.5 rounded border shadow-sm font-bold ${getEventStatusColor(plan.status)}`}>‚óè {plan.status}</span>}
                                                                    {nextMaintText && <div className="flex items-center gap-1 bg-purple-50 text-purple-700 px-1.5 py-0.5 rounded border border-purple-100"><span className="font-bold text-[10px]">üöÄ K·ª≥ t·ªõi:</span><span className="font-mono text-[10px]">{nextMaintText}</span></div>}
                                                                </div>
                                                                
                                                                {plan.info && <div className="text-gray-500 italic mt-1 bg-white p-1.5 rounded border border-gray-100 text-[11px]"><span className="font-semibold text-red-400 not-italic mr-1">Ghi ch√∫:</span>{plan.info}</div>}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ) : (
                                        /* CH·∫æ ƒê·ªò S·ª¨A NHANH (GI·ªÆ NGUY√äN) */
                                        <div>
                                            <div className="border p-2 bg-blue-50 rounded text-sm mb-2 border-blue-200">
                                                <div className="font-bold text-xs mb-1 text-blue-800">{editingMaintId ? "S·ª≠a:" : "Th√™m:"}</div>
                                                <input placeholder="M√¥ t·∫£..." className="w-full border p-1 mb-1 text-xs" value={newMaint.description} onChange={e=>setNewMaint({...newMaint, description: e.target.value})}/>
                                                <div className="grid grid-cols-2 gap-1 mb-1">
                                                    <input list="puMaintInline" placeholder="ƒê∆°n v·ªã..." className="border p-1 text-xs" value={newMaint.performingUnit} onChange={e=>setNewMaint({...newMaint, performingUnit: e.target.value})}/>
                                                    <input list="eqMaintInline" placeholder="Thi·∫øt b·ªã..." className="border p-1 text-xs" value={newMaint.maintenanceEquipment} onChange={e=>setNewMaint({...newMaint, maintenanceEquipment: e.target.value})}/>
                                                </div>
                                                <div className="grid grid-cols-2 gap-1 mb-1">
                                                    <input type="date" className="border p-1 text-xs" value={newMaint.start} onChange={e=>setNewMaint({...newMaint, start: e.target.value})}/>
                                                    <input type="date" className="border p-1 text-xs" value={newMaint.end} onChange={e=>setNewMaint({...newMaint, end: e.target.value})}/>
                                                </div>
                                                <div className="flex gap-2 mt-2">
                                                    <button onClick={handleAddOrUpdateMaint} className="flex-1 bg-blue-600 text-white py-1 rounded font-bold hover:bg-blue-700">L∆∞u</button>
                                                    {editingMaintId && <button onClick={()=>handleDeleteMaintItem(editingMaintId)} className="bg-gray-100 text-gray-600 px-3 rounded text-xs font-bold">X√≥a</button>}
                                                </div>
                                            </div>
                                            <div className="space-y-1 max-h-40 overflow-y-auto custom-scrollbar">
                                                {(tempMaints || []).map(plan => (
                                                    <div key={plan.id} className="text-xs p-1 border rounded cursor-pointer flex justify-between bg-gray-50" onClick={()=>handleStartEditMaintItem(plan)}>
                                                        <span className="truncate w-2/3">{plan.description}</span> 
                                                        <span className="text-gray-500">{formatDate(plan.start)}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </Card>

                                    {/* CARD S·ª∞ C·ªê D·ª™NG M√ÅY (GIAO DI·ªÜN M·ªöI - ƒê·ªíNG B·ªò) */}
								<Card className="p-5">
									<div className="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
										<h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2">S·ª± c·ªë d·ª´ng m√°y</h3>
										{/* --- N√öT B√ÅO C√ÅO S·ª∞ C·ªê (M·ªöI) --- */}
										<button 
											onClick={() => setShowAnnualShutdownModal(true)}
											className="text-[10px] bg-rose-50 text-rose-700 border border-rose-200 px-2 py-1 rounded hover:bg-rose-100 transition-colors flex items-center gap-1 font-bold"
											title="Xem b·∫£ng t·ªïng h·ª£p s·ª± c·ªë c·∫£ nƒÉm"
										>
											<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
											B√°o c√°o s·ª± c·ªë
										</button>
										{/* N√∫t H·ªßy (n·∫øu b·∫°n v·∫´n d√πng mode s·ª≠a nhanh) */}
										{isEditingShutdown && (
											<button onClick={()=>setIsEditingShutdown(false)} className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded">H·ªßy</button>
										)}
										
									</div>

									{!isEditingShutdown ? (
										<div>
											{/* Header ph·ª•: N√∫t th√™m m·ªõi */}
											<div className="mb-2">
												{ADMIN_USERS.includes(currentUser) && (
													<button 
														onClick={handleAddShutdownDirectly} 
														className="text-xs bg-red-100 text-red-700 px-2 py-1 rounded hover:bg-red-200 transition-colors font-medium border border-red-200"
													>
														+ Th√™m s·ª± c·ªë
													</button>
												)}
											</div>
											
											<div className="space-y-2 max-h-80 overflow-y-auto custom-scrollbar">
												{(currentSharedData.shutdownIncidents || []).length === 0 && (
													<p className="text-xs text-gray-400 italic text-center py-2">Kh√¥ng c√≥ s·ª± c·ªë ghi nh·∫≠n</p>
												)}
												
												{(currentSharedData.shutdownIncidents || []).map(plan => {
													const hours = calculateHoursDiff(plan.start, plan.end);
													const isProcessing = !plan.end || plan.status !== 'ƒê√£ kh·∫Øc ph·ª•c';

													return (
														<div key={plan.id} className="text-sm bg-gray-50 p-3 rounded border border-gray-200 cursor-pointer hover:bg-red-50 transition-colors flex flex-col gap-1 group" onDoubleClick={() => openShutdownDetail(plan)}>
															
															{/* H√ÄNG 1: TI√äU ƒê·ªÄ + T·ªîNG GI·ªú */}
															<div className="flex justify-between items-start">
																<div className="font-bold text-gray-800 text-sm flex-1 mr-2 group-hover:text-red-700 transition-colors">
																	{plan.equipment ? `${plan.equipment}: ` : ""}{plan.description}
																</div>
																<div className="flex items-center font-bold text-red-600 text-xs bg-red-100 px-2 py-0.5 rounded-full border border-red-200 shadow-sm">
																	<span className="text-red-400 text-[10px] uppercase mr-1">STOP:</span>
																	{hours.toFixed(2)}h
																</div>
															</div>

															{/* H√ÄNG 2: TH·ªúI GIAN TH·ª∞C T·∫æ (NH√ÉN R·ªòNG w-20) */}
															<div className="text-xs text-gray-500 mt-1">
																<div className={`flex items-center gap-2 p-1 rounded border ${isProcessing ? 'bg-red-50 border-red-100 text-red-800' : 'bg-emerald-50 border-emerald-100 text-emerald-800'}`}>
																	<span className={`text-[10px] font-bold uppercase w-20 flex-shrink-0 whitespace-nowrap ${isProcessing ? 'text-red-500' : 'text-emerald-500'}`}>
																		‚è±Ô∏è TH·ª∞C T·∫æ:
																	</span>
																	<div className="font-mono font-bold text-[11px]">
																		{formatDate(plan.start)}
																		{plan.end ? (
																			<>
																				<span className="mx-1 opacity-60">‚ûî</span>
																				{formatDate(plan.end)}
																			</>
																		) : (
																			<span className="ml-2 text-[10px] italic animate-pulse text-red-500">
																				(ƒêang x·ª≠ l√Ω...)
																			</span>
																		)}
																	</div>
																</div>
															</div>

															{/* H√ÄNG 3: TR·∫†NG TH√ÅI & TH√îNG TIN */}
															<div className="mt-1.5 flex flex-wrap items-center gap-2">
																<span className={`inline-flex items-center text-[10px] px-2 py-0.5 rounded border shadow-sm font-bold whitespace-nowrap ${getEventStatusColor(plan.status)}`}>
																	‚óè {plan.status}
																</span>
																{plan.eventType && (
																	<span className="inline-block text-[10px] px-1.5 py-0.5 bg-white border border-gray-300 text-gray-500 rounded shadow-sm">
																		{plan.eventType}
																	</span>
																)}
															</div>

															{/* H√ÄNG 4: NGUY√äN NH√ÇN / GHI CH√ö */}
															{(plan.cause || plan.info) && (
																<div className="text-gray-500 italic mt-1 bg-white p-1.5 rounded border border-gray-100 text-[11px] space-y-1">
																	{plan.cause && <div><span className="font-semibold text-red-400 not-italic mr-1">Nguy√™n nh√¢n:</span>{plan.cause}</div>}
																	{plan.info && <div><span className="font-semibold text-gray-400 not-italic mr-1">Ghi ch√∫:</span>{plan.info}</div>}
																</div>
															)}
														</div>
													);
												})}
											</div>
										</div>
									) : (
										/* PH·∫¶N S·ª¨A NHANH (B·∫†N C√ì TH·ªÇ GI·ªÆ L·∫†I HO·∫∂C B·ªé) */
										<div>...</div>
									)}
								</Card>

                                    {/* CARD C√ÅC S·ª∞ KI·ªÜN KH√ÅC (GIAO DI·ªÜN M·ªöI - ƒê·ªíNG B·ªò) */}
                                <Card className="p-5">
                                    <div className="flex justify-between items-center mb-4 pb-2 border-b border-gray-100">
                                        <h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2">C√°c s·ª± ki·ªán kh√°c</h3>
                                        
                                        {/* N√∫t H·ªßy ch·∫ø ƒë·ªô s·ª≠a (n·∫øu ƒëang b·∫≠t) */}
                                        {isEditingEvent && (
                                            <button onClick={()=>setIsEditingEvent(false)} className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200">
                                                H·ªßy
                                            </button>
                                        )}
										{/* --- N√öT B√ÅO C√ÅO S·ª∞ KI·ªÜN (M·ªöI) --- */}
											<button 
												onClick={() => setShowAnnualEventModal(true)}
												className="text-[10px] bg-purple-50 text-purple-700 border border-purple-200 px-2 py-1 rounded hover:bg-purple-100 transition-colors flex items-center gap-1 font-bold shadow-sm"
											>
												<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
												B√°o c√°o s·ª± ki·ªán
											</button>
                                    </div>

                                    {!isEditingEvent ? (
                                        <div>
                                            {/* Header ph·ª• c·ªßa Card S·ª± ki·ªán */}
											<div className="mb-2">
												{ADMIN_USERS.includes(currentUser) && (
													<button 
														onClick={handleAddEventDirectly} 
														className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200 transition-colors font-medium border border-purple-200"
													>
														+ Th√™m s·ª± ki·ªán
													</button>
												)}
											</div>
                                            
                                            {/* DANH S√ÅCH C√ÅC S·ª∞ KI·ªÜN KH√ÅC */}
                                            <div className="space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
                                                {(!currentSharedData.events || currentSharedData.events.length === 0) && (
                                                    <p className="text-xs text-gray-400 italic text-center py-2">Ch∆∞a c√≥ s·ª± ki·ªán n√†o</p>
                                                )}

                                                {currentSharedData.events.map(ev => {
												// T√≠nh to√°n s·ªë gi·ªù th·ª±c hi·ªán (n·∫øu c√≥ ƒë·ªß ng√†y b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c)
												const hours = calculateHoursDiff(ev.startDate || ev.date, ev.endDate);

												return (
													<div key={ev.id} className="text-sm bg-gray-50 p-3 rounded border border-gray-200 cursor-pointer hover:bg-purple-50 transition-colors flex flex-col gap-1 group" onDoubleClick={()=>openEventDetail(ev)}>
														
														{/* H√ÄNG 1: TI√äU ƒê·ªÄ + T·ªîNG GI·ªú */}
														<div className="flex justify-between items-start">
															<div className="font-bold text-gray-800 text-sm flex-1 mr-2 group-hover:text-purple-700 transition-colors">
																{ev.name}
															</div>
															<div className="flex items-center font-bold text-purple-600 text-xs bg-purple-100 px-2 py-0.5 rounded-full border border-purple-200 shadow-sm">
																<span className="text-purple-400 text-[10px] uppercase mr-1">TIME:</span>
																{hours.toFixed(2)}h
															</div>
														</div>

														{/* H√ÄNG 2: TH·ªúI GIAN CHI TI·∫æT (D·ª∞ KI·∫æN vs TH·ª∞C T·∫æ) */}
														<div className="text-xs text-gray-500 mt-2 space-y-1">
															
															{/* A. D√íNG D·ª∞ KI·∫æN (N·∫øu c√≥ d·ªØ li·ªáu d·ª± ki·∫øn) */}
															{ev.plannedStart && (
																<div className="flex items-center gap-2 bg-slate-50 p-1 rounded border border-slate-100">
																	<span className="text-[10px] font-bold text-slate-400 uppercase w-20 flex-shrink-0 whitespace-nowrap">
																		üìÖ D·ª∞ KI·∫æN:
																	</span>
																	<span className="font-mono text-[11px] text-slate-600">
																		{formatDate(ev.plannedStart)} 
																		<span className="mx-1 text-slate-300">‚ûî</span> 
																		{formatDate(ev.plannedEnd)}
																	</span>
																</div>
															)}

															{/* B. D√íNG TH·ª∞C T·∫æ (M√†u t√≠m ƒë·ªìng b·ªô v·ªõi th·∫ª S·ª± ki·ªán) */}
															<div className="flex items-center gap-2 p-1 rounded border bg-purple-50 border-purple-100 text-purple-800">
																<span className="text-[10px] font-bold uppercase w-20 flex-shrink-0 whitespace-nowrap text-purple-500">
																	‚è±Ô∏è TH·ª∞C T·∫æ:
																</span>
																<div className="font-mono font-bold text-[11px]">
																	{formatDate(ev.startDate || ev.date)}
																	{ev.endDate ? (
																		<>
																			<span className="mx-1 opacity-60">‚ûî</span>
																			{formatDate(ev.endDate)}
																		</>
																	) : (
																		<span className="ml-2 text-[10px] italic animate-pulse text-red-500">
																			(ƒêang di·ªÖn ra...)
																		</span>
																	)}
																</div>
															</div>
														</div>

														{/* H√ÄNG 3: LO·∫†I & TR·∫†NG TH√ÅI */}
														<div className="mt-1.5 flex flex-wrap items-center gap-2">
															<span className="inline-block text-[10px] px-1.5 py-0.5 bg-white border border-gray-300 text-gray-500 rounded shadow-sm">
																{ev.eventType || 'Kh√°c'}
															</span>
															{ev.status && (
																<span className={`inline-flex items-center text-[10px] px-2 py-0.5 rounded border shadow-sm font-bold whitespace-nowrap ${getEventStatusColor(ev.status)}`}>
																	‚óè {ev.status}
																</span>
															)}
														</div>

														{/* H√ÄNG 4: GHI CH√ö */}
														{ev.info && (
															<div className="text-gray-500 italic mt-1 bg-white p-1.5 rounded border border-gray-100 text-[11px]">
																<span className="font-semibold text-purple-400 not-italic mr-1">Ghi ch√∫:</span>
																{ev.info}
															</div>
														)}
													</div>
												);
											})}
                                            </div>
                                        </div>
                                    ) : (
                                        /* CH·∫æ ƒê·ªò S·ª¨A NHANH (GI·ªÆ NGUY√äN FORM NH∆Ø C≈® NH∆ØNG B·ªé ƒê∆†N V·ªä) */
                                        <div>
                                            <div className="border p-2 bg-purple-50 rounded text-sm mb-2 border-purple-200">
                                                <div className="font-bold text-xs mb-1 text-purple-800">{editingEventId ? "S·ª≠a s·ª± ki·ªán:" : "Th√™m m·ªõi:"}</div>
                                                <input placeholder="N·ªôi dung s·ª± ki·ªán..." className="w-full border p-1 mb-1 text-xs" value={newEvent.name} onChange={e=>setNewEvent({...newEvent, name: e.target.value})}/>
                                                
                                                <div className="grid grid-cols-2 gap-1 mb-1">
                                                    <div>
                                                        <label className="block text-[10px] font-bold text-gray-500 mb-0.5">Gi√†n li√™n quan</label>
                                                        <input list="rp" placeholder="Gi√†n..." className="border p-1 text-xs w-full" value={newEvent.relatedPlatforms} onChange={e=>setNewEvent({...newEvent, relatedPlatforms: e.target.value})}/><datalist id="rp">{RELATED_PLATFORMS.map(p=><option key={p} value={p}/>)}</datalist>
                                                    </div>
                                                    <div>
                                                        <label className="block text-[10px] font-bold text-gray-500 mb-0.5">Thi·∫øt b·ªã</label>
                                                        <input list="eq" placeholder="Thi·∫øt b·ªã..." className="border p-1 text-xs w-full" value={newEvent.equipment} onChange={e=>setNewEvent({...newEvent, equipment: e.target.value})}/><datalist id="eq">{MAINTENANCE_EQUIPMENT.map(e=><option key={e} value={e}/>)}</datalist>
                                                    </div>
                                                </div>

                                                <div className="mb-1">
                                                    <label className="block text-[10px] font-bold text-gray-500 mb-0.5">Th·ªùi gian th·ª±c hi·ªán</label>
                                                    <div className="grid grid-cols-2 gap-1">
                                                        <input type="datetime-local" className="border p-1 text-xs w-full" value={newEvent.startDate} onChange={e=>setNewEvent({...newEvent, startDate: e.target.value})}/>
                                                        <input type="datetime-local" className="border p-1 text-xs w-full" value={newEvent.endDate} onChange={e=>setNewEvent({...newEvent, endDate: e.target.value})}/>
                                                    </div>
                                                </div>
                                                
                                                <div className="mb-1">
                                                    <label className="block text-[10px] font-bold text-gray-500 mb-0.5">Th√¥ng tin kh√°c</label>
                                                    <textarea placeholder="Ghi ch√∫..." className="w-full border p-1 text-xs h-10" value={newEvent.info} onChange={e=>setNewEvent({...newEvent, info: e.target.value})}/>
                                                </div>

                                                <div className="mb-1">
                                                    <label className="block text-[10px] font-bold text-gray-500 mb-0.5">Lo·∫°i</label>
                                                    <select className="w-full border p-1 text-xs bg-white" value={newEvent.eventType || 'Kh√°c'} onChange={e => setNewEvent({...newEvent, eventType: e.target.value})}>
                                                        {EVENT_TYPE_OPTIONS.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                                    </select>
                                                </div>

                                                <div className="mb-1">
                                                    <div className="flex flex-wrap gap-2 mt-1">
                                                        {EVENT_STATUS_OPTIONS.map(s => (
                                                            <label key={s} className="text-[10px] flex items-center gap-1 bg-white px-1 border rounded cursor-pointer hover:bg-gray-50">
                                                                <input type="radio" name="evtSt" checked={newEvent.status===s} onChange={()=>setNewEvent({...newEvent, status: s})}/>{s}
                                                            </label>
                                                        ))}
                                                    </div>
                                                </div>

                                                <div className="flex gap-2 mt-2">
                                                    <button onClick={handleAddOrUpdateEvent} className="flex-1 bg-purple-600 text-white py-1 rounded font-bold hover:bg-purple-700">{editingEventId ? "C·∫≠p nh·∫≠t" : "Th√™m"}</button>
                                                    {editingEventId && <button onClick={()=>handleDeleteEventItem(editingEventId)} className="bg-gray-100 text-gray-600 px-3 rounded text-xs font-bold hover:bg-gray-200">X√≥a</button>}
                                                </div>
                                            </div>

                                            <div className="space-y-1 max-h-40 overflow-y-auto custom-scrollbar">
                                                {tempEvents.map(ev => (
                                                    <div key={ev.id} className={`text-xs p-1 border rounded cursor-pointer ${editingEventId===ev.id ? 'bg-purple-100 border-purple-300' : 'bg-gray-50'}`} onClick={()=>handleStartEditEventItem(ev)}>
                                                        <span className="font-semibold">{ev.name}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </Card>
                                </div>

                                
                                <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                                    {/* CARD TI·∫æN ƒê·ªò GASLIFT */}
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between bg-blue-100 p-2 rounded-t-lg border-b-2 border-blue-500">
                                            <h3 className="font-bold text-blue-900 text-lg">H·ªá th·ªëng GASLIFT</h3>
                                            
                                            {/* CH·ªà HI·ªÜN N√öT N·∫æU L√Ä ADMIN */}
                                            {!isEditingPlan && ADMIN_USERS.includes(currentUser) && (
                                                <button onClick={handleStartEditPlan} className="text-xs bg-white text-blue-700 px-2 py-1 rounded shadow-sm hover:bg-blue-50">
                                                    S·ª≠a K·∫ø ho·∫°ch
                                                </button>
                                            )}
                                        </div>
                                        
                                        <div className="bg-white p-4 rounded-b-lg shadow-sm border border-gray-200">
                                            {/* Plan & Metrics */}
                                            <div className="grid grid-cols-2 gap-4 mb-4">
                                                <div className="bg-blue-50 p-3 rounded border border-blue-100">
                                                    <div className="text-xs text-blue-500 font-bold uppercase mb-1">K·∫ø ho·∫°ch th√°ng</div>
                                                    {!isEditingPlan ? (
                                                        <>
                                                            <div className="text-xl font-bold text-blue-800">{formatVolume(gasData.plan.target)} m¬≥</div>
                                                            <div className="text-xs text-blue-600">{gasData.plan.workingDays} ng√†y l√†m vi·ªác</div>
                                                        </>
                                                    ) : (
                                                        <div className="space-y-1">
                                                            <input type="number" className="w-full text-xs border p-1 rounded" value={tempPlanGas.target} onChange={e=>setTempPlanGas({...tempPlanGas, target: e.target.value})} />
                                                            <input type="number" className="w-full text-xs border p-1 rounded" value={tempPlanGas.workingDays} onChange={e=>setTempPlanGas({...tempPlanGas, workingDays: e.target.value})} />
                                                        </div>
                                                    )}
                                                </div>
                                                {/* C·∫¨P NH·∫¨T V2: TH·∫∫ TI·∫æN ƒê·ªò (GASLIFT) - TH√äM KH NƒÇM */}
                                                <div className="bg-green-50 p-2.5 rounded border border-green-100 flex flex-col justify-between h-full shadow-sm">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <div>
                                                            <div className="text-[10px] text-green-600 font-bold uppercase mb-0.5">Ti·∫øn ƒë·ªô KH</div>
                                                            <div className="text-2xl font-black text-green-800 leading-none">{gasMetrics.percentComplete.toFixed(1)}%</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-[10px] text-gray-400 font-medium">C√≤n l·∫°i (m¬≥)</div>
                                                            <div className="text-xs font-bold text-green-700">{formatVolume(gasMetrics.remainingTarget)}</div>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Ph·∫ßn hi·ªÉn th·ªã T√≠ch l≈©y & K·∫ø ho·∫°ch nƒÉm */}
                                                    <div className="space-y-1 border-t border-green-200 pt-2 mt-1">
                                                        <div className="flex justify-between items-center text-xs">
                                                            <span className="text-green-700 font-medium">TL Th√°ng:</span>
                                                            <span className="font-bold text-gray-800">{formatVolume(gasMetrics.accumulated)}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center text-xs">
                                                            <span className="text-green-700 font-medium">TL NƒÉm:</span>
                                                            <span className="font-bold text-blue-900">{formatVolume(gasYearTotal)}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center text-xs">
                                                            <span className="text-gray-500 font-medium italic">KH NƒÉm:</span>
                                                            <span className="font-bold text-gray-600 italic">{formatVolume(gasYearPlanTotal)}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Daily Required Rate Calculation (NEW) */}
                                            <div className="mb-4 bg-indigo-50 p-3 rounded border border-indigo-100">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-xs font-bold text-indigo-700 uppercase">Y√™u c·∫ßu v·∫≠n h√†nh ng√†y</span>
                                                    <span className="text-[10px] text-gray-500">(17:00 h√¥m tr∆∞·ªõc - 17:00 h√¥m nay)</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <div className="flex-1">
                                                        <label className="block text-[10px] text-gray-500 mb-1">S·ªë ng√†y b·∫£o d∆∞·ª°ng c√≤n l·∫°i</label>
                                                        <input 
                                                            type="number" 
                                                            className="w-full border border-indigo-200 rounded p-1 text-sm text-center focus:ring-2 focus:ring-indigo-500 outline-none" 
                                                            value={gasMaintInput} 
                                                            onChange={e => setGasMaintInput(Number(e.target.value))}
                                                            min="0"
                                                        />
                                                    </div>
                                                    <div className="flex-1 text-right">
                                                        <div className="text-2xl font-bold text-indigo-800">{formatVolume(gasDailyReq.required)}</div>
                                                        <div className="text-[10px] text-indigo-600">m¬≥/ng√†y ({gasDailyReq.remainingWorkingDays} ng√†y c√≤n l·∫°i)</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* D·ª∞ B√ÅO CU·ªêI NG√ÄY GASLIFT */}
											<div className="border-t border-gray-100 pt-4 mt-2">
												<div className="flex justify-between items-center mb-3">
													<h4 className="text-sm font-bold text-gray-800 uppercase">D·ª± b√°o cu·ªëi ng√†y</h4>
												</div>
												<div className="grid grid-cols-2 gap-4 mb-3">
													{/* √î T√≠ch l≈©y */}
													<div>
														<label className="block text-xs font-bold text-gray-600 mb-1.5">T√≠ch l≈©y (t·ª´ 17h)</label>
														<input 
															type="text" 
															className="w-full border border-gray-300 rounded p-2 text-sm font-bold text-blue-800 focus:ring-1 focus:ring-blue-500 outline-none" 
															value={eodForecastGas.accumulated ? Number(eodForecastGas.accumulated).toLocaleString('vi-VN') : ''} 
															onChange={e => {
																const rawVal = e.target.value.replace(/\./g, '');
																if (!isNaN(rawVal)) {
																	setEodForecastGas({...eodForecastGas, accumulated: rawVal});
																}
															}} 
															placeholder="0"
														/>
													</div>
													{/* √î L∆∞u l∆∞·ª£ng hi·ªán t·∫°i */}
													<div>
														<label className="block text-xs font-bold text-gray-600 mb-1.5">L∆∞u l∆∞·ª£ng hi·ªán t·∫°i (m¬≥/h)</label>
														<input 
															type="text" 
															className="w-full border border-gray-300 rounded p-2 text-sm font-bold text-blue-800 focus:ring-1 focus:ring-blue-500 outline-none" 
															value={eodForecastGas.currentRate ? Number(eodForecastGas.currentRate).toLocaleString('vi-VN') : ''} 
															onChange={e => {
																const rawVal = e.target.value.replace(/\./g, '');
																if (!isNaN(rawVal)) {
																	setEodForecastGas({...eodForecastGas, currentRate: rawVal});
																}
															}} 
															placeholder="0"
														/>
													</div>
												</div>
												<div className="mb-3">
													<label className="block text-xs font-bold text-gray-600 mb-1.5">Th·ªùi ƒëi·ªÉm ghi nh·∫≠n</label>
													<input type="datetime-local" className="w-full border border-gray-300 rounded p-2 text-sm font-medium text-gray-700 focus:ring-1 focus:ring-blue-500 outline-none" value={eodForecastGas.time} onChange={e => setEodForecastGas({...eodForecastGas, time: e.target.value})}/>
												</div>
												{gasEod && (
													<div className="mt-3 bg-blue-50 p-3 rounded-lg border border-blue-200">
														<div className="flex justify-between mb-1"><span className="text-xs font-bold text-blue-600 uppercase">D·ª± ki·∫øn ƒë·∫øn 17:00</span></div>
														<div className="flex items-baseline gap-2">
															<span className="text-2xl font-black text-blue-700">{formatVolume(gasEod.projectedTotal)}</span>
															<span className="text-xs font-bold text-blue-500">m¬≥</span>
															<span className={`ml-auto text-sm font-bold px-2 py-0.5 rounded ${gasEod.percent >= 100 ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}`}>
																{gasEod.percent.toFixed(1)}%
															</span>
														</div>
													</div>
												)}
											</div>

                                            
                                            {/* D·ª∞ B√ÅO D√ÄI H·∫†N GASLIFT TH√ÅNG, NƒÇM-  */}
                                            <div className="border-t border-gray-100 pt-4 mt-2">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h4 className="text-sm font-bold text-gray-800 uppercase">D·ª± b√°o D√†i H·∫°n</h4>
                                                </div>
                                                <div className="mb-4">
													<label className="block text-xs font-bold text-gray-600 mb-1.5">S·∫£n l∆∞·ª£ng ƒë·∫°i di·ªán (c√°c ng√†y c√≤n l·∫°i)</label>
													<div className="relative">
														<input 
															/* 1. ƒê·ªïi th√†nh type text ƒë·ªÉ hi·ªÉn th·ªã ƒë∆∞·ª£c d·∫•u ch·∫•m */
															type="text" 
															className="w-full border border-blue-300 bg-blue-50/50 rounded p-2 text-sm font-bold text-blue-800 focus:ring-1 focus:ring-blue-500 outline-none pl-3" 
															
															/* 2. Logic hi·ªÉn th·ªã: Th√™m d·∫•u ch·∫•m v√†o s·ªë (V√≠ d·ª•: 10000 -> 10.000) */
															value={eomForecastGas.representativeDaily 
																? Number(eomForecastGas.representativeDaily).toLocaleString('vi-VN') 
																: ''} 
															
															/* 3. Logic nh·∫≠p li·ªáu: X√≥a d·∫•u ch·∫•m tr∆∞·ªõc khi l∆∞u ƒë·ªÉ gi·ªØ s·ªë nguy√™n b·∫£n */
															onChange={e => {
																// L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† x√≥a h·∫øt d·∫•u ch·∫•m (ƒë·ªÉ th√†nh s·ªë thu·∫ßn)
																const rawVal = e.target.value.replace(/\./g, '');
																
																// Ch·ªâ cho ph√©p nh·∫≠p s·ªë
																if (!isNaN(rawVal)) {
																	setEomForecastGas({...eomForecastGas, representativeDaily: rawVal});
																	localStorage.setItem('DGCP_PREF_GAS_RATE', rawVal); 
																}
															}} 
															placeholder="Nh·∫≠p m¬≥/ng√†y..."
														/>
														<span className="absolute right-3 top-2 text-xs text-gray-400 font-bold">m¬≥/ng√†y</span>
													</div>
												</div>
                                                
                                                {gasLongTerm && (
                                                    <div className="space-y-3">
                                                        {/* SECTION 1: EOM */}
                                                        <div className="bg-white rounded-lg border border-gray-200 p-3 shadow-sm">
                                                            <div className="text-xs text-gray-500 uppercase font-bold mb-2 border-b pb-2">D·ª± b√°o Cu·ªëi Th√°ng {selectedMonth}</div>
                                                            <div className="flex justify-between items-end">
                                                                <div>
                                                                    <div className="text-2xl font-black text-blue-800 leading-none">{formatVolume(gasLongTerm.expectedMonthTotal)}</div>
                                                                    <div className="text--[10px] text-gray-400 font-bold mt-1">T·ªïng s·∫£n l∆∞·ª£ng (m¬≥)</div>
                                                                </div>
                                                                <div className={`text-xs font-bold px-2 py-1 rounded mb-1 ${gasLongTerm.expectedMonthPercent >= 100 ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}`}>
                                                                    {gasLongTerm.expectedMonthPercent.toFixed(1)}% KH
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {/* SECTION 2: EOY */}
                                                        <div className="bg-gradient-to-r from-purple-50 to-white rounded-lg border border-purple-100 p-3 shadow-sm">
                                                            <div className="text-xs text-purple-600 uppercase font-bold mb-2 border-b border-purple-100 pb-2">D·ª± b√°o Cu·ªëi NƒÉm {year}</div>
                                                            <div className="flex justify-between items-end">
                                                                <div>
                                                                    <div className="text-2xl font-black text-purple-800 leading-none">{formatVolume(gasLongTerm.totalYearForecast)}</div>
                                                                    <div className="text-[10px] text-purple-400 font-bold mt-1">T·ªïng s·∫£n l∆∞·ª£ng (m¬≥)</div>
                                                                </div>
                                                                <div className={`text-xs font-bold px-2 py-1 rounded mb-1 ${gasLongTerm.totalYearPercent >= 100 ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}`}>
                                                                    {gasLongTerm.totalYearPercent.toFixed(1)}% KH
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                            <div className="mt-4 pt-3 border-t border-gray-100 text-[10px] text-gray-400 italic">
                                                {/* --- B·∫¢NG K·∫æ HO·∫†CH 12 TH√ÅNG (GASLIFT) --- */}
                                            <div className="border-t border-gray-100 pt-3 mt-3">
                                                <button 
                                                    onClick={() => setShowGasPlanTable(!showGasPlanTable)}
                                                    className="flex items-center justify-between w-full text-xs font-bold text-blue-700 hover:bg-blue-50 p-2 rounded transition-colors"
                                                >
                                                    <span className="flex items-center gap-1">
                                                        B·∫£ng k·∫ø ho·∫°ch chi ti·∫øt nƒÉm {year} (Click ƒë·ªÉ xem)
                                                    </span>
                                                    {showGasPlanTable}
                                                </button>
                                                
                                                {showGasPlanTable && (
                                                    <div className="mt-2 overflow-hidden border border-blue-200 rounded-lg animate-in fade-in slide-in-from-top-2">
                                                        <table className="w-full text-xs text-center">
                                                            <thead className="bg-blue-100 text-blue-900 font-bold">
                                                                <tr>
                                                                    <th className="p-2 border-b border-blue-200">Th√°ng</th>
                                                                    <th className="p-2 border-b border-blue-200">K·∫ø ho·∫°ch (m¬≥)</th>
                                                                    <th className="p-2 border-b border-blue-200">Ng√†y LV</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody className="divide-y divide-blue-50 bg-white">
                                                                {MONTHS.map(m => (
                                                                    <tr key={m} className={m === selectedMonth ? "bg-yellow-100 font-bold border-l-4 border-l-blue-500" : "hover:bg-gray-50"}>
                                                                        <td className="p-1.5 text-gray-600">Th√°ng {m}</td>
                                                                        <td className="p-1.5 text-blue-700 font-mono">{formatVolume(db.GASLIFT[m]?.plan?.target)}</td>
                                                                        <td className="p-1.5 text-gray-500">{db.GASLIFT[m]?.plan?.workingDays}</td>
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                            <tfoot className="bg-blue-50 font-bold text-blue-900">
                                                                <tr>
                                                                    <td className="p-2 border-t border-blue-200">C·∫£ nƒÉm</td>
                                                                    <td className="p-2 border-t border-blue-200 font-mono">
                                                                        {formatVolume(MONTHS.reduce((s, m) => s + (db.GASLIFT[m]?.plan?.target || 0), 0))}
                                                                    </td>
                                                                    <td className="p-2 border-t border-blue-200">-</td>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    </div>
                                                )}
                                            </div>
                                            <p className="font-semibold mb-1">* Ghi ch√∫ c√°ch t√≠nh:</p>
                                                <ul className="list-disc pl-3 space-y-0.5">
                                                    <li><strong>Y√™u c·∫ßu ng√†y (17h-17h):</strong> (KH Th√°ng - Th·ª±c t·∫ø t√≠ch l≈©y) / (Ng√†y c√≤n l·∫°i - Ng√†y b·∫£o d∆∞·ª°ng).</li>
                                                    <li><strong>D·ª± b√°o Th√°ng:</strong> Th·ª±c t·∫ø t√≠ch l≈©y + (SL ƒë·∫°i di·ªán √ó (Ng√†y c√≤n l·∫°i - Ng√†y b·∫£o d∆∞·ª°ng)).</li>
                                                    <li><strong>D·ª± b√°o NƒÉm:</strong> Th·ª±c t·∫ø c√°c th√°ng tr∆∞·ªõc + D·ª± b√°o th√°ng n√†y + KH c√°c th√°ng c√≤n l·∫°i.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    {/* CARD TI·∫æN ƒê·ªò BCP  */}
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between bg-orange-100 p-2 rounded-t-lg border-b-2 border-orange-500">
                                            <h3 className="font-bold text-orange-900 text-lg">H·ªá th·ªëng BCP-DGCP</h3>
                                            {/* CH·ªà HI·ªÜN N√öT N·∫æU L√Ä ADMIN */}
                                            {!isEditingPlan && ADMIN_USERS.includes(currentUser) && (
                                                <button onClick={handleStartEditPlan} className="text-xs bg-white text-orange-700 px-2 py-1 rounded shadow-sm hover:bg-orange-50">
                                                    S·ª≠a K·∫ø ho·∫°ch
                                                </button>
                                            )}
                                        </div>
                                        
                                        <div className="bg-white p-4 rounded-b-lg shadow-sm border border-gray-200">
                                            {/* Plan & Metrics */}
                                            <div className="grid grid-cols-2 gap-4 mb-4">
                                                <div className="bg-orange-50 p-3 rounded border border-orange-100">
                                                    <div className="text-xs text-orange-500 font-bold uppercase mb-1">K·∫ø ho·∫°ch th√°ng</div>
                                                    {!isEditingPlan ? (
                                                        <>
                                                            <div className="text-xl font-bold text-orange-800">{formatVolume(bcpData.plan.target)} m¬≥</div>
                                                            <div className="text-xs text-orange-600">{bcpData.plan.workingDays} ng√†y l√†m vi·ªác</div>
                                                        </>
                                                    ) : (
                                                        <div className="space-y-1">
                                                            <input type="number" className="w-full text-xs border p-1 rounded" value={tempPlanBCP.target} onChange={e=>setTempPlanBCP({...tempPlanBCP, target: e.target.value})} />
                                                            <input type="number" className="w-full text-xs border p-1 rounded" value={tempPlanBCP.workingDays} onChange={e=>setTempPlanBCP({...tempPlanBCP, workingDays: e.target.value})} />
                                                        </div>
                                                    )}
                                                </div>
                                                {/* C·∫¨P NH·∫¨T V2: TH·∫∫ TI·∫æN ƒê·ªò (BCP) - TH√äM KH NƒÇM */}
                                                <div className="bg-green-50 p-2.5 rounded border border-green-100 flex flex-col justify-between h-full shadow-sm">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <div>
                                                            <div className="text-[10px] text-green-600 font-bold uppercase mb-0.5">Ti·∫øn ƒë·ªô KH</div>
                                                            <div className="text-2xl font-black text-green-800 leading-none">{bcpMetrics.percentComplete.toFixed(1)}%</div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-[10px] text-gray-400 font-medium">C√≤n l·∫°i (m¬≥)</div>
                                                            <div className="text-xs font-bold text-green-700">{formatVolume(bcpMetrics.remainingTarget)}</div>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Ph·∫ßn hi·ªÉn th·ªã T√≠ch l≈©y & K·∫ø ho·∫°ch nƒÉm */}
                                                    <div className="space-y-1 border-t border-green-200 pt-2 mt-1">
                                                        <div className="flex justify-between items-center text-xs">
                                                            <span className="text-green-700 font-medium">TL Th√°ng:</span>
                                                            <span className="font-bold text-gray-800">{formatVolume(bcpMetrics.accumulated)}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center text-xs">
                                                            <span className="text-green-700 font-medium">TL NƒÉm:</span>
                                                            <span className="font-bold text-blue-900">{formatVolume(bcpYearTotal)}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center text-xs">
                                                            <span className="text-gray-500 font-medium italic">KH NƒÉm:</span>
                                                            <span className="font-bold text-gray-600 italic">{formatVolume(bcpYearPlanTotal)}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Daily Required Rate Calculation (NEW) */}
                                            <div className="mb-4 bg-red-50 p-3 rounded border border-red-100">
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="text-xs font-bold text-red-700 uppercase">Y√™u c·∫ßu v·∫≠n h√†nh ng√†y</span>
                                                    <span className="text-[10px] text-gray-500">(17:00 h√¥m tr∆∞·ªõc - 17:00 h√¥m nay)</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <div className="flex-1">
                                                        <label className="block text-[10px] text-gray-500 mb-1">S·ªë ng√†y b·∫£o d∆∞·ª°ng c√≤n l·∫°i</label>
                                                        <input 
                                                            type="number" 
                                                            className="w-full border border-red-200 rounded p-1 text-sm text-center focus:ring-2 focus:ring-red-500 outline-none" 
                                                            value={bcpMaintInput} 
                                                            onChange={e => setBcpMaintInput(Number(e.target.value))}
                                                            min="0"
                                                        />
                                                    </div>
                                                    <div className="flex-1 text-right">
                                                        <div className="text-2xl font-bold text-red-800">{formatVolume(bcpDailyReq.required)}</div>
                                                        <div className="text-[10px] text-red-600">m¬≥/ng√†y ({bcpDailyReq.remainingWorkingDays} ng√†y c√≤n l·∫°i)</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* D·ª∞ B√ÅO CU·ªêI NG√ÄY BCP-DGCP */}
											<div className="border-t border-gray-100 pt-4 mt-2">
												<div className="flex justify-between items-center mb-3">
													<h4 className="text-sm font-bold text-gray-800 uppercase">D·ª± b√°o cu·ªëi ng√†y</h4>
												</div>
												<div className="grid grid-cols-2 gap-4 mb-3">
													{/* √î T√≠ch l≈©y - ƒê√£ s·ª≠a format s·ªë */}
													<div>
														<label className="block text-xs font-bold text-gray-600 mb-1.5">T√≠ch l≈©y (t·ª´ 17h)</label>
														<input 
															type="text" 
															className="w-full border border-gray-300 rounded p-2 text-sm font-bold text-orange-800 focus:ring-1 focus:ring-orange-500 outline-none" 
															value={eodForecastBCP.accumulated ? Number(eodForecastBCP.accumulated).toLocaleString('vi-VN') : ''} 
															onChange={e => {
																// X√≥a d·∫•u ch·∫•m ƒë·ªÉ l·∫•y s·ªë g·ªëc
																const rawVal = e.target.value.replace(/\./g, '');
																if (!isNaN(rawVal)) {
																	setEodForecastBCP({...eodForecastBCP, accumulated: rawVal});
																}
															}} 
															placeholder="0"
														/>
													</div>

													{/* √î L∆∞u l∆∞·ª£ng hi·ªán t·∫°i - ƒê√£ s·ª≠a format s·ªë */}
													<div>
														<label className="block text-xs font-bold text-gray-600 mb-1.5">L∆∞u l∆∞·ª£ng hi·ªán t·∫°i (m¬≥/h)</label>
														<input 
															type="text" 
															className="w-full border border-gray-300 rounded p-2 text-sm font-bold text-orange-800 focus:ring-1 focus:ring-orange-500 outline-none" 
															value={eodForecastBCP.currentRate ? Number(eodForecastBCP.currentRate).toLocaleString('vi-VN') : ''} 
															onChange={e => {
																const rawVal = e.target.value.replace(/\./g, '');
																if (!isNaN(rawVal)) {
																	setEodForecastBCP({...eodForecastBCP, currentRate: rawVal});
																}
															}} 
															placeholder="0"
														/>
													</div>
												</div>

												<div className="mb-3">
													<label className="block text-xs font-bold text-gray-600 mb-1.5">Th·ªùi ƒëi·ªÉm ghi nh·∫≠n</label>
													<input 
														type="datetime-local" 
														className="w-full border border-gray-300 rounded p-2 text-sm font-medium text-gray-700 focus:ring-1 focus:ring-orange-500 outline-none" 
														value={eodForecastBCP.time} 
														onChange={e => setEodForecastBCP({...eodForecastBCP, time: e.target.value})}
													/>
												</div>

												{bcpEod && (
													<div className="mt-3 bg-orange-50 p-3 rounded-lg border border-orange-200">
														<div className="flex justify-between mb-1"><span className="text-xs font-bold text-orange-600 uppercase">D·ª± ki·∫øn ƒë·∫øn 17:00</span></div>
														<div className="flex items-baseline gap-2">
															<span className="text-2xl font-black text-orange-700">{formatVolume(bcpEod.projectedTotal)}</span>
															<span className="text-xs font-bold text-orange-500">m¬≥</span>
															<span className={`ml-auto text-sm font-bold px-2 py-0.5 rounded ${bcpEod.percent >= 100 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
																{bcpEod.percent.toFixed(1)}%
															</span>
														</div>
													</div>
												)}
											</div>

                                            {/* D·ª∞ B√ÅO D√ÄI H·∫†N BCP-DGCP TH√ÅNG, NƒÇM */}
                                            <div className="border-t border-gray-100 pt-4 mt-2">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h4 className="text-sm font-bold text-gray-800 uppercase">D·ª± b√°o D√†i H·∫°n</h4>
                                                </div>
                                                <div className="mb-4">
													<label className="block text-xs font-bold text-gray-600 mb-1.5">S·∫£n l∆∞·ª£ng ƒë·∫°i di·ªán (c√°c ng√†y c√≤n l·∫°i)</label>
													<div className="relative">
														<input 
															/* 1. ƒê·ªïi th√†nh type text ƒë·ªÉ hi·ªÉn th·ªã ƒë∆∞·ª£c d·∫•u ch·∫•m */
															type="text" 
															className="w-full border border-orange-300 bg-orange-50/50 rounded p-2 text-sm font-bold text-orange-800 focus:ring-1 focus:ring-orange-500 outline-none pl-3" 
															
															/* 2. Logic hi·ªÉn th·ªã: Th√™m d·∫•u ch·∫•m v√†o s·ªë (V√≠ d·ª•: 10000 -> 10.000) */
															value={eomForecastBCP.representativeDaily 
																? Number(eomForecastBCP.representativeDaily).toLocaleString('vi-VN') 
																: ''} 
															
															/* 3. Logic nh·∫≠p li·ªáu: X√≥a d·∫•u ch·∫•m tr∆∞·ªõc khi l∆∞u ƒë·ªÉ gi·ªØ s·ªë nguy√™n b·∫£n */
															onChange={e => {
																const rawVal = e.target.value.replace(/\./g, '');
																
																if (!isNaN(rawVal)) {
																	setEomForecastBCP({...eomForecastBCP, representativeDaily: rawVal});
																	localStorage.setItem('DGCP_PREF_BCP_RATE', rawVal); 
																}
															}} 
															placeholder="Nh·∫≠p m¬≥/ng√†y..."
														/>
														<span className="absolute right-3 top-2 text-xs text-gray-400 font-bold">m¬≥/ng√†y</span>
													</div>
												</div>
                                                
                                                {bcpLongTerm && (
                                                    <div className="space-y-3">
                                                        {/* SECTION 1: EOM */}
                                                        <div className="bg-white rounded-lg border border-gray-200 p-3 shadow-sm">
                                                            <div className="text-xs text-gray-500 uppercase font-bold mb-2 border-b pb-2">D·ª± b√°o Cu·ªëi Th√°ng {selectedMonth}</div>
                                                            <div className="flex justify-between items-end">
                                                                <div>
                                                                    <div className="text-2xl font-black text-orange-800 leading-none">{formatVolume(bcpLongTerm.expectedMonthTotal)}</div>
                                                                    <div className="text-[10px] text-gray-400 font-bold mt-1">T·ªïng s·∫£n l∆∞·ª£ng (m¬≥)</div>
                                                                </div>
                                                                <div className={`text-xs font-bold px-2 py-1 rounded mb-1 ${bcpLongTerm.expectedMonthPercent >= 100 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                                    {bcpLongTerm.expectedMonthPercent.toFixed(1)}% KH
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {/* SECTION 2: EOY */}
                                                        <div className="bg-gradient-to-r from-purple-50 to-white rounded-lg border border-purple-100 p-3 shadow-sm">
                                                            <div className="text-xs text-purple-600 uppercase font-bold mb-2 border-b border-purple-100 pb-2">D·ª± b√°o Cu·ªëi NƒÉm {year}</div>
                                                            <div className="flex justify-between items-end">
                                                                <div>
                                                                    <div className="text-2xl font-black text-purple-800 leading-none">{formatVolume(bcpLongTerm.totalYearForecast)}</div>
                                                                    <div className="text-[10px] text-purple-400 font-bold mt-1">T·ªïng s·∫£n l∆∞·ª£ng (m¬≥)</div>
                                                                </div>
                                                                <div className={`text-xs font-bold px-2 py-1 rounded mb-1 ${bcpLongTerm.totalYearPercent >= 100 ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}`}>
                                                                    {bcpLongTerm.totalYearPercent.toFixed(1)}% KH
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                            <div className="mt-4 pt-3 border-t border-gray-100 text-[10px] text-gray-400 italic">
                                                {/* --- B·∫¢NG K·∫æ HO·∫†CH 12 TH√ÅNG (BCP) --- */}
                                            <div className="border-t border-gray-100 pt-3 mt-3">
                                                <button 
                                                    onClick={() => setShowBcpPlanTable(!showBcpPlanTable)}
                                                    className="flex items-center justify-between w-full text-xs font-bold text-orange-700 hover:bg-orange-50 p-2 rounded transition-colors"
                                                >
                                                    <span className="flex items-center gap-1">
                                                        B·∫£ng k·∫ø ho·∫°ch chi ti·∫øt nƒÉm {year} (Click ƒë·ªÉ xem)
                                                    </span>
                                                    {showBcpPlanTable}
                                                </button>
                                                
                                                {showBcpPlanTable && (
                                                    <div className="mt-2 overflow-hidden border border-orange-200 rounded-lg animate-in fade-in slide-in-from-top-2">
                                                        <table className="w-full text-xs text-center">
                                                            <thead className="bg-orange-100 text-orange-900 font-bold">
                                                                <tr>
                                                                    <th className="p-2 border-b border-orange-200">Th√°ng</th>
                                                                    <th className="p-2 border-b border-orange-200">K·∫ø ho·∫°ch (m¬≥)</th>
                                                                    <th className="p-2 border-b border-orange-200">Ng√†y LV</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody className="divide-y divide-orange-50 bg-white">
                                                                {MONTHS.map(m => (
                                                                    <tr key={m} className={m === selectedMonth ? "bg-yellow-100 font-bold border-l-4 border-l-orange-500" : "hover:bg-gray-50"}>
                                                                        <td className="p-1.5 text-gray-600">Th√°ng {m}</td>
                                                                        <td className="p-1.5 text-orange-700 font-mono">{formatVolume(db.BCP[m]?.plan?.target)}</td>
                                                                        <td className="p-1.5 text-gray-500">{db.BCP[m]?.plan?.workingDays}</td>
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                            <tfoot className="bg-orange-50 font-bold text-orange-900">
                                                                <tr>
                                                                    <td className="p-2 border-t border-orange-200">C·∫£ nƒÉm</td>
                                                                    <td className="p-2 border-t border-orange-200 font-mono">
                                                                        {formatVolume(MONTHS.reduce((s, m) => s + (db.BCP[m]?.plan?.target || 0), 0))}
                                                                    </td>
                                                                    <td className="p-2 border-t border-orange-200">-</td>
                                                                </tr>
                                                            </tfoot>
                                                        </table>
                                                    </div>
                                                )}
                                            </div>
                                            <p className="font-semibold mb-1">* Ghi ch√∫ c√°ch t√≠nh:</p>
                                                <ul className="list-disc pl-3 space-y-0.5">
                                                    <li><strong>Y√™u c·∫ßu ng√†y (17h-17h):</strong> (KH Th√°ng - Th·ª±c t·∫ø t√≠ch l≈©y) / (Ng√†y c√≤n l·∫°i - Ng√†y b·∫£o d∆∞·ª°ng).</li>
                                                    <li><strong>D·ª± b√°o Th√°ng:</strong> Th·ª±c t·∫ø t√≠ch l≈©y + (SL ƒë·∫°i di·ªán √ó (Ng√†y c√≤n l·∫°i - Ng√†y b·∫£o d∆∞·ª°ng)).</li>
                                                    <li><strong>D·ª± b√°o NƒÉm:</strong> Th·ª±c t·∫ø c√°c th√°ng tr∆∞·ªõc + D·ª± b√°o th√°ng n√†y + KH c√°c th√°ng c√≤n l·∫°i.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* CARD S·ª¨A K·∫æ HO·∫†CH (HI·ªÜN L√äN N·∫æU C√ì S·ª¨A) */}
                                {isEditingPlan && (
                                    <div className="flex justify-center gap-4 mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg animate-pulse">
                                        <span className="font-bold text-yellow-800 flex items-center">ƒêang ch·ªânh s·ª≠a k·∫ø ho·∫°ch...</span>
                                        <button onClick={handleSavePlan} className="bg-blue-600 text-white px-6 py-1 rounded font-bold hover:bg-blue-700">L∆∞u Thay ƒê·ªïi</button>
                                        <button onClick={handleCancelEditPlan} className="bg-gray-200 text-gray-700 px-6 py-1 rounded font-bold hover:bg-gray-300">H·ªßy</button>
                                    </div>
                                )}

                                {/* CARD B·∫¢NG S·ªê LI·ªÜU TH·ª∞C T·∫æ TH√ÅNG (*/}
								<div className="bg-white rounded-xl shadow-lg border border-indigo-200 overflow-hidden mt-6">
									{/* S·ª≠ d·ª•ng CollapsibleHeader ƒë·ªÉ l√†m thanh ti√™u ƒë·ªÅ c√≥ n√∫t ƒë√≥ng/m·ªü */}
									<CollapsibleHeader 
										title={`B·∫£ng s·ªë li·ªáu th·ª±c t·∫ø t·ªïng h·ª£p th√°ng ${selectedMonth}`}
										isCollapsed={collapseStates.table} 
										onToggle={() => toggleCollapse('table')}
										iconColor="text-indigo-700"
									/>

									{/* N·ªôi dung b·∫£ng ch·ªâ hi·ªÉn th·ªã khi collapseStates.table l√† false */}
									{!collapseStates.table && (
										<div className="animate-in slide-in-from-top-2 duration-300">
											<Card className="p-0 border-none shadow-none">
												<div className="bg-gray-50 p-3 border-b flex justify-between items-center flex-wrap gap-2">
													<div>
														{!isEditingActuals ? (
															<div className="flex items-center gap-2">
																{ADMIN_USERS.includes(currentUser) && (
																	<>
																		<button 
																			onClick={() => setImportMode('ACTUAL')} 
																			className="text-xs bg-white text-green-700 border border-green-200 px-3 py-1.5 rounded hover:bg-green-50 transition-colors font-bold flex items-center gap-1 shadow-sm whitespace-nowrap"
																		>
																			Nh·∫≠p Th√°ng {selectedMonth}
																		</button>
																		<button 
																			onClick={() => setImportMode('YEAR_ACTUAL')} 
																			className="text-xs bg-green-50 text-green-800 border border-green-300 px-3 py-1.5 rounded hover:bg-green-100 transition-colors font-bold flex items-center gap-1 shadow-sm whitespace-nowrap"
																		>
																			Nh·∫≠p C·∫£ NƒÉm
																		</button>
																		<button onClick={handleStartEditActuals} className="text-xs bg-indigo-600 text-white px-4 py-1.5 rounded hover:bg-indigo-700 font-bold transition-colors shadow-sm flex items-center gap-1 whitespace-nowrap">
																			S·ª≠a th·ªß c√¥ng
																		</button>
																	</>
																)}
															</div>
														) : (
															<div className="flex gap-2">
																<button onClick={() => setImportMode('ACTUAL')} className="text-xs bg-white text-green-700 border border-green-200 px-3 py-1 rounded hover:bg-green-50 transition-colors font-bold flex items-center gap-1">
																	Import th√™m
																</button>
																<button onClick={handleSaveActuals} className="text-xs bg-green-600 text-white px-4 py-1 rounded hover:bg-green-700 font-bold animate-pulse shadow-md transition-colors flex items-center gap-1">
																	L∆∞u t·∫•t c·∫£
																</button>
																<button onClick={handleCancelEditActuals} className="text-xs bg-gray-200 text-gray-700 px-4 py-1 rounded hover:bg-gray-300 font-bold transition-colors">
																	H·ªßy b·ªè
																</button>
															</div>
														)}
													</div>
												</div>
												
												<div className="overflow-x-auto max-h-[500px] custom-scrollbar">
													<table className="w-full text-sm text-left border-collapse">
														<thead className="bg-gray-100 sticky top-0 z-10 shadow-sm text-xs uppercase">
																<tr>
																	<th className="border-b p-3 w-16 text-center text-gray-600 cursor-pointer select-none" onClick={() => requestActualsSort('day')}>Ng√†y</th>
																	<th className="border-b p-3 text-center text-blue-800 bg-blue-50/50 cursor-pointer select-none border-l" onClick={() => requestActualsSort('gasVal')}>Gaslift (m¬≥)</th>
																	<th className="border-b p-3 text-gray-500 w-1/4">Ghi ch√∫ Gaslift</th>
																	<th className="border-b p-3 text-center text-orange-800 bg-orange-50/50 cursor-pointer select-none border-l" onClick={() => requestActualsSort('bcpVal')}>BCP (m¬≥)</th>
																	<th className="border-b p-3 text-gray-500 w-1/4">Ghi ch√∫ BCP</th>
																</tr>
														</thead>
														<tbody className="divide-y divide-gray-100">
															{sortedCombinedActuals.map((item, index) => {
																const prevItem = index > 0 ? sortedCombinedActuals[index - 1] : null;
																
																const renderTrend = (current, prev) => {
																	if (current === undefined || current === null || !prev || prev === undefined) return null;
																	const diff = current - prev;
																	if (diff === 0) return <span className="text-gray-300 text-[10px] ml-1 font-bold">-</span>;
																	const isUp = diff > 0;
																	const colorClass = isUp ? "text-green-600" : "text-red-600";
																	return (
																		<span className={`${colorClass} ml-1 cursor-help inline-flex items-center`}>
																			<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
																				{isUp ? <path d="m18 15-6-6-6 6"/> : <path d="m6 9 6 6 6-6"/>}
																			</svg>
																		</span>
																	);
																};

																return (
																	<tr key={item.day} className="hover:bg-gray-50 cursor-pointer transition-colors" onDoubleClick={() => openDayDetail(item)}>
																		<td className="p-2 text-center font-bold text-gray-700 bg-gray-50/30">{item.day}/{selectedMonth}</td>
																		<td className="p-1 text-center border-l bg-blue-50/10">
																			{!isEditingActuals ? (
																				<div className="flex justify-center items-center gap-1">
																					<span className={`font-mono font-medium ${item.gasVal ? 'text-blue-700' : 'text-gray-300'}`}>
																						{formatVolume(item.gasVal)}
																					</span>
																					{renderTrend(item.gasVal, prevItem?.gasVal)}
																				</div>
																			) : (
																				<input 
																					type="number" 
																					className="w-full text-center p-1 border border-blue-200 rounded focus:ring-1 focus:ring-blue-500 outline-none text-blue-700 font-bold" 
																					value={item.gasVal !== undefined ? item.gasVal : ''} 
																					onChange={e => updateTempActual('GAS', item.day, e.target.value)} 
																					placeholder="-" 
																				/>
																			)}
																		</td>
																		<td className="p-1 text-xs text-gray-500 truncate max-w-[150px]">
																			{!isEditingActuals ? (item.gasNote) : (
																				<input type="text" className="w-full p-1 border border-gray-200 rounded focus:ring-1 focus:ring-blue-500 outline-none" 
																					value={item.gasNote || ''} onChange={e => updateTempNote('GAS', item.day, e.target.value)} />
																			)}
																		</td>
																		<td className="p-1 text-center border-l bg-orange-50/10">
																			{!isEditingActuals ? (
																				<div className="flex justify-center items-center gap-1">
																					<span className={`font-mono font-medium ${item.bcpVal ? 'text-orange-700' : 'text-gray-300'}`}>
																						{formatVolume(item.bcpVal)}
																					</span>
																					{renderTrend(item.bcpVal, prevItem?.bcpVal)}
																				</div>
																			) : (
																				<input type="number" className="w-full text-center p-1 border border-orange-200 rounded focus:ring-1 focus:ring-orange-500 outline-none text-orange-700 font-bold" 
																					value={item.bcpVal !== undefined ? item.bcpVal : ''} onChange={e => updateTempActual('BCP', item.day, e.target.value)} placeholder="-" />
																			)}
																		</td>
																		<td className="p-1 text-xs text-gray-500 truncate max-w-[150px]">
																			{!isEditingActuals ? (item.bcpNote) : (
																				<input type="text" className="w-full p-1 border border-gray-200 rounded focus:ring-1 focus:ring-blue-500 outline-none" 
																					value={item.bcpNote || ''} onChange={e => updateTempNote('BCP', item.day, e.target.value)} />
																			)}
																		</td>
																	</tr>
																);
															})}
														</tbody>
													</table>
												</div>
											</Card>
										</div>
									)}
								</div>
        
                                {/* Bi·ªÉu ƒë·ªì xu h∆∞·ªõng s·∫£n l∆∞·ª£ng th√°ng */}
								<div className="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mt-6">
									<CollapsibleHeader 
										title={`Bi·ªÉu ƒë·ªì xu h∆∞·ªõng s·∫£n l∆∞·ª£ng th√°ng${selectedMonth}`}
										isCollapsed={collapseStates.chart} 
										onToggle={() => toggleCollapse('chart')}
									/>
									{!collapseStates.chart && (
										<div className="p-4 animate-in slide-in-from-top-2 duration-300">
											<SimpleChart 
												data={sortedCombinedActuals} 
												planGas={gasData.plan.target} 
												planBCP={bcpData.plan.target}
												month={selectedMonth} 
											/>
										</div>
									)}
								</div>
								{/* --- B·∫¢NG THEO D√ïI S·ªê GI·ªú CH·∫†Y C·ª¶A THI·∫æT B·ªä --- */}
								<div className="mt-6 bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
									{/* S·ª≠ d·ª•ng CollapsibleHeader ƒë·ªÉ t·∫°o thanh ti√™u ƒë·ªÅ c√≥ n√∫t ƒë√≥ng/m·ªü */}
									<CollapsibleHeader 
									title={`üìä THEO D√ïI S·ªê GI·ªú CH·∫†Y C·ª¶A THI·∫æT B·ªä (Th√°ng ${selectedMonth})`}
									isCollapsed={collapseStates.equipment} 
									onToggle={() => toggleCollapse('equipment')}
									iconColor="text-slate-800" // ƒê·ªïi th√†nh m√†u x√°m ƒëen ƒë·∫≠m ƒë·ªÉ n·ªïi b·∫≠t tr√™n n·ªÅn x√°m nh·∫°t
									className="bg-slate-50" // Ho·∫∑c b·∫°n c√≥ th·ªÉ ƒë·ªïi h·∫≥n n·ªÅn th√†nh m√†u t·ªëi n·∫øu mu·ªën d√πng ch·ªØ tr·∫Øng
								/>

									{/* N·ªôi dung b·∫£ng ch·ªâ hi·ªÉn th·ªã khi collapseStates.equipment l√† false */}
									{!collapseStates.equipment && (
										<div className="animate-in slide-in-from-top-2 duration-300">
											<div className="bg-slate-800 p-3 flex justify-end border-t border-slate-700">
												<span className="text-base bg-slate-700 px-2 py-1 rounded text-slate-300">
													Ch√™nh l·ªách = D·ª± b√°o cu·ªëi th√°ng - K·∫ø ho·∫°ch g·ªëc
												</span>
											</div>
											
											<div className="overflow-x-auto">
												<table className="w-full text-base text-left border-collapse">
													<thead className="bg-slate-50 text-slate-600 uppercase text-base">
														<tr>
															<th rowSpan={2} className="p-2 border-r border-b text-center w-20 bg-slate-100 font-bold text-base">Thi·∫øt b·ªã</th>
															<th rowSpan={2} className="p-2 border-r border-b text-center bg-amber-50 text-amber-700 font-black w-24 text-base">
																T·ªïng gi·ªù ch·∫°y<br/>theo k·∫ø ho·∫°ch
															</th>
															<th colSpan={3} className="p-2 border-r border-b text-center bg-blue-50 text-blue-700 font-bold text-base">
																TH·ªúI ƒêI·ªÇM HI·ªÜN T·∫†I
															</th>
															<th colSpan={2} className="p-2 border-r border-b text-center bg-emerald-50 text-emerald-700 font-bold text-base">
																D·ª∞ B√ÅO CU·ªêI TH√ÅNG
															</th>
															<th rowSpan={2} className="p-2 border-b text-center bg-slate-200 text-slate-700 font-black w-24 text-base">
																CH√äNH L·ªÜCH<br/>(SO V·ªöI KH)
															</th>
														</tr>
														<tr>
															<th className="p-2 border-r border-b text-center w-20 font-medium text-base">ƒê√£ d·ª´ng B·∫£o d∆∞·ª°ng</th>
															<th className="p-2 border-r border-b text-center w-20 font-medium text-red-700 text-base">S·ª± c·ªë</th>
															<th className="p-2 border-r border-b text-center w-20 bg-blue-100/50 text-blue-700 font-black text-base">ƒê√É CH·∫†Y</th>
															<th className="p-2 border-r border-b text-center w-20 font-medium text-slate-700 text-base">B·∫£o d∆∞·ª°ng C√≤n l·∫°i</th>
															<th className="p-2 border-r border-b text-center w-24 bg-emerald-100/50 text-emerald-700 font-black text-base">CH·∫†Y D·ª∞ KI·∫æN</th>
														</tr>
													</thead>
													
													<tbody className="divide-y divide-slate-100">
														{equipStats && Object.keys(equipStats).length > 0 ? (
															Object.entries(equipStats).map(([eq, data]) => {
																const gapVal = parseFloat(data.gap);
																const isNegative = gapVal < 0;

																return (
																	<tr key={eq} className="hover:bg-slate-50 transition-colors text-base">
																		<td className="p-3 font-bold text-slate-700 border-r bg-slate-50/30 text-center text-base">{eq}</td>
																		<td className="p-3 text-center font-black text-amber-700 bg-amber-50/20 border-r border-slate-200 text-base">
																			{data.plannedRunTotal}h
																		</td>
																		<td className="p-3 text-center text-slate-600 font-bold border-r border-slate-100 text-base">{data.maintDownSoFar}h</td>
																		<td className="p-3 text-center text-red-500 font-bold border-r border-slate-100 text-base">{data.breakdownSoFar}h</td>
																		<td className="p-3 text-center font-black text-blue-700 bg-blue-50/20 border-r border-slate-200 text-base">
																			{data.runSoFar}h
																		</td>
																		<td className="p-3 text-center font-bold text-slate-400 italic border-r border-slate-100 text-base">{data.maintRemaining}h</td>
																		<td className="p-3 text-center font-black text-emerald-700 bg-emerald-50/20 border-r border-slate-200 text-base decoration-emerald-200 decoration-2">
																			{data.runForecast}h
																		</td>
																		<td className={`p-3 text-center font-black border-l border-slate-300 text-base ${isNegative ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>
																			{gapVal > 0 ? '+' : ''}{data.gap}h
																			{isNegative && <div className="text-base font-normal opacity-80 mt-0.5">Th·∫•t tho√°t</div>}
																		</td>
																	</tr>
																);
															})
														) : (
															<tr><td colSpan={8} className="p-4 text-center text-slate-400">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
														)}
													</tbody>
												</table>
											</div>
										</div>
									)}
								</div>

                            </div>
                        )}



                        {/* --- N√öT QUAY V·ªÄ ƒê·∫¶U TRANG --- */}
                        {showScrollTop && (
                            <button
                                onClick={scrollToTop}
                                className="fixed bottom-8 right-8 bg-blue-600/80 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 z-40 hover:-translate-y-1 group backdrop-blur-sm border border-blue-400"
                                title="Quay v·ªÅ ƒë·∫ßu trang"
                            >
                                {/* Icon M≈©i t√™n l√™n */}
                                <svg 
                                    width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"
                                    className="group-hover:animate-bounce"
                                >
                                    <path d="m18 15-6-6-6 6"/>
                                </svg>
                            </button>
                        )}

						{/* --- MODAL CH·ªåN C√îNG VI·ªÜC CHUY·ªÇN TH√ÅNG --- */}
                        {showTransferModal && (
                            <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[10005] p-4 backdrop-blur-sm">
                                <div className="bg-white rounded-xl w-full max-w-2xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
                                    <div className="p-4 border-b bg-orange-50 flex justify-between items-center">
                                        <h3 className="font-bold text-orange-800 flex items-center gap-2">
                                            üìã CHUY·ªÇN VI·ªÜC T·ªíN ƒê·ªåNG SANG TH√ÅNG {selectedMonth + 1}
                                        </h3>
                                        <button onClick={() => setShowTransferModal(false)} className="text-gray-400 hover:text-red-500">‚úï</button>
                                    </div>
                                    
                                    <div className="p-4 bg-gray-50 text-sm text-gray-600 italic">
                                        D∆∞·ªõi ƒë√¢y l√† c√°c c√¥ng vi·ªác <strong>ƒë√£ b·∫Øt ƒë·∫ßu</strong> nh∆∞ng <strong>ch∆∞a k·∫øt th√∫c</strong>. 
                                        Vui l√≤ng t√≠ch ch·ªçn nh·ªØng vi·ªác mu·ªën ti·∫øp t·ª•c theo d√µi ·ªü th√°ng sau.
                                    </div>

                                    <div className="flex-1 overflow-y-auto max-h-[60vh] p-4">
                                        <table className="w-full text-sm text-left border-collapse">
                                            <thead className="bg-gray-100 text-gray-500 text-xs uppercase sticky top-0">
                                                <tr>
                                                    <th className="p-3 w-10">
                                                        <input type="checkbox" 
                                                            onChange={(e) => {
                                                                if (e.target.checked) setSelectedTransferIds(new Set(pendingItems.map(i => i.id)));
                                                                else setSelectedTransferIds(new Set());
                                                            }}
                                                            checked={selectedTransferIds.size === pendingItems.length}
                                                        />
                                                    </th>
                                                    <th className="p-3">Lo·∫°i</th>
                                                    <th className="p-3">N·ªôi dung c√¥ng vi·ªác</th>
                                                    <th className="p-3">Ng√†y b·∫Øt ƒë·∫ßu</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200 bg-white">
                                                {pendingItems.map(item => (
                                                    <tr key={item.id} className="hover:bg-blue-50 transition-colors cursor-pointer" onClick={() => {
                                                        const newSet = new Set(selectedTransferIds);
                                                        if (newSet.has(item.id)) newSet.delete(item.id);
                                                        else newSet.add(item.id);
                                                        setSelectedTransferIds(newSet);
                                                    }}>
                                                        <td className="p-3">
                                                            <input type="checkbox" checked={selectedTransferIds.has(item.id)} readOnly className="pointer-events-none" />
                                                        </td>
                                                        <td className="p-3 font-bold text-xs">
                                                            <span className={`px-2 py-1 rounded border ${
                                                                item.type==='B·∫£o d∆∞·ª°ng'?'bg-blue-50 text-blue-700 border-blue-200':
                                                                item.type==='S·ª± c·ªë'?'bg-red-50 text-red-700 border-red-200':'bg-yellow-50 text-yellow-700 border-yellow-200'
                                                            }`}>{item.type}</span>
                                                        </td>
                                                        <td className="p-3 font-medium text-gray-800">{item.description || item.name}</td>
                                                        <td className="p-3 text-gray-500 font-mono text-xs">{formatDate(item.start || item.startDate || item.date)}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>

                                    <div className="p-4 border-t bg-white flex justify-end gap-3">
                                        <button onClick={() => setShowTransferModal(false)} className="px-4 py-2 text-gray-600 font-bold text-sm hover:bg-gray-100 rounded">H·ªßy b·ªè</button>
                                        <button onClick={handleConfirmTransfer} className="px-6 py-2 bg-orange-600 text-white font-bold text-sm rounded shadow hover:bg-orange-700 transition-colors">
                                            X√°c nh·∫≠n Chuy·ªÉn ({selectedTransferIds.size})
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- B·∫¢NG ƒêI·ªÄU KHI·ªÇN NH·∫¨T K√ù (LOG DASHBOARD) --- */}
                        {showLogModal && (
                            <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[10002] p-2 md:p-4 backdrop-blur-sm">
                                <div className="bg-white rounded-xl w-full max-w-4xl max-h-[90vh] shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
                                    <div className="p-4 border-b bg-slate-800 text-white flex justify-between items-center">
                                        <div className="flex items-center gap-2">                             
                                            <h2 className="text-lg font-bold uppercase tracking-tight">Nh·∫≠t k√Ω v·∫≠n h√†nh & Audit Log</h2>
                                        </div>
                                        <button onClick={() => setShowLogModal(false)} className="text-slate-400 hover:text-white transition-colors">‚úï ƒê√≥ng</button>
                                    </div>
                                    
                                    <div className="p-4 bg-slate-50 border-b flex gap-3">
                                        <div className="relative flex-1">
                                            {/* S·ª¨ D·ª§NG ICON FIND ·ªû ƒê√ÇY */}
                                            <input 
                                                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 bg-white" 
                                                placeholder="T√¨m theo t√™n ng∆∞·ªùi d√πng, h√†nh ƒë·ªông (X√≥a, S·ª≠a, Gas...)..."
                                                value={logSearchTerm}
                                                onChange={(e) => setLogSearchTerm(e.target.value)}
                                            />
                                        </div>
                                        <button onClick={handleRefreshLogsOnly} className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 shadow transition-colors flex items-center gap-1">
                                            L√†m m·ªõi
                                        </button>
                                    </div>

                                    <div className="flex-grow overflow-y-auto custom-scrollbar">
                                        <table className="w-full text-sm text-left border-collapse">
                                            <thead className="bg-slate-100 sticky top-0 z-10 border-b shadow-sm">
                                                <tr>
                                                    {/* --- C·ªòT TH·ªúI GIAN (ƒê√É S·ª¨A ICON) --- */}
                                                    <th 
                                                        className="p-3 font-bold text-slate-600 w-44 cursor-pointer hover:bg-slate-200 transition-colors select-none group"
                                                        onClick={() => setLogSortOrder(prev => prev === 'desc' ? 'asc' : 'desc')}
                                                        title="Click ƒë·ªÉ ƒë·ªïi th·ª© t·ª± s·∫Øp x·∫øp"
                                                    >
                                                        <div className="flex items-center gap-1">
                                                            Th·ªùi gian
                                                            {/* Icon m≈©i t√™n (V·∫Ω tr·ª±c ti·∫øp b·∫±ng SVG ƒë·ªÉ kh√¥ng b·ªã l·ªói h√¨nh vu√¥ng) */}
                                                            {logSortOrder === 'desc' ? (
                                                                // M≈©i t√™n xu·ªëng (M·ªõi nh·∫•t tr∆∞·ªõc)
                                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                                    <path d="m6 9 6 6 6-6"/>
                                                                </svg>
                                                            ) : (
                                                                // M≈©i t√™n l√™n (C≈© nh·∫•t tr∆∞·ªõc)
                                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                                    <path d="m18 15-6-6-6 6"/>
                                                                </svg>
                                                            )}
                                                        </div>
                                                    </th>
                                                    <th className="p-3 font-bold text-slate-600 w-40">Nh√¢n s·ª±</th>
                                                    <th className="p-3 font-bold text-slate-600">N·ªôi dung thay ƒë·ªïi</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {systemLogs
                                                    .filter(l => l.user.toLowerCase().includes(logSearchTerm.toLowerCase()) || l.action.toLowerCase().includes(logSearchTerm.toLowerCase()))
                                                    // --- LOGIC S·∫ÆP X·∫æP T·∫†I ƒê√ÇY ---
                                                    .sort((a, b) => {
                                                        const dateA = new Date(a.time).getTime();
                                                        const dateB = new Date(b.time).getTime();
                                                        return logSortOrder === 'desc' ? dateB - dateA : dateA - dateB;
                                                    })
                                                    // -----------------------------
                                                    .map((log, idx) => (
                                                    <tr key={idx} className="hover:bg-blue-50/50 transition-colors">
                                                        <td className="p-3 text-xs font-mono text-slate-500">
                                                            {new Date(log.time).toLocaleString('vi-VN')}
                                                        </td>
                                                        <td className="p-3">
                                                            <span className="px-2 py-0.5 rounded bg-blue-100 text-blue-700 text-[10px] font-bold uppercase border border-blue-200">
                                                                {log.user}
                                                            </span>
                                                        </td>
                                                        <td className={`p-3 text-sm ${log.action.includes('X√ìA') || log.action.includes('H·ª¶Y') ? 'text-red-600 font-medium' : 'text-slate-700'}`}>
                                                            {log.action}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="p-2 bg-slate-50 border-t text-[10px] text-slate-400 text-center italic">
                                        D·ªØ li·ªáu hi·ªÉn th·ªã 50 h√†nh ƒë·ªông g·∫ßn nh·∫•t tr√™n h·ªá th·ªëng.
                                    </div>
                                </div>
                            </div>
                        )}
  
                        {/* B·∫¢NG B√ÅO C√ÅO T·ªîNG H·ª¢P */}
                        {showCombinedReport && (
                            <div id="report-modal" className="fixed inset-0 bg-gray-900/75 backdrop-blur-sm flex items-center justify-center z-50 p-2 md:p-4">
                                <div id="report-container" className="bg-white w-full max-w-6xl max-h-full md:max-h-[95vh] rounded-xl shadow-2xl overflow-hidden flex flex-col">
                                    
                                    {/* REPORT HEADER */}
                                    <div id="report-header" className="flex-none p-4 md:p-6 border-b border-gray-200 flex flex-col md:flex-row justify-between items-start bg-blue-900 text-white shrink-0">
                                        <div className="mb-4 md:mb-0">
                                            <h2 className="text-xl md:text-2xl font-bold uppercase tracking-wide">B√°o C√°o T√¨nh H√¨nh V·∫≠n H√†nh</h2>
                                            <div className="flex items-center gap-2 mt-2 no-print">
                                                <span className="text-blue-200 text-sm">K·ª≥ b√°o c√°o:</span>
                                                
                                                {/* N√∫t L√πi (V·∫Ω b·∫±ng SVG ƒë∆°n gi·∫£n) */}
                                                {reportPeriod === 'MONTH' && (
                                                    <button 
                                                        onClick={() => changeSelectedMonth(-1)} 
                                                        className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-blue-800 text-blue-300 hover:text-white transition-colors"
                                                        title="Th√°ng tr∆∞·ªõc"
                                                    >
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
                                                            <path d="M15 18l-6-6 6-6"/>
                                                        </svg>
                                                    </button>
                                                )}

                                                <select 
                                                    value={reportPeriod} 
                                                    onChange={(e) => setReportPeriod(e.target.value)}
                                                    className="bg-blue-800 text-white border border-blue-600 text-sm rounded px-3 py-1 outline-none font-bold cursor-pointer hover:bg-blue-700"
                                                >
                                                    <option value="MONTH">Th√°ng {selectedMonth} (Hi·ªán t·∫°i)</option>
                                                    <option value="Q1">Qu√Ω 1 (Th√°ng 1-3)</option>
                                                    <option value="Q2">Qu√Ω 2 (Th√°ng 4-6)</option>
                                                    <option value="Q3">Qu√Ω 3 (Th√°ng 7-9)</option>
                                                    <option value="Q4">Qu√Ω 4 (Th√°ng 10-12)</option>
                                                    <option value="YEAR">C·∫£ NƒÉm {year}</option>
                                                </select>

                                                {/* N√∫t Ti·∫øn (V·∫Ω b·∫±ng SVG ƒë∆°n gi·∫£n) */}
                                                {reportPeriod === 'MONTH' && (
                                                    <button 
                                                        onClick={() => changeSelectedMonth(1)} 
                                                        className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-blue-800 text-blue-300 hover:text-white transition-colors"
                                                        title="Th√°ng sau"
                                                    >
                                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
                                                            <path d="M9 18l6-6-6-6"/>
                                                        </svg>
                                                    </button>
                                                )}
                                            </div>
                                            {/* Hi·ªÉn th·ªã text tƒ©nh khi in */}
                                            <p className="hidden print:block text-blue-100 mt-1 font-bold">
                                                {reportPeriod === 'MONTH' ? `Th√°ng ${selectedMonth}/${year}` : 
                                                 reportPeriod === 'YEAR' ? `NƒÉm ${year}` : 
                                                 `${reportPeriod} - NƒÉm ${year}`}
                                            </p>
                                        </div>
                                        <div className="text-left md:text-right w-full md:w-auto">
                                            <p className="text-xs md:text-sm text-blue-200">Ng√†y xu·∫•t b√°o c√°o</p>
                                            <p className="font-mono font-bold text-sm md:text-base mb-3">{currentTime.toLocaleDateString('vi-VN')} {currentTime.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'})}</p>
                                            <div className="flex gap-2 justify-end no-print">
                                                <button onClick={() => {setShowCombinedReport(false); setReportPeriod('MONTH');}} className="bg-blue-800 text-blue-100 border border-blue-700 px-3 py-1.5 rounded text-sm font-bold hover:bg-blue-700 hover:text-white transition-colors">ƒê√≥ng</button>
                                                <button onClick={() => window.print()} className="bg-white text-blue-900 px-3 py-1.5 md:px-4 md:py-2 rounded text-xs md:text-sm font-bold shadow hover:bg-blue-50 transition-colors flex items-center gap-2 whitespace-nowrap">
                                                    {/* Icon M√°y in (SVG tr·ª±c ti·∫øp) */}
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                                        <rect x="6" y="14" width="12" height="8"></rect>
                                                    </svg>
                                                    In B√°o c√°o
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {/* REPORT BODY */}
                                    <div id="report-body" className="flex-grow overflow-y-auto p-4 md:p-8 space-y-6 bg-slate-50">
                                        {/* SECTION 1: B·∫¢NG T·ªîNG H·ª¢P KPI (ƒê√É KH√îI PH·ª§C & T√çNH THEO K·ª≤) */}
                                        <section className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                                            <h3 className="text-sm font-bold text-gray-600 uppercase tracking-wider mb-3 border-b pb-2 flex justify-between">
                                                <span>I. T·ªïng h·ª£p Ch·ªâ s·ªë S·∫£n xu·∫•t (KPIs) - {reportPeriod === 'MONTH' ? `Th√°ng ${selectedMonth}` : reportPeriod}</span>
                                            </h3>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-sm border-collapse border border-gray-200">
                                                    <thead className="bg-gray-100 text-gray-700">
                                                        <tr>
                                                            <th className="border p-2 text-left w-32">H·ªá th·ªëng</th>
                                                            <th className="border p-2 text-right">K·∫ø ho·∫°ch (m¬≥)</th>
                                                            <th className="border p-2 text-right">Th·ª±c t·∫ø (m¬≥)</th>
                                                            <th className="border p-2 text-right text-blue-700">% Ho√†n th√†nh</th>
                                                            <th className="border p-2 text-right">Ch√™nh l·ªách</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {/* D√≤ng Gaslift */}
                                                        <tr>
                                                            <td className="border p-2 font-bold text-blue-800">GASLIFT</td>
                                                            <td className="border p-2 text-right font-mono">{formatVolume(combinedReportData.kpi.gasPlan)}</td>
                                                            <td className="border p-2 text-right font-mono font-bold">{formatVolume(combinedReportData.kpi.gasActual)}</td>
                                                            <td className="border p-2 text-right font-bold">
                                                                <span className={`px-2 py-0.5 rounded ${
                                                                    (combinedReportData.kpi.gasActual / combinedReportData.kpi.gasPlan) >= 1 ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'
                                                                }`}>
                                                                    {combinedReportData.kpi.gasPlan > 0 ? ((combinedReportData.kpi.gasActual / combinedReportData.kpi.gasPlan) * 100).toFixed(1) : 0}%
                                                                </span>
                                                            </td>
                                                            <td className="border p-2 text-right font-mono text-gray-500">
                                                                {formatVolume(combinedReportData.kpi.gasActual - combinedReportData.kpi.gasPlan)}
                                                            </td>
                                                        </tr>
                                                        {/* D√≤ng BCP */}
                                                        <tr>
                                                            <td className="border p-2 font-bold text-orange-800">BCP-DGCP</td>
                                                            <td className="border p-2 text-right font-mono">{formatVolume(combinedReportData.kpi.bcpPlan)}</td>
                                                            <td className="border p-2 text-right font-mono font-bold">{formatVolume(combinedReportData.kpi.bcpActual)}</td>
                                                            <td className="border p-2 text-right font-bold">
                                                                <span className={`px-2 py-0.5 rounded ${
                                                                    (combinedReportData.kpi.bcpActual / combinedReportData.kpi.bcpPlan) >= 1 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
                                                                }`}>
                                                                    {combinedReportData.kpi.bcpPlan > 0 ? ((combinedReportData.kpi.bcpActual / combinedReportData.kpi.bcpPlan) * 100).toFixed(1) : 0}%
                                                                </span>
                                                            </td>
                                                            <td className="border p-2 text-right font-mono text-gray-500">
                                                                {formatVolume(combinedReportData.kpi.bcpActual - combinedReportData.kpi.bcpPlan)}
                                                            </td>
                                                        </tr>
                                                        {/* D√≤ng T·ªïng */}
                                                        <tr className="bg-gray-50 font-bold">
                                                            <td className="border p-2 text-gray-800">T·ªîNG C·ªòNG</td>
                                                            <td className="border p-2 text-right font-mono">{formatVolume(combinedReportData.kpi.gasPlan + combinedReportData.kpi.bcpPlan)}</td>
                                                            <td className="border p-2 text-right font-mono text-indigo-700">{formatVolume(combinedReportData.kpi.gasActual + combinedReportData.kpi.bcpActual)}</td>
                                                            <td className="border p-2 text-right">
                                                                {(combinedReportData.kpi.gasPlan + combinedReportData.kpi.bcpPlan) > 0 
                                                                    ? (((combinedReportData.kpi.gasActual + combinedReportData.kpi.bcpActual) / (combinedReportData.kpi.gasPlan + combinedReportData.kpi.bcpPlan)) * 100).toFixed(1) 
                                                                    : 0}%
                                                            </td>
                                                            <td className="border p-2 text-right font-mono">
                                                                {formatVolume((combinedReportData.kpi.gasActual + combinedReportData.kpi.bcpActual) - (combinedReportData.kpi.gasPlan + combinedReportData.kpi.bcpPlan))}
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </section>
										{/* SECTION 2: GI·ªú CH·∫†Y THI·∫æT B·ªä (ƒê√É UPDATE THEO K·ª≤ B√ÅO C√ÅO) */}
                                    <section className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                                        <h3 className="text-sm font-bold text-gray-600 uppercase tracking-wider mb-3 border-b pb-2 flex justify-between">
                                            {/* S·ª≠a ti√™u ƒë·ªÅ ƒë·ªÉ hi·ªÉn th·ªã ƒë√∫ng K·ª≥ b√°o c√°o */}
                                            <span>II. T·ªïng h·ª£p Gi·ªù v·∫≠n h√†nh Thi·∫øt b·ªã ({reportPeriod === 'MONTH' ? `Th√°ng ${selectedMonth}` : reportPeriod})</span>
                                        </h3>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm text-left border-collapse border border-slate-200">
                                                <thead className="bg-slate-100 text-slate-700 uppercase text-[10px]">
                                                    <tr>
                                                        <th rowSpan={2} className="p-2 border-r border-b border-slate-300 text-center w-24 font-bold bg-slate-200">Thi·∫øt b·ªã</th>
                                                        <th rowSpan={2} className="p-2 border-r border-b border-slate-300 text-center bg-amber-100 text-amber-800 font-black w-28">
                                                            T·ªïng gi·ªù ch·∫°y<br/>theo k·∫ø ho·∫°ch
                                                        </th>
                                                        <th colSpan={3} className="p-2 border-r border-b border-slate-300 text-center bg-blue-100 text-blue-800 font-bold">
                                                            TH·ªúI ƒêI·ªÇM HI·ªÜN T·∫†I
                                                        </th>
                                                        <th colSpan={2} className="p-2 border-r border-b border-slate-300 text-center bg-emerald-100 text-emerald-800 font-bold">
                                                            D·ª∞ B√ÅO CU·ªêI K·ª≤
                                                        </th>
                                                        <th rowSpan={2} className="p-2 border-b border-slate-300 text-center bg-slate-200 text-slate-700 font-black w-24">
                                                            CH√äNH L·ªÜCH<br/>(SO V·ªöI KH)
                                                        </th>
                                                    </tr>
                                                    <tr className="bg-slate-50">
                                                        {/* Nh√≥m Hi·ªán t·∫°i */}
                                                        <th className="p-2 border-r border-b border-slate-300 text-center w-24 font-medium">ƒê√£ d·ª´ng B·∫£o d∆∞·ª°ng</th>
                                                        <th className="p-2 border-r border-b border-slate-300 text-center w-24 font-medium text-red-600">S·ª± c·ªë</th>
                                                        <th className="p-2 border-r border-b border-slate-300 text-center w-24 bg-blue-50 text-blue-800 font-black">ƒê√É CH·∫†Y</th>

                                                        {/* Nh√≥m Cu·ªëi th√°ng */}
                                                        <th className="p-2 border-r border-b border-slate-300 text-center w-24 font-medium text-slate-500">B·∫£o d∆∞·ª°ng c√≤n l·∫°i</th>
                                                        <th className="p-2 border-r border-b border-slate-300 text-center w-28 bg-emerald-50 text-emerald-800 font-black">CH·∫†Y D·ª∞ KI·∫æN</th>
                                                    </tr>
                                                </thead>
                                                
                                                <tbody className="divide-y divide-slate-200">
                                                    {/* S·ª¨ D·ª§NG BI·∫æN M·ªöI: aggregatedEquipStats */}
                                                    {aggregatedEquipStats && Object.keys(aggregatedEquipStats).length > 0 ? (
                                                        Object.entries(aggregatedEquipStats).map(([eq, data]) => {
                                                            const gapVal = parseFloat(data.gap);
                                                            const isNegative = gapVal < 0; 

                                                            return (
                                                                <tr key={eq} className="hover:bg-slate-50 transition-colors text-[11px]">
                                                                    <td className="p-2 border-r border-slate-200 font-bold text-slate-700 bg-slate-50 text-center">{eq}</td>

                                                                    {/* 1. K·∫ø ho·∫°ch (Baseline) */}
                                                                    <td className="p-2 border-r border-slate-200 text-center font-black text-amber-700 bg-amber-50">
                                                                        {data.plannedRunTotal}h
                                                                    </td>

                                                                    {/* 2. Hi·ªán t·∫°i */}
                                                                    <td className="p-2 border-r border-slate-200 text-center text-slate-600">{data.maintDownSoFar}h</td>
                                                                    <td className="p-2 border-r border-slate-200 text-center text-red-600 font-bold">{data.breakdownSoFar}h</td>
                                                                    <td className="p-2 border-r border-slate-200 text-center font-black text-blue-700 bg-blue-50">
                                                                        {data.runSoFar}h
                                                                    </td>

                                                                    {/* 3. D·ª± b√°o Cu·ªëi k·ª≥ */}
                                                                    <td className="p-2 border-r border-slate-200 text-center text-slate-500 italic">{data.maintRemaining}h</td>
                                                                    <td className="p-2 border-r border-slate-200 text-center font-black text-emerald-700 bg-emerald-50 underline decoration-dotted">
                                                                        {data.runForecast}h
                                                                    </td>

                                                                    {/* 4. Ch√™nh l·ªách */}
                                                                    <td className={`p-2 text-center font-black border-l border-slate-300 ${isNegative ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>
                                                                        {gapVal > 0 ? '+' : ''}{data.gap}h
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })
                                                    ) : (
                                                        <tr><td colSpan={8} className="p-4 text-center text-slate-400">ƒêang t√≠nh to√°n d·ªØ li·ªáu...</td></tr>
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div className="mt-2 text-[10px] text-slate-500 italic">
                                            * S·ªë li·ªáu ƒë∆∞·ª£c t·ª± ƒë·ªông c·ªông d·ªìn theo k·ª≥ b√°o c√°o: <strong>{reportPeriod === 'MONTH' ? `Th√°ng ${selectedMonth}` : reportPeriod}</strong>.
                                        </div>
                                    </section>
										
                                        {/* SECTION 3: SUMMARY CARDS (METRICS) */}
                                        <section className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            
                                            {/* CARD 1: S·ª∞ C·ªê D·ª™NG M√ÅY (RED) */}
                                            <div className="bg-white p-4 rounded-xl border-t-4 border-red-500 shadow-sm">
                                                <h3 className="text-sm font-bold text-gray-500 uppercase mb-3 flex justify-between">
                                                    <span>II. S·ª± c·ªë D·ª´ng m√°y</span>                                                    
                                                </h3>
                                                <div className="grid grid-cols-2 gap-4 mb-3">
                                                    <div>
                                                        <div className="text-2xl font-black text-red-700">{combinedReportData.totalShutdowns}</div>
                                                        <div className="text-xs text-gray-400 font-bold">T·ªïng s·ªë v·ª•</div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-2xl font-black text-gray-700">{combinedReportData.totalShutdownHours.toFixed(1)}</div>
                                                        <div className="text-xs text-gray-400 font-bold">T·ªïng gi·ªù d·ª´ng (h)</div>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 text-xs border-t border-gray-100 pt-3">
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">ƒê√£ kh·∫Øc ph·ª•c:</span>
                                                        <span className="font-bold text-green-600">{combinedReportData.shutdownFixed} v·ª•</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Ch∆∞a kh·∫Øc ph·ª•c:</span>
                                                        <span className="font-bold text-red-600">{combinedReportData.shutdownPending} v·ª•</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Thi·∫øt b·ªã hay h·ªèng:</span>
                                                        <span className="font-bold text-gray-800">{combinedReportData.topEquip}</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* CARD 2: B·∫¢O D∆Ø·ª†NG (BLUE) */}
                                            <div className="bg-white p-4 rounded-xl border-t-4 border-blue-500 shadow-sm">
                                                <h3 className="text-sm font-bold text-gray-500 uppercase mb-3 flex justify-between">
                                                    <span>III. K·∫ø ho·∫°ch B·∫£o d∆∞·ª°ng</span>                                                    
                                                </h3>
                                                <div className="flex items-center gap-4 mb-3">
                                                    <div className="relative w-16 h-16">
                                                        <svg className="w-full h-full" viewBox="0 0 36 36">
                                                            <path className="text-gray-100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" strokeWidth="4" />
                                                            <path className="text-blue-500" strokeDasharray={`${combinedReportData.maintPercent}, 100`} d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" strokeWidth="4" />
                                                        </svg>
                                                        <div className="absolute inset-0 flex items-center justify-center text-[10px] font-bold text-blue-700">
                                                            {combinedReportData.maintPercent.toFixed(0)}%
                                                        </div>
                                                    </div>
                                                    <div className="flex-1">
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-500">T·ªïng ƒë·∫ßu vi·ªác:</span>
                                                            <span className="font-bold">{combinedReportData.totalMaints}</span>
                                                        </div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-500">Ho√†n th√†nh:</span>
                                                            <span className="font-bold text-green-600">{combinedReportData.maintCompleted}</span>
                                                        </div>
                                                        <div className="flex justify-between text-xs">
                                                            <span className="text-gray-500">T·ªïng gi·ªù l√†m:</span>
                                                            <span className="font-bold">{combinedReportData.totalMaintHours.toFixed(1)}h</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="text-xs border-t border-gray-100 pt-2 text-gray-500">
                                                    ƒê∆°n v·ªã th·ª±c hi·ªán nhi·ªÅu nh·∫•t: <span className="font-bold text-gray-800">{combinedReportData.topUnit}</span>
                                                </div>
                                            </div>

                                            {/* CARD 3: S·ª∞ KI·ªÜN KH√ÅC (YELLOW) */}
                                            <div className="bg-white p-4 rounded-xl border-t-4 border-yellow-500 shadow-sm">
                                                <h3 className="text-sm font-bold text-gray-500 uppercase mb-3 flex justify-between">
                                                    <span>IV. S·ª± ki·ªán kh√°c</span>                                                    
                                                </h3>
                                                <div className="grid grid-cols-2 gap-4 mb-4">
                                                    <div>
                                                        <div className="text-2xl font-black text-yellow-700">{combinedReportData.totalEvents}</div>
                                                        <div className="text-xs text-gray-400 font-bold">T·ªïng s·ª± ki·ªán</div>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 text-xs border-t border-gray-100 pt-3">
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Lo·∫°i 'K·∫ø ho·∫°ch':</span>
                                                        <span className="font-bold">{combinedReportData.eventPlanCount}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-gray-600">Lo·∫°i 'Kh√°c':</span>
                                                        <span className="font-bold">{combinedReportData.totalEvents - combinedReportData.eventPlanCount}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </section>

                                        {/* SECTION 4: TIMELINE CHI TI·∫æT */}
                                        <section>
                                            <h3 className="text-sm font-bold text-gray-600 uppercase tracking-wider mb-3 flex items-center gap-2">
                                                IV. Nh·∫≠t k√Ω Chi ti·∫øt (Timeline)
                                            </h3>
                                            <div className="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                                                <table className="w-full text-sm text-left">
                                                    <thead className="bg-gray-100 text-gray-500 uppercase text-xs">
                                                        <tr>
                                                            {/* Ch·ªâ hi·ªán c·ªôt Th√°ng khi xem b√°o c√°o Qu√Ω/NƒÉm */}
                                                            {reportPeriod !== 'MONTH' && <th className="p-3 border-b w-20 text-center">Th√°ng</th>}
                                                            <th className="p-3 border-b w-32">Th·ªùi gian</th>
                                                            <th className="p-3 border-b w-32">Lo·∫°i</th>
                                                            <th className="p-3 border-b">N·ªôi dung / M√¥ t·∫£</th>
                                                            <th className="p-3 border-b w-28">ƒê∆°n v·ªã</th>
                                                            <th className="p-3 border-b w-32">Tr·∫°ng th√°i</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-gray-100">
                                                        {combinedReportData.timeline.length === 0 ? (
                                                            <tr><td colSpan="6" className="p-8 text-center text-gray-400 italic">Kh√¥ng c√≥ d·ªØ li·ªáu trong k·ª≥ b√°o c√°o n√†y.</td></tr>
                                                        ) : (
                                                            combinedReportData.timeline.map((item, idx) => (
                                                                <tr key={idx} className="hover:bg-gray-50 transition-colors">
                                                                    {reportPeriod !== 'MONTH' && (
                                                                        <td className="p-3 text-center font-bold text-gray-400 border-r border-gray-50">
                                                                            {item.month || new Date(item.start).getMonth() + 1}
                                                                        </td>
                                                                    )}
                                                                    <td className="p-3 align-top">
                                                                        <div className="font-mono text-xs font-bold text-blue-700">{formatDate(item.start)}</div>
                                                                        {item.end && <div className="font-mono text-xs text-orange-700 mt-1">‚ûú {formatDate(item.end)}</div>}
                                                                    </td>
                                                                    <td className="p-3 align-top">
                                                                         <span className={`px-2 py-1 rounded text-[10px] font-bold border whitespace-nowrap ${
                                                                            item.type === 'B·∫£o d∆∞·ª°ng' ? 'bg-blue-50 text-blue-700 border-blue-200' : 
                                                                            (item.type === 'S·ª± c·ªë d·ª´ng m√°y' ? 'bg-red-50 text-red-700 border-red-200' : 'bg-yellow-50 text-yellow-700 border-yellow-200')
                                                                        }`}>
                                                                            {item.type}
                                                                        </span>
                                                                    </td>
                                                                    <td className="p-3 align-top">
                                                                        <div className="font-bold text-gray-800">{item.description || item.name}</div>
                                                                        <div className="text-xs text-gray-500 mt-1">
                                                                            {item.info && <span>{item.info}</span>}
                                                                            {item.relatedPlatforms && <span className="ml-2 px-1 bg-gray-100 rounded">Gi√†n: {item.relatedPlatforms}</span>}
                                                                            {item.equipment && <span className="ml-2 px-1 bg-indigo-50 text-indigo-700 rounded border border-indigo-100">{item.equipment}</span>}
                                                                        </div>
                                                                    </td>
                                                                    <td className="p-3 align-top text-gray-600 text-xs">{item.performingUnit || '-'}</td>
                                                                    <td className="p-3 align-top">
                                                                        {item.status && (
                                                                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded ${
                                                                                item.status.includes('ƒê√£') ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'
                                                                            }`}>
                                                                                {item.status}
                                                                            </span>
                                                                        )}
                                                                    </td>
                                                                </tr>
                                                            ))
                                                        )}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </section>

                                        <div className="text-center text-xs text-gray-400 pt-4 border-t">
                                            <p>B√°o c√°o ƒë∆∞·ª£c tr√≠ch xu·∫•t t·ª± ƒë·ªông t·ª´ h·ªá th·ªëng.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

						{/* --- B√ÅO C√ÅO K·∫æ HO·∫†CH B·∫¢O D∆Ø·ª†NG NƒÇM (UPDATE V4: C√ì B·ªò L·ªåC) --- */}
                        {showAnnualMaintModal && (
                            <div className="fixed inset-0 bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-[10005] p-2 md:p-4">
                                <div className="bg-white w-full max-w-[95%] h-full md:h-auto md:max-h-[95vh] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
                                    
                                    {/* Header Modal */}
                                    <div className="p-4 border-b bg-indigo-700 text-white flex justify-between items-center shrink-0">
                                        <div className="flex items-center gap-3">
                                            <div className="bg-white/20 p-2 rounded-lg">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                                            </div>
                                            <div>
                                                <h2 className="text-xl font-bold uppercase tracking-wide">B√°o c√°o T·ªïng h·ª£p B·∫£o d∆∞·ª°ng NƒÉm {year}</h2>
                                                <p className="text-indigo-200 text-xs">Chi ti·∫øt th·ªùi gian v√† ch√™nh l·ªách th·ª±c t·∫ø</p>
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => window.print()} className="bg-white text-indigo-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-50 shadow-sm flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                                                In B√°o c√°o
                                            </button>
                                            <button onClick={() => setShowAnnualMaintModal(false)} className="text-indigo-100 hover:text-white hover:bg-indigo-600/50 p-2 rounded-lg transition-colors">‚úï ƒê√≥ng</button>
                                        </div>
                                    </div>

                                    {/* --- THANH B·ªò L·ªåC (FILTER BAR) --- */}
                                    <div className="bg-gray-50 border-b border-gray-200 p-3 flex flex-wrap gap-4 items-center print:hidden">
                                        <div className="flex items-center gap-2">
                                            <span className="text-xs font-bold text-gray-500 uppercase">L·ªçc Thi·∫øt b·ªã:</span>
                                            <select 
                                                className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none"
                                                value={yearFilterEq}
                                                onChange={(e) => setYearFilterEq(e.target.value)}
                                            >
                                                <option value="ALL">-- T·∫•t c·∫£ Thi·∫øt b·ªã --</option>
                                                {MAINTENANCE_EQUIPMENT.map(eq => <option key={eq} value={eq}>{eq}</option>)}
                                            </select>
                                        </div>

                                        <div className="flex items-center gap-2">
                                            <span className="text-xs font-bold text-gray-500 uppercase">L·ªçc Tr·∫°ng th√°i:</span>
                                            <select 
                                                className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none"
                                                value={yearFilterSt}
                                                onChange={(e) => setYearFilterSt(e.target.value)}
                                            >
                                                <option value="ALL">-- T·∫•t c·∫£ Tr·∫°ng th√°i --</option>
                                                {EVENT_STATUS_OPTIONS.map(st => <option key={st} value={st}>{st}</option>)}
                                            </select>
                                        </div>
                                        
                                        {/* N√∫t Reset Filter */}
                                        {(yearFilterEq !== 'ALL' || yearFilterSt !== 'ALL') && (
                                            <button 
                                                onClick={() => { setYearFilterEq('ALL'); setYearFilterSt('ALL'); }}
                                                className="text-xs text-red-600 hover:text-red-800 underline font-bold"
                                            >
                                                X√≥a b·ªô l·ªçc
                                            </button>
                                        )}
                                    </div>

                                    {/* N·ªôi dung b·∫£ng */}
                                    <div className="flex-1 overflow-y-auto p-4 bg-slate-50 custom-scrollbar print:overflow-visible print:h-auto">
                                        <div className="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden print:border-none print:shadow-none">
                                            <table className="w-full text-xs text-left border-collapse">
                                                <thead className="bg-gray-100 text-gray-600 uppercase font-bold sticky top-0 z-10 print:static">
                                                    <tr>
                                                        <th className="p-3 border-b border-r text-center w-24">Th√°ng</th> 
                                                        <th className="p-3 border-b border-r w-24">Thi·∫øt b·ªã</th>
                                                        <th className="p-3 border-b border-r w-36">N·ªôi dung c√¥ng vi·ªác</th>
                                                        <th className="p-3 border-b border-r w-20 text-center">ƒê∆°n v·ªã</th>
                                                        
                                                        <th className="p-3 border-b border-r w-48 text-center bg-blue-50 text-blue-800">
                                                            Th·ªùi gian D·ª± ki·∫øn<br/>
                                                            <span className="text-[10px] font-normal lowercase">(Ng√†y gi·ªù & Th·ªùi l∆∞·ª£ng)</span>
                                                        </th>
                                                        
                                                        <th className="p-3 border-b border-r w-48 text-center bg-green-50 text-green-800">
                                                            Th·ªùi gian Th·ª±c t·∫ø<br/>
                                                            <span className="text-[10px] font-normal lowercase">(Ng√†y gi·ªù & Th·ªùi l∆∞·ª£ng)</span>
                                                        </th>

                                                        <th className="p-3 border-b border-r w-32 text-center bg-orange-50 text-orange-800">
                                                            Ch√™nh l·ªách<br/>
                                                            <span className="text-[10px] font-normal lowercase">(Th·ª±c t·∫ø - D·ª± ki·∫øn)</span>
                                                        </th>
                                                        
                                                        <th className="p-3 border-b w-28 text-center">Tr·∫°ng th√°i</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-200 text-slate-700">
                                                    {(() => {
                                                        const formatHoursAndDays = (hours) => {
                                                            if (!hours || isNaN(hours) || hours === 0) return "-";
                                                            const days = (hours / 24).toFixed(1);
                                                            const displayHours = Number.isInteger(hours) ? hours : hours.toFixed(1);
                                                            return `${displayHours}h (${days} ng√†y)`;
                                                        };

                                                        const formatFullDate = (dateStr) => {
                                                            if (!dateStr) return "";
                                                            const d = new Date(dateStr);
                                                            if (isNaN(d.getTime())) return "";
                                                            return d.toLocaleString('vi-VN', {
                                                                day: '2-digit', month: '2-digit', year: 'numeric',
                                                                hour: '2-digit', minute: '2-digit'
                                                            });
                                                        };

                                                        // 1. T·ªîNG H·ª¢P D·ªÆ LI·ªÜU
                                                        let rawPlans = [];
                                                        for (let m = 1; m <= 12; m++) {
                                                            const plans = db?.SHARED?.[m]?.maintenancePlans || [];
                                                            plans.forEach(p => rawPlans.push({ ...p, month: m }));
                                                        }

                                                        // 2. √ÅP D·ª§NG B·ªò L·ªåC (FILTER)
                                                        const filteredPlans = rawPlans.filter(item => {
                                                            const matchEq = yearFilterEq === 'ALL' || item.maintenanceEquipment === yearFilterEq;
                                                            const matchSt = yearFilterSt === 'ALL' || item.status === yearFilterSt;
                                                            return matchEq && matchSt;
                                                        });

                                                        if (filteredPlans.length === 0) {
                                                            return (
                                                                <tr>
                                                                    <td colSpan={8} className="p-8 text-center text-gray-400 italic">
                                                                        Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ph√π h·ª£p v·ªõi b·ªô l·ªçc.
                                                                    </td>
                                                                </tr>
                                                            );
                                                        }

                                                        // 3. S·∫ÆP X·∫æP
                                                        filteredPlans.sort((a, b) => {
                                                            if (a.month !== b.month) return a.month - b.month;
                                                            return new Date(a.plannedStart || a.start) - new Date(b.plannedStart || b.start);
                                                        });

                                                        // 4. T√çNH TO√ÅN ROWSPAN CHO C√ÅC D√íNG SAU KHI L·ªåC
                                                        // (Ch·ªâ g·ªôp c√°c th√°ng c√≥ d·ªØ li·ªáu hi·ªÉn th·ªã)
                                                        const monthCounts = {};
                                                        filteredPlans.forEach(p => {
                                                            monthCounts[p.month] = (monthCounts[p.month] || 0) + 1;
                                                        });

                                                        return filteredPlans.map((item, idx) => {
                                                            // Logic x√°c ƒë·ªãnh d√≤ng ƒë·∫ßu ti√™n c·ªßa th√°ng (trong danh s√°ch ƒë√£ l·ªçc)
                                                            const isFirstRowOfMonth = idx === 0 || item.month !== filteredPlans[idx - 1].month;
                                                            
                                                            const planDuration = parseFloat(item.plannedHours) || 0;
                                                            
                                                            let actDuration = 0;
                                                            if (item.start && item.end) {
                                                                const s = new Date(item.start);
                                                                const e = new Date(item.end);
                                                                actDuration = (e - s) / (1000 * 60 * 60);
                                                            } else if (item.actualHours) {
                                                                actDuration = parseFloat(item.actualHours);
                                                            }

                                                            const diff = actDuration > 0 ? (actDuration - planDuration) : null;
                                                            const isOverTime = diff > 0;

                                                            return (
                                                                <tr key={idx} className="hover:bg-gray-50 transition-colors">
                                                                    
                                                                    {/* C·ªôt Th√°ng (RowSpan theo s·ªë l∆∞·ª£ng ƒë√£ l·ªçc) */}
                                                                    {isFirstRowOfMonth && (
                                                                        <td 
                                                                            className="p-3 text-center font-bold border-r text-gray-800 bg-gray-50 align-middle border-b"
                                                                            rowSpan={monthCounts[item.month]}
                                                                        >
                                                                            Th√°ng {item.month}
                                                                        </td>
                                                                    )}
                                                                    
                                                                    <td className="p-3 border-r font-bold text-slate-700">{item.maintenanceEquipment}</td>
                                                                    
                                                                    <td className="p-3 border-r">
                                                                        <div className="font-medium text-gray-900 text-xs line-clamp-3">{item.description}</div>
                                                                        {item.isUnplanned && <span className="text-[9px] text-red-600 font-bold bg-red-50 px-1 rounded uppercase mt-1 inline-block border border-red-100">S·ª± c·ªë ƒë·ªôt xu·∫•t</span>}
                                                                    </td>
                                                                    
                                                                    <td className="p-3 border-r text-gray-600 text-center">{item.performingUnit}</td>
                                                                    
                                                                    {/* D·ª± ki·∫øn */}
                                                                    <td className="p-3 border-r bg-blue-50/10 align-middle">
                                                                        {!item.isUnplanned ? (
                                                                            <div className="flex flex-col gap-1 items-center">
                                                                                <div className="text-xs text-gray-600 font-mono font-medium">
                                                                                    {formatFullDate(item.plannedStart)} <br/> ‚Üì <br/> {formatFullDate(item.plannedEnd)}
                                                                                </div>
                                                                                <div className="font-bold text-blue-700 bg-blue-50 px-2 py-1 rounded text-center border border-blue-100 w-full mt-1">
                                                                                    {formatHoursAndDays(planDuration)}
                                                                                </div>
                                                                            </div>
                                                                        ) : <div className="text-center text-gray-300">-</div>}
                                                                    </td>

                                                                    {/* Th·ª±c t·∫ø */}
                                                                    <td className="p-3 border-r bg-green-50/10 align-middle">
                                                                        {item.start ? (
                                                                            <div className="flex flex-col gap-1 items-center">
                                                                                 <div className="text-xs text-gray-600 font-mono font-medium">
                                                                                    {formatFullDate(item.start)} <br/> ‚Üì <br/> {item.end ? formatFullDate(item.end) : <span className="text-red-500 italic">ƒêang ch·∫°y...</span>}
                                                                                </div>
                                                                                <div className={`font-bold px-2 py-1 rounded text-center border w-full mt-1 ${item.end ? 'text-green-700 bg-green-50 border-green-100' : 'text-gray-400 bg-gray-100'}`}>
                                                                                    {item.end ? formatHoursAndDays(actDuration) : "Ch∆∞a xong"}
                                                                                </div>
                                                                            </div>
                                                                        ) : <div className="text-center text-gray-300">-</div>}
                                                                    </td>

                                                                    <td className="p-3 border-r text-center align-middle">
                                                                        {diff !== null ? (
                                                                            <div className={`font-bold px-2 py-1 rounded border ${isOverTime ? 'bg-red-50 text-red-600 border-red-200' : 'bg-emerald-50 text-emerald-600 border-emerald-200'}`}>
                                                                                {isOverTime ? '+' : ''}{formatHoursAndDays(diff)}
                                                                            </div>
                                                                        ) : <span className="text-gray-300">-</span>}
                                                                    </td>
                                                                    
                                                                    <td className="p-3 text-center align-middle">
                                                                        <span className={`inline-block text-[10px] px-2 py-1 rounded border font-bold ${getEventStatusColor(item.status)}`}>
                                                                            {item.status}
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            );
                                                        });
                                                    })()}
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        {/* Footer B√°o c√°o */}
                                        <div className="mt-8 grid grid-cols-2 text-center text-sm font-bold text-gray-700 break-inside-avoid">
                                            <div>
                                                <p className="uppercase text-gray-500 text-xs mb-16">Ng∆∞·ªùi l·∫≠p bi·ªÉu</p>
                                                <p>{currentUser || '....................'}</p>
                                            </div>
                                            <div>
                                                <p className="uppercase text-gray-500 text-xs mb-16">L√£nh ƒë·∫°o ph√™ duy·ªát</p>
                                                <p>....................</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

						{/* --- B√ÅO C√ÅO S·ª∞ C·ªê D·ª™NG M√ÅY (THEO TH√ÅNG/QU√ù/NƒÇM) --- */}
						{showAnnualShutdownModal && (
							<div className="fixed inset-0 bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-[10005] p-2 md:p-4">
								<div className="bg-white w-full max-w-[95%] h-full md:h-auto md:max-h-[95vh] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
									
									{/* Header Modal */}
									<div className="p-4 border-b bg-rose-700 text-white flex justify-between items-center shrink-0">
										<div className="flex items-center gap-3">
											<div className="bg-white/20 p-2 rounded-lg">
												<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
											</div>
											<div>
												<h2 className="text-xl font-bold uppercase tracking-wide">B√°o c√°o T·ªïng h·ª£p S·ª± c·ªë d·ª´ng m√°y {year}</h2>
												<p className="text-rose-200 text-xs">D·ªØ li·ªáu l·ªçc theo: {shutdownReportPeriod === 'YEAR' ? 'C·∫£ nƒÉm' : shutdownReportPeriod === 'MONTH' ? `Th√°ng ${selectedMonth}` : `Qu√Ω ${shutdownReportPeriod.replace('Q','')}`}</p>
											</div>
										</div>
										<div className="flex gap-2">
											<button onClick={() => window.print()} className="bg-white text-rose-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-rose-50 shadow-sm flex items-center gap-2">
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
												In B√°o c√°o
											</button>
											<button onClick={() => setShowAnnualShutdownModal(false)} className="text-rose-100 hover:text-white hover:bg-rose-600/50 p-2 rounded-lg transition-colors">‚úï ƒê√≥ng</button>
										</div>
									</div>

									{/* --- THANH B·ªò L·ªåC N√ÇNG C·∫§P --- */}
									<div className="bg-gray-50 border-b border-gray-200 p-3 flex flex-wrap gap-6 items-center print:hidden">
										{/* L·ªçc theo K·ª≥ (M·ªõi) */}
										<div className="flex items-center gap-2">
											<span className="text-xs font-bold text-gray-500 uppercase">K·ª≥ b√°o c√°o:</span>
											<select 
												className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-rose-700 outline-none focus:ring-2 focus:ring-rose-500"
												value={shutdownReportPeriod}
												onChange={(e) => setShutdownReportPeriod(e.target.value)}
											>
												<option value="MONTH">Th√°ng hi·ªán t·∫°i ({selectedMonth})</option>
												<option value="Q1">Qu√Ω 1 (Th√°ng 1-3)</option>
												<option value="Q2">Qu√Ω 2 (Th√°ng 4-6)</option>
												<option value="Q3">Qu√Ω 3 (Th√°ng 7-9)</option>
												<option value="Q4">Qu√Ω 4 (Th√°ng 10-12)</option>
												<option value="YEAR">C·∫£ NƒÉm {year}</option>
											</select>
										</div>

										{/* L·ªçc theo Thi·∫øt b·ªã */}
										<div className="flex items-center gap-2">
											<span className="text-xs font-bold text-gray-500 uppercase">Thi·∫øt b·ªã:</span>
											<select 
												className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-rose-500"
												value={yearFilterEq}
												onChange={(e) => setYearFilterEq(e.target.value)}
											>
												<option value="ALL">-- T·∫•t c·∫£ --</option>
												{AFFECTED_EQUIPMENT_OPTIONS.map(eq => <option key={eq} value={eq}>{eq}</option>)}
											</select>
										</div>

										{/* L·ªçc theo Tr·∫°ng th√°i */}
										<div className="flex items-center gap-2">
											<span className="text-xs font-bold text-gray-500 uppercase">Tr·∫°ng th√°i:</span>
											<select 
												className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-rose-500"
												value={yearFilterSt}
												onChange={(e) => setYearFilterSt(e.target.value)}
											>
												<option value="ALL">-- T·∫•t c·∫£ --</option>
												{SHUTDOWN_STATUS_OPTIONS.map(st => <option key={st} value={st}>{st}</option>)}
											</select>
										</div>
									</div>

									{/* B·∫£ng d·ªØ li·ªáu */}
									<div className="flex-1 overflow-y-auto p-4 bg-slate-50 custom-scrollbar print:overflow-visible print:h-auto">
										<div className="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden print:border-none print:shadow-none">
											<table className="w-full text-xs text-left border-collapse">
												<thead className="bg-gray-100 text-gray-600 uppercase font-bold sticky top-0 z-10 print:static">
													<tr>
														<th className="p-3 border-b border-r text-center w-24">Th√°ng</th> 
														<th className="p-3 border-b border-r w-24 text-center">Thi·∫øt b·ªã</th>
														<th className="p-3 border-b border-r w-40">M√¥ t·∫£ s·ª± c·ªë</th>
														<th className="p-3 border-b border-r w-40">Nguy√™n nh√¢n</th>
														<th className="p-3 border-b border-r text-center bg-red-50 text-red-800">Th·ªùi gian d·ª´ng m√°y</th>
														<th className="p-3 border-b w-28 text-center">Tr·∫°ng th√°i</th>
													</tr>
												</thead>
												<tbody className="divide-y divide-gray-200 text-slate-700">
													{(() => {
														// 1. X√°c ƒë·ªãnh danh s√°ch th√°ng c·∫ßn qu√©t d·ª±a tr√™n b·ªô l·ªçc K·ª≥
														let monthsToScan = [];
														if (shutdownReportPeriod === 'MONTH') monthsToScan = [selectedMonth];
														else if (shutdownReportPeriod === 'Q1') monthsToScan = [1, 2, 3];
														else if (shutdownReportPeriod === 'Q2') monthsToScan = [4, 5, 6];
														else if (shutdownReportPeriod === 'Q3') monthsToScan = [7, 8, 9];
														else if (shutdownReportPeriod === 'Q4') monthsToScan = [10, 11, 12];
														else if (shutdownReportPeriod === 'YEAR') monthsToScan = [1,2,3,4,5,6,7,8,9,10,11,12];

														// 2. T·ªïng h·ª£p d·ªØ li·ªáu t·ª´ c√°c th√°ng ƒë√£ ch·ªçn
														let rawIncidents = [];
														monthsToScan.forEach(m => {
															const items = db?.SHARED?.[m]?.shutdownIncidents || [];
															items.forEach(i => rawIncidents.push({ ...i, month: m }));
														});

														// 3. √Åp d·ª•ng b·ªô l·ªçc thi·∫øt b·ªã v√† tr·∫°ng th√°i
														const filtered = rawIncidents.filter(i => {
															const matchEq = yearFilterEq === 'ALL' || i.equipment === yearFilterEq;
															const matchSt = yearFilterSt === 'ALL' || i.status === yearFilterSt;
															return matchEq && matchSt;
														});

														if (filtered.length === 0) return <tr><td colSpan={6} className="p-8 text-center text-gray-400 italic">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu s·ª± c·ªë trong k·ª≥ b√°o c√°o ƒë√£ ch·ªçn.</td></tr>;

														// 4. S·∫Øp x·∫øp v√† t√≠nh RowSpan
														filtered.sort((a, b) => a.month - b.month || new Date(a.start) - new Date(b.start));
														const monthCounts = {};
														filtered.forEach(p => monthCounts[p.month] = (monthCounts[p.month] || 0) + 1);

														return filtered.map((item, idx) => {
															const isFirstRowOfMonth = idx === 0 || item.month !== filtered[idx - 1].month;
															const duration = calculateHoursDiff(item.start, item.end);

															return (
																<tr key={idx} className="hover:bg-rose-50/30 transition-colors">
																	{isFirstRowOfMonth && (
																		<td className="p-3 text-center font-bold border-r text-gray-800 bg-gray-50 align-middle border-b" rowSpan={monthCounts[item.month]}>
																			Th√°ng {item.month}
																		</td>
																	)}
																	<td className="p-3 border-r font-bold text-red-700 text-center">{item.equipment}</td>
																	<td className="p-3 border-r font-medium">{item.description}</td>
																	<td className="p-3 border-r text-gray-500 italic">{item.cause || "-"}</td>
																	<td className="p-3 border-r bg-red-50/10 align-middle">
																		<div className="flex flex-col gap-1 items-center">
																			<div className="text-xs text-gray-600 font-mono">
																				{formatDate(item.start)} <br/> ‚Üì <br/> {item.end ? formatDate(item.end) : <span className="text-red-500 animate-pulse font-bold">Ch∆∞a kh·∫Øc ph·ª•c</span>}
																			</div>
																			<div className="font-bold text-red-700 bg-red-50 px-2 py-0.5 rounded border border-red-100 w-full text-center mt-1">
																				{duration.toFixed(1)}h ({(duration/24).toFixed(1)} ng√†y)
																			</div>
																		</div>
																	</td>
																	<td className="p-3 text-center align-middle">
																		<span className={`inline-block text-[10px] px-2 py-1 rounded border font-bold ${getEventStatusColor(item.status)}`}>
																			{item.status}
																		</span>
																	</td>
																</tr>
															);
														});
													})()}
												</tbody>
											</table>
										</div>
										
										{/* Footer Ch·ªØ k√Ω */}
										<div className="mt-8 grid grid-cols-2 text-center text-sm font-bold text-gray-700 break-inside-avoid">
											<div>
												<p className="uppercase text-gray-500 text-xs mb-16">Ng∆∞·ªùi l·∫≠p bi·ªÉu</p>
												<p>{currentUser || '....................'}</p>
											</div>
											<div>
												<p className="uppercase text-gray-500 text-xs mb-16">L√£nh ƒë·∫°o ph√™ duy·ªát</p>
												<p>....................</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						)}

						{/* --- MB√ÅO C√ÅO S·ª∞ KI·ªÜN KH√ÅC (THEO TH√ÅNG/QU√ù/NƒÇM) --- */}
						{showAnnualEventModal && (
							<div className="fixed inset-0 bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-[10005] p-2 md:p-4">
								<div className="bg-white w-full max-w-[95%] h-full md:h-auto md:max-h-[95vh] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
									
									{/* Header Modal */}
									<div className="p-4 border-b bg-purple-700 text-white flex justify-between items-center shrink-0">
										<div className="flex items-center gap-3">
											<div className="bg-white/20 p-2 rounded-lg">
												<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
											</div>
											<div>
												<h2 className="text-xl font-bold uppercase tracking-wide">B√°o c√°o T·ªïng h·ª£p S·ª± ki·ªán kh√°c {year}</h2>
												<p className="text-purple-200 text-xs">Chi ti·∫øt ti·∫øn ƒë·ªô th·ª±c hi·ªán v√† th·ªùi l∆∞·ª£ng c√¥ng vi·ªác</p>
											</div>
										</div>
										<div className="flex gap-2">
											<button onClick={() => window.print()} className="bg-white text-purple-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-purple-50 shadow-sm flex items-center gap-2">
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
												In B√°o c√°o
											</button>
											<button onClick={() => setShowAnnualEventModal(false)} className="text-purple-100 hover:text-white hover:bg-purple-600/50 p-2 rounded-lg transition-colors">‚úï ƒê√≥ng</button>
										</div>
									</div>

									{/* Thanh B·ªô l·ªçc */}
									<div className="bg-gray-50 border-b border-gray-200 p-3 flex flex-wrap gap-6 items-center print:hidden">
										<div className="flex items-center gap-2">
											<span className="text-xs font-bold text-gray-500 uppercase">K·ª≥ b√°o c√°o:</span>
											<select 
												className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-purple-700 outline-none focus:ring-2 focus:ring-purple-500"
												value={eventReportPeriod}
												onChange={(e) => setEventReportPeriod(e.target.value)}
											>
												<option value="MONTH">Th√°ng hi·ªán t·∫°i ({selectedMonth})</option>
												<option value="Q1">Qu√Ω 1 (Th√°ng 1-3)</option>
												<option value="Q2">Qu√Ω 2 (Th√°ng 4-6)</option>
												<option value="Q3">Qu√Ω 3 (Th√°ng 7-9)</option>
												<option value="Q4">Qu√Ω 4 (Th√°ng 10-12)</option>
												<option value="YEAR">C·∫£ NƒÉm {year}</option>
											</select>
										</div>

										<div className="flex items-center gap-2">
											<span className="text-xs font-bold text-gray-500 uppercase">Thi·∫øt b·ªã:</span>
											<select 
												className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-purple-500"
												value={yearFilterEq}
												onChange={(e) => setYearFilterEq(e.target.value)}
											>
												<option value="ALL">-- T·∫•t c·∫£ --</option>
												{MAINTENANCE_EQUIPMENT.map(eq => <option key={eq} value={eq}>{eq}</option>)}
											</select>
										</div>

										<div className="flex items-center gap-2">
											<span className="text-xs font-bold text-gray-500 uppercase">Tr·∫°ng th√°i:</span>
											<select 
												className="border border-gray-300 rounded px-2 py-1 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-purple-500"
												value={yearFilterSt}
												onChange={(e) => setYearFilterSt(e.target.value)}
											>
												<option value="ALL">-- T·∫•t c·∫£ --</option>
												{EVENT_STATUS_OPTIONS.map(st => <option key={st} value={st}>{st}</option>)}
											</select>
										</div>
									</div>

									{/* N·ªôi dung b·∫£ng */}
									<div className="flex-1 overflow-y-auto p-4 bg-slate-50 custom-scrollbar print:overflow-visible print:h-auto">
										<div className="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden print:border-none print:shadow-none">
											<table className="w-full text-xs text-left border-collapse">
												<thead className="bg-gray-100 text-gray-600 uppercase font-bold sticky top-0 z-10 print:static">
													<tr>
														<th className="p-3 border-b border-r text-center w-24">Th√°ng</th> 
														<th className="p-3 border-b border-r w-24 text-center">Thi·∫øt b·ªã</th>
														<th className="p-3 border-b border-r w-40">N·ªôi dung s·ª± ki·ªán</th>
														<th className="p-3 border-b border-r w-20 text-center">Lo·∫°i</th>
														<th className="p-3 border-b border-r text-center bg-blue-50 text-blue-800 w-44">Th·ªùi gian D·ª± ki·∫øn</th>
														<th className="p-3 border-b border-r text-center bg-purple-50 text-purple-800 w-44">Th·ªùi gian Th·ª±c t·∫ø</th>
														<th className="p-3 border-b w-28 text-center">Tr·∫°ng th√°i</th>
													</tr>
												</thead>
												<tbody className="divide-y divide-gray-200 text-slate-700">
													{(() => {
														// 1. T·ªïng h·ª£p d·ªØ li·ªáu theo K·ª≥
														let monthsToScan = [];
														if (eventReportPeriod === 'MONTH') monthsToScan = [selectedMonth];
														else if (eventReportPeriod === 'Q1') monthsToScan = [1, 2, 3];
														else if (eventReportPeriod === 'Q2') monthsToScan = [4, 5, 6];
														else if (eventReportPeriod === 'Q3') monthsToScan = [7, 8, 9];
														else if (eventReportPeriod === 'Q4') monthsToScan = [10, 11, 12];
														else if (eventReportPeriod === 'YEAR') monthsToScan = [1,2,3,4,5,6,7,8,9,10,11,12];

														let rawEvents = [];
														monthsToScan.forEach(m => {
															const items = db?.SHARED?.[m]?.events || [];
															items.forEach(i => rawEvents.push({ ...i, month: m }));
														});

														// 2. L·ªçc
														const filtered = rawEvents.filter(i => {
															const matchEq = yearFilterEq === 'ALL' || i.equipment === yearFilterEq;
															const matchSt = yearFilterSt === 'ALL' || i.status === yearFilterSt;
															return matchEq && matchSt;
														});

														if (filtered.length === 0) return <tr><td colSpan={7} className="p-8 text-center text-gray-400 italic">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu s·ª± ki·ªán ph√π h·ª£p.</td></tr>;

														// 3. S·∫Øp x·∫øp & RowSpan
														filtered.sort((a, b) => a.month - b.month || new Date(a.startDate) - new Date(b.startDate));
														const monthCounts = {};
														filtered.forEach(p => monthCounts[p.month] = (monthCounts[p.month] || 0) + 1);

														return filtered.map((item, idx) => {
															const isFirstRowOfMonth = idx === 0 || item.month !== filtered[idx - 1].month;
															const planHrs = calculateHoursDiff(item.plannedStart, item.plannedEnd);
															const actHrs = calculateHoursDiff(item.startDate, item.endDate);

															return (
																<tr key={idx} className="hover:bg-purple-50/20 transition-colors">
																	{isFirstRowOfMonth && (
																		<td className="p-3 text-center font-bold border-r text-gray-800 bg-gray-50 align-middle border-b" rowSpan={monthCounts[item.month]}>
																			Th√°ng {item.month}
																		</td>
																	)}
																	<td className="p-3 border-r font-bold text-slate-700 text-center">{item.equipment || "-"}</td>
																	<td className="p-3 border-r font-medium">
																		{item.name}
																		{item.info && <div className="text-[10px] text-gray-400 italic font-normal mt-1">{item.info}</div>}
																	</td>
																	<td className="p-3 border-r text-center text-gray-500 font-medium">{item.eventType}</td>
																	
																	{/* C·ªôt D·ª± ki·∫øn */}
																	<td className="p-3 border-r bg-blue-50/10 align-middle text-center">
																		{item.plannedStart ? (
																			<>
																				<div className="text-xs text-gray-600 font-mono">
																					{formatDate(item.plannedStart)} <br/> ‚Üì <br/> {formatDate(item.plannedEnd)}
																				</div>
																				<div className="font-bold text-blue-700 mt-1">{planHrs.toFixed(1)}h ({(planHrs/24).toFixed(1)}n)</div>
																			</>
																		) : "-"}
																	</td>

																	{/* C·ªôt Th·ª±c t·∫ø */}
																	<td className="p-3 border-r bg-purple-50/10 align-middle text-center">
																		<div className="text-xs text-gray-600 font-mono">
																			{formatDate(item.startDate)} <br/> ‚Üì <br/> {item.endDate ? formatDate(item.endDate) : <span className="text-red-500 italic">ƒêang ti·∫øn h√†nh...</span>}
																		</div>
																		{item.endDate && <div className="font-bold text-purple-700 mt-1">{actHrs.toFixed(1)}h ({(actHrs/24).toFixed(1)}n)</div>}
																	</td>

																	<td className="p-3 text-center align-middle">
																		<span className={`inline-block text-[10px] px-2 py-1 rounded border font-bold ${getEventStatusColor(item.status)}`}>
																			{item.status}
																		</span>
																	</td>
																</tr>
															);
														});
													})()}
												</tbody>
											</table>
										</div>
										
										{/* Footer Ch·ªØ k√Ω */}
										<div className="mt-8 grid grid-cols-2 text-center text-sm font-bold text-gray-700 break-inside-avoid">
											<div>
												<p className="uppercase text-gray-500 text-xs mb-16">Ng∆∞·ªùi l·∫≠p bi·ªÉu</p>
												<p>{currentUser || '....................'}</p>
											</div>
											<div>
												<p className="uppercase text-gray-500 text-xs mb-16">L√£nh ƒë·∫°o ph√™ duy·ªát</p>
												<p>....................</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						)}

                        {/* Giao di·ªán IMPORT PLAN EXCEL MODAL (GIAO DI·ªÜN PRO - ƒê√É C·∫¨P NH·∫¨T 3 C·ªòT) */}
                        {importMode && (
                            <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-[10003] p-4 backdrop-blur-sm">
                                <div className="bg-white rounded-xl w-full max-w-4xl shadow-2xl flex flex-col max-h-[90vh]">
                                    {/* Header */}
                                    <div className="p-5 border-b flex justify-between items-center bg-gray-50 rounded-t-xl">
                                        <div className="flex items-center gap-3">
                                            <div>
                                                <h2 className="text-lg font-bold text-gray-800">
                                                    {importMode === 'PLAN' ? `Nh·∫≠p K·∫ø ho·∫°ch nƒÉm ${year}` : 
                                                     importMode === 'YEAR_ACTUAL' ? `Nh·∫≠p Th·ª±c t·∫ø C·∫£ nƒÉm ${year}` : 
                                                     importMode === 'SVODKA' ? `Import t·ª´ file Svodka` :
                                                     `Nh·∫≠p Th·ª±c t·∫ø Th√°ng ${selectedMonth}`}
                                                </h2>
                                                <p className="text-xs text-gray-500">H·ªó tr·ª£ ƒë·ªãnh d·∫°ng .xlsx, .xls</p>
                                            </div>
                                        </div>
                                        <button onClick={() => {setImportMode(null); setPreviewData([]);}} className="text-gray-400 hover:text-red-500 transition-colors">‚úï</button>
                                    </div>

                                    {/* Body */}
                                    <div className="p-6 overflow-y-auto custom-scrollbar">
                                        
                                        {/* GIAO DI·ªÜN CH·ªåN FILE (3 C·ªòT) - CH·ªà HI·ªÜN KHI CH∆ØA C√ì PREVIEW */}
                                        {previewData.length === 0 && (
                                            <div className="mb-6">
                                                {/* N·∫øu l√† mode PLAN th√¨ hi·ªán 3 l·ª±a ch·ªçn, c√°c mode kh√°c hi·ªán giao di·ªán c≈© */}
                                                {importMode === 'PLAN' ? (
                                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                        {/* L·ª±a ch·ªçn 1: T·∫£i file m·∫´u */}
                                                        <div className="bg-blue-50 border border-blue-200 p-4 rounded-xl flex flex-col items-center text-center justify-center cursor-pointer hover:bg-blue-100 transition-all hover:scale-105 h-40 shadow-sm" onClick={handleDownloadTemplate}>
                                                            <div className="p-3 bg-blue-200 rounded-full mb-3 text-blue-700">
                                                                
                                                            </div>
                                                            <span className="text-sm font-bold text-blue-900">1. T·∫£i file Excel m·∫´u</span>
                                                            <span className="text-[10px] text-blue-600 mt-1">D√πng file chu·∫©n c·ªßa App</span>
                                                        </div>

                                                        {/* L·ª±a ch·ªçn 2: Upload file m·∫´u */}
                                                        <div className="bg-gray-50 border-2 border-dashed border-gray-300 p-4 rounded-xl flex flex-col items-center text-center justify-center relative hover:bg-gray-100 transition-all hover:scale-105 h-40 cursor-pointer group">
                                                            <div className="p-3 bg-gray-200 rounded-full mb-3 text-gray-600 group-hover:bg-gray-300 transition-colors">
                                                                
                                                            </div>
                                                            <span className="text-sm font-bold text-gray-700">2. Ch·ªçn file Excel m·∫´u</span>
                                                            <span className="text-[10px] text-gray-500 mt-1">File ƒë√£ ƒëi·ªÅn theo m·∫´u (1)</span>
                                                            <input 
                                                                type="file" 
                                                                ref={fileInputRef}
                                                                accept=".xlsx, .xls" 
                                                                onChange={handleFileUpload} // H√†m c≈© x·ª≠ l√Ω file m·∫´u
                                                                className="absolute inset-0 opacity-0 cursor-pointer" 
                                                            />
                                                        </div>

                                                        {/* L·ª±a ch·ªçn 3: Upload file Svodka (M·ªöI) */}
                                                        <div className="bg-green-50 border-2 border-dashed border-green-400 p-4 rounded-xl flex flex-col items-center text-center justify-center relative hover:bg-green-100 transition-all hover:scale-105 h-40 cursor-pointer group">
                                                            <div className="p-3 bg-green-200 rounded-full mb-3 text-green-700 group-hover:bg-green-300 transition-colors">
                                                                
                                                            </div>
                                                            <span className="text-sm font-bold text-green-900">3. Ch·ªçn file Svodka Excel</span>
                                                            <span className="text-[10px] text-green-700 mt-1">L·∫•y t·ª´ Sheet "Total"</span>
                                                            <input 
                                                                type="file" 
                                                                accept=".xlsx, .xls" 
                                                                onChange={withXLSX(handleSvodkaPlanUpload)} 
                                                                className="absolute inset-0 opacity-0 cursor-pointer" 
                                                            />
                                                        </div>
                                                    </div>
                                                ) : (
                                                    /* Giao di·ªán upload cho c√°c mode kh√°c (ACTUAL, SVODKA...) - Gi·ªØ nguy√™n logic c≈© nh∆∞ng l√†m ƒë·∫πp h∆°n */
                                                    <div className="flex flex-col md:flex-row gap-4">
                                                        {importMode !== 'SVODKA' && (
                                                            <div className="flex-1 bg-blue-50 border border-blue-100 p-4 rounded-lg flex flex-col items-center text-center justify-center cursor-pointer hover:bg-blue-100 transition-colors" onClick={withXLSX(handleDownloadTemplate)}>
                                                                <span className="text-sm font-bold text-blue-800">1. T·∫£i file m·∫´u</span>
                                                                <span className="text-xs text-blue-600 mt-1">D√πng file n√†y ƒë·ªÉ ƒëi·ªÅn d·ªØ li·ªáu</span>
                                                            </div>
                                                        )}
                                                        <div className="flex-1 bg-gray-50 border-2 border-dashed border-gray-300 p-4 rounded-lg flex flex-col items-center text-center justify-center relative hover:bg-gray-100 transition-colors">
                                                            <span className="text-sm font-bold text-gray-700">2. Ch·ªçn file Excel</span>
                                                            <span className="text-xs text-gray-500 mt-1">ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</span>
                                                            <input 
                                                                type="file" 
                                                                ref={fileInputRef}
                                                                accept=".xlsx, .xls" 
                                                                onChange={withXLSX(handleFileUpload)}
                                                                className="absolute inset-0 opacity-0 cursor-pointer"
                                                            />
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {/* B·∫£ng Preview d·ªØ li·ªáu (Ch·ªâ hi·ªán khi c√≥ data) */}
                                        {previewData.length > 0 ? (
                                            <div className="border rounded-lg overflow-hidden animate-in fade-in slide-in-from-bottom-4">
                                                <div className="bg-gray-100 px-3 py-2 border-b font-bold text-xs text-gray-600 flex justify-between items-center">
                                                    <span>XEM TR∆Ø·ªöC D·ªÆ LI·ªÜU ({previewData.length} d√≤ng)</span>
                                                    <button onClick={() => {setPreviewData([]); if(fileInputRef.current) fileInputRef.current.value='';}} className="text-red-500 hover:text-red-700 text-xs font-bold underline">Ch·ªçn l·∫°i file kh√°c</button>
                                                </div>
                                                <div className="max-h-60 overflow-y-auto">
                                                    <table className="w-full text-sm text-center">
                                                        <thead className="bg-gray-50 text-gray-500 sticky top-0">
                                                            <tr>
                                                                <th className="p-2 border-b w-32">{importMode === 'PLAN' ? 'Th√°ng' : 'Ng√†y'}</th>
                                                                <th className="p-2 border-b bg-blue-50 text-blue-800">Gaslift (Main)</th>
                                                                {importMode === 'PLAN' && <th className="p-2 border-b text-gray-400">Ng√†y LV</th>}
                                                                <th className="p-2 border-b bg-orange-50 text-orange-800">BCP (Main)</th>
                                                                {importMode === 'PLAN' && <th className="p-2 border-b text-gray-400">Ng√†y LV</th>}
                                                                {importMode === 'SVODKA' && <th className="p-2 border-b text-left pl-4">Chi ti·∫øt kh√°c</th>}
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y divide-gray-100">
                                                            {previewData.map((row, idx) => (
                                                                <tr key={idx} className="border-b last:border-0 hover:bg-blue-50 transition-colors">
                                                                    <td className="p-2 font-bold text-gray-700">{row.displayDate || row.arg1}</td>
                                                                    <td className="p-2 text-blue-700 font-mono font-bold">
                                                                        {importMode === 'SVODKA' ? formatVolume(row.gasMain) : (row.val1 ? row.val1.toLocaleString('vi-VN') : '-')}
                                                                    </td>
                                                                    {importMode === 'PLAN' && <td className="p-2 text-gray-500 text-xs">{row.day1}</td>}
                                                                    <td className="p-2 text-orange-700 font-mono font-bold">
                                                                        {importMode === 'SVODKA' ? formatVolume(row.bcpMain) : (row.val2 ? row.val2.toLocaleString('vi-VN') : '-')}
                                                                    </td>
                                                                    {importMode === 'PLAN' && <td className="p-2 text-gray-500 text-xs">{row.day2}</td>}
                                                                    {importMode === 'SVODKA' && (
                                                                        <td className="p-2 text-xs text-gray-500 text-left pl-4 italic">
                                                                            ƒê√£ l·∫•y {row.details ? Object.keys(row.details).length : 0} th√¥ng s·ªë chi ti·∫øt...
                                                                        </td>
                                                                    )}
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        ) : (
                                            /* Th√¥ng b√°o khi ch∆∞a c√≥ file (ch·ªâ hi·ªán ·ªü c√°c mode kh√¥ng ph·∫£i PLAN v√¨ PLAN ƒë√£ c√≥ 3 c·ªôt ·ªü tr√™n) */
                                            importMode !== 'PLAN' && (
                                                <div className="text-center py-8 text-gray-400 italic bg-gray-50 rounded-lg border border-gray-100">
                                                    Ch∆∞a c√≥ d·ªØ li·ªáu. Vui l√≤ng ch·ªçn file Excel ƒë·ªÉ ti·∫øp t·ª•c.
                                                </div>
                                            )
                                        )}
                                    </div>

                                    {/* Footer */}
                                    <div className="p-5 border-t bg-gray-50 flex justify-end gap-3 rounded-b-xl">
                                        <button onClick={() => {setImportMode(null); setPreviewData([]);}} className="px-5 py-2 text-gray-600 hover:bg-gray-200 rounded-lg text-sm font-bold transition-colors">H·ªßy b·ªè</button>
                                        <button 
                                            onClick={handleConfirmImport} 
                                            disabled={previewData.length === 0}
                                            className={`px-5 py-2 rounded-lg text-sm font-bold shadow-md flex items-center gap-2 transition-colors ${
                                                previewData.length === 0 
                                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                                : 'bg-blue-600 text-white hover:bg-blue-700'
                                            }`}
                                        >
                                            X√°c nh·∫≠n Nh·∫≠p li·ªáu
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ... (C√°c Modal chi ti·∫øt ng√†y, b·∫£o d∆∞·ª°ng, s·ª± c·ªë, s·ª± ki·ªán gi·ªØ nguy√™n nh∆∞ c≈©) ... */}
                        {/* DAY DETAIL MODAL */}
                        {dayDetail && (
                            <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                                <div className="bg-white rounded-xl w-full max-w-md shadow-2xl flex flex-col transform transition-all scale-100">
                                    <div className="p-5 border-b flex justify-between items-center bg-gray-50 rounded-t-xl">
                                        <h2 className="text-lg font-bold text-gray-800">Chi ti·∫øt ng√†y {dayDetail.day}/{selectedMonth}/{year}</h2>
                                        <button onClick={closeDayDetail} className="text-gray-400 hover:text-red-500 transition-colors">‚úï</button>
                                    </div>
                                    <div className="p-6 space-y-4">
                                        <div className="space-y-3 p-3 bg-blue-50 rounded border border-blue-100">
                                            <h4 className="font-bold text-blue-800 text-sm">H·ªá th·ªëng Gaslift</h4>
                                            <div><label className="block text-xs font-medium text-gray-700 mb-1">S·∫£n l∆∞·ª£ng (m¬≥)</label><input type="number" className="w-full border border-gray-300 rounded p-2 focus:ring-1 outline-none text-sm" value={dayDetail.gasVal} onChange={e => setDayDetail({...dayDetail, gasVal: e.target.value})} placeholder="Nh·∫≠p..." autoFocus /></div>
                                            <div><label className="block text-xs font-medium text-gray-700 mb-1">Ghi ch√∫</label><input className="w-full border border-gray-300 rounded p-2 focus:ring-1 outline-none text-sm" value={dayDetail.gasNote} onChange={e => setDayDetail({...dayDetail, gasNote: e.target.value})} placeholder="..." /></div>
                                        </div>
                                        <div className="space-y-3 p-3 bg-orange-50 rounded border border-orange-100">
                                            <h4 className="font-bold text-orange-800 text-sm">H·ªá th·ªëng BCP</h4>
                                            <div><label className="block text-xs font-medium text-gray-700 mb-1">S·∫£n l∆∞·ª£ng (m¬≥)</label><input type="number" className="w-full border border-gray-300 rounded p-2 focus:ring-1 outline-none text-sm" value={dayDetail.bcpVal} onChange={e => setDayDetail({...dayDetail, bcpVal: e.target.value})} placeholder="Nh·∫≠p..." /></div>
                                            <div><label className="block text-xs font-medium text-gray-700 mb-1">Ghi ch√∫</label><input className="w-full border border-gray-300 rounded p-2 focus:ring-1 outline-none text-sm" value={dayDetail.bcpNote} onChange={e => setDayDetail({...dayDetail, bcpNote: e.target.value})} placeholder="..." /></div>
                                        </div>
                                        <div className="flex justify-end gap-3 pt-2">
                                            <button onClick={closeDayDetail} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm font-medium">H·ªßy b·ªè</button>
                                            <button onClick={saveDayDetail} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium shadow-md transition-colors">L∆∞u thay ƒë·ªïi</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* B·∫¢NG CHI TI·∫æT K·∫æ HO·∫†CH B·∫¢O D∆Ø·ª†NG MODAL*/}
						{maintDetail && (
						<div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[10001] p-4 backdrop-blur-sm">
							<div className="bg-white rounded-xl w-full max-w-lg shadow-2xl flex flex-col max-h-[95vh] overflow-hidden">
								
								{/* Header chuy√™n nghi·ªáp */}
								<div className="p-4 border-b flex justify-between items-center bg-slate-50">
									<div>
										<h2 className="text-lg font-bold text-slate-800">
											{maintDetail.isNew ? "Th√™m m·ªõi B·∫£o d∆∞·ª°ng" : "Chi ti·∫øt B·∫£o d∆∞·ª°ng"}
										</h2>
										<p className="text-[10px] text-slate-500 uppercase font-semibold">
											C·∫¨P NH·∫¨T K·∫æ HO·∫†CH & V·∫¨N H√ÄNH TH·ª∞C T·∫æ
										</p>
									</div>
									<button onClick={closeMaintDetail} className="text-gray-400 hover:text-red-500 bg-white w-8 h-8 rounded-full shadow-sm border flex items-center justify-center">‚úï</button>
								</div>

								{/* üëá V√ôNG CU·ªòN N·ªòI DUNG CH√çNH (B·∫ÆT ƒê·∫¶U) üëá */}
								<div className="p-5 space-y-4 overflow-y-auto custom-scrollbar">
									
									{/* 1. Th√¥ng tin chung */}
									<div className="space-y-3">
										<label className="block text-[11px] font-bold text-slate-500 uppercase mb-[-8px]">M√¥ t·∫£ c√¥ng vi·ªác</label>
										<input 
											placeholder="Nh·∫≠p t√™n c√¥ng vi·ªác b·∫£o d∆∞·ª°ng..." 
											className="w-full border border-slate-300 rounded-lg p-2.5 text-sm font-bold focus:ring-2 focus:ring-blue-500 outline-none shadow-sm" 
											value={maintDetail.description} 
											onChange={e => setMaintDetail({...maintDetail, description: e.target.value})} 
										/>
										
										<div className="grid grid-cols-2 gap-3">
											<div>
												<label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">ƒê∆°n v·ªã th·ª±c hi·ªán</label>
												<input list="units" className="w-full border border-slate-300 rounded-lg p-2 text-sm" value={maintDetail.performingUnit} onChange={e => setMaintDetail({...maintDetail, performingUnit: e.target.value})} />
											</div>
											<div>
												<label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">Thi·∫øt b·ªã d·ª´ng</label>
												<select className="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-blue-700" value={maintDetail.maintenanceEquipment} onChange={e => setMaintDetail({...maintDetail, maintenanceEquipment: e.target.value})}>
													{['GTC-A', 'GTC-B', 'BCP-DGCP', 'GTG'].map(eq => <option key={eq} value={eq}>{eq}</option>)}
												</select>
											</div>
										</div>
									</div>

									{/* 2. Toggle B·∫£o d∆∞·ª°ng ƒë·ªôt xu·∫•t */}
									<div className="flex items-center justify-between p-1 bg-amber-50 rounded-xl border border-amber-200 shadow-sm">
										<div className="flex items-center gap-3">
											<span className="text-amber-600">‚ö†Ô∏è</span>
											<div>
												<p className="text-xs font-black text-amber-900 uppercase">B·∫£o d∆∞·ª°ng ƒë·ªôt xu·∫•t</p>
												<p className="text-[11px] text-amber-600">B·∫≠t n·∫øu vi·ªác n√†y kh√¥ng c√≥ trong k·∫ø ho·∫°ch g·ªëc</p>
											</div>
										</div>
										<label className="relative inline-flex items-center cursor-pointer">
											<input type="checkbox" className="sr-only peer" checked={maintDetail.isUnplanned} onChange={e => setMaintDetail({...maintDetail, isUnplanned: e.target.checked, plannedHours: e.target.checked ? 0 : maintDetail.plannedHours})} />
											<div className="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-amber-500 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
										</label>
									</div>

									{/* 3. Ph·∫ßn D·ª± ki·∫øn (C√≥ logic: M·∫∑c ƒë·ªãnh 5:00 s√°ng + T·ª± t√≠nh gi·ªù k·∫øt th√∫c) */}
                                    {!maintDetail.isUnplanned && (
                                        <div className="bg-blue-50/50 p-3 rounded-xl border border-blue-100 space-y-2">
                                            <h3 className="text-[11px] font-black text-blue-700 uppercase flex items-center gap-2">üóìÔ∏è TH·ªúI GIAN D·ª∞ KI·∫æN (L√äN K·∫æ HO·∫†CH)</h3>
                                            
                                            <div className="space-y-2">
                                                {/* H√†ng 1: Ng√†y b·∫Øt ƒë·∫ßu d·ª± ki·∫øn */}
                                                <div className="flex items-center gap-2">
                                                    <label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">
                                                        B·∫Øt ƒë·∫ßu
                                                    </label>
                                                    <input 
                                                        type="datetime-local" 
                                                        className="flex-0 border border-blue-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-blue-500 outline-none bg-white font-bold text-slate-600"
                                                        value={maintDetail.plannedStart} 
                                                        onChange={e => {
                                                            let newStart = e.target.value;
                                                            
                                                            // --- LOGIC 1: M·∫∂C ƒê·ªäNH 5:00 S√ÅNG KHI CH·ªåN NG√ÄY ---
                                                            if (newStart) {
                                                                const [newDatePart, newTimePart] = newStart.split('T');
                                                                const oldDatePart = maintDetail.plannedStart ? maintDetail.plannedStart.split('T')[0] : '';

                                                                // N·∫øu Ng√†y thay ƒë·ªïi (so v·ªõi c≈©) -> Force v·ªÅ 05:00
                                                                // N·∫øu Ng√†y gi·ªëng c≈© (t·ª©c l√† ƒëang ch·ªânh gi·ªù) -> Gi·ªØ nguy√™n gi·ªù ng∆∞·ªùi d√πng ch·ªçn
                                                                if (newDatePart !== oldDatePart) {
                                                                    newStart = `${newDatePart}T05:00`;
                                                                }
                                                            }
                                                            // --------------------------------------------------

                                                            let newEnd = maintDetail.plannedEnd;
                                                            
                                                            // --- LOGIC 2: T·ª∞ ƒê·ªòNG T√çNH NG√ÄY K·∫æT TH√öC D·ª∞A V√ÄO ƒê·ªäNH M·ª®C ---
                                                            if (maintDetail.plannedHours && parseFloat(maintDetail.plannedHours) > 0 && newStart) {
                                                                const startDate = new Date(newStart);
                                                                const hoursToAdd = parseFloat(maintDetail.plannedHours);
                                                                const endDate = new Date(startDate.getTime() + (hoursToAdd * 60 * 60 * 1000));
                                                                
                                                                const offset = endDate.getTimezoneOffset() * 60000;
                                                                newEnd = new Date(endDate.getTime() - offset).toISOString().slice(0, 16);
                                                            } 
                                                            else {
                                                                // N·∫øu ch∆∞a c√≥ ƒë·ªãnh m·ª©c th√¨ t√≠nh ng∆∞·ª£c l·∫°i gi·ªù
                                                                const hours = autoCalculateHours(newStart, newEnd);
                                                                setMaintDetail({ ...maintDetail, plannedStart: newStart, plannedHours: hours });
                                                                return; 
                                                            }

                                                            setMaintDetail({ ...maintDetail, plannedStart: newStart, plannedEnd: newEnd });
                                                        }} 
                                                    />
                                                </div>

                                                {/* H√†ng 2: Ng√†y k·∫øt th√∫c d·ª± ki·∫øn */}
                                                <div className="flex items-center gap-2">
                                                    <label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">
                                                        K·∫øt th√∫c
                                                    </label>         
                                                    <input 
                                                        type="datetime-local" 
                                                        className="flex-0 border border-blue-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-blue-500 outline-none bg-white font-bold text-slate-600"  
                                                        value={maintDetail.plannedEnd} 
                                                        onChange={e => {
                                                            const newEnd = e.target.value;
                                                            const hours = autoCalculateHours(maintDetail.plannedStart, newEnd);
                                                            setMaintDetail({
                                                                ...maintDetail, 
                                                                plannedEnd: newEnd, 
                                                                plannedHours: hours 
                                                            });
                                                        }} 
                                                    />
                                                </div>
                                            </div>

                                            {/* H√†ng 3: ƒê·ªãnh m·ª©c gi·ªù */}
                                            <div className="flex justify-between items-center pt-2 border-t border-blue-100">
                                                <span className="text-[11px] font-bold text-blue-600">ƒê·ªäNH M·ª®C D·ª™NG D·ª∞ KI·∫æN:</span>
                                                <div className="flex items-center gap-1">
                                                    <input 
                                                        type="number" 
                                                        step="0.5" 
                                                        className="w-20 border border-blue-300 rounded p-1 text-xs text-center font-bold focus:bg-blue-50 focus:ring-1 focus:ring-blue-500 outline-none transition-colors" 
                                                        value={maintDetail.plannedHours} 
                                                        onChange={e => {
                                                            const newHours = e.target.value;
                                                            let newEnd = maintDetail.plannedEnd;

                                                            // Logic t√≠nh xu√¥i: C√≥ B·∫Øt ƒë·∫ßu + C√≥ Gi·ªù -> Ra K·∫øt th√∫c
                                                            if (maintDetail.plannedStart && newHours && parseFloat(newHours) > 0) {
                                                                const startDate = new Date(maintDetail.plannedStart);
                                                                const hoursToAdd = parseFloat(newHours);
                                                                const endDate = new Date(startDate.getTime() + (hoursToAdd * 60 * 60 * 1000));
                                                                
                                                                const offset = endDate.getTimezoneOffset() * 60000;
                                                                newEnd = new Date(endDate.getTime() - offset).toISOString().slice(0, 16);
                                                            }

                                                            setMaintDetail({
                                                                ...maintDetail, 
                                                                plannedHours: newHours,
                                                                plannedEnd: newEnd
                                                            });
                                                        }} 
                                                    />
                                                    <span className="text-[11px] font-bold text-blue-400">GI·ªú</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}

									{/* 4. Ph·∫ßn Th·ª±c t·∫ø (M√ÄU XANH NG·ªåC) */}
									<div className="bg-emerald-50/50 p-3 rounded-xl border border-emerald-100 space-y-3">
										<h3 className="text-[11px] font-black text-emerald-700 uppercase flex items-center gap-2 mb-1">
											‚è±Ô∏è V·∫¨N H√ÄNH TH·ª∞C T·∫æ (GHI NH·∫¨N)
										</h3>
										
										<div className="space-y-2">
											{/* H√†ng 1: Ng√†y b·∫Øt ƒë·∫ßu th·ª±c t·∫ø */}
											<div className="flex items-center gap-2">
												<label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">
													B·∫Øt ƒë·∫ßu
												</label>
												<input 
													type="datetime-local" 
													className="flex-0 border border-emerald-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-emerald-500 outline-none bg-white font-bold text-slate-600"
													value={maintDetail.start} 
													onChange={e => {
														const newStart = e.target.value;
														const hours = autoCalculateHours(newStart, maintDetail.end);
														setMaintDetail({
															...maintDetail, 
															start: newStart, 
															actualHours: hours 
														});
													}} 
												/>
											</div>

											{/* H√†ng 2: Ng√†y k·∫øt th√∫c th·ª±c t·∫ø */}
											<div className="flex items-center gap-2">
												<label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">
													K·∫øt th√∫c
												</label>
												<input 
													type="datetime-local" 
													className="flex-0 border border-emerald-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-emerald-500 outline-none bg-white font-bold text-slate-600"
													value={maintDetail.end} 
													onChange={e => {
														const newEnd = e.target.value;
														const hours = autoCalculateHours(maintDetail.start, newEnd);
														setMaintDetail({
															...maintDetail, 
															end: newEnd, 
															actualHours: hours 
														});
													}} 
												/>
											</div>
										</div>

										<div className="flex justify-between items-center pt-2 border-t border-emerald-100">
											<span className="text-[11px] font-bold text-emerald-600">GI·ªú D·ª™NG TH·ª∞C T·∫æ:</span>
											<div className="flex items-center gap-1">
												<input type="number" className="w-20 border border-emerald-300 rounded p-1 text-xs text-center font-bold" value={maintDetail.actualHours} onChange={e => setMaintDetail({...maintDetail, actualHours: e.target.value})} />
												<span className="text-[11px] font-bold text-emerald-400">GI·ªú</span>
											</div>
										</div>
									</div>

									{/* 5. KH·ªêI M·ªöI: K·∫æ HO·∫†CH TI·∫æP THEO (M√ÄU T√çM - ƒê√É ƒê∆ØA V√ÄO V√ôNG CU·ªòN) */}
                                    <div className="bg-purple-50/50 p-3 rounded-xl border border-purple-100 space-y-3">
                                        <h3 className="text-[11px] font-black text-purple-700 uppercase flex items-center gap-2 mb-1">
                                            üöÄ K·∫æ HO·∫†CH B·∫¢O D∆Ø·ª†NG TI·∫æP THEO (D·ª∞ KI·∫æN)
                                        </h3>
                                        
                                        <div className="space-y-2">
                                            {/* H√†ng 1: Nh·∫≠p t·ªïng gi·ªù ch·∫°y m√°y (UCP) */}
                                            <div className="flex items-center justify-between gap-2">
                                                <label className="text-[11px] font-bold text-slate-500 uppercase whitespace-nowrap" title="T·ªïng s·ªë gi·ªù m√°y ƒë√£ ho·∫°t ƒë·ªông t√≠nh ƒë·∫øn th·ªùi ƒëi·ªÉm d·ª´ng m√°y">
                                                    T·ªïng gi·ªù ch·∫°y m√°y (UCP) khi d·ª´ng:
                                                </label>
                                                <div className="flex items-center gap-1">
                                                    <input 
                                                        type="number" 
                                                        placeholder="Nh·∫≠p gi·ªù..." 
                                                        className="w-28 border border-purple-200 rounded p-1 text-[11px] text-right font-mono text-purple-900 focus:ring-1 focus:ring-purple-500 outline-none bg-white"
                                                        value={maintDetail.ucpAtStop || ''} 
                                                        onChange={e => setMaintDetail({...maintDetail, ucpAtStop: e.target.value})} 
                                                    />
                                                    <span className="text-[10px] font-bold text-slate-400">Gi·ªù</span>
                                                </div>
                                            </div>

                                            {/* H√†ng 2: T√≠nh to√°n ng√†y d·ª± ki·∫øn (+2000h) */}
                                            <div className="flex items-center justify-between gap-2 bg-white/60 p-1.5 rounded border border-purple-100">
                                                <label className="text-[11px] font-bold text-purple-700 uppercase whitespace-nowrap">
                                                    D·ª± b√°o k·ª≥ t·ªõi (+2000h):
                                                </label>
                                                <span className="text-[11px] font-black text-purple-900 font-mono">
                                                    {(() => {
                                                        // Logic: L·∫•y ng√†y K·∫øt th√∫c th·ª±c t·∫ø (B·∫Øt ƒë·∫ßu ch·∫°y l·∫°i) + 2000 gi·ªù
                                                        if (!maintDetail.end) return "---";
                                                        const endDate = new Date(maintDetail.end);
                                                        if (isNaN(endDate.getTime())) return "---";
                                                        
                                                        // C·ªông 2000 gi·ªù (2000 * 60 * 60 * 1000 ms)
                                                        const nextDate = new Date(endDate.getTime() + (2000 * 60 * 60 * 1000));
                                                        
                                                        // Format ng√†y gi·ªù VN
                                                        return `${nextDate.getHours().toString().padStart(2,'0')}:${nextDate.getMinutes().toString().padStart(2,'0')} ${nextDate.getDate().toString().padStart(2,'0')}/${(nextDate.getMonth()+1).toString().padStart(2,'0')}/${nextDate.getFullYear()}`;
                                                    })()}
                                                </span>
                                            </div>
                                            <div className="text-[9px] text-purple-400 italic text-right">* Th·ªùi gian ƒë∆∞·ª£c t√≠nh t·ª´ th·ªùi ƒëi·ªÉm k·∫øt th√∫c b·∫£o d∆∞·ª°ng th·ª±c t·∫ø</div>
                                        </div>
                                    </div>
									{/* 6. TH√îNG TIN KH√ÅC (GHI CH√ö)*/}
                                    <div className="space-y-2 pt-2 border-t border-dashed border-slate-200">
                                        <label className="block text-[11px] font-bold text-slate-500 uppercase mb-[-4px]">
                                            Th√¥ng tin kh√°c / Ghi ch√∫
                                        </label>
                                        <textarea 
                                            className="w-full border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none shadow-sm h-20 resize-none bg-white"
                                            placeholder="Nh·∫≠p ghi ch√∫ chi ti·∫øt cho c√¥ng vi·ªác n√†y..."
                                            value={maintDetail.info || ''}
                                            onChange={e => setMaintDetail({...maintDetail, info: e.target.value})}
                                        />
                                    </div>
									{/* 5. Tr·∫°ng th√°i k·∫ø ho·∫°ch b·∫£o d∆∞·ª°ng(ƒê√É C·∫¨P NH·∫¨T T·ª∞ ƒê·ªòNG) */}
									<div className="mt-4 p-3 bg-slate-50 rounded-xl border border-dashed border-slate-300">
										<div className="flex justify-between items-center">
											<div>
												<label className="block text-[11px] font-bold text-slate-500 uppercase leading-tight">Tr·∫°ng th√°i h·ªá th·ªëng:</label>
												<p className="text-[10px] text-slate-400 italic">T·ª± ƒë·ªông nh·∫≠n di·ªán t·ª´ th·ªùi gian th·ª±c t·∫ø</p>
											</div>
											
											{(() => {
												// Logic hi·ªÉn th·ªã realtime khi ƒëang nh·∫≠p li·ªáu trong Modal
												const currentStatus = autoDetermineStatus(maintDetail.start, maintDetail.end);
												return (
													<div className={`px-4 py-1.5 rounded-full border text-xs font-black shadow-sm flex items-center gap-2 ${getEventStatusColor(currentStatus)}`}>
														<span className="w-2 h-2 rounded-full bg-current"></span>
														{currentStatus.toUpperCase()}
													</div>
												);
											})()}
										</div>
									</div>
									
								</div> 
								{/* üëÜ K·∫æT TH√öC V√ôNG CU·ªòN}

								{/* Footer */}
								<div className="p-4 border-t bg-slate-50 flex justify-between">
									{!maintDetail.isNew ? (
										<button onClick={() => deleteMaintFromDetail(maintDetail.id)} className="px-4 py-2 bg-white border border-red-200 text-red-600 rounded-lg text-xs font-bold hover:bg-red-50">üóëÔ∏è X√ìA</button>
									) : <div />}
									<div className="flex gap-2">
										<button onClick={closeMaintDetail} className="px-4 py-2 text-slate-600 font-bold text-xs uppercase">H·ªßy</button>
										<button onClick={saveMaintDetail} className="px-6 py-2 bg-blue-600 text-white rounded-lg font-black text-xs uppercase shadow-md hover:bg-blue-700">
											{maintDetail.isNew ? "TH√äM M·ªöI" : "L∆ØU C·∫¨P NH·∫¨T"}
										</button>
									</div>
								</div>
							</div>
						</div>
					)}

                        {/* B·∫¢NG CHI TI·∫æT S·ª∞ C·ªê D·ª™NG M√ÅY MODAL (ƒê·ªíNG B·ªò GIAO DI·ªÜN) */}
{shutdownDetail && (
    <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[10001] p-4 backdrop-blur-sm">
        <div className="bg-white rounded-xl w-full max-w-lg shadow-2xl flex flex-col max-h-[95vh] overflow-hidden animate-in fade-in zoom-in duration-200">
            
            {/* Header chuy√™n nghi·ªáp */}
            <div className="p-4 border-b flex justify-between items-center bg-red-50">
                <div>
                    <h2 className="text-lg font-bold text-red-900">
                        {!shutdownDetail.id ? "Th√™m m·ªõi S·ª± c·ªë" : "Chi ti·∫øt S·ª± c·ªë d·ª´ng m√°y"}
                    </h2>
                    <p className="text-[10px] text-red-600 uppercase font-semibold">
                        GHI NH·∫¨N BI·∫æN ƒê·ªòNG D·ª™NG/CH·∫†Y M√ÅY TH·ª∞C T·∫æ
                    </p>
                </div>
                <button onClick={closeShutdownDetail} className="text-gray-400 hover:text-red-500 bg-white w-8 h-8 rounded-full shadow-sm border flex items-center justify-center transition-colors">‚úï</button>
            </div>

            {/* üëá V√ôNG CU·ªòN N·ªòI DUNG CH√çNH üëá */}
            <div className="p-5 space-y-4 overflow-y-auto custom-scrollbar">
                
                {/* 1. Th√¥ng tin chung */}
                <div className="space-y-3">
                    <label className="block text-[11px] font-bold text-slate-500 uppercase mb-[-8px]">M√¥ t·∫£ s·ª± c·ªë</label>
                    <input 
                        placeholder="Nh·∫≠p n·ªôi dung s·ª± c·ªë..." 
                        className="w-full border border-slate-300 rounded-lg p-2.5 text-sm font-bold focus:ring-2 focus:ring-red-500 outline-none shadow-sm" 
                        value={shutdownDetail.description} 
                        onChange={e => setShutdownDetail({...shutdownDetail, description: e.target.value})} 
                    />
                    
                    <div className="grid grid-cols-2 gap-3">
                        <div>
                            <label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">Thi·∫øt b·ªã b·ªã ·∫£nh h∆∞·ªüng</label>
                            <select 
                                className="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-red-700 focus:ring-2 focus:ring-red-500 outline-none bg-white" 
                                value={shutdownDetail.equipment} 
                                onChange={e => setShutdownDetail({...shutdownDetail, equipment: e.target.value})}
                            >
                                <option value="">-- Ch·ªçn thi·∫øt b·ªã --</option>
                                {AFFECTED_EQUIPMENT_OPTIONS.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">Gi√†n li√™n quan</label>
                            <input list="rpShutdownDetail" className="w-full border border-slate-300 rounded-lg p-2 text-sm" value={shutdownDetail.relatedPlatforms || ''} onChange={e => setShutdownDetail({...shutdownDetail, relatedPlatforms: e.target.value})} placeholder="Ch·ªçn/Nh·∫≠p..." />
                            <datalist id="rpShutdownDetail">{RELATED_PLATFORMS.map(p => <option key={p} value={p} />)}</datalist>
                        </div>
                    </div>
                </div>

                {/* 2. Kh·ªëi Th·ªùi gian th·ª±c t·∫ø (M√†u ƒê·ªè nh·∫°t) */}
                <div className="bg-red-50/50 p-3 rounded-xl border border-red-100 space-y-2">
                    <h3 className="text-[11px] font-black text-red-700 uppercase flex items-center gap-2">
                        ‚è±Ô∏è TH·ªúI GIAN D·ª™NG & CH·∫†Y L·∫†I
                    </h3>
                    
                    <div className="space-y-2">
                        <div className="flex items-center gap-2">
                            <label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">B·∫Øt ƒë·∫ßu d·ª´ng</label>
                            <input 
                                type="datetime-local" 
                                className="flex-1 border border-red-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-red-500 outline-none bg-white font-bold text-slate-600"
                                value={shutdownDetail.start} 
                                onChange={e => setShutdownDetail({...shutdownDetail, start: e.target.value})} 
                            />
                        </div>
                        <div className="flex items-center gap-2">
                            <label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">Ch·∫°y l·∫°i m√°y</label>
                            <input 
                                type="datetime-local" 
                                className="flex-1 border border-red-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-red-500 outline-none bg-white font-bold text-slate-600"
                                value={shutdownDetail.end} 
                                onChange={e => setShutdownDetail({...shutdownDetail, end: e.target.value})} 
                            />
                        </div>
                    </div>

                    <div className="flex justify-between items-center pt-2 border-t border-red-100">
                        <span className="text-[11px] font-bold text-red-600">T·ªîNG GI·ªú D·ª™NG:</span>
                        <div className="flex items-center gap-1 bg-white px-3 py-1 rounded border border-red-200 shadow-sm font-mono font-black text-red-800">
                            {calculateHoursDiff(shutdownDetail.start, shutdownDetail.end).toFixed(2)}
                            <span className="text-[10px] font-bold text-red-400 ml-1 uppercase">Gi·ªù</span>
                        </div>
                    </div>
                </div>

                {/* 3. Nguy√™n nh√¢n & Ghi ch√∫ */}
                <div className="space-y-3 pt-2 border-t border-dashed border-slate-200">
                    <div>
                        <label className="block text-[11px] font-bold text-slate-500 uppercase">Nguy√™n nh√¢n chi ti·∫øt</label>
                        <textarea 
                            className="w-full border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-red-500 outline-none shadow-sm h-16 resize-none bg-white"
                            placeholder="Nh·∫≠p nguy√™n nh√¢n g√¢y s·ª± c·ªë..."
                            value={shutdownDetail.cause || ''}
                            onChange={e => setShutdownDetail({...shutdownDetail, cause: e.target.value})}
                        />
                    </div>
                    <div>
                        <label className="block text-[11px] font-bold text-slate-500 uppercase">Ghi ch√∫ b·ªï sung</label>
                        <textarea 
                            className="w-full border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-red-500 outline-none shadow-sm h-16 resize-none bg-white"
                            placeholder="Th√¥ng tin kh√°c..."
                            value={shutdownDetail.info || ''}
                            onChange={e => setShutdownDetail({...shutdownDetail, info: e.target.value})}
                        />
                    </div>
                </div>

                {/* 4. Tr·∫°ng th√°i S·ª± c·ªë (T·ª∞ ƒê·ªòNG) */}
                <div className="mt-4 p-3 bg-red-50 rounded-xl border border-red-100">
                    <div className="flex justify-between items-center">
                        <div>
                            <label className="block text-[11px] font-bold text-red-700 uppercase leading-tight">T√¨nh tr·∫°ng kh·∫Øc ph·ª•c:</label>
                            <p className="text-[10px] text-red-400 italic">H·ªá th·ªëng t·ª± t√≠nh theo th·ªùi gian ch·∫°y m√°y</p>
                        </div>
                        {(() => {
                            const currentStatus = autoDetermineStatus(shutdownDetail.start, shutdownDetail.end, true);
                            const isProcessing = currentStatus === "ƒêang x·ª≠ l√Ω";
                            return (
                                <div className={`px-4 py-1.5 rounded-full border text-xs font-black shadow-sm flex items-center gap-2 ${
                                    isProcessing ? "bg-red-100 border-red-300 text-red-700 animate-pulse" : "bg-emerald-100 border-emerald-300 text-emerald-700"
                                }`}>
                                    <span className={`w-2 h-2 rounded-full ${isProcessing ? 'bg-red-500' : 'bg-emerald-500'}`}></span>
                                    {currentStatus.toUpperCase()}
                                </div>
                            );
                        })()}
                    </div>
                </div>

            </div> 

            {/* Footer */}
            <div className="p-4 border-t bg-slate-50 flex justify-between items-center">
                {shutdownDetail.id ? (
                    <button onClick={deleteShutdownFromDetail} className="px-4 py-2 bg-white border border-red-200 text-red-600 rounded-lg text-xs font-bold hover:bg-red-50 transition-colors shadow-sm">
                        üóëÔ∏è X√ìA S·ª∞ C·ªê
                    </button>
                ) : <div />}
                
                <div className="flex gap-3">
                    <button onClick={closeShutdownDetail} className="px-4 py-2 text-slate-600 font-bold text-xs uppercase hover:bg-gray-200 rounded-lg">H·ªßy</button>
                    <button onClick={saveShutdownDetail} className="px-6 py-2 bg-red-600 text-white rounded-lg font-black text-xs uppercase shadow-md hover:bg-red-700 transition-colors">
                        {!shutdownDetail.id ? "TH√äM M·ªöI" : "L∆ØU C·∫¨P NH·∫¨T"}
                    </button>
                </div>
            </div>
        </div>
    </div>
)}

                        {/* B·∫¢NG CHI TI·∫æT C√ÅC S·ª∞ KI·ªÜN KH√ÅC MODAL (ƒê·ªíNG B·ªò 100% V·ªöI B·∫¢O D∆Ø·ª†NG) */}
						{eventDetail && (
							<div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[10001] p-4 backdrop-blur-sm">
								<div className="bg-white rounded-xl w-full max-w-lg shadow-2xl flex flex-col max-h-[95vh] overflow-hidden animate-in fade-in zoom-in duration-200">
									
									{/* Header chuy√™n nghi·ªáp */}
									<div className="p-4 border-b flex justify-between items-center bg-slate-50">
										<div>
											<h2 className="text-lg font-bold text-slate-800">
												{!eventDetail.id ? "Th√™m m·ªõi S·ª± ki·ªán" : "Chi ti·∫øt S·ª± ki·ªán"}
											</h2>
											<p className="text-[10px] text-slate-500 uppercase font-semibold">
												C·∫¨P NH·∫¨T K·∫æ HO·∫†CH & TH·ª∞C T·∫æ S·ª∞ KI·ªÜN
											</p>
										</div>
										<button onClick={closeEventDetail} className="text-gray-400 hover:text-red-500 bg-white w-8 h-8 rounded-full shadow-sm border flex items-center justify-center transition-colors">‚úï</button>
									</div>

									{/* üëá V√ôNG CU·ªòN N·ªòI DUNG CH√çNH üëá */}
									<div className="p-5 space-y-4 overflow-y-auto custom-scrollbar">
										
										{/* 1. Th√¥ng tin chung */}
										<div className="space-y-3">
											<label className="block text-[11px] font-bold text-slate-500 uppercase mb-[-8px]">N·ªôi dung s·ª± ki·ªán</label>
											<input 
												placeholder="Nh·∫≠p n·ªôi dung ho·∫∑c t√™n s·ª± ki·ªán..." 
												className="w-full border border-slate-300 rounded-lg p-2.5 text-sm font-bold focus:ring-2 focus:ring-purple-500 outline-none shadow-sm" 
												value={eventDetail.name} 
												onChange={e => setEventDetail({...eventDetail, name: e.target.value})} 
											/>
											
											<div className="grid grid-cols-2 gap-3">
												<div>
													<label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">Gi√†n li√™n quan</label>
													<input list="rpDetail" className="w-full border border-slate-300 rounded-lg p-2 text-sm" value={eventDetail.relatedPlatforms || ''} onChange={e => setEventDetail({...eventDetail, relatedPlatforms: e.target.value})} placeholder="Ch·ªçn/Nh·∫≠p..." />
													<datalist id="rpDetail">{RELATED_PLATFORMS.map(p => <option key={p} value={p} />)}</datalist>
												</div>
												<div>
													<label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">Thi·∫øt b·ªã (N·∫øu c√≥)</label>
													<input list="eqDetail" className="w-full border border-slate-300 rounded-lg p-2 text-sm font-bold text-purple-700" value={eventDetail.equipment || ''} onChange={e => setEventDetail({...eventDetail, equipment: e.target.value})} placeholder="Ch·ªçn/Nh·∫≠p..." />
													<datalist id="eqDetail">{MAINTENANCE_EQUIPMENT.map(e=><option key={e} value={e}/>)}</datalist>
												</div>
											</div>

											<div>
												<label className="block text-[11px] font-bold text-slate-500 mb-1 uppercase">Lo·∫°i s·ª± ki·ªán</label>
												<select className="w-full border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none bg-white font-bold" value={eventDetail.eventType || 'Kh√°c'} onChange={e => setEventDetail({...eventDetail, eventType: e.target.value})}>
													{EVENT_TYPE_OPTIONS.map(opt => <option key={opt} value={opt}>{opt}</option>)}
												</select>
											</div>
										</div>

										{/* 2. Ph·∫ßn D·ª± ki·∫øn (Logic: M·∫∑c ƒë·ªãnh 5:00 s√°ng + T·ª± t√≠nh ng√†y k·∫øt th√∫c) */}
										<div className="bg-blue-50/50 p-3 rounded-xl border border-blue-100 space-y-2">
											<h3 className="text-[11px] font-black text-blue-700 uppercase flex items-center gap-2">üóìÔ∏è TH·ªúI GIAN D·ª∞ KI·∫æN (L√äN K·∫æ HO·∫†CH)</h3>
											
											<div className="space-y-2">
												{/* H√†ng 1: B·∫Øt ƒë·∫ßu d·ª± ki·∫øn */}
												<div className="flex items-center gap-2">
													<label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">B·∫Øt ƒë·∫ßu</label>
													<input 
														type="datetime-local" 
														className="flex-1 border border-blue-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-blue-500 outline-none bg-white font-bold text-slate-600"
														value={eventDetail.plannedStart || ''} 
														onChange={e => {
															let newStart = e.target.value;
															if (newStart) {
																const newDatePart = newStart.split('T')[0];
																const oldDatePart = eventDetail.plannedStart ? eventDetail.plannedStart.split('T')[0] : '';
																if (newDatePart !== oldDatePart) newStart = `${newDatePart}T05:00`;
															}

															let newEnd = eventDetail.plannedEnd || '';
															if (eventDetail.plannedHours && parseFloat(eventDetail.plannedHours) > 0 && newStart) {
																const startDate = new Date(newStart);
																const endDate = new Date(startDate.getTime() + (parseFloat(eventDetail.plannedHours) * 3600000));
																const offset = endDate.getTimezoneOffset() * 60000;
																newEnd = new Date(endDate.getTime() - offset).toISOString().slice(0, 16);
															}
															setEventDetail({ ...eventDetail, plannedStart: newStart, plannedEnd: newEnd });
														}} 
													/>
												</div>

												{/* H√†ng 2: K·∫øt th√∫c d·ª± ki·∫øn */}
												<div className="flex items-center gap-2">
													<label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">K·∫øt th√∫c</label>
													<input 
														type="datetime-local" 
														className="flex-1 border border-blue-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-blue-500 outline-none bg-white font-bold text-slate-600"
														value={eventDetail.plannedEnd || ''} 
														onChange={e => {
															const newEnd = e.target.value;
															const hours = autoCalculateHours(eventDetail.plannedStart, newEnd);
															setEventDetail({ ...eventDetail, plannedEnd: newEnd, plannedHours: hours });
														}} 
													/>
												</div>
											</div>

											{/* ƒê·ªãnh m·ª©c gi·ªù d·ª± ki·∫øn */}
											<div className="flex justify-between items-center pt-2 border-t border-blue-100">
												<span className="text-[11px] font-bold text-blue-600 uppercase">ƒê·ªãnh m·ª©c th·ªùi gian:</span>
												<div className="flex items-center gap-1">
													<input 
														type="number" step="0.5"
														className="w-20 border border-blue-300 rounded p-1 text-xs text-center font-bold focus:ring-1 focus:ring-blue-500 outline-none" 
														value={eventDetail.plannedHours || ''} 
														onChange={e => {
															const newHours = e.target.value;
															let newEnd = eventDetail.plannedEnd;
															if (eventDetail.plannedStart && newHours && parseFloat(newHours) > 0) {
																const startDate = new Date(eventDetail.plannedStart);
																const endDate = new Date(startDate.getTime() + (parseFloat(newHours) * 3600000));
																const offset = endDate.getTimezoneOffset() * 60000;
																newEnd = new Date(endDate.getTime() - offset).toISOString().slice(0, 16);
															}
															setEventDetail({ ...eventDetail, plannedHours: newHours, plannedEnd: newEnd });
														}} 
													/>
													<span className="text-[11px] font-bold text-blue-400">GI·ªú</span>
												</div>
											</div>
										</div>

										{/* 3. Kh·ªëi Th·ª±c t·∫ø (M√†u T√≠m nh·∫°t) */}
										<div className="bg-purple-50/50 p-3 rounded-xl border border-purple-100 space-y-2">
											<h3 className="text-[11px] font-black text-purple-700 uppercase flex items-center gap-2">‚è±Ô∏è TH·ªúI GIAN TH·ª∞C HI·ªÜN (GHI NH·∫¨N)</h3>
											
											<div className="space-y-2">
												<div className="flex items-center gap-2">
													<label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">B·∫Øt ƒë·∫ßu</label>
													<input 
														type="datetime-local" 
														className="flex-1 border border-purple-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-purple-500 outline-none bg-white font-bold text-slate-600"
														value={eventDetail.startDate || ''} 
														onChange={e => {
															const newStart = e.target.value;
															const hours = autoCalculateHours(newStart, eventDetail.endDate);
															setEventDetail({ ...eventDetail, startDate: newStart, actualHours: hours });
														}} 
													/>
												</div>
												<div className="flex items-center gap-2">
													<label className="text-[11px] font-bold text-slate-400 uppercase whitespace-nowrap w-20">K·∫øt th√∫c</label>
													<input 
														type="datetime-local" 
														className="flex-1 border border-purple-200 rounded p-1 text-[11px] uppercase focus:ring-1 focus:ring-purple-500 outline-none bg-white font-bold text-slate-600"
														value={eventDetail.endDate || ''} 
														onChange={e => {
															const newEnd = e.target.value;
															const hours = autoCalculateHours(eventDetail.startDate, newEnd);
															setEventDetail({ ...eventDetail, endDate: newEnd, actualHours: hours });
														}} 
													/>
												</div>
											</div>

											{/* T·ªïng th·ªùi gian th·ª±c t·∫ø */}
											<div className="flex justify-between items-center pt-2 border-t border-purple-100">
												<span className="text-[11px] font-bold text-purple-600 uppercase">T·ªïng th·ªùi gian th·ª±c t·∫ø:</span>
												<div className="flex items-center gap-1 bg-white px-2 py-1 rounded border border-purple-200 shadow-sm">
													<span className="text-sm font-black text-purple-800 font-mono">
														{eventDetail.actualHours || '0'}
													</span>
													<span className="text-[10px] font-bold text-purple-400">GI·ªú</span>
												</div>
											</div>
										</div>

										{/* 4. Ghi ch√∫ */}
										<div className="space-y-2 pt-2 border-t border-dashed border-slate-200">
											<label className="block text-[11px] font-bold text-slate-500 uppercase mb-[-4px]">Ghi ch√∫ / Th√¥ng tin kh√°c</label>
											<textarea 
												className="w-full border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-purple-500 outline-none shadow-sm h-20 resize-none bg-white"
												placeholder="Nh·∫≠p ghi ch√∫ chi ti·∫øt..."
												value={eventDetail.info || ''}
												onChange={e => setEventDetail({...eventDetail, info: e.target.value})}
											/>
										</div>

										{/* 5. Tr·∫°ng th√°i S·ª± ki·ªán (T·ª∞ ƒê·ªòNG) */}
										<div className="mt-4 p-3 bg-purple-50 rounded-xl border border-purple-100">
											<div className="flex justify-between items-center">
												<div>
													<label className="block text-[11px] font-bold text-purple-700 uppercase leading-tight">Ti·∫øn ƒë·ªô th·ª±c hi·ªán:</label>
													<p className="text-[10px] text-purple-400 italic">H·ªá th·ªëng t·ª± t√≠nh theo th·ªùi gian ghi nh·∫≠n</p>
												</div>
												
												{(() => {
													const currentStatus = autoDetermineStatus(eventDetail.startDate, eventDetail.endDate);
													return (
														<div className={`px-4 py-1.5 rounded-full border text-xs font-black shadow-sm flex items-center gap-2 ${getEventStatusColor(currentStatus)}`}>
															<span className="w-2 h-2 rounded-full bg-current"></span>
															{currentStatus.toUpperCase()}
														</div>
													);
												})()}
											</div>
										</div>
									</div>

									{/* Footer */}
									<div className="p-4 border-t bg-slate-50 flex justify-between items-center">
										{eventDetail.id ? (
											<button onClick={() => deleteEventFromDetail(eventDetail.id)} className="px-4 py-2 bg-white border border-red-200 text-red-600 rounded-lg text-xs font-bold hover:bg-red-50 transition-colors shadow-sm">
												üóëÔ∏è X√ìA
											</button>
										) : <div />}
										
										<div className="flex gap-3">
											<button onClick={closeEventDetail} className="px-4 py-2 text-slate-600 font-bold text-xs uppercase hover:bg-gray-200 rounded-lg transition-colors">H·ªßy</button>
											<button onClick={saveEventDetail} className="px-6 py-2 bg-purple-600 text-white rounded-lg font-black text-xs uppercase shadow-md hover:bg-purple-700 transition-colors">
												{!eventDetail.id ? "TH√äM M·ªöI" : "L∆ØU C·∫¨P NH·∫¨T"}
											</button>
										</div>
									</div>
								</div>
							</div>
						)}
                    
                {/* KH·ªêI GIAO DI·ªÜN TAB 2 NH·∫¨P LI·ªÜU H√ÄNG NG√ÄY: */}
                {activeView === 'DAILY_INPUT' && (
                    <div className="animate-in fade-in duration-300">
                        {/* --- THANH C√îNG C·ª§ CH·ªåN NG√ÄY (GIAO DI·ªÜN M·ªöI: N√öT TR√íN + STICKY/D√çNH) --- */}						
						<div className="sticky top-12 z-40 bg-white/95 backdrop-blur-sm p-3 rounded-xl shadow-md border border-gray-200 mb-6 flex flex-col xl:flex-row items-center justify-between gap-4 transition-all">
							{/* 1. KHU V·ª∞C CH·ªåN NG√ÄY (B√äN TR√ÅI) */}
							<div className="flex items-center gap-3 w-full xl:w-auto justify-center xl:justify-start">
								<label className="font-bold text-gray-600 text-sm uppercase tracking-wide hidden sm:block">Ng√†y d·ªØ li·ªáu:</label>
								
								<div className="flex items-center gap-2 bg-gray-50 p-1 rounded-full border border-gray-200">
									{/* N√∫t L√πi */}
									<button 
										onClick={() => changeDailyDate(-1)}
										className="w-8 h-8 flex items-center justify-center bg-white rounded-full text-gray-600 hover:text-blue-600 hover:bg-blue-50 shadow-sm border border-gray-100 transition-all active:scale-90"
										title="L√πi 1 ng√†y"
									>
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
									</button>

									{/* √î Input Ng√†y */}
									<input 
										type="date" 
										className="bg-transparent border-none outline-none font-mono font-bold text-blue-700 text-sm px-2 focus:ring-0 cursor-pointer"
										value={dailyDate}
										onChange={(e) => setDailyDate(e.target.value)}
										onKeyDown={(e) => {
											if(e.key === 'ArrowLeft') changeDailyDate(-1);
											if(e.key === 'ArrowRight') changeDailyDate(1);
										}}
									/>

									{/* N√∫t Ti·∫øn */}
									<button 
										onClick={() => changeDailyDate(1)}
										className="w-8 h-8 flex items-center justify-center bg-white rounded-full text-gray-600 hover:text-blue-600 hover:bg-blue-50 shadow-sm border border-gray-100 transition-all active:scale-90"
										title="Ti·∫øn 1 ng√†y"
									>
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18l6-6-6-6"/></svg>
									</button>
								</div>

								{/* N√∫t H√¥m nay */}
								<button 
									onClick={() => {
										const d = new Date();
										const offset = d.getTimezoneOffset() * 60000;
										setDailyDate(new Date(d.getTime() - offset).toISOString().slice(0, 10));
									}}
									className="flex items-center gap-1 text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100 transition-colors whitespace-nowrap"
								>
									H√¥m nay
								</button>
							</div>

							{/* 2. KHU V·ª∞C 3 N√öT CH·ª®C NƒÇNG (B√äN PH·∫¢I - GRID 3 C·ªòT ƒê·ªÄU NHAU) */}
							<div className="grid grid-cols-3 gap-3 w-full xl:w-auto min-w-[500px]">

								{/* N√∫t 1: Update Svodka */}
								<button 
									onClick={handlePushToSvodka}
									disabled={isSyncing}
									className={`flex items-center justify-center gap-2 px-2 py-2.5 rounded-lg font-bold text-sm text-white shadow-md transition-all w-full ${
										isSyncing 
										? 'bg-gray-400 cursor-not-allowed' 
										: 'bg-gradient-to-r from-orange-500 to-red-500 hover:shadow-lg hover:-translate-y-0.5'
									}`}
									title="ƒê·∫©y d·ªØ li·ªáu ng√†y ƒëang ch·ªçn sang file DGCP Svodka (Sheet Detail)"
								>
									{isSyncing ? (
										<>
											<svg className="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
											<span className="truncate">ƒêang g·ª≠i...</span>
										</>
									) : (
										<span className="truncate">Update Svodka</span>
									)}
								</button>

								{/* N√∫t 2: Xem Svodka */}
								<button 
									onClick={() => window.open("https://docs.google.com/spreadsheets/d/1EFsWL_NYhI6UenWAxz0pB1QDetCwMyroFRtsWV6CgXc/edit", "_blank")}
									className="flex items-center justify-center gap-2 px-2 py-2.5 rounded-lg font-bold text-sm text-green-700 bg-white border border-green-600 shadow-sm hover:bg-green-50 transition-all w-full"
									title="M·ªü file Svodka tr√™n Google Sheet"
								>
									<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="8" y1="13" x2="16" y2="13"></line><line x1="8" y1="17" x2="16" y2="17"></line><line x1="10" y1="9" x2="10" y2="9"></line></svg>
									<span className="truncate">Xem Svodka</span>
								</button>

								{/* N√∫t 3: X√≥a S·ªë Li·ªáu */}
								<button 
									onClick={handleClearAllDailyData}
									className="flex items-center justify-center gap-2 px-2 py-2.5 rounded-lg font-bold text-sm text-red-700 bg-red-50 border border-red-200 shadow-sm hover:bg-red-100 hover:shadow-md transition-all w-full"
									title="Ch·ªâ x√≥a s·ªë li·ªáu RP, RC, ƒêi·ªán, GTC... Gi·ªØ l·∫°i B√°o c√°o v√† Nh√¢n s·ª±"
								>
									<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
									<span className="truncate">X√≥a S·ªë Li·ªáu</span>
								</button>

							</div>
						</div>
						
								
						{/* --- KHU V·ª∞C C√îNG C·ª§ IMPORT (2 N√öT N·∫∞M NGANG) --- */}
						<div className="mt-4 pt-4 border-t border-gray-100">
							<h3 className="text-sm font-bold text-gray-700 mb-2">üì• C√îNG C·ª§ NH·∫¨P LI·ªÜU (IMPORT)</h3>
							
							{/* S·ª≠ d·ª•ng Flexbox ƒë·ªÉ d√†n ngang */}
							<div className="flex gap-4">
								
								{/* --- N√öT 1: UPLOAD C√ÅC GI√ÄN H√ÄNG LO·∫†T(50%) --- */}
								{/* D√πng w-1/2 ƒë·ªÉ chi·∫øm 50% chi·ªÅu r·ªông */}
								<div className="w-1/2 bg-blue-50 border border-blue-200 p-4 rounded-xl flex flex-col items-center text-center justify-center relative hover:bg-blue-100 transition-colors cursor-pointer group">
									<div className="p-2 bg-blue-100 rounded-full mb-2 group-hover:scale-110 transition-transform">
										{/* Icon Upload File */}
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
									</div>
									<div>
										<h4 className="font-bold text-blue-800 text-sm"> Upload c√°c gi√†n (Ng√†y)</h4>
										<p className="text-[10px] text-blue-600 mt-0.5">N·∫°p b√°o c√°o cho 1 ng√†y c·ª• th·ªÉ</p>
									</div>
									{/* Input c·ªßa UPLOAD C√ÅC GI√ÄN H√ÄNG LO·∫†T */}
									<input 
										type="file" 
										multiple
										accept=".xlsx, .xls"
										onChange={withXLSX(handleBatchUpload)}
										className="absolute inset-0 opacity-0 cursor-pointer"
										title="Ch·ªçn file b√°o c√°o ng√†y"
									/>
								</div>

								{/* --- N√öT 2: IMPORT FILE SVODKA EXCEL (50%) --- */}
								{/* D√πng w-1/2 ƒë·ªÉ chi·∫øm 50% chi·ªÅu r·ªông */}
								<div className="w-1/2 bg-gradient-to-br from-purple-500 to-indigo-600 p-4 rounded-xl flex flex-col items-center text-center justify-center relative hover:shadow-lg transition-all cursor-pointer group">
									<div className="p-2 bg-white/20 rounded-full mb-2 group-hover:scale-110 transition-transform">
										{/* Icon Database */}
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-white"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>
									</div>
									<div>
										<h4 className="font-bold text-white text-sm">Import Svodka Excel</h4>
										<p className="text-[10px] text-indigo-100 mt-0.5">N·∫°p d·ªØ li·ªáu (Detail/HR/Others...)</p>
									</div>
									{/* Input c·ªßa Import file Svodka Excel */}
									<input 
										type="file" 
										accept=".xlsx, .xls"
										onChange={withXLSX(handleImportFullHistory)}
										className="absolute inset-0 opacity-0 cursor-pointer"
										title="Ch·ªçn file Svodka t·ªïng h·ª£p"
									/>
								</div>

							</div>
						</div>

						{/* --- KHU V·ª∞C C√ÅC TH·∫∫ TH√îNG S·ªê --- */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            {/* FORM RP3 (XANH L√Å - C√ì C·ªòT ƒê∆†N V·ªä) --- */}
                            <div className="bg-white rounded-xl shadow-lg border border-green-100 overflow-hidden">
                                <div className="bg-green-600 p-2 flex justify-between items-center text-white">
                                    <h3 className="font-bold text-lg">RP3</h3>
                                    <div className="flex gap-2">
                                        {/* N√∫t X√≥a (D·∫°ng Ch·ªØ) */}
                                        <button 
                                            onClick={() => clearData("RP3", setRp3Data)}
                                            className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                        >
                                            X√≥a
                                        </button>
                                        
                                        <div className="relative">
                                            <button className="bg-white text-green-700 px-3 py-1 rounded text-xs font-bold flex gap-1 hover:bg-green-50 items-center h-full shadow-sm">
                                                Upload
                                            </button>
                                            <input type="file" accept=".xlsx,.xls,.csv" onChange={withXLSX(handleRP3Import)} className="absolute inset-0 opacity-0 cursor-pointer" />
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                    <table className="w-full text-sm">
                                        <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                            <tr>
                                                <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                                <th className="py-2 text-right">Gi√° tr·ªã</th>
                                                <th className="py-2 text-center w-12">ƒêV</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
											{/* 1. V√íNG L·∫∂P HI·ªÇN TH·ªä C√ÅC M·ª§C NH·∫¨P LI·ªÜU B√åNH TH∆Ø·ªúNG */}
											{RP3_CONFIG.map((item, idx) => (
												<tr key={idx} className="hover:bg-white transition-colors">
													<td className="py-2 text-gray-700 font-medium pl-1 text-xs">
														{item.label}
													</td>
													<td className="py-2">
														<input 
															type="number" 
															className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 outline-none font-mono text-green-700 font-bold bg-white"
															value={rp3Data[item.key] || ''}
															onChange={(e) => setRp3Data({...rp3Data, [item.key]: e.target.value})}
															placeholder="-"
														/>
													</td>
													<td className="py-2 text-center text-xs text-gray-400 font-medium">
														{item.unit}
													</td>
												</tr>
											))}

											{/* 2. H√ÄNG T·ªîNG Fuelgas RP3 ·ªöI TH√äM) */}
											{/* Logic: T√≠nh t·ªïng 3 tr∆∞·ªùng Gas DGCP to ... v√† hi·ªÉn th·ªã Read-only */}
											<tr className="bg-green-50 border-t-2 border-green-200">
												<td className="py-2 text-green-800 font-bold pl-1 text-xs uppercase">
													T·ªïng Fuelgas RP3
												</td>
												<td className="py-2">
													<input 
														type="text" 
														disabled 
														className="w-full text-right p-1.5 border-none bg-transparent font-mono text-green-900 font-bold"
														value={(() => {
															// --- S·ª¨A L·∫†I T√äN KEY CHO ƒê√öNG V·ªöI C·∫§U H√åNH (RP3_CONFIG) ---
															const taurus = parseFloat(rp3Data['gas_dgcp_taurus'] || 0);   // Key ƒë√∫ng: gas_dgcp_taurus
															const saturn = parseFloat(rp3Data['gas_dgcp_saturn'] || 0);   // Key ƒë√∫ng: gas_dgcp_saturn
															const typhoon = parseFloat(rp3Data['gas_dgcp_typhoon'] || 0); // Key ƒë√∫ng: gas_dgcp_typhoon
															
															const total = taurus + saturn + typhoon;
															
															return isNaN(total) ? 0 : total.toLocaleString('en-US'); 
														})()}
													/>
												</td>
												<td className="py-2 text-center text-xs text-green-700 font-bold">
													m¬≥
												</td>
											</tr>
										</tbody>
                                    </table>
                                </div>
                                
                            </div>
  							
                        {/* --- FORM RP2 (XANH D∆Ø∆†NG - C√ì C·ªòT ƒê∆†N V·ªä) --- */}
                            <div className="bg-white rounded-xl shadow-lg border border-blue-100 overflow-hidden">
                                <div className="bg-blue-600 p-2 flex justify-between items-center text-white">
                                    <h3 className="font-bold text-lg">RP2</h3>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => clearData("RP2", setRp2Data)}
                                            className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                        >
                                            X√≥a
                                        </button>

                                        <div className="relative">
                                            <button className="bg-white text-blue-700 px-3 py-1 rounded text-xs font-bold flex gap-1 hover:bg-blue-50 items-center h-full shadow-sm">
                                                Upload
                                            </button>
                                            <input type="file" accept=".xlsx,.xls,.csv" onChange={withXLSX(handleRP2Import)} className="absolute inset-0 opacity-0 cursor-pointer" />
                                        </div>
                                    </div>
                                </div>
                                <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                    <table className="w-full text-sm">
                                        <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                            <tr>
                                                <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                                <th className="py-2 text-right">Gi√° tr·ªã</th>
                                                <th className="py-2 text-center w-12">ƒêV</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {RP2_CONFIG.map((item, idx) => (
                                                <tr key={idx} className="hover:bg-white transition-colors">
                                                    <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                        {item.label}
                                                    </td>
                                                    <td className="py-2">
                                                        <input 
                                                            type={item.key === 'pressure' ? "text" : "number"}
                                                            className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono text-blue-700 font-bold bg-white"
                                                            value={rp2Data[item.key] || ''}
                                                            onChange={(e) => setRp2Data({...rp2Data, [item.key]: e.target.value})}
                                                            placeholder="-"
                                                        />
                                                    </td>
                                                    <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                        {item.unit}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="p-2 border-t bg-gray-50 flex justify-center">
                                    <span className="text-xs text-gray-400 italic">
                                        L·∫•y d·ªØ li·ªáu √¥ B4, C4, D4
                                    </span>
                                </div>
                            </div>
							
                        {/* FORM RP1 (M√ÄU T√çM - ƒê√É C·∫¨P NH·∫¨T) */}
                        <div className="bg-white rounded-xl shadow-lg border border-purple-100 overflow-hidden">
                            <div className="bg-purple-600 p-2 flex justify-between items-center text-white">
                                    <h3 className="font-bold text-lg">RP1</h3>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => clearData("RP1", setRp1Data)}
                                            className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                        >
                                            X√≥a
                                        </button>

                                        <div className="relative">
                                            <button className="bg-white text-purple-700 px-3 py-1 rounded text-xs font-bold flex gap-1 hover:bg-purple-50 items-center h-full shadow-sm">
                                               Upload
                                            </button>
                                            <input type="file" accept=".xlsx,.xls,.csv" onChange={withXLSX(handleRP1Import)} className="absolute inset-0 opacity-0 cursor-pointer" />
                                        </div>
                                    </div>
                                </div>
                            <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                <table className="w-full text-sm">
                                    <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                        <tr>
                                            <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                            <th className="py-2 text-right">Gi√° tr·ªã</th>
                                            <th className="py-2 text-center w-12">ƒêV</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {RP1_CONFIG.map((item, idx) => (
                                            <tr key={idx} className="hover:bg-white transition-colors">
                                                <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                    {item.label}
                                                </td>
                                                <td className="py-2">
                                                    <input 
                                                        type="number"
                                                        className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 outline-none font-mono text-purple-700 font-bold bg-white"
                                                        value={rp1Data[item.key] || ''}
                                                        onChange={(e) => setRp1Data({...rp1Data, [item.key]: e.target.value})}
                                                        placeholder="-"
                                                    />
                                                </td>
                                                <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                    {item.unit}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-2 border-t bg-gray-50 flex justify-center">
                                <span className="text-xs text-gray-400 italic">
                                    L·∫•y d·ªØ li·ªáu c·ªôt D & E (Sheet 17h)
                                </span>
                            </div>
                        </div>
						
						{/* FORM RC1/3 (M·ªöI - M√ÄU CAM ƒê·∫¨M) */}
                        <div className="bg-white rounded-xl shadow-lg border border-orange-200 overflow-hidden">
                            <div className="bg-orange-700 p-2 flex justify-between items-center text-white">
                                    <h3 className="font-bold text-lg">RC1/3</h3>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => clearData("RC1/3", setRc13Data)}
                                            className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                        >
                                            X√≥a
                                        </button>

                                        <div className="relative">
                                            <button className="bg-white text-orange-800 px-3 py-1 rounded text-xs font-bold flex gap-1 hover:bg-orange-50 items-center h-full shadow-sm">
                                                Upload
                                            </button>
                                            <input type="file" accept=".xlsx,.xls,.csv" onChange={withXLSX(handleRC13Import)} className="absolute inset-0 opacity-0 cursor-pointer" />
                                        </div>
                                    </div>
                                </div>
                            <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                <table className="w-full text-sm">
                                    <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                        <tr>
                                            <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                            <th className="py-2 text-right">Gi√° tr·ªã</th>
                                            <th className="py-2 text-center w-12">ƒêV</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {RC13_CONFIG.map((item, idx) => (
                                            <tr key={idx} className="hover:bg-white transition-colors">
                                                <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                    {item.label}
                                                </td>
                                                <td className="py-2">
                                                    <input 
                                                        // N·∫øu c·ªôt 1 (L∆∞u l∆∞·ª£ng) -> S·ªë, C·ªôt 2 (√Åp su·∫•t) -> Text
                                                        type={item.colIndex === 1 ? "number" : "text"}
                                                        className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 outline-none font-mono text-orange-800 font-bold bg-white"
                                                        value={rc13Data[item.key] || ''}
                                                        onChange={(e) => setRc13Data({...rc13Data, [item.key]: e.target.value})}
                                                        placeholder="-"
                                                    />
                                                </td>
                                                <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                    {item.unit}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-2 border-t bg-gray-50 flex justify-center">
                                <span className="text-xs text-gray-400 italic">
                                    L·∫•y d·ªØ li·ªáu B4, B5, C4, C5
                                </span>
                            </div>
                        </div>
						
						{/* FORM ƒêI·ªÜN (M·ªöI - M√ÄU V√ÄNG) */}
                        <div className="bg-white rounded-xl shadow-lg border border-yellow-200 overflow-hidden">
                            <div className="bg-yellow-600 p-2 flex justify-between items-center text-white">
                                    <h3 className="font-bold text-lg">ƒêI·ªÜN (DGCP)</h3>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => clearData("ƒêI·ªÜN", setElecData)}
                                            className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                        >
                                            X√≥a
                                        </button>

                                        <div className="relative">
                                            <button className="bg-white text-yellow-700 px-3 py-1 rounded text-xs font-bold flex gap-1 hover:bg-yellow-50 items-center h-full shadow-sm">
                                                Upload
                                            </button>
                                            <input type="file" accept=".xlsx,.xls,.csv" onChange={withXLSX(handleElecImport)} className="absolute inset-0 opacity-0 cursor-pointer" />
                                        </div>
                                    </div>
                                </div>
                            <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                <table className="w-full text-sm">
                                    <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                        <tr>
                                            <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                            <th className="py-2 text-right">Gi√° tr·ªã</th>
                                            <th className="py-2 text-center w-12">ƒêV</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {ELEC_CONFIG.map((item, idx) => (
                                            <tr key={idx} className="hover:bg-white transition-colors">
                                                <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                    {item.label}
                                                </td>
                                                <td className="py-2">
                                                    <input 
                                                        type="number"
                                                        className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-yellow-500 outline-none font-mono text-yellow-800 font-bold bg-white"
                                                        value={elecData[item.key] || ''}
                                                        onChange={(e) => setElecData({...elecData, [item.key]: e.target.value})}
                                                        placeholder="-"
                                                    />
                                                </td>
                                                <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                    {item.unit}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-2 border-t bg-gray-50 flex justify-center">
                                <span className="text-xs text-gray-400 italic">
                                    Sheet Daily: E7-E10
                                </span>
                            </div>
                        </div>	
						
						{/* FORM GTC PH√íNG LER (M·ªöI - M√ÄU XANH NG·ªåC) */}
                        <div className="bg-white rounded-xl shadow-lg border border-teal-200 overflow-hidden">
                            <div className="bg-teal-600 p-2 flex justify-between items-center text-white">
                                    <h3 className="font-bold text-lg">GTC A/B</h3>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => clearData("GTC", setGtcData)}
                                            className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                        >
                                            X√≥a
                                        </button>

                                        <div className="relative">
                                            <button className="bg-white text-teal-700 px-3 py-1 rounded text-xs font-bold flex gap-1 hover:bg-teal-50 items-center h-full shadow-sm">
                                                Upload
                                            </button>
                                            <input type="file" accept=".xlsx,.xls,.csv" onChange={withXLSX(handleGtcImport)} className="absolute inset-0 opacity-0 cursor-pointer" />
                                        </div>
                                    </div>
                                </div>
                            <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                <table className="w-full text-sm">
                                    <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                        <tr>
                                            <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                            <th className="py-2 text-right">Gi√° tr·ªã</th>
                                            <th className="py-2 text-center w-12">ƒêV</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {GTC_CONFIG.map((item, idx) => (
                                            <tr key={idx} className="hover:bg-white transition-colors">
                                                <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                    {item.label}
                                                </td>
                                                <td className="py-2">
                                                    <input 
                                                        type="number"
                                                        className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-teal-500 outline-none font-mono text-teal-800 font-bold bg-white"
                                                        value={gtcData[item.key] || ''}
                                                        onChange={(e) => setGtcData({...gtcData, [item.key]: e.target.value})}
                                                        placeholder="-"
                                                    />
                                                </td>
                                                <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                    {item.unit}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-2 border-t bg-gray-50 flex justify-center">
                                <span className="text-xs text-gray-400 italic">
                                    Sheet 17h: B3:I4
                                </span>
                            </div>
                        </div>
						
						{/* FORM DGCP GAS (M·ªöI - M√ÄU CH√ÄM - C√ì T√çNH LP FUELGAS) --- */}
                        <div className="bg-white rounded-xl shadow-lg border border-indigo-200 overflow-hidden">
                            <div className="bg-indigo-600 p-2 flex justify-between items-center text-white">
                                <h3 className="font-bold text-lg">DGCP GAS</h3>
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => clearData("DGCP GAS", setDgcpGasData)}
                                        className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                    >
                                        X√≥a
                                    </button>
                                </div>
                            </div>
                            <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                <table className="w-full text-sm">
                                    <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                        <tr>
                                            <th className="py-2 text-left pl-1">H·∫°ng m·ª•c</th>
                                            <th className="py-2 text-right">Gi√° tr·ªã</th>
                                            <th className="py-2 text-center w-12">ƒêV</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {/* 1. C√°c d√≤ng nh·∫≠p li·ªáu th√¥ng th∆∞·ªùng */}
                                        {DGCP_GAS_CONFIG.map((item, idx) => (
                                            <tr key={idx} className="hover:bg-white transition-colors">
                                                <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                    {item.label}
                                                </td>
                                                <td className="py-2">
                                                    <input 
                                                        type="number"
                                                        className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 outline-none font-mono text-indigo-800 font-bold bg-white"
                                                        value={dgcpGasData[item.key] || ''}
                                                        onChange={(e) => setDgcpGasData({...dgcpGasData, [item.key]: e.target.value})}
                                                        placeholder="-"
                                                    />
                                                </td>
                                                <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                    {item.unit}
                                                </td>
                                            </tr>
                                        ))}

                                        {/* 2. D√≤ng LP Fuelgas (T·ª± ƒë·ªông t√≠nh to√°n) */}
                                        <tr className="bg-indigo-50 border-t-2 border-indigo-100">
                                            <td className="py-3 text-indigo-900 font-bold pl-1 text-xs uppercase">
                                                LP Fuelgas
                                            </td>
                                            <td className="py-3 text-right font-mono font-bold text-lg text-indigo-700">
                                                {(() => {
                                                    // A. L·∫•y gi√° tr·ªã 'Fuel gas' t·ª´ th·∫ª n√†y
                                                    const fuelGasInput = parseFloat(dgcpGasData.fuel_gas) || 0;

                                                    // B. T√≠nh T·ªïng (Sum) t·ª´ th·∫ª M√†u H·ªìng (Fuel Gas on DGCP)
                                                    const density = parseFloat(fuelGasData.density) || 0;
                                                    let pinkSum = 0;
                                                    
                                                    if (density !== 0) {
                                                        const m3_a = fuelGasData.gtca_kg ? Math.round(parseFloat(fuelGasData.gtca_kg) / density) : 0;
                                                        const m3_b = fuelGasData.gtcb_kg ? Math.round(parseFloat(fuelGasData.gtcb_kg) / density) : 0;
                                                        // GTG t√≠nh theo c√¥ng th·ª©c ƒë·∫∑c bi·ªát: * 24 * 1.02
                                                        const m3_gtg = fuelGasData.gtg_kg ? Math.round((parseFloat(fuelGasData.gtg_kg) * 24 * 1.02) / density) : 0;
                                                        
                                                        pinkSum = m3_a + m3_b + m3_gtg;
                                                    }

                                                    // C. T√≠nh k·∫øt qu·∫£: Fuel gas - T·ªïng (Sum)
                                                    const result = fuelGasInput - pinkSum;

                                                    // Hi·ªÉn th·ªã k·∫øt qu·∫£ c√≥ d·∫•u ph·∫©y ngƒÉn c√°ch
                                                    return result.toLocaleString('en-US');
                                                })()}
                                            </td>
                                            <td className="py-3 text-center text-xs text-indigo-500 font-bold">
                                                m¬≥
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-2 border-t bg-gray-50 flex justify-center">
                                <span className="text-xs text-gray-400 italic">
                                    LP Fuelgas = Fuel gas - T·ªïng (Fuel Gas on DGCP)
                                </span>
                            </div>
                        </div>
						
						{/* --- FORM FUEL GAS ON DGCP (C·∫¨P NH·∫¨T: T·ªîNG M3 C·ªòNG D·ªíN & NOTE Q4-2026) --- */}
                        <div className="bg-white rounded-xl shadow-lg border border-pink-200 overflow-hidden">
                            <div className="bg-pink-600 p-2 flex justify-between items-center text-white">
                                <h3 className="font-bold text-lg flex items-center gap-2">
                                    Fuel Gas DGCP
                                </h3>
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => {
                                            if(window.confirm("X√≥a d·ªØ li·ªáu Fuel Gas (v·ªÅ m·∫∑c ƒë·ªãnh)?")) {
                                                setFuelGasData({ density: 0.908, density_note: "Q4-2026" });
                                            }
                                        }}
                                        className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                    >
                                        X√≥a
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-4 bg-gray-50 overflow-x-auto">
                                <table className="w-full text-sm border-collapse bg-white shadow-sm rounded-lg overflow-hidden">
                                    <thead className="bg-pink-50 text-pink-800 uppercase text-xs font-bold">
                                        <tr>
                                            <th className="p-3 text-left border-b border-pink-100">H·∫°ng m·ª•c</th>
                                            <th className="p-3 text-right border-b border-pink-100 w-32">SCADA (kg)</th>
                                            <th className="p-3 text-right border-b border-pink-100 w-32 bg-gray-50">Quy ƒë·ªïi (m¬≥)</th>
                                            <th className="p-3 text-left border-b border-pink-100">Ghi ch√∫</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {/* H√†ng GTC-A */}
                                        <tr className="hover:bg-pink-50/30 transition-colors">
                                            <td className="p-3 font-medium text-gray-700">GTC-A</td>
                                            <td className="p-2">
                                                <input type="number" className="w-full text-right p-1 border border-gray-300 rounded font-bold text-gray-800 focus:ring-2 focus:ring-pink-400 outline-none" 
                                                    value={fuelGasData.gtca_kg || ''} 
                                                    onChange={(e) => setFuelGasData({...fuelGasData, gtca_kg: e.target.value})} 
                                                    placeholder="0"
                                                />
                                            </td>
                                            <td className="p-3 text-right font-mono font-bold text-blue-600 bg-gray-50">
                                                {fuelGasData.gtca_kg && fuelGasData.density ? 
                                                    Math.round(parseFloat(fuelGasData.gtca_kg) / parseFloat(fuelGasData.density)).toLocaleString('en-US') 
                                                    : '-'}
                                            </td>
                                            <td className="p-2">
                                                <input type="text" className="w-full p-1 border-b border-transparent focus:border-pink-300 outline-none text-gray-600 italic" 
                                                    value={fuelGasData.gtca_note || ''} onChange={(e) => setFuelGasData({...fuelGasData, gtca_note: e.target.value})}
                                                />
                                            </td>
                                        </tr>

                                        {/* H√†ng GTC-B */}
                                        <tr className="hover:bg-pink-50/30 transition-colors">
                                            <td className="p-3 font-medium text-gray-700">GTC-B</td>
                                            <td className="p-2">
                                                <input type="number" className="w-full text-right p-1 border border-gray-300 rounded font-bold text-gray-800 focus:ring-2 focus:ring-pink-400 outline-none" 
                                                    value={fuelGasData.gtcb_kg || ''} 
                                                    onChange={(e) => setFuelGasData({...fuelGasData, gtcb_kg: e.target.value})} 
                                                    placeholder="0"
                                                />
                                            </td>
                                            <td className="p-3 text-right font-mono font-bold text-blue-600 bg-gray-50">
                                                {fuelGasData.gtcb_kg && fuelGasData.density ? 
                                                    Math.round(parseFloat(fuelGasData.gtcb_kg) / parseFloat(fuelGasData.density)).toLocaleString('en-US') 
                                                    : '-'}
                                            </td>
                                            <td className="p-2">
                                                <input type="text" className="w-full p-1 border-b border-transparent focus:border-pink-300 outline-none text-gray-600 italic" 
                                                    value={fuelGasData.gtcb_note || ''} onChange={(e) => setFuelGasData({...fuelGasData, gtcb_note: e.target.value})}
                                                />
                                            </td>
                                        </tr>

                                        {/* H√†ng GTG */}
                                        <tr className="hover:bg-pink-50/30 transition-colors">
                                            <td className="p-3 font-medium text-gray-700">GTG</td>
                                            <td className="p-2">
                                                <input type="number" className="w-full text-right p-1 border border-gray-300 rounded font-bold text-gray-800 focus:ring-2 focus:ring-pink-400 outline-none" 
                                                    value={fuelGasData.gtg_kg || ''} 
                                                    onChange={(e) => setFuelGasData({...fuelGasData, gtg_kg: e.target.value})} 
                                                    placeholder="0"
                                                />
                                            </td>
                                            <td className="p-3 text-right font-mono font-bold text-blue-600 bg-gray-50">
                                                {fuelGasData.gtg_kg && fuelGasData.density ? 
                                                    Math.round( (parseFloat(fuelGasData.gtg_kg) * 24 * 1.02) / parseFloat(fuelGasData.density) ).toLocaleString('en-US') 
                                                    : '-'}
                                            </td>
                                            <td className="p-2">
                                                <input type="text" className="w-full p-1 border-b border-transparent focus:border-pink-300 outline-none text-gray-600 italic" 
                                                    value={fuelGasData.gtg_note || ''} onChange={(e) => setFuelGasData({...fuelGasData, gtg_note: e.target.value})}
                                                />
                                            </td>
                                        </tr>

                                        {/* H√†ng Gas Density */}
                                        <tr className="bg-yellow-50/50">
                                            <td className="p-3 font-bold text-gray-700">Gas Density</td>
                                            <td className="p-2">
                                                <input type="number" step="0.001" className="w-full text-right p-1 border border-yellow-300 rounded font-bold text-yellow-800 focus:ring-2 focus:ring-yellow-500 outline-none bg-yellow-50" 
                                                    value={fuelGasData.density} 
                                                    onChange={(e) => setFuelGasData({...fuelGasData, density: e.target.value})} 
                                                />
                                            </td>
                                            <td className="p-3 text-right text-xs text-gray-400 italic bg-gray-50">
                                                (H·ªá s·ªë chia)
                                            </td>
                                            <td className="p-2">
                                                <input type="text" className="w-full p-1 bg-transparent border-b border-transparent focus:border-yellow-300 outline-none text-gray-600 italic" 
                                                    value={fuelGasData.density_note || ''} onChange={(e) => setFuelGasData({...fuelGasData, density_note: e.target.value})}
                                                    placeholder="Q4-2026"
                                                />
                                            </td>
                                        </tr>

                                        {/* H√†ng SUM (T·ªîNG) - ƒê√£ b·ªè kg, ch·ªâ gi·ªØ m3 */}
                                        <tr className="bg-pink-100 border-t-2 border-pink-200">
                                            <td className="p-3 font-bold text-pink-900">T·ªîNG (SUM)</td>
                                            <td className="p-3 text-right font-bold text-pink-900">
                                                {/* ƒê√£ b·ªè t·ªïng kg theo y√™u c·∫ßu */}
                                            </td>
                                            <td className="p-3 text-right font-mono font-bold text-xl text-pink-700 bg-pink-50">
                                                {/* T·ªïng m3 = C·ªông d·ªìn 3 gi√° tr·ªã m3 ƒë√£ l√†m tr√≤n b√™n tr√™n */}
                                                {fuelGasData.density ? (
                                                    (fuelGasData.gtca_kg ? Math.round(parseFloat(fuelGasData.gtca_kg) / parseFloat(fuelGasData.density)) : 0) +
                                                    (fuelGasData.gtcb_kg ? Math.round(parseFloat(fuelGasData.gtcb_kg) / parseFloat(fuelGasData.density)) : 0) +
                                                    (fuelGasData.gtg_kg ? Math.round((parseFloat(fuelGasData.gtg_kg) * 24 * 1.02) / parseFloat(fuelGasData.density)) : 0)
                                                ).toLocaleString('en-US') : '0'}
                                            </td>
                                            <td className="p-3"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
						
						{/* --- FORM TH√îNG S·ªê C√îNG NGH·ªÜ GTC(FULL WIDTH - M√ÄU X√ÅM ƒê·∫¨M) --- */}
                        <div className="col-span-full bg-white rounded-xl shadow-lg border border-gray-300 overflow-hidden">
                            <div className="bg-slate-700 p-2 flex justify-between items-center text-white">
                                <h3 className="font-bold text-lg flex items-center gap-2">
                                    TH√îNG S·ªê C√îNG NGH·ªÜ GTC
                                </h3>
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => clearData("Th√¥ng s·ªë CN", setTechData)}
                                        className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                    >
                                        X√≥a
                                    </button>
                                </div>
                            </div>
                            
                            <div className="p-0 overflow-x-auto custom-scrollbar">
                                <table className="w-full text-xs border-collapse min-w-[1200px]">
                                    {/* --- HEADER TABLE --- */}
                                    <thead>
                                        <tr className="bg-slate-100 text-slate-600 uppercase tracking-wider text-center border-b border-gray-300">
                                            <th className="p-2 border-r border-gray-200 sticky left-0 bg-slate-100 z-10 w-20">Khu v·ª±c</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-blue-50">Inlet 1st</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-blue-100">Outlet 1st</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-green-50">Inlet 2nd</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-green-100">Outlet 2nd</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200">Speed %</th>
                                            <th className="p-2 border-r border-gray-200">PCD</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-red-50">Gi·ªù d·ª´ng (h)</th>
                                            <th className="p-2 border-r border-gray-200">T5 (‚ÑÉ)</th>
                                            <th className="p-2 border-r border-gray-200">Gaslift</th>
                                            <th className="p-2 border-r border-gray-200">Status</th>
                                            
                                            {/* Ph·∫ßn Chung (General) */}
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-yellow-50 border-l-4 border-l-slate-300">Inlet RP3</th>
                                            <th colSpan="2" className="p-2 border-r border-gray-200 bg-yellow-100">Slug Catcher</th>
                                            <th colSpan="2" className="p-2 bg-orange-50">Outlet DGCP</th>
                                        </tr>
                                        <tr className="bg-slate-50 text-slate-500 font-medium text-center border-b border-gray-200">
                                            <th className="p-2 border-r border-gray-200 sticky left-0 bg-slate-50 z-10">Unit</th>
                                            {/* GTC Inputs */}
                                            <th className="w-16 bg-blue-50">Pin</th><th className="w-16 bg-blue-50 border-r">Tin</th>
                                            <th className="w-16 bg-blue-100">Pout</th><th className="w-16 bg-blue-100 border-r">Tout</th>
                                            <th className="w-16 bg-green-50">Pin</th><th className="w-16 bg-green-50 border-r">Tin</th>
                                            <th className="w-16 bg-green-100">Pout</th><th className="w-16 bg-green-100 border-r">Tout</th>
                                            <th className="w-16">NGP</th><th className="w-16 border-r">NPT</th>
                                            <th className="w-16 border-r">-</th>
                                            <th className="w-16 bg-red-50">Th∆∞·ªùng</th><th className="w-16 bg-red-50 border-r">S·ª± c·ªë</th>
                                            <th className="w-16 border-r">-</th>
                                            <th className="w-20 border-r">m3/h</th>
                                            <th className="w-24 border-r">Run/Stop</th>
                                            
                                            {/* General Inputs */}
                                            <th className="w-16 bg-yellow-50 border-l-4 border-l-slate-300">Pin</th><th className="w-16 bg-yellow-50 border-r">Tin</th>
                                            <th className="w-16 bg-yellow-100">Pin</th><th className="w-16 bg-yellow-100 border-r">Tin</th>
                                            <th className="w-16 bg-orange-50">Pout</th><th className="w-16 bg-orange-50">Tout</th>
                                        </tr>
                                    </thead>

                                    {/* --- BODY TABLE --- */}
                                    <tbody className="divide-y divide-gray-200">
                                        {['GTC-A', 'GTC-B'].map((gtc, idx) => {
                                            const prefix = gtc.toLowerCase().replace('-','');
                                            return (
                                            <tr key={gtc} className="hover:bg-gray-50 transition-colors">
                                                {/* T√™n GTC */}
                                                <td className="p-2 font-bold text-slate-700 border-r border-gray-200 sticky left-0 bg-white z-10 text-center">{gtc}</td>
                                                
                                                {/* V√≤ng l·∫∑p c√°c ch·ªâ s·ªë (ƒê√É X√ìA 'gaslift' RA KH·ªéI ƒê√ÇY) */}
                                                {['p1in','t1in','p1out','t1out','p2in','t2in','p2out','t2out','ngp','npt','pcd','stop_nor','stop_emer','t5'].map((field, i) => (
                                                    <td key={field} className={`p-1 border-r border-gray-100 ${(i>=0 && i<=3)?'bg-blue-50/30':(i>=4 && i<=7)?'bg-green-50/30':(i>=11 && i<=12)?'bg-red-50/30':''}`}>
                                                        <input 
                                                            type="text" 
                                                            className="w-full text-center bg-transparent outline-none focus:text-blue-600 font-mono font-bold text-sm" 
                                                            value={techData[`${prefix}_${field}`] || ''} 
                                                            onChange={(e) => setTechData({...techData, [`${prefix}_${field}`]: e.target.value})} 
                                                            placeholder="-" 
                                                        />
                                                    </td>
                                                ))}

                                                {/* üëá C·ªòT GASLIFT (G·ªòP D√íNG) üëá */}
                                                {idx === 0 && (
                                                    <td rowSpan={2} className="p-1 border-r border-gray-100 bg-white align-middle">
                                                        <input 
                                                            type="text" 
                                                            className="w-full text-center bg-transparent outline-none focus:text-blue-600 font-mono font-bold text-sm h-full" 
                                                            placeholder="-" 
                                                            value={techData['common_gaslift'] || ''} 
                                                            onChange={(e) => setTechData({...techData, common_gaslift: e.target.value})}
                                                        />
                                                    </td>
                                                )}

                                                {/* Status Dropdown */}
                                                <td className="p-1 border-r border-gray-100">
                                                    <select 
                                                        className="w-full bg-transparent text-center outline-none text-xs font-bold text-slate-700"
                                                        value={techData[`${prefix}_status`] || ''}
                                                        onChange={(e) => setTechData({...techData, [`${prefix}_status`]: e.target.value})}
                                                    >
                                                        <option value="">-</option>
                                                        <option value="Running">Running</option>
                                                        <option value="Stop">Stop</option>
                                                        <option value="Standby">Standby</option>
                                                    </select>
                                                </td>

                                                {/* General Inputs (Ch·ªâ hi·ªán ·ªü d√≤ng GTC-A) */}
                                                {idx === 0 ? (
                                                    <>
                                                        <td className="p-1 bg-yellow-50/30 border-l-4 border-l-slate-100"><input type="text" className="w-full text-center bg-transparent outline-none font-bold text-purple-700 text-sm" placeholder="-" value={techData['gen_rp3_pin']||''} onChange={(e)=>setTechData({...techData, gen_rp3_pin:e.target.value})}/></td>
                                                        <td className="p-1 bg-yellow-50/30 border-r border-gray-100"><input type="text" className="w-full text-center bg-transparent outline-none font-bold text-purple-700 text-sm" placeholder="-" value={techData['gen_rp3_tin']||''} onChange={(e)=>setTechData({...techData, gen_rp3_tin:e.target.value})}/></td>
                                                        
                                                        <td className="p-1 bg-yellow-100/30"><input type="text" className="w-full text-center bg-transparent outline-none font-bold text-purple-700 text-sm" placeholder="-" value={techData['gen_slug_pin']||''} onChange={(e)=>setTechData({...techData, gen_slug_pin:e.target.value})}/></td>
                                                        <td className="p-1 bg-yellow-100/30 border-r border-gray-100"><input type="text" className="w-full text-center bg-transparent outline-none font-bold text-purple-700 text-sm" placeholder="-" value={techData['gen_slug_tin']||''} onChange={(e)=>setTechData({...techData, gen_slug_tin:e.target.value})}/></td>
                                                        
                                                        <td className="p-1 bg-orange-50/30"><input type="text" className="w-full text-center bg-transparent outline-none font-bold text-purple-700 text-sm" placeholder="-" value={techData['gen_dgcp_pout']||''} onChange={(e)=>setTechData({...techData, gen_dgcp_pout:e.target.value})}/></td>
                                                        <td className="p-1 bg-orange-50/30"><input type="text" className="w-full text-center bg-transparent outline-none font-bold text-purple-700 text-sm" placeholder="-" value={techData['gen_dgcp_tout']||''} onChange={(e)=>setTechData({...techData, gen_dgcp_tout:e.target.value})}/></td>
                                                    </>
                                                ) : (
                                                    <td colSpan="6" className="bg-gray-50 border-l-4 border-l-gray-200 text-center text-gray-300 italic text-[10px]">
                                                        (Th√¥ng s·ªë chung nh·∫≠p ·ªü d√≤ng tr√™n)
                                                    </td>
                                                )}
                                            </tr>
                                            )})}
                                    </tbody>
                                </table>
                            </div>
                            <div className="p-2 border-t bg-gray-50 flex justify-center">
                                <span className="text-xs text-gray-400 italic">
                                    Nh·∫≠p li·ªáu th·ªß c√¥ng theo file Th√¥ng s·ªë c√¥ng ngh·ªá.xlsx
                                </span>
                            </div>
                        </div>
						
						{/* --- FORM TH√îNG S·ªê C√îNG NGH·ªÜ BCP-DGCP (M√ÄU CAM ƒê·∫¨M - KH·ªöP V·ªöI BCP) --- */}
                                <div className="col-span-full bg-white rounded-xl shadow-lg border border-orange-300 overflow-hidden">
                                    <div className="bg-orange-700 p-2 flex justify-between items-center text-white">
                                        <h3 className="font-bold text-lg flex items-center gap-2">
                                            TH√îNG S·ªê C√îNG NGH·ªÜ BCP-DGCP
                                        </h3>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={() => clearData("BCP Tech", setBcpTechData)}
                                                className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                            >
                                                X√≥a
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="p-0 overflow-x-auto custom-scrollbar">
                                        <table className="w-full text-xs border-collapse min-w-[1200px]">
                                            {/* --- HEADER TABLE (C·∫•u tr√∫c gi·ªëng Excel) --- */}
                                            <thead>
                                                <tr className="bg-orange-50 text-orange-900 uppercase tracking-wider text-center border-b border-orange-200">
                                                    <th rowSpan="2" className="p-2 border-r border-orange-200 sticky left-0 bg-orange-50 z-10 w-24 align-middle">ƒê·ªëi t∆∞·ª£ng</th>
                                                    
                                                    {/* C5 RP3 */}
                                                    <th colSpan="2" className="p-2 border-r border-orange-200 bg-blue-50">C5 RP3</th>
                                                    
                                                    {/* Inlet */}
                                                    <th colSpan="2" className="p-2 border-r border-orange-200 bg-green-50">Inlet</th>
                                                    
                                                    {/* Outlet */}
                                                    <th colSpan="2" className="p-2 border-r border-orange-200 bg-indigo-50">Outlet</th>
                                                    
                                                    {/* Oil Temp */}
                                                    <th className="p-2 border-r border-orange-200">Oil temp</th>
                                                    
                                                    {/* Load */}
                                                    <th className="p-2 border-r border-orange-200 w-16">Speed %</th>
                                                    
                                                    {/* PCV Opening */}
                                                    <th colSpan="2" className="p-2 border-r border-orange-200 bg-yellow-50">PCV M·ªü %</th>
                                                    
                                                    {/* Stop Time */}
                                                    <th colSpan="2" className="p-2 border-r border-orange-200 bg-red-50">Gi·ªù D·ª´ng (h)</th>
                                                    
                                                    {/* Flow */}
                                                    <th className="p-2 border-r border-orange-200 bg-gray-50">Flow (m3/h)</th>
                                                    
                                                    {/* Outlet RP3 */}
                                                    <th colSpan="2" className="p-2 border-r border-orange-200 bg-blue-50">Outlet RP3</th>
                                                    
                                                    {/* Status */}
                                                    <th rowSpan="2" className="p-2 border-r border-orange-200 bg-orange-50 align-middle w-28">Status</th>
                                                </tr>
                                                
                                                {/* D√≤ng Header ph·ª• (ƒê∆°n v·ªã/T√™n con) */}
                                                <tr className="bg-white text-slate-500 font-medium text-center border-b border-gray-200 text-[12px]">
                                                    {/* C5 RP3 */}
                                                    <th className="p-1 border-r bg-blue-50/50">Pin-RP3</th><th className="p-1 border-r bg-blue-50/50">Tin-RP3</th>
                                                    {/* Inlet */}
                                                    <th className="p-1 border-r bg-green-50/50">Pin</th><th className="p-1 border-r bg-green-50/50">Tin</th>
                                                    {/* Outlet */}
                                                    <th className="p-1 border-r bg-indigo-50/50">Pout</th><th className="p-1 border-r bg-indigo-50/50">Tout</th>
                                                    {/* Oil Temp */}
                                                    <th className="p-1 border-r">‚ÑÉ</th>
                                                    {/* Load */}
                                                    <th className="p-1 border-r">(Motor)</th>
                                                    {/* PCV */}
                                                    <th className="p-1 border-r bg-yellow-50/50">301C</th><th className="p-1 border-r bg-yellow-50/50">303C</th>
                                                    {/* Stop Time */}
                                                    <th className="p-1 border-r bg-red-50/50">Th∆∞·ªùng</th><th className="p-1 border-r bg-red-50/50">S·ª± c·ªë</th>
                                                    {/* Flow */}
                                                    <th className="p-1 border-r bg-gray-50/50">FT-305C</th>
                                                    {/* Outlet RP3 */}
                                                    <th className="p-1 border-r bg-blue-50/50">Pout</th><th className="p-1 border-r bg-blue-50/50">Tout</th>
                                                </tr>
                                            </thead>

                                            {/* --- BODY TABLE --- */}
                                            <tbody>
                                                <tr className="hover:bg-orange-50 transition-colors">
                                                    <td className="p-2 font-bold text-orange-900 border-r border-gray-200 sticky left-0 bg-white z-10 text-center shadow-sm">BCP</td>
                                                    
                                                    {/* INPUTS - D√πng h√†m map ƒë·ªÉ code g·ªçn h∆°n */}
                                                    {[
                                                        'c5_pin_rp3', 'c5_tin_rp3',         // C5 RP3
                                                        'inlet_pin', 'inlet_tin',           // Inlet
                                                        'outlet_pout', 'outlet_tout',       // Outlet
                                                        'oil_temp',                         // Oil Temp
                                                        'motor_load',                       // Load
                                                        'pcv_301c', 'pcv_303c',             // PCV
                                                        'stop_normal', 'stop_emergency',    // Stop Time
                                                        'flow_ft305c',                      // Flow
                                                        'out_pout_rp3', 'out_tout_rp3'      // Outlet RP3
                                                    ].map((key, idx) => (
                                                        <td key={key} className="p-1 border-r border-gray-100">
                                                            <input 
                                                                type="number" step="0.1"
                                                                className={`w-full text-center bg-transparent outline-none focus:text-orange-600 font-mono font-bold ${idx===12 ? 'text-blue-700 text-sm' : ''}`}
                                                                placeholder="-"
                                                                value={bcpTechData[key] || ''}
                                                                onChange={(e) => setBcpTechData({...bcpTechData, [key]: e.target.value})}
                                                            />
                                                        </td>
                                                    ))}

                                                    {/* STATUS DROPDOWN (Chu·∫©n h√≥a gi·ªëng GTC: Running/Stop/Standby) */}
                                                    <td className="p-1 border-r border-gray-100">
                                                        <select 
                                                            className="w-full bg-transparent text-center font-bold text-xs outline-none text-slate-700"
                                                            value={bcpTechData.status || ''}
                                                            onChange={(e) => setBcpTechData({...bcpTechData, status: e.target.value})}
                                                        >
                                                            <option value="">-</option> 
                                                            <option value="Running">Running</option>
                                                            <option value="Stop">Stop</option>
                                                            <option value="Standby">Standby</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="p-2 border-t bg-gray-50 flex justify-center">
                                        <span className="text-xs text-gray-400 italic">
                                            D·ªØ li·ªáu nh·∫≠p th·ªß c√¥ng theo file Th√¥ng s·ªë BCP.xlsx
                                        </span>
                                    </div>
                                </div>
							
											

								{/* FORM K·∫æ HO·∫†CH NG√ÄY MAI */}
                                    <div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-blue-300 overflow-hidden">
                                        <div className="bg-blue-700 p-2 flex justify-between items-center text-white">
                                            <h3 className="font-bold text-lg flex items-center gap-2">
                                                K·∫æ HO·∫†CH NG√ÄY MAI
                                            </h3>
                                            <div className="flex gap-2">
                                                <button 
                                                    onClick={() => setNextDayPlan({ content: "" })}
                                                    className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                                >
                                                    X√≥a
                                                </button>
                                            </div>
                                        </div>
                                        <div className="p-4 bg-gray-50">
                                            <textarea 
                                                className="w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm font-medium text-gray-700 leading-relaxed bg-white shadow-inner resize-y"
                                                placeholder="- G·∫°ch ƒë·∫ßu d√≤ng c√¥ng vi·ªác 1...&#10;- G·∫°ch ƒë·∫ßu d√≤ng c√¥ng vi·ªác 2..."
                                                value={nextDayPlan.content || ''}
                                                onChange={(e) => setNextDayPlan({ ...nextDayPlan, content: e.target.value })}
                                            />
                                            <div className="mt-2 text-right">
                                                <span className="text-[10px] text-gray-400 italic">
                                                    * T·ª± ƒë·ªông l∆∞u khi nh·∫≠p li·ªáu
                                                </span>
                                            </div>
                                        </div>
                                    </div>
								
								{/* FORM TH√îNG TIN TRONG NG√ÄY (M√ÄU T√çM) --- */}
                                    <div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-purple-300 overflow-hidden">
                                        <div className="bg-purple-700 p-2 flex justify-between items-center text-white">
                                            <h3 className="font-bold text-lg flex items-center gap-2">
                                                TH√îNG TIN TRONG NG√ÄY
                                            </h3>
                                            <div className="flex gap-2">
                                                <button 
                                                    onClick={() => setDailyInfo({ content: "" })}
                                                    className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
                                                >
                                                    X√≥a
                                                </button>
                                            </div>
                                        </div>
                                        <div className="p-4 bg-gray-50">
                                            <textarea 
                                                className="w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none text-sm font-medium text-gray-700 leading-relaxed bg-white shadow-inner resize-y"
                                                placeholder="- Nh·∫≠p th√¥ng tin ho·∫°t ƒë·ªông, s·ª± ki·ªán trong ng√†y..."
                                                value={dailyInfo.content || ''}
                                                onChange={(e) => setDailyInfo({ ...dailyInfo, content: e.target.value })}
                                            />
                                            <div className="mt-2 text-right">
                                                <span className="text-[10px] text-gray-400 italic">
                                                    * T·ª± ƒë·ªông l∆∞u khi nh·∫≠p li·ªáu
                                                </span>
                                            </div>
                                        </div>
                                    </div>
								
								{/* FORM NH√ÇN S·ª∞ DGCP (M√ÄU CYAN) --- */}
                                    <div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-cyan-300 overflow-hidden">
                                        <div className="bg-cyan-700 p-2 flex justify-between items-center text-white">
                                            <h3 className="font-bold text-lg flex items-center gap-2">
                                                NH√ÇN S·ª∞ TR√äN GI√ÄN
                                            </h3>
                                            <button 
                                                onClick={() => setPersonnelData([...personnelData, { id: Date.now(), company: "", count: "", job: "" }])}
                                                className="bg-white text-cyan-700 px-3 py-1 rounded text-xs font-bold hover:bg-cyan-50 transition-colors shadow-sm flex items-center gap-1"
                                            >
                                                + Th√™m d√≤ng
                                            </button>
                                        </div>
                                        
                                        <div className="p-0 overflow-x-auto">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-cyan-50 text-cyan-800 font-bold uppercase text-xs border-b border-cyan-200">
                                                    <tr>
                                                        <th className="px-4 py-3 w-1/4">C√¥ng ty / Nh√† th·∫ßu</th>
                                                        <th className="px-4 py-3 w-20 text-center">SL</th>
                                                        <th className="px-4 py-3">N·ªôi dung c√¥ng vi·ªác</th>
                                                        <th className="px-4 py-3 w-10 text-center">#</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-100">
                                                    {personnelData.map((row, index) => (
                                                        <tr key={row.id} className="hover:bg-gray-50 transition-colors">
                                                            <td className="p-2 border-r border-gray-50">
                                                                <input 
                                                                    type="text" 
                                                                    className="w-full bg-transparent outline-none font-bold text-gray-700 placeholder-gray-300"
                                                                    placeholder="T√™n CT..."
                                                                    value={row.company}
                                                                    onChange={(e) => {
                                                                        const newData = [...personnelData];
                                                                        newData[index].company = e.target.value;
                                                                        setPersonnelData(newData);
                                                                    }}
                                                                />
                                                            </td>
                                                            <td className="p-2 border-r border-gray-50">
                                                                <input 
                                                                    type="text" 
                                                                    className="w-full bg-transparent outline-none text-center font-bold text-blue-600"
                                                                    placeholder="0"
                                                                    value={row.count}
                                                                    onChange={(e) => {
                                                                        const newData = [...personnelData];
                                                                        newData[index].count = e.target.value;
                                                                        setPersonnelData(newData);
                                                                    }}
                                                                />
                                                            </td>
                                                            <td className="p-2 border-r border-gray-50">
                                                                <input 
                                                                    type="text" 
                                                                    className="w-full bg-transparent outline-none text-gray-600"
                                                                    placeholder="M√¥ t·∫£ c√¥ng vi·ªác..."
                                                                    value={row.job}
                                                                    onChange={(e) => {
                                                                        const newData = [...personnelData];
                                                                        newData[index].job = e.target.value;
                                                                        setPersonnelData(newData);
                                                                    }}
                                                                />
                                                            </td>
                                                            <td className="p-2 text-center">
                                                                <button 
                                                                    onClick={() => {
                                                                        const newData = personnelData.filter(r => r.id !== row.id);
                                                                        setPersonnelData(newData);
                                                                    }}
                                                                    className="text-gray-300 hover:text-red-500 transition-colors"
                                                                    title="X√≥a d√≤ng"
                                                                >
                                                                    ‚úï
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                    {/* D√≤ng t·ªïng c·ªông */}
                                                    <tr className="bg-cyan-50 font-bold text-cyan-800">
                                                        <td className="px-4 py-2 text-right">T·ªîNG C·ªòNG:</td>
                                                        <td className="px-4 py-2 text-center text-lg">
                                                            {personnelData.reduce((sum, row) => sum + (parseInt(row.count) || 0), 0)}
                                                        </td>
                                                        <td colSpan={2}></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
								
								{/* --- FORM NG∆Ø·ªúI QU·∫¢N L√ù - CH·ªåN HO·∫∂C NH·∫¨P --- */}
                                    <div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-indigo-200 overflow-hidden mb-20">
                                        <div className="bg-indigo-600 p-2 flex justify-between items-center text-white">
                                            <h3 className="font-bold text-base flex items-center gap-2">
                                               NG∆Ø·ªúI QU·∫¢N L√ù 
                                            </h3>
                                        </div>
                                        
                                        <div className="p-6 bg-gray-50 flex flex-col md:flex-row items-center gap-4">
                                            <label className="font-bold text-gray-700 whitespace-nowrap">
                                                X√°c nh·∫≠n b√°o c√°o:
                                            </label>
                                            
                                            <div className="relative flex-1 w-full">
                                                {/* √î Input cho ph√©p nh·∫≠p tay ho·∫∑c ch·ªçn t·ª´ list */}
                                                <input
                                                    type="text"
                                                    list="manager-options"
                                                    className="w-full p-3 pl-4 pr-10 bg-white border border-gray-300 rounded-lg text-gray-700 font-bold focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm placeholder-gray-400"
                                                    placeholder="Nh·∫≠p t√™n ho·∫∑c ch·ªçn t·ª´ danh s√°ch..."
                                                    value={managerData.name || ""}
                                                    onChange={(e) => setManagerData({ name: e.target.value })}
                                                />

                                                {/* Danh s√°ch g·ª£i √Ω (Ch·ªâ hi·ªán 2 ng∆∞·ªùi n√†y) */}
                                                <datalist id="manager-options">
                                                    <option value="H–∞—á–∞–ª—å–Ω–∏–∫ –ö–ü–î: –•–∞—Ä–∏—Ç–æ–Ω–æ–≤ –Æ.–°." />
                                                    <option value="–ó–∞–º. –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –ö–ü–î: –ù–≥. –ú. –í–∏–µ–Ω" />
                                                </datalist>
                                                
                                                {/* Icon Edit trang tr√≠ */}
                                                <div className="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-400">
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
								
								{/* --- FORM GI·ªú D·ª™NG BCP-RP3 (M·ªöI - M√ÄU CYAN) --- */}
								<div className="bg-white rounded-xl shadow-lg border border-cyan-200 overflow-hidden">
									<div className="bg-cyan-600 p-2 flex justify-between items-center text-white">
										<h3 className="font-bold text-lg flex items-center gap-2">
											S·ªë gi·ªù d·ª´ng BCP-RP3
										</h3>
										<div className="flex gap-2">
											<button 
												onClick={() => {
													if(window.confirm("X√≥a d·ªØ li·ªáu gi·ªù d·ª´ng BCP?")) setBcpStopData({});
												}}
												className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
											>
												X√≥a
											</button>
										</div>
									</div>
                            
									<div className="p-4 bg-gray-50 flex justify-center">
										<table className="w-full max-w-md text-sm border-collapse bg-white shadow-sm rounded-lg overflow-hidden">
											<thead className="bg-cyan-50 text-cyan-800 uppercase text-xs font-bold">
												<tr>
													<th className="p-3 text-center border-b border-cyan-100 w-1/2">B√¨nh th∆∞·ªùng (A3)</th>
													<th className="p-3 text-center border-b border-cyan-100 w-1/2 border-l border-cyan-100">S·ª± c·ªë (B3)</th>
												</tr>
											</thead>
											<tbody className="divide-y divide-gray-100">
												<tr>
													<td className="p-4">
														<input 
															type="number" 
															step="0.1"
															className="w-full text-center p-2 border border-gray-300 rounded-lg font-bold text-gray-800 focus:ring-2 focus:ring-cyan-400 outline-none text-lg" 
															value={bcpStopData.normal || ''} 
															onChange={(e) => setBcpStopData({...bcpStopData, normal: e.target.value})} 
															placeholder="0"
														/>
													</td>
													<td className="p-4 border-l border-gray-100">
														<input 
															type="number" 
															step="0.1"
															className="w-full text-center p-2 border border-gray-300 rounded-lg font-bold text-red-600 focus:ring-2 focus:ring-red-400 outline-none text-lg bg-red-50" 
															value={bcpStopData.emergency || ''} 
															onChange={(e) => setBcpStopData({...bcpStopData, emergency: e.target.value})} 
															placeholder="0"
														/>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
						
								{/* FORM H√ìA PH·∫®M (M√ÄU EMERALD - C√ì T·ª∞ ƒê·ªòNG NH·ªö) --- */}
                                <div className="bg-white rounded-xl shadow-lg border border-emerald-200 overflow-hidden">
                                    <div className="bg-emerald-600 p-2 flex justify-between items-center text-white">
                                        <h3 className="font-bold text-lg flex items-center gap-2">
                                            H√ìA PH·∫®M
                                        </h3>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={() => {
                                                    if(window.confirm("Kh√¥i ph·ª•c v·ªÅ m·∫∑c ƒë·ªãnh g·ªëc (Excel)?")) {
                                                        setChemicalsData({
                                                            gaslift_lit: "29", ac202_lit: "0",
                                                            oxy_ace_full: "10/4", oxy_ace_empty: "2/8"
                                                        });
                                                    }
                                                }}
                                                className="bg-white text-emerald-700 px-3 py-1 rounded text-xs font-bold hover:bg-emerald-50 transition-colors shadow-sm"
                                            >
                                                M·∫∑c ƒë·ªãnh
                                            </button>
                                        </div>
                                    </div>
                                    <div className="p-4 bg-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                                        <table className="w-full text-sm">
                                            <thead className="text-xs text-gray-500 uppercase bg-gray-100 sticky top-0">
                                                <tr>
                                                    <th className="py-2 text-left pl-1">T√™n H√≥a Ph·∫©m</th>
                                                    <th className="py-2 text-right">S·ªë l∆∞·ª£ng</th>
                                                    <th className="py-2 text-center w-12">ƒêV</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                {CHEMICALS_CONFIG.map((item, idx) => (
                                                    <tr key={idx} className="hover:bg-white transition-colors">
                                                        <td className="py-2 text-gray-700 font-medium pl-1 text-xs">
                                                            {item.label}
                                                        </td>
                                                        <td className="py-2">
                                                            <input 
                                                                type={item.key.includes('oxy') ? "text" : "number"} // Oxy cho nh·∫≠p ch·ªØ (10/4), c√≤n l·∫°i nh·∫≠p s·ªë
                                                                className="w-full text-right p-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none font-mono text-emerald-800 font-bold bg-white"
                                                                value={chemicalsData[item.key] || ''}
                                                                onChange={(e) => setChemicalsData({...chemicalsData, [item.key]: e.target.value})}
                                                            />
                                                        </td>
                                                        <td className="py-2 text-center text-xs text-gray-400 font-medium">
                                                            {item.unit}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        <div className="mt-2 text-[10px] text-gray-400 italic text-center">
                                            * T·ª± ƒë·ªông l·∫•y gi√° tr·ªã c·ªßa ng√†y h√¥m tr∆∞·ªõc n·∫øu ch∆∞a nh·∫≠p.
                                        </div>
                                    </div>
                                </div>	
								
								{/* --- FORM AN TO√ÄN - S·ª®C KH·ªéE - M√îI TR∆Ø·ªúNG (M√ÄU ƒê·ªé/ROSE) --- */}
                                    <div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-rose-200 overflow-hidden">
                                        <div className="bg-rose-600 p-2 flex justify-between items-center text-white">
                                            <h3 className="font-bold text-lg flex items-center gap-2">
                                                AN TO√ÄN - S·ª®C KH·ªéE - M√îI TR∆Ø·ªúNG
                                            </h3>
                                            <div className="flex gap-2">
                                                <button 
                                                    onClick={() => setSafetyData({
                                                        incidents: "–ù–æ—Ä–º–∞–ª—å–Ω–æ/–ù–µ—Ç",      
                                                        systems: "–ù–µ—Ç/–ù–µ—Ç/–ù–µ—Ç",          
                                                        suggestions: "–ù–µ—Ç/–ù–µ—Ç/–ù–µ—Ç",      
                                                        env_impact: "–ù–µ—Ç"                
                                                    })}
                                                    className="bg-white text-rose-700 px-3 py-1 rounded text-xs font-bold hover:bg-rose-50 transition-colors shadow-sm"
                                                >
                                                    M·∫∑c ƒë·ªãnh
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div className="p-4 bg-gray-50 grid grid-cols-1 gap-4">
                                            {/* M·ª•c 1: Tai n·∫°n & S·ª± c·ªë */}
                                            <div>
                                                <label className="block text-xs font-bold text-gray-700 mb-1">
                                                    1. Tai n·∫°n / S·ª± c·ªë / S·ª©c kh·ªèe nh√¢n s·ª±
                                                </label>
                                                <input 
                                                    type="text" 
                                                    className="w-full border border-gray-300 rounded p-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none text-rose-800 font-medium"
                                                    placeholder="V√≠ d·ª•: B√¨nh th∆∞·ªùng/Kh√¥ng"
                                                    value={safetyData.incidents || ''}
                                                    onChange={(e) => setSafetyData({...safetyData, incidents: e.target.value})}
                                                />
                                            </div>

                                            {/* M·ª•c 2: H·ªá th·ªëng an to√†n */}
                                            <div>
                                                <label className="block text-xs font-bold text-gray-700 mb-1">
                                                    2. T√¨nh tr·∫°ng h·ªá th·ªëng PCCC / C·∫£nh b√°o / ESD
                                                </label>
                                                <input 
                                                    type="text" 
                                                    className="w-full border border-gray-300 rounded p-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none text-rose-800 font-medium"
                                                    placeholder="V√≠ d·ª•: T·ªët/Ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng"
                                                    value={safetyData.systems || ''}
                                                    onChange={(e) => setSafetyData({...safetyData, systems: e.target.value})}
                                                />
                                            </div>

                                            {/* M·ª•c 3 & 4: Chia ƒë√¥i h√†ng d∆∞·ªõi */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-xs font-bold text-gray-700 mb-1">
                                                        3. C√¥ng t√°c an to√†n / ƒê·ªÅ xu·∫•t
                                                    </label>
                                                    <textarea 
                                                        rows={2}
                                                        className="w-full border border-gray-300 rounded p-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none resize-none"
                                                        value={safetyData.suggestions || ''}
                                                        onChange={(e) => setSafetyData({...safetyData, suggestions: e.target.value})}
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs font-bold text-gray-700 mb-1">
                                                        4. C√¥ng vi·ªác ·∫£nh h∆∞·ªüng M√¥i tr∆∞·ªùng
                                                    </label>
                                                    <textarea 
                                                        rows={2}
                                                        className="w-full border border-gray-300 rounded p-2 text-sm focus:ring-2 focus:ring-rose-500 outline-none resize-none"
                                                        value={safetyData.env_impact || ''}
                                                        onChange={(e) => setSafetyData({...safetyData, env_impact: e.target.value})}
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                        <div className="p-2 border-t bg-rose-50 flex justify-center">
                                            <span className="text-xs text-rose-400 italic">
                                                * D·ªØ li·ªáu t·ª± ƒë·ªông k·∫ø th·ª´a t·ª´ ng√†y h√¥m tr∆∞·ªõc
                                            </span>
                                        </div>
                                    </div>
								
								{/* --- FORM ƒê·∫∂T T√ÄU (M√ÄU TEAL) --- */}
								<div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-teal-300 overflow-hidden">
									<div className="bg-teal-700 p-2 flex justify-between items-center text-white">
										<h3 className="font-bold text-lg flex items-center gap-2">
											{/* Icon T√†u (ho·∫∑c Container) */}
											<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.9 5.8 2.8 8"/><path d="M12 10V4"/><path d="M8 8v-1a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v1"/></svg>
											ƒê·∫∂T T√ÄU (Logistics)
										</h3>
										<div className="flex gap-2">
											<button 
												onClick={() => setShipBooking({ content: "" })}
												className="bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition-colors shadow-sm"
											>
												X√≥a
											</button>
										</div>
									</div>
									<div className="p-4 bg-gray-50">
										<textarea 
											className="w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none text-sm font-medium text-gray-700 leading-relaxed bg-white shadow-inner resize-y"
											placeholder="- Nh·∫≠p th√¥ng tin y√™u c·∫ßu ƒë·∫∑t t√†u/tr·ª±c ca..."
											value={shipBooking.content || ''}
											onChange={(e) => setShipBooking({ ...shipBooking, content: e.target.value })}
										/>
										<div className="mt-2 text-right">
											<span className="text-[10px] text-gray-400 italic">
												* T·ª± ƒë·ªông l∆∞u khi nh·∫≠p li·ªáu (C·ªôt H - Sheet Others)
											</span>
										</div>
									</div>
								</div>
								
					</div> 
				</div>
			)}    

            </main> 

                    {/* --- LOGIN MODAL (GIAO DI·ªÜN C√ì LOGO & FOOTER T√ÅC GI·∫¢) --- */}
                    {showLoginModal && (
                        <div className="fixed inset-0 bg-slate-900/90 flex items-center justify-center z-[99999] backdrop-blur-sm">
                            <div className="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center border border-gray-100 flex flex-col">
                                
                                {/* KHU V·ª∞C LOGO */}
                                <div className="mb-6 flex justify-center">
                                    <img 
                                        src="data:image/png;base64,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ggZWmmL8Ta47pMtNv7uJW26+RX1v5847b+f2O9RHzvP7W37PzbfcJCeYy5o1q6ReTGvLAV58cR633no7s2fPYfXqNRQKvbKB/Rzlcszu3bu5X059y60388yzz7BhwwbWvL+GeyXrLdLvVtnmNsGtt97CLbfczO9+91vMkVatWJba833xevjBudwu3DuEY2B6W/m2W27jySeeYvu2HZqI78gZ75cst6VQoW00bxXd23jk4UdYtXJVivug6N0mm911551ynruZrYl3+223cfPvb+aWm2+WreawSR9xS8WixjJoMhbYtmULjz70kHB+zy2//z23S+Y7b79D9r1TtrpDdr2Vm266SfnbefGF52g5cAD7151236cpZAaR8yjnI091TQ2Fnl5eeXmBmD3Au++8Q2trq5ghw2r2xQnzZNgnn3yKRYuWsGfPPgYMGMi6tWt5beHr8tK35OXvgy6eOto7WLZsOS+/9DJvvbmI9rYOGS4hEY1E4dyJqhfroLyNd7lUFr29LFjwCi+pz5rV79PW2o7de8izpfimdHAefGAuO3fsZNzYcYweNZod23emRpwr4+3etUf4CQcOtPDqqwtllFv4yY9/wiOPPMqWLVslF9TX11NXW5Mab/GiN7lNzvVzRaK5csbNGzdQp/Y2yfrWW0t49tnnePKppyR7G86pu6Czs5O3FHUef/xx5r88n/3796c07R9+vf7a6yxQ3dr336dX0ayzs4MVy5dh0eB3v/0Njz32qKJnJ3t27+Kdt99WZH6VlStWUiqWIVE8SJQEpK4TgEwjfaBLX+3Xb9jEiy++zIvzXmbr1u1y6CJBfUqlmL179yv6LeZl8V616j2CJnlNdTU9PT28++47qd1+/l8/51FFxta2Niyabtq4kccefZSf/vTf+c2vf5vK0trSSlW+iqaGRnK5PDt37lQweYZf/fLX/PpXv9bYv6iJs4s4lryphOC1tMk4juNmHMfFF15EdT5PobvMqwteY+37ayWMFJJSHW3tLHz1NTZu2MQhhxzCtdfPZMDgwXjdcMa6xXT6CJev0o2nnMJnc6IcpQYYOXokv9KS8ejjj/LUM0/zlKLbbZr95114ISedeio/+vG/MUeD97d/97dE1k8jddElF/PzX/6cP9xzN1/9+jd4/a23WPneauobG7nq6qu5+95ZPDD3Ib7wpS9yxJFHkpGy23bs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" 
                                        alt="Logo" 
                                        className="h-28 w-auto object-contain drop-shadow-xl animate-in fade-in zoom-in duration-500"
                                    />
                                </div>

                                <h2 className="text-2xl font-black text-gray-800 mb-1 tracking-tight">H·ªÜ TH·ªêNG QU·∫¢N L√ù</h2>
                                <p className="text-sm text-gray-500 mb-6 font-medium">V·∫≠n h√†nh Khai th√°c Gi√†n DGCP</p>
                                
                                {/* Form Admin */}
                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const name = e.target.elements.username.value.trim();
                                    if (ADMIN_USERS.includes(name)) {
                                        setCurrentUser(name);
                                        setShowLoginModal(false);
                                        logToCloud(name, "ƒêƒÉng nh·∫≠p th√†nh c√¥ng (Quy·ªÅn Admin)"); 
                                    } else {
                                        alert("‚õî T√™n ƒëƒÉng nh·∫≠p kh√¥ng c√≥ quy·ªÅn Admin!");
                                        logToCloud(name, "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i");
                                    }
                                }}>
                                    <div className="text-left text-xs font-bold text-gray-500 mb-1 ml-1 uppercase tracking-wide">T√™n ƒëƒÉng nh·∫≠p</div>
                                    <input 
                                        name="username" 
                                        className="w-full border border-gray-300 bg-gray-50 p-3 rounded-lg mb-4 focus:ring-2 focus:ring-blue-500 outline-none font-bold text-gray-700 transition-all focus:bg-white" 
                                        placeholder="Nh·∫≠p user..." 
                                        autoFocus
                                    />
                                    <button type="submit" className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition-all shadow-lg hover:shadow-blue-500/30 mb-4 active:scale-95">
                                        ƒêƒÉng nh·∫≠p
                                    </button>
                                </form>

                                {/* N√∫t d√†nh cho KH√ÅCH */}
                                <div className="relative flex py-3 items-center">
                                    <div className="flex-grow border-t border-gray-200"></div>
                                    <span className="flex-shrink-0 mx-4 text-gray-400 text-xs uppercase font-bold">Ho·∫∑c</span>
                                    <div className="flex-grow border-t border-gray-200"></div>
                                </div>
                                
                                <button 
                                    onClick={() => {
                                        setCurrentUser('Kh√°ch');
                                        setShowLoginModal(false);
                                        logToCloud('Kh√°ch', "Truy c·∫≠p ch·∫ø ƒë·ªô Xem");
                                    }}
                                    className="w-full bg-white border border-gray-300 text-gray-600 py-2.5 rounded-lg font-bold hover:bg-gray-50 hover:border-gray-400 transition-all text-sm mb-6"
                                >
                                    Xem v·ªõi vai tr√≤ Kh√°ch
                                </button>

                                {/* --- FOOTER: NG∆Ø·ªúI PH√ÅT TRI·ªÇN (C·∫¨P NH·∫¨T FONT TO H∆†N) --- */}
                                <div className="mt-auto pt-5 border-t border-gray-100">
                                    <p className="text-sm text-gray-500 italic">
                                        Ng∆∞·ªùi ph√°t tri·ªÉn ·ª©ng d·ª•ng: <span className="font-bold text-blue-600 text-base not-italic">L√¢m Ti·ªÅn Phi-KSCN</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                </div> 
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GasProductionManager />);
    </script>
</body>
</html>
